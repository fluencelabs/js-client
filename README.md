# Fluence JS SDK

[![npm](https://img.shields.io/npm/v/@fluencelabs/fluence)](https://www.npmjs.com/package/@fluencelabs/fluence)

Official SDK providing javascript-based implementation of the Fluence Peer.

## Installation

With npm

```bash
npm install @fluencelabs/fluence
```

With yarn

```bash
yarn add @fluencelabs/fluence
```

## Getting started

To start communicating with the Fluence network you need to initiate FluencePeer and connect to an existing node. The picked node will be used as a relay. The easiest way to do so is by using [fluence-network-environment](https://github.com/fluencelabs/fluence-network-environment) package

```typescript
import { krasnodar } from '@fluencelabs/fluence-network-environment';

export const relayNode = krasnodar[0];
```

Initialize a local peer

```typescript
import { FluencePeer } from '@fluencelabs/fluence';

await FluencePeer.default.init({ connectTo: relayNode });
```

Once the peer is initialized you can start interacting with Fluence network. **We strongly recommend to use Aqua programming language** for that instead of exposing js sdk internals. The aqua compiler will generate all the necessary boilerplate code for you. For more information about Aqua please refer to [the Aqua book](https://doc.fluence.dev/aqua-book/) and the [official repo](https://github.com/fluencelabs/aqua)

Consider the following aqua code compiled into `helloWorld.ts`:

```
service HelloWorld("hello_world"):
    hello(s: string)

func sayHello():
    HelloWorld.hello("hello, world")
```

Which can now be called from typescript:

```typescript
import { registerHelloWorld, sayHello } from './helloWorld';

// register handler for HelloWorld service
registerHelloWorld(
    {},
    {
        hello: (arg) => {
            console.log(arg);
        },
    },
);

// call sayHello function just like a ordinary function in js
sayHello()
    .then(() => {
        console.log('Said hello');
    })
    .catch((err) => {
        console.log('An error occured, ', err);
    });
```

## Global and Instance API

The SDK provied a default instance of the FluencePeer. That should be enough for the vast majority of use cases. The instance can be obtained from `FluencePeer.default` as shown in previous section. By default all functions generated by the Aqua compiler will be executed against the default peer for convenience.

Sometimes it might be needed to run several peers inside the same js vm. In order to do that you first need to create a new instance of FluencePeer class. The compiler provied instance counterparts for every function which can be used as follows:

```typescript
const peer = new FluencePeer();

await peer.init({ connectTo: relayNode });

// register service handler on the specifi peer
peer.registerHelloWorld(
    {},
    {
        hello: (arg) => {
            console.log(arg);
        },
    },
);

try {
    // execute functions through the specific peer
    await peer.sayHello();
    console.log('Said hello');
} catch (err) {
    console.log('An error occured, ', err);
}
```

## Documentation

Guide on building applications: [doc.fluence.dev](https://doc.fluence.dev/docs/tutorials_tutorials/building-a-frontend-with-js-sdk)

Sample applications:

-   [FluentPad](https://github.com/fluencelabs/fluent-pad): a collaborative text editor with users online status synchronization
-   [Examples](https://github.com/fluencelabs/examples): examples of using the Aqua programming language

About [Fluence](https://fluence.network/)

## Developing

### Setting up Dev

Install node packages

```bash
npm install
```

### Running tests

Tests are split into unit and integration categories. By default integration tests require a locally running Fluence node with 4310 port open for ws connections. The dependency can be started with docker

```bash
 docker run --rm -e RUST_LOG="info" -p 1210:1210 -p 4310:4310 fluencelabs/fluence:freeze -t 1210 -w 4310 -k gKdiCSUr1TFGFEgu2t8Ch1XEUsrN5A2UfBLjSZvfci9SPR3NvZpACfcpPGC3eY4zma1pk7UvYv5zb1VjvPHwCjj
```

To run all tests in interactive mode

```bash
npm run test
```

To run only unit tests

```bash
npm run test:unit
```

To run only integration tests

```bash
npm run test:unit
```

To run all tests

```bash
npm run test:all
```

## Contributing

While the project is still in the early stages of development, you are welcome to track progress and contribute. As the project is undergoing rapid changes, interested contributors should contact the team before embarking on larger pieces of work. All contributors should consult with and agree to our [basic contributing rules](CONTRIBUTING.md).

## License

[Apache 2.0](LICENSE)

## About Fluence

Fluence is an open application platform where apps can build on each other, share data and users

|         Layer         |                                                               Tech                                                                |              Scale               |               State               |                                                   Based on                                                    |
| :-------------------: | :-------------------------------------------------------------------------------------------------------------------------------: | :------------------------------: | :-------------------------------: | :-----------------------------------------------------------------------------------------------------------: |
|       Execution       |                                             [FCE](https://github.com/fluencelabs/fce)                                             |           Single peer            | Disk, network, external processes | Wasm, [IT](https://github.com/fluencelabs/interface-types), [Wasmer\*](https://github.com/fluencelabs/wasmer) |
|      Composition      |                                      [Aquamarine](https://github.com/fluencelabs/aquamarine)                                      |          Involved peers          |      Results and signatures       |                                                 ⇅, π-calculus                                                 |
|       Topology        | [TrustGraph](https://github.com/fluencelabs/fluence/tree/master/trust-graph), [DHT\*](https://github.com/fluencelabs/rust-libp2p) | Distributed with Kademlia\* algo |    Actual state of the network    |                                [libp2p](https://github.com/libp2p/rust-libp2p)                                |
| Security & Accounting |                                                            Blockchain                                                             |          Whole network           |        Licenses & payments        |                                                  substrate?                                                   |

<img alt="aquamarine scheme" align="center" src="doc/stack.png"/>
