// auto-generated

export default "LyoqKioqKi8gKGZ1bmN0aW9uKG1vZHVsZXMpIHsgLy8gd2VicGFja0Jvb3RzdHJhcAovKioqKioqLyAJLy8gVGhlIG1vZHVsZSBjYWNoZQovKioqKioqLyAJdmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTsKLyoqKioqKi8KLyoqKioqKi8gCS8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uCi8qKioqKiovIAlmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7Ci8qKioqKiovCi8qKioqKiovIAkJLy8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlCi8qKioqKiovIAkJaWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHsKLyoqKioqKi8gCQkJcmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7Ci8qKioqKiovIAkJfQovKioqKioqLyAJCS8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpCi8qKioqKiovIAkJdmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0gewovKioqKioqLyAJCQlpOiBtb2R1bGVJZCwKLyoqKioqKi8gCQkJbDogZmFsc2UsCi8qKioqKiovIAkJCWV4cG9ydHM6IHt9Ci8qKioqKiovIAkJfTsKLyoqKioqKi8KLyoqKioqKi8gCQkvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb24KLyoqKioqKi8gCQltb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTsKLyoqKioqKi8KLyoqKioqKi8gCQkvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkCi8qKioqKiovIAkJbW9kdWxlLmwgPSB0cnVlOwovKioqKioqLwovKioqKioqLyAJCS8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlCi8qKioqKiovIAkJcmV0dXJuIG1vZHVsZS5leHBvcnRzOwovKioqKioqLyAJfQovKioqKioqLwovKioqKioqLwovKioqKioqLyAJLy8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXykKLyoqKioqKi8gCV9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7Ci8qKioqKiovCi8qKioqKiovIAkvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZQovKioqKioqLyAJX193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlczsKLyoqKioqKi8KLyoqKioqKi8gCS8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0cwovKioqKioqLyAJX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7Ci8qKioqKiovIAkJaWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkgewovKioqKioqLyAJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTsKLyoqKioqKi8gCQl9Ci8qKioqKiovIAl9OwovKioqKioqLwovKioqKioqLyAJLy8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0cwovKioqKioqLyAJX193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykgewovKioqKioqLyAJCWlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykgewovKioqKioqLyAJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTsKLyoqKioqKi8gCQl9Ci8qKioqKiovIAkJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTsKLyoqKioqKi8gCX07Ci8qKioqKiovCi8qKioqKiovIAkvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3QKLyoqKioqKi8gCS8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdAovKioqKioqLyAJLy8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zCi8qKioqKiovIAkvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3QKLyoqKioqKi8gCS8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmUKLyoqKioqKi8gCV9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7Ci8qKioqKiovIAkJaWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7Ci8qKioqKiovIAkJaWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTsKLyoqKioqKi8gCQlpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlOwovKioqKioqLyAJCXZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7Ci8qKioqKiovIAkJX193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTsKLyoqKioqKi8gCQlPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7Ci8qKioqKiovIAkJaWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpOwovKioqKioqLyAJCXJldHVybiBuczsKLyoqKioqKi8gCX07Ci8qKioqKiovCi8qKioqKiovIAkvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlcwovKioqKioqLyAJX193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7Ci8qKioqKiovIAkJdmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/Ci8qKioqKiovIAkJCWZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6Ci8qKioqKiovIAkJCWZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07Ci8qKioqKiovIAkJX193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpOwovKioqKioqLyAJCXJldHVybiBnZXR0ZXI7Ci8qKioqKiovIAl9OwovKioqKioqLwovKioqKioqLyAJLy8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsCi8qKioqKiovIAlfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07Ci8qKioqKiovCi8qKioqKiovIAkvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfXwovKioqKioqLyAJX193ZWJwYWNrX3JlcXVpcmVfXy5wID0gIiI7Ci8qKioqKiovCi8qKioqKiovCi8qKioqKiovIAkvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHMKLyoqKioqKi8gCXJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9ICIuL3NyYy9pbmRleC50cyIpOwovKioqKioqLyB9KQovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKioqKioqLyAoewoKLyoqKi8gIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmx1ZW5jZWxhYnMrbWFyaW5lLWpzQDAuMy4zOC9ub2RlX21vZHVsZXMvQGZsdWVuY2VsYWJzL21hcmluZS1qcy9kaXN0L01hcmluZVNlcnZpY2UuanMiOgovKiEqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlwKICAhKioqIC9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9AZmx1ZW5jZWxhYnMrbWFyaW5lLWpzQDAuMy4zOC9ub2RlX21vZHVsZXMvQGZsdWVuY2VsYWJzL21hcmluZS1qcy9kaXN0L01hcmluZVNlcnZpY2UuanMgKioqIQogIFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CmV2YWwoIlxuLypcbiAqIENvcHlyaWdodCAyMDIyIEZsdWVuY2UgTGFicyBMaW1pdGVkXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG52YXIgX19hc3NpZ24gPSAodGhpcyAmJiB0aGlzLl9fYXNzaWduKSB8fCBmdW5jdGlvbiAoKSB7XG4gICAgX19hc3NpZ24gPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uICh0KSB7XG4gICAgICAgIGZvciAodmFyIHMsIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xuICAgICAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTtcbiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gcylcbiAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKVxuICAgICAgICAgICAgICAgICAgICB0W3BdID0gc1twXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdDtcbiAgICB9O1xuICAgIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHtcbiAgICAgICAgICAgIHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHtcbiAgICAgICAgICAgIHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2dlbmVyYXRvciA9ICh0aGlzICYmIHRoaXMuX19nZW5lcmF0b3IpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBib2R5KSB7XG4gICAgdmFyIF8gPSB7IGxhYmVsOiAwLCBzZW50OiBmdW5jdGlvbiAoKSB7IGlmICh0WzBdICYgMSlcbiAgICAgICAgICAgIHRocm93IHRbMV07IHJldHVybiB0WzFdOyB9LCB0cnlzOiBbXSwgb3BzOiBbXSB9LCBmLCB5LCB0LCBnO1xuICAgIHJldHVybiBnID0geyBuZXh0OiB2ZXJiKDApLCBcInRocm93XCI6IHZlcmIoMSksIFwicmV0dXJuXCI6IHZlcmIoMikgfSwgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIChnW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9KSwgZztcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgcmV0dXJuIGZ1bmN0aW9uICh2KSB7IHJldHVybiBzdGVwKFtuLCB2XSk7IH07IH1cbiAgICBmdW5jdGlvbiBzdGVwKG9wKSB7XG4gICAgICAgIGlmIChmKVxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XG4gICAgICAgIHdoaWxlIChfKVxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBpZiAoZiA9IDEsIHkgJiYgKHQgPSBvcFswXSAmIDIgPyB5W1wicmV0dXJuXCJdIDogb3BbMF0gPyB5W1widGhyb3dcIl0gfHwgKCh0ID0geVtcInJldHVyblwiXSkgJiYgdC5jYWxsKHkpLCAwKSA6IHkubmV4dCkgJiYgISh0ID0gdC5jYWxsKHksIG9wWzFdKSkuZG9uZSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQ7XG4gICAgICAgICAgICAgICAgaWYgKHkgPSAwLCB0KVxuICAgICAgICAgICAgICAgICAgICBvcCA9IFtvcFswXSAmIDIsIHQudmFsdWVdO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAob3BbMF0pIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICB0ID0gb3A7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgXy5sYWJlbCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG9wWzFdLCBkb25lOiBmYWxzZSB9O1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICAgICAgICAgICAgICBfLmxhYmVsKys7XG4gICAgICAgICAgICAgICAgICAgICAgICB5ID0gb3BbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICBvcCA9IFswXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDc6XG4gICAgICAgICAgICAgICAgICAgICAgICBvcCA9IF8ub3BzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgXy50cnlzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISh0ID0gXy50cnlzLCB0ID0gdC5sZW5ndGggPiAwICYmIHRbdC5sZW5ndGggLSAxXSkgJiYgKG9wWzBdID09PSA2IHx8IG9wWzBdID09PSAyKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8gPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCAob3BbMV0gPiB0WzBdICYmIG9wWzFdIDwgdFszXSkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5sYWJlbCA9IG9wWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5sYWJlbCA9IHRbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdCA9IG9wO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgXy5sYWJlbCA8IHRbMl0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLmxhYmVsID0gdFsyXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLm9wcy5wdXNoKG9wKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8ub3BzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgXy50cnlzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG9wID0gYm9keS5jYWxsKHRoaXNBcmcsIF8pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBvcCA9IFs2LCBlXTtcbiAgICAgICAgICAgICAgICB5ID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgICAgIGYgPSB0ID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgaWYgKG9wWzBdICYgNSlcbiAgICAgICAgICAgIHRocm93IG9wWzFdO1xuICAgICAgICByZXR1cm4geyB2YWx1ZTogb3BbMF0gPyBvcFsxXSA6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9O1xuICAgIH1cbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1hcmluZVNlcnZpY2UgPSB2b2lkIDA7XG52YXIgd2FzaV8xID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgQHdhc21lci93YXNpICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0B3YXNtZXIrd2FzaUAwLjEyLjAvbm9kZV9tb2R1bGVzL0B3YXNtZXIvd2FzaS9saWIvaW5kZXguZXNtLmpzXCIpO1xudmFyIGJyb3dzZXJfMSA9IF9faW1wb3J0RGVmYXVsdChfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISBAd2FzbWVyL3dhc2kvbGliL2JpbmRpbmdzL2Jyb3dzZXIgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vQHdhc21lcit3YXNpQDAuMTIuMC9ub2RlX21vZHVsZXMvQHdhc21lci93YXNpL2xpYi9iaW5kaW5ncy9icm93c2VyLmpzXCIpKTtcbnZhciB3YXNtZnNfMSA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIEB3YXNtZXIvd2FzbWZzICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0B3YXNtZXIrd2FzbWZzQDAuMTIuMC9ub2RlX21vZHVsZXMvQHdhc21lci93YXNtZnMvbGliL2luZGV4LmVzbS5qc1wiKTtcbnZhciBtYXJpbmVfanNfMSA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vbWFyaW5lX2pzICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmbHVlbmNlbGFicyttYXJpbmUtanNAMC4zLjM4L25vZGVfbW9kdWxlcy9AZmx1ZW5jZWxhYnMvbWFyaW5lLWpzL2Rpc3QvbWFyaW5lX2pzLmpzXCIpO1xudmFyIGNhY2hlZ2V0VWludDhNZW1vcnkwID0gbnVsbDtcbmZ1bmN0aW9uIGdldFVpbnQ4TWVtb3J5MCh3YXNtKSB7XG4gICAgaWYgKGNhY2hlZ2V0VWludDhNZW1vcnkwID09PSBudWxsIHx8IGNhY2hlZ2V0VWludDhNZW1vcnkwLmJ1ZmZlciAhPT0gd2FzbS5tZW1vcnkuYnVmZmVyKSB7XG4gICAgICAgIGNhY2hlZ2V0VWludDhNZW1vcnkwID0gbmV3IFVpbnQ4QXJyYXkod2FzbS5tZW1vcnkuYnVmZmVyKTtcbiAgICB9XG4gICAgcmV0dXJuIGNhY2hlZ2V0VWludDhNZW1vcnkwO1xufVxuZnVuY3Rpb24gZ2V0U3RyaW5nRnJvbVdhc20wKHdhc20sIHB0ciwgbGVuKSB7XG4gICAgcmV0dXJuIGRlY29kZXIuZGVjb2RlKGdldFVpbnQ4TWVtb3J5MCh3YXNtKS5zdWJhcnJheShwdHIsIHB0ciArIGxlbikpO1xufVxudmFyIGRlY29kZXIgPSBuZXcgVGV4dERlY29kZXIoKTtcbnZhciBNYXJpbmVTZXJ2aWNlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1hcmluZVNlcnZpY2UoY29udHJvbE1vZHVsZSwgc2VydmljZU1vZHVsZSwgc2VydmljZUlkLCBsb2dGdW5jdGlvbiwgbWFyaW5lU2VydmljZUNvbmZpZywgZW52KSB7XG4gICAgICAgIHRoaXMuY29udHJvbE1vZHVsZSA9IGNvbnRyb2xNb2R1bGU7XG4gICAgICAgIHRoaXMuc2VydmljZU1vZHVsZSA9IHNlcnZpY2VNb2R1bGU7XG4gICAgICAgIHRoaXMuc2VydmljZUlkID0gc2VydmljZUlkO1xuICAgICAgICB0aGlzLmxvZ0Z1bmN0aW9uID0gbG9nRnVuY3Rpb247XG4gICAgICAgIHRoaXMuZW52ID0ge307XG4gICAgICAgIHRoaXMuX2NvbnRyb2xNb2R1bGVJbnN0YW5jZSA9ICdub3Qtc2V0JztcbiAgICAgICAgdGhpcy5lbnYgPSBfX2Fzc2lnbih7IFdBU01fTE9HOiAnb2ZmJyB9LCBlbnYpO1xuICAgIH1cbiAgICBNYXJpbmVTZXJ2aWNlLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgd2FzaSwgY2ZnLCB3YXNpSW1wb3J0cywgc2VydmljZUluc3RhbmNlLCBjb250cm9sTW9kdWxlSW5zdGFuY2UsIGN1c3RvbVNlY3Rpb25zLCBpdEN1c3RvbVNlY3Rpb25zLCByYXdSZXN1bHQsIHJlc3VsdDtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICB3YXNpID0gbmV3IHdhc2lfMS5XQVNJKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnY6IHRoaXMuZW52LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpbmRpbmdzOiBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgYnJvd3Nlcl8xLmRlZmF1bHQpLCB7IGZzOiBuZXcgd2FzbWZzXzEuV2FzbUZzKCkuZnMgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNmZyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHBvcnRzOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgd2FzaUltcG9ydHMgPSBoYXNXYXNpSW1wb3J0cyh0aGlzLnNlcnZpY2VNb2R1bGUpID8gd2FzaS5nZXRJbXBvcnRzKHRoaXMuc2VydmljZU1vZHVsZSkgOiB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlKHRoaXMuc2VydmljZU1vZHVsZSwgX19hc3NpZ24oX19hc3NpZ24oe30sIHdhc2lJbXBvcnRzKSwgeyBob3N0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dfdXRmOF9zdHJpbmc6IGZ1bmN0aW9uIChsZXZlbFJhdywgdGFyZ2V0LCBvZmZzZXQsIHNpemUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgd2FzbSA9IGNmZy5leHBvcnRzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsZXZlbCA9IHJhd0xldmVsVG9UeXBlcyhsZXZlbFJhdyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxldmVsID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBnZXRTdHJpbmdGcm9tV2FzbTAod2FzbSwgb2Zmc2V0LCBzaXplKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5sb2dGdW5jdGlvbih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZpY2U6IF90aGlzLnNlcnZpY2VJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogbWVzc2FnZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV2ZWw6IGxldmVsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSB9KSldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlSW5zdGFuY2UgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB3YXNpLnN0YXJ0KHNlcnZpY2VJbnN0YW5jZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjZmcuZXhwb3J0cyA9IHNlcnZpY2VJbnN0YW5jZS5leHBvcnRzO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgKDAsIG1hcmluZV9qc18xLmluaXQpKHRoaXMuY29udHJvbE1vZHVsZSldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sTW9kdWxlSW5zdGFuY2UgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21TZWN0aW9ucyA9IFdlYkFzc2VtYmx5Lk1vZHVsZS5jdXN0b21TZWN0aW9ucyh0aGlzLnNlcnZpY2VNb2R1bGUsICdpbnRlcmZhY2UtdHlwZXMnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0Q3VzdG9tU2VjdGlvbnMgPSBuZXcgVWludDhBcnJheShjdXN0b21TZWN0aW9uc1swXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByYXdSZXN1bHQgPSBjb250cm9sTW9kdWxlSW5zdGFuY2UucmVnaXN0ZXJfbW9kdWxlKHRoaXMuc2VydmljZUlkLCBpdEN1c3RvbVNlY3Rpb25zLCBzZXJ2aWNlSW5zdGFuY2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBKU09OLnBhcnNlKHJhd1Jlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY29udHJvbE1vZHVsZUluc3RhbmNlID0gY29udHJvbE1vZHVsZUluc3RhbmNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCByZXN1bHRdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGV4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgJ3JlZ2lzdGVyX21vZHVsZSByZXN1bHQgcGFyc2luZyBlcnJvcjogJyArIGV4ICsgJywgb3JpZ2luYWwgdGV4dDogJyArIHJhd1Jlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBNYXJpbmVTZXJ2aWNlLnByb3RvdHlwZS50ZXJtaW5hdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX2NvbnRyb2xNb2R1bGVJbnN0YW5jZSA9ICdub3Qtc2V0JztcbiAgICB9O1xuICAgIE1hcmluZVNlcnZpY2UucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiAoZnVuY3Rpb25OYW1lLCBhcmdzLCBjYWxsUGFyYW1zKSB7XG4gICAgICAgIGlmICh0aGlzLl9jb250cm9sTW9kdWxlSW5zdGFuY2UgPT09ICdub3Qtc2V0Jykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdOb3QgaW5pdGlhbGl6ZWQnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fY29udHJvbE1vZHVsZUluc3RhbmNlID09PSAndGVybWluYXRlZCcpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGVybWluYXRlZCcpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBhcmdzU3RyaW5nID0gSlNPTi5zdHJpbmdpZnkoYXJncyk7XG4gICAgICAgIHZhciByYXdSZXMgPSB0aGlzLl9jb250cm9sTW9kdWxlSW5zdGFuY2UuY2FsbF9tb2R1bGUodGhpcy5zZXJ2aWNlSWQsIGZ1bmN0aW9uTmFtZSwgYXJnc1N0cmluZyk7XG4gICAgICAgIHZhciBqc29uUmVzID0gSlNPTi5wYXJzZShyYXdSZXMpO1xuICAgICAgICBpZiAoanNvblJlcy5lcnJvcikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwibWFyaW5lLWpzIGZhaWxlZCB3aXRoOiBcIi5jb25jYXQoanNvblJlcy5lcnJvcikpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBqc29uUmVzLnJlc3VsdDtcbiAgICB9O1xuICAgIHJldHVybiBNYXJpbmVTZXJ2aWNlO1xufSgpKTtcbmV4cG9ydHMuTWFyaW5lU2VydmljZSA9IE1hcmluZVNlcnZpY2U7XG5mdW5jdGlvbiBoYXNXYXNpSW1wb3J0cyhtb2R1bGUpIHtcbiAgICB2YXIgaW1wb3J0cyA9IFdlYkFzc2VtYmx5Lk1vZHVsZS5pbXBvcnRzKG1vZHVsZSk7XG4gICAgdmFyIGZpcnN0V2FzaUltcG9ydCA9IGltcG9ydHMuZmluZChmdW5jdGlvbiAoeCkge1xuICAgICAgICByZXR1cm4geC5tb2R1bGUgPT09ICd3YXNpX3NuYXBzaG90X3ByZXZpZXcxJyB8fCB4Lm1vZHVsZSA9PT0gJ3dhc2lfdW5zdGFibGUnO1xuICAgIH0pO1xuICAgIHJldHVybiBmaXJzdFdhc2lJbXBvcnQgIT09IHVuZGVmaW5lZDtcbn1cbnZhciByYXdMZXZlbFRvVHlwZXMgPSBmdW5jdGlvbiAocmF3TGV2ZWwpIHtcbiAgICBzd2l0Y2ggKHJhd0xldmVsKSB7XG4gICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgIHJldHVybiAnZXJyb3InO1xuICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICByZXR1cm4gJ3dhcm4nO1xuICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICByZXR1cm4gJ2luZm8nO1xuICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICByZXR1cm4gJ2RlYnVnJztcbiAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgcmV0dXJuICd0cmFjZSc7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xufTtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL0BmbHVlbmNlbGFicyttYXJpbmUtanNAMC4zLjM4L25vZGVfbW9kdWxlcy9AZmx1ZW5jZWxhYnMvbWFyaW5lLWpzL2Rpc3QvTWFyaW5lU2VydmljZS5qcz8iKTsKCi8qKiovIH0pLAoKLyoqKi8gIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmx1ZW5jZWxhYnMrbWFyaW5lLWpzQDAuMy4zOC9ub2RlX21vZHVsZXMvQGZsdWVuY2VsYWJzL21hcmluZS1qcy9kaXN0L2NvbmZpZy5qcyI6Ci8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqISpcCiAgISoqKiAvaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vQGZsdWVuY2VsYWJzK21hcmluZS1qc0AwLjMuMzgvbm9kZV9tb2R1bGVzL0BmbHVlbmNlbGFicy9tYXJpbmUtanMvZGlzdC9jb25maWcuanMgKioqIQogIFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKZXZhbCgiXG4vKlxuICogQ29weXJpZ2h0IDIwMjIgRmx1ZW5jZSBMYWJzIExpbWl0ZWRcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL0BmbHVlbmNlbGFicyttYXJpbmUtanNAMC4zLjM4L25vZGVfbW9kdWxlcy9AZmx1ZW5jZWxhYnMvbWFyaW5lLWpzL2Rpc3QvY29uZmlnLmpzPyIpOwoKLyoqKi8gfSksCgovKioqLyAiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmbHVlbmNlbGFicyttYXJpbmUtanNAMC4zLjM4L25vZGVfbW9kdWxlcy9AZmx1ZW5jZWxhYnMvbWFyaW5lLWpzL2Rpc3QvaW5kZXguanMiOgovKiEqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqISpcCiAgISoqKiAvaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vQGZsdWVuY2VsYWJzK21hcmluZS1qc0AwLjMuMzgvbm9kZV9tb2R1bGVzL0BmbHVlbmNlbGFicy9tYXJpbmUtanMvZGlzdC9pbmRleC5qcyAqKiohCiAgXCoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CmV2YWwoIlxuLypcbiAqIENvcHlyaWdodCAyMDIyIEZsdWVuY2UgTGFicyBMaW1pdGVkXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uIChvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKVxuICAgICAgICBrMiA9IGs7XG4gICAgdmFyIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG0sIGspO1xuICAgIGlmICghZGVzYyB8fCAoXCJnZXRcIiBpbiBkZXNjID8gIW0uX19lc01vZHVsZSA6IGRlc2Mud3JpdGFibGUgfHwgZGVzYy5jb25maWd1cmFibGUpKSB7XG4gICAgICAgIGRlc2MgPSB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gbVtrXTsgfSB9O1xuICAgIH1cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIGRlc2MpO1xufSkgOiAoZnVuY3Rpb24gKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpXG4gICAgICAgIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19leHBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2V4cG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtLCBleHBvcnRzKSB7XG4gICAgZm9yICh2YXIgcCBpbiBtKVxuICAgICAgICBpZiAocCAhPT0gXCJkZWZhdWx0XCIgJiYgIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChleHBvcnRzLCBwKSlcbiAgICAgICAgICAgIF9fY3JlYXRlQmluZGluZyhleHBvcnRzLCBtLCBwKTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1hcmluZVNlcnZpY2UgPSB2b2lkIDA7XG52YXIgTWFyaW5lU2VydmljZV8xID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9NYXJpbmVTZXJ2aWNlICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmbHVlbmNlbGFicyttYXJpbmUtanNAMC4zLjM4L25vZGVfbW9kdWxlcy9AZmx1ZW5jZWxhYnMvbWFyaW5lLWpzL2Rpc3QvTWFyaW5lU2VydmljZS5qc1wiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1hcmluZVNlcnZpY2VcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIE1hcmluZVNlcnZpY2VfMS5NYXJpbmVTZXJ2aWNlOyB9IH0pO1xuX19leHBvcnRTdGFyKF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vY29uZmlnICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmbHVlbmNlbGFicyttYXJpbmUtanNAMC4zLjM4L25vZGVfbW9kdWxlcy9AZmx1ZW5jZWxhYnMvbWFyaW5lLWpzL2Rpc3QvY29uZmlnLmpzXCIpLCBleHBvcnRzKTtcbl9fZXhwb3J0U3RhcihfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL3R5cGVzICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmbHVlbmNlbGFicyttYXJpbmUtanNAMC4zLjM4L25vZGVfbW9kdWxlcy9AZmx1ZW5jZWxhYnMvbWFyaW5lLWpzL2Rpc3QvdHlwZXMuanNcIiksIGV4cG9ydHMpO1xuXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8vaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vQGZsdWVuY2VsYWJzK21hcmluZS1qc0AwLjMuMzgvbm9kZV9tb2R1bGVzL0BmbHVlbmNlbGFicy9tYXJpbmUtanMvZGlzdC9pbmRleC5qcz8iKTsKCi8qKiovIH0pLAoKLyoqKi8gIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmx1ZW5jZWxhYnMrbWFyaW5lLWpzQDAuMy4zOC9ub2RlX21vZHVsZXMvQGZsdWVuY2VsYWJzL21hcmluZS1qcy9kaXN0L21hcmluZV9qcy5qcyI6Ci8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqISpcCiAgISoqKiAvaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vQGZsdWVuY2VsYWJzK21hcmluZS1qc0AwLjMuMzgvbm9kZV9tb2R1bGVzL0BmbHVlbmNlbGFicy9tYXJpbmUtanMvZGlzdC9tYXJpbmVfanMuanMgKioqIQogIFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKZXZhbCgiXG4vKlxuICogQ29weXJpZ2h0IDIwMjIgRmx1ZW5jZSBMYWJzIExpbWl0ZWRcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHtcbiAgICAgICAgICAgIHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHtcbiAgICAgICAgICAgIHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2dlbmVyYXRvciA9ICh0aGlzICYmIHRoaXMuX19nZW5lcmF0b3IpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBib2R5KSB7XG4gICAgdmFyIF8gPSB7IGxhYmVsOiAwLCBzZW50OiBmdW5jdGlvbiAoKSB7IGlmICh0WzBdICYgMSlcbiAgICAgICAgICAgIHRocm93IHRbMV07IHJldHVybiB0WzFdOyB9LCB0cnlzOiBbXSwgb3BzOiBbXSB9LCBmLCB5LCB0LCBnO1xuICAgIHJldHVybiBnID0geyBuZXh0OiB2ZXJiKDApLCBcInRocm93XCI6IHZlcmIoMSksIFwicmV0dXJuXCI6IHZlcmIoMikgfSwgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIChnW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9KSwgZztcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgcmV0dXJuIGZ1bmN0aW9uICh2KSB7IHJldHVybiBzdGVwKFtuLCB2XSk7IH07IH1cbiAgICBmdW5jdGlvbiBzdGVwKG9wKSB7XG4gICAgICAgIGlmIChmKVxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XG4gICAgICAgIHdoaWxlIChfKVxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBpZiAoZiA9IDEsIHkgJiYgKHQgPSBvcFswXSAmIDIgPyB5W1wicmV0dXJuXCJdIDogb3BbMF0gPyB5W1widGhyb3dcIl0gfHwgKCh0ID0geVtcInJldHVyblwiXSkgJiYgdC5jYWxsKHkpLCAwKSA6IHkubmV4dCkgJiYgISh0ID0gdC5jYWxsKHksIG9wWzFdKSkuZG9uZSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQ7XG4gICAgICAgICAgICAgICAgaWYgKHkgPSAwLCB0KVxuICAgICAgICAgICAgICAgICAgICBvcCA9IFtvcFswXSAmIDIsIHQudmFsdWVdO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAob3BbMF0pIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICB0ID0gb3A7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgXy5sYWJlbCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG9wWzFdLCBkb25lOiBmYWxzZSB9O1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICAgICAgICAgICAgICBfLmxhYmVsKys7XG4gICAgICAgICAgICAgICAgICAgICAgICB5ID0gb3BbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICBvcCA9IFswXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDc6XG4gICAgICAgICAgICAgICAgICAgICAgICBvcCA9IF8ub3BzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgXy50cnlzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISh0ID0gXy50cnlzLCB0ID0gdC5sZW5ndGggPiAwICYmIHRbdC5sZW5ndGggLSAxXSkgJiYgKG9wWzBdID09PSA2IHx8IG9wWzBdID09PSAyKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8gPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCAob3BbMV0gPiB0WzBdICYmIG9wWzFdIDwgdFszXSkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5sYWJlbCA9IG9wWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5sYWJlbCA9IHRbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdCA9IG9wO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgXy5sYWJlbCA8IHRbMl0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLmxhYmVsID0gdFsyXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLm9wcy5wdXNoKG9wKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8ub3BzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgXy50cnlzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG9wID0gYm9keS5jYWxsKHRoaXNBcmcsIF8pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBvcCA9IFs2LCBlXTtcbiAgICAgICAgICAgICAgICB5ID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgICAgIGYgPSB0ID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgaWYgKG9wWzBdICYgNSlcbiAgICAgICAgICAgIHRocm93IG9wWzFdO1xuICAgICAgICByZXR1cm4geyB2YWx1ZTogb3BbMF0gPyBvcFsxXSA6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9O1xuICAgIH1cbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmluaXQgPSB2b2lkIDA7XG4vLyBUaGlzIGlzIHBhdGNoZWQgZ2VuZXJhdGVkIGJ5IHdhc20tcGFjayBmaWxlXG52YXIgbWFyaW5lX2pzX2pzXzEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL3NuaXBwZXRzL21hcmluZS1qcy02ZmFhNjdiOGFmOWNjMTczL21hcmluZS1qcy5qcyAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmx1ZW5jZWxhYnMrbWFyaW5lLWpzQDAuMy4zOC9ub2RlX21vZHVsZXMvQGZsdWVuY2VsYWJzL21hcmluZS1qcy9kaXN0L3NuaXBwZXRzL21hcmluZS1qcy02ZmFhNjdiOGFmOWNjMTczL21hcmluZS1qcy5qc1wiKTtcbmZ1bmN0aW9uIGluaXQobW9kdWxlKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICBmdW5jdGlvbiBnZXRPYmplY3QoaWR4KSB7IHJldHVybiBoZWFwW2lkeF07IH1cbiAgICAgICAgZnVuY3Rpb24gZHJvcE9iamVjdChpZHgpIHtcbiAgICAgICAgICAgIGlmIChpZHggPCAzNilcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBoZWFwW2lkeF0gPSBoZWFwX25leHQ7XG4gICAgICAgICAgICBoZWFwX25leHQgPSBpZHg7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gdGFrZU9iamVjdChpZHgpIHtcbiAgICAgICAgICAgIHZhciByZXQgPSBnZXRPYmplY3QoaWR4KTtcbiAgICAgICAgICAgIGRyb3BPYmplY3QoaWR4KTtcbiAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZ2V0VWludDhNZW1vcnkwKCkge1xuICAgICAgICAgICAgaWYgKGNhY2hlZFVpbnQ4TWVtb3J5MC5ieXRlTGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgY2FjaGVkVWludDhNZW1vcnkwID0gbmV3IFVpbnQ4QXJyYXkod2FzbS5tZW1vcnkuYnVmZmVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBjYWNoZWRVaW50OE1lbW9yeTA7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZ2V0U3RyaW5nRnJvbVdhc20wKHB0ciwgbGVuKSB7XG4gICAgICAgICAgICByZXR1cm4gY2FjaGVkVGV4dERlY29kZXIuZGVjb2RlKGdldFVpbnQ4TWVtb3J5MCgpLnN1YmFycmF5KHB0ciwgcHRyICsgbGVuKSk7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gYWRkSGVhcE9iamVjdChvYmopIHtcbiAgICAgICAgICAgIGlmIChoZWFwX25leHQgPT09IGhlYXAubGVuZ3RoKVxuICAgICAgICAgICAgICAgIGhlYXAucHVzaChoZWFwLmxlbmd0aCArIDEpO1xuICAgICAgICAgICAgdmFyIGlkeCA9IGhlYXBfbmV4dDtcbiAgICAgICAgICAgIGhlYXBfbmV4dCA9IGhlYXBbaWR4XTtcbiAgICAgICAgICAgIGhlYXBbaWR4XSA9IG9iajtcbiAgICAgICAgICAgIHJldHVybiBpZHg7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gcGFzc1N0cmluZ1RvV2FzbTAoYXJnLCBtYWxsb2MsIHJlYWxsb2MpIHtcbiAgICAgICAgICAgIGlmIChyZWFsbG9jID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgYnVmID0gY2FjaGVkVGV4dEVuY29kZXIuZW5jb2RlKGFyZyk7XG4gICAgICAgICAgICAgICAgdmFyIHB0cl8xID0gbWFsbG9jKGJ1Zi5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIGdldFVpbnQ4TWVtb3J5MCgpLnN1YmFycmF5KHB0cl8xLCBwdHJfMSArIGJ1Zi5sZW5ndGgpLnNldChidWYpO1xuICAgICAgICAgICAgICAgIFdBU01fVkVDVE9SX0xFTiA9IGJ1Zi5sZW5ndGg7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHB0cl8xO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGxlbiA9IGFyZy5sZW5ndGg7XG4gICAgICAgICAgICB2YXIgcHRyID0gbWFsbG9jKGxlbik7XG4gICAgICAgICAgICB2YXIgbWVtID0gZ2V0VWludDhNZW1vcnkwKCk7XG4gICAgICAgICAgICB2YXIgb2Zmc2V0ID0gMDtcbiAgICAgICAgICAgIGZvciAoOyBvZmZzZXQgPCBsZW47IG9mZnNldCsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvZGUgPSBhcmcuY2hhckNvZGVBdChvZmZzZXQpO1xuICAgICAgICAgICAgICAgIGlmIChjb2RlID4gMHg3RilcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgbWVtW3B0ciArIG9mZnNldF0gPSBjb2RlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG9mZnNldCAhPT0gbGVuKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9mZnNldCAhPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBhcmcgPSBhcmcuc2xpY2Uob2Zmc2V0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcHRyID0gcmVhbGxvYyhwdHIsIGxlbiwgbGVuID0gb2Zmc2V0ICsgYXJnLmxlbmd0aCAqIDMpO1xuICAgICAgICAgICAgICAgIHZhciB2aWV3ID0gZ2V0VWludDhNZW1vcnkwKCkuc3ViYXJyYXkocHRyICsgb2Zmc2V0LCBwdHIgKyBsZW4pO1xuICAgICAgICAgICAgICAgIHZhciByZXQgPSBlbmNvZGVTdHJpbmcoYXJnLCB2aWV3KTtcbiAgICAgICAgICAgICAgICBvZmZzZXQgKz0gcmV0LndyaXR0ZW47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBXQVNNX1ZFQ1RPUl9MRU4gPSBvZmZzZXQ7XG4gICAgICAgICAgICByZXR1cm4gcHRyO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGdldEludDMyTWVtb3J5MCgpIHtcbiAgICAgICAgICAgIGlmIChjYWNoZWRJbnQzMk1lbW9yeTAuYnl0ZUxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGNhY2hlZEludDMyTWVtb3J5MCA9IG5ldyBJbnQzMkFycmF5KHdhc20ubWVtb3J5LmJ1ZmZlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gY2FjaGVkSW50MzJNZW1vcnkwO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHBhc3NBcnJheThUb1dhc20wKGFyZywgbWFsbG9jKSB7XG4gICAgICAgICAgICB2YXIgcHRyID0gbWFsbG9jKGFyZy5sZW5ndGggKiAxKTtcbiAgICAgICAgICAgIGdldFVpbnQ4TWVtb3J5MCgpLnNldChhcmcsIHB0ciAvIDEpO1xuICAgICAgICAgICAgV0FTTV9WRUNUT1JfTEVOID0gYXJnLmxlbmd0aDtcbiAgICAgICAgICAgIHJldHVybiBwdHI7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlZ2lzdGVycyBhIG1vZHVsZSBpbnNpZGUgd2ViLXJ1bnRpbWUuXG4gICAgICAgICAqXG4gICAgICAgICAqICMgQXJndW1lbnRzXG4gICAgICAgICAqXG4gICAgICAgICAqICogYG5hbWVgIC0gbmFtZSBvZiBtb2R1bGUgdG8gcmVnaXN0ZXJcbiAgICAgICAgICogKiBgd2l0X3NlY3Rpb25fYnl0ZXNgIC0gYnl0ZXMgb2YgXCJpbnRlcmZhY2UtdHlwZXNcIiBjdXN0b20gc2VjdGlvbiBmcm9tIHdhc20gZmlsZVxuICAgICAgICAgKiAqIGBpbnN0YW5jZWAgLSBgV2ViQXNzZW1ibHk6Okluc3RhbmNlYCBtYWRlIGZyb20gdGFyZ2V0IHdhc20gZmlsZVxuICAgICAgICAgKlxuICAgICAgICAgKiAjIFJldHVybiB2YWx1ZVxuICAgICAgICAgKlxuICAgICAgICAgKiBKU09OIG9iamVjdCB3aXRoIGZpZWxkIFwiZXJyb3JcIi4gSWYgZXJyb3IgaXMgZW1wdHksIG1vZHVsZSBpcyByZWdpc3RlcmVkLlxuICAgICAgICAgKiBvdGhlcndpc2UsIGl0IGNvbnRhaW5zIGVycm9yIG1lc3NhZ2UuXG4gICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lXG4gICAgICAgICAqIEBwYXJhbSB7VWludDhBcnJheX0gd2l0X3NlY3Rpb25fYnl0ZXNcbiAgICAgICAgICogQHBhcmFtIHthbnl9IHdhc21faW5zdGFuY2VcbiAgICAgICAgICogQHJldHVybnMge3N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uIHJlZ2lzdGVyX21vZHVsZShuYW1lLCB3aXRfc2VjdGlvbl9ieXRlcywgd2FzbV9pbnN0YW5jZSkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICB2YXIgcmV0cHRyID0gd2FzbS5fX3diaW5kZ2VuX2FkZF90b19zdGFja19wb2ludGVyKC0xNik7XG4gICAgICAgICAgICAgICAgdmFyIHB0cjAgPSBwYXNzU3RyaW5nVG9XYXNtMChuYW1lLCB3YXNtLl9fd2JpbmRnZW5fbWFsbG9jLCB3YXNtLl9fd2JpbmRnZW5fcmVhbGxvYyk7XG4gICAgICAgICAgICAgICAgdmFyIGxlbjAgPSBXQVNNX1ZFQ1RPUl9MRU47XG4gICAgICAgICAgICAgICAgdmFyIHB0cjEgPSBwYXNzQXJyYXk4VG9XYXNtMCh3aXRfc2VjdGlvbl9ieXRlcywgd2FzbS5fX3diaW5kZ2VuX21hbGxvYyk7XG4gICAgICAgICAgICAgICAgdmFyIGxlbjEgPSBXQVNNX1ZFQ1RPUl9MRU47XG4gICAgICAgICAgICAgICAgd2FzbS5yZWdpc3Rlcl9tb2R1bGUocmV0cHRyLCBwdHIwLCBsZW4wLCBwdHIxLCBsZW4xLCBhZGRIZWFwT2JqZWN0KHdhc21faW5zdGFuY2UpKTtcbiAgICAgICAgICAgICAgICB2YXIgcjAgPSBnZXRJbnQzMk1lbW9yeTAoKVtyZXRwdHIgLyA0ICsgMF07XG4gICAgICAgICAgICAgICAgdmFyIHIxID0gZ2V0SW50MzJNZW1vcnkwKClbcmV0cHRyIC8gNCArIDFdO1xuICAgICAgICAgICAgICAgIHJldHVybiBnZXRTdHJpbmdGcm9tV2FzbTAocjAsIHIxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgICAgIHdhc20uX193YmluZGdlbl9hZGRfdG9fc3RhY2tfcG9pbnRlcigxNik7XG4gICAgICAgICAgICAgICAgd2FzbS5fX3diaW5kZ2VuX2ZyZWUocjAsIHIxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICogIENhbGxzIGEgZnVuY3Rpb24gZnJvbSBhIG1vZHVsZS5cbiAgICAgICAgICpcbiAgICAgICAgICogIyBBcmd1bWVudHNcbiAgICAgICAgICpcbiAgICAgICAgICogKiBtb2R1bGVfbmFtZSAtIG5hbWUgb2YgcmVnaXN0ZXJlZCBtb2R1bGVcbiAgICAgICAgICogKiBmdW5jdGlvbl9uYW1lIC0gbmFtZSBvZiB0aGUgZnVuY3Rpb24gdG8gY2FsbFxuICAgICAgICAgKiAqIGFyZ3MgLSBKU09OIGFycmF5IG9mIGZ1bmN0aW9uIGFyZ3VtZW50c1xuICAgICAgICAgKlxuICAgICAgICAgKiAjIFJldHVybiB2YWx1ZVxuICAgICAgICAgKlxuICAgICAgICAgKiBKU09OIG9iamVjdCB3aXRoIGZpZWxkcyBcImVycm9yXCIgYW5kIFwicmVzdWx0XCIuIElmIFwiZXJyb3JcIiBpcyBlbXB0eSBzdHJpbmcsXG4gICAgICAgICAqIFwicmVzdWx0XCIgY29udGFpbnMgYSBmdW5jdGlvbiByZXR1cm4gdmFsdWUuIE90aGVyd2lzZSwgXCJlcnJvclwiIGNvbnRhaW5zIGVycm9yIG1lc3NhZ2UuXG4gICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBtb2R1bGVfbmFtZVxuICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gZnVuY3Rpb25fbmFtZVxuICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gYXJnc1xuICAgICAgICAgKiBAcmV0dXJucyB7c3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gY2FsbF9tb2R1bGUobW9kdWxlX25hbWUsIGZ1bmN0aW9uX25hbWUsIGFyZ3MpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgdmFyIHJldHB0ciA9IHdhc20uX193YmluZGdlbl9hZGRfdG9fc3RhY2tfcG9pbnRlcigtMTYpO1xuICAgICAgICAgICAgICAgIHZhciBwdHIwID0gcGFzc1N0cmluZ1RvV2FzbTAobW9kdWxlX25hbWUsIHdhc20uX193YmluZGdlbl9tYWxsb2MsIHdhc20uX193YmluZGdlbl9yZWFsbG9jKTtcbiAgICAgICAgICAgICAgICB2YXIgbGVuMCA9IFdBU01fVkVDVE9SX0xFTjtcbiAgICAgICAgICAgICAgICB2YXIgcHRyMSA9IHBhc3NTdHJpbmdUb1dhc20wKGZ1bmN0aW9uX25hbWUsIHdhc20uX193YmluZGdlbl9tYWxsb2MsIHdhc20uX193YmluZGdlbl9yZWFsbG9jKTtcbiAgICAgICAgICAgICAgICB2YXIgbGVuMSA9IFdBU01fVkVDVE9SX0xFTjtcbiAgICAgICAgICAgICAgICB2YXIgcHRyMiA9IHBhc3NTdHJpbmdUb1dhc20wKGFyZ3MsIHdhc20uX193YmluZGdlbl9tYWxsb2MsIHdhc20uX193YmluZGdlbl9yZWFsbG9jKTtcbiAgICAgICAgICAgICAgICB2YXIgbGVuMiA9IFdBU01fVkVDVE9SX0xFTjtcbiAgICAgICAgICAgICAgICB3YXNtLmNhbGxfbW9kdWxlKHJldHB0ciwgcHRyMCwgbGVuMCwgcHRyMSwgbGVuMSwgcHRyMiwgbGVuMik7XG4gICAgICAgICAgICAgICAgdmFyIHIwID0gZ2V0SW50MzJNZW1vcnkwKClbcmV0cHRyIC8gNCArIDBdO1xuICAgICAgICAgICAgICAgIHZhciByMSA9IGdldEludDMyTWVtb3J5MCgpW3JldHB0ciAvIDQgKyAxXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0U3RyaW5nRnJvbVdhc20wKHIwLCByMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgICAgICB3YXNtLl9fd2JpbmRnZW5fYWRkX3RvX3N0YWNrX3BvaW50ZXIoMTYpO1xuICAgICAgICAgICAgICAgIHdhc20uX193YmluZGdlbl9mcmVlKHIwLCByMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZ2V0QXJyYXlVOEZyb21XYXNtMChwdHIsIGxlbikge1xuICAgICAgICAgICAgcmV0dXJuIGdldFVpbnQ4TWVtb3J5MCgpLnN1YmFycmF5KHB0ciAvIDEsIHB0ciAvIDEgKyBsZW4pO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGdldEltcG9ydHMoKSB7XG4gICAgICAgICAgICB2YXIgaW1wb3J0cyA9IHt9O1xuICAgICAgICAgICAgaW1wb3J0cy53YmcgPSB7fTtcbiAgICAgICAgICAgIGltcG9ydHMud2JnLl9fd2JnX3dyaXRlYnl0ZXJhbmdlXzBjNTlhYWJjMmFhZDEyMTAgPSBmdW5jdGlvbiAoYXJnMCwgYXJnMSwgYXJnMiwgYXJnMykge1xuICAgICAgICAgICAgICAgICgwLCBtYXJpbmVfanNfanNfMS53cml0ZV9ieXRlX3JhbmdlKShnZXRPYmplY3QoYXJnMCksIGFyZzEgPj4+IDAsIGdldEFycmF5VThGcm9tV2FzbTAoYXJnMiwgYXJnMykpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGltcG9ydHMud2JnLl9fd2JnX3JlYWRieXRlXzBiOTZjZDYyZTRjMWFmMjUgPSBmdW5jdGlvbiAoYXJnMCwgYXJnMSkge1xuICAgICAgICAgICAgICAgIHZhciByZXQgPSAoMCwgbWFyaW5lX2pzX2pzXzEucmVhZF9ieXRlKShnZXRPYmplY3QoYXJnMCksIGFyZzEgPj4+IDApO1xuICAgICAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaW1wb3J0cy53YmcuX193YmdfcmVhZGJ5dGVyYW5nZV82ZGVmNTk3MGIxYWViZjYxID0gZnVuY3Rpb24gKGFyZzAsIGFyZzEsIGFyZzIsIGFyZzMpIHtcbiAgICAgICAgICAgICAgICAoMCwgbWFyaW5lX2pzX2pzXzEucmVhZF9ieXRlX3JhbmdlKShnZXRPYmplY3QoYXJnMCksIGFyZzEgPj4+IDAsIGdldEFycmF5VThGcm9tV2FzbTAoYXJnMiwgYXJnMykpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGltcG9ydHMud2JnLl9fd2JnX2dldG1lbW9yeXNpemVfMTZkNzkyYzU0NzQ2OWJhNCA9IGZ1bmN0aW9uIChhcmcwKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJldCA9ICgwLCBtYXJpbmVfanNfanNfMS5nZXRfbWVtb3J5X3NpemUpKGdldE9iamVjdChhcmcwKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpbXBvcnRzLndiZy5fX3diZ19uZXdfYWJkYTc2ZTg4M2JhOGE1ZiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmV0ID0gbmV3IEVycm9yKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFkZEhlYXBPYmplY3QocmV0KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpbXBvcnRzLndiZy5fX3diZ19zdGFja182NTgyNzlmZTQ0NTQxY2Y2ID0gZnVuY3Rpb24gKGFyZzAsIGFyZzEpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmV0ID0gZ2V0T2JqZWN0KGFyZzEpLnN0YWNrO1xuICAgICAgICAgICAgICAgIHZhciBwdHIwID0gcGFzc1N0cmluZ1RvV2FzbTAocmV0LCB3YXNtLl9fd2JpbmRnZW5fbWFsbG9jLCB3YXNtLl9fd2JpbmRnZW5fcmVhbGxvYyk7XG4gICAgICAgICAgICAgICAgdmFyIGxlbjAgPSBXQVNNX1ZFQ1RPUl9MRU47XG4gICAgICAgICAgICAgICAgZ2V0SW50MzJNZW1vcnkwKClbYXJnMCAvIDQgKyAxXSA9IGxlbjA7XG4gICAgICAgICAgICAgICAgZ2V0SW50MzJNZW1vcnkwKClbYXJnMCAvIDQgKyAwXSA9IHB0cjA7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaW1wb3J0cy53YmcuX193YmdfZXJyb3JfZjg1MTY2N2FmNzFiY2ZjNiA9IGZ1bmN0aW9uIChhcmcwLCBhcmcxKSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihnZXRTdHJpbmdGcm9tV2FzbTAoYXJnMCwgYXJnMSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgICAgICAgICAgd2FzbS5fX3diaW5kZ2VuX2ZyZWUoYXJnMCwgYXJnMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGltcG9ydHMud2JnLl9fd2JpbmRnZW5fb2JqZWN0X2Ryb3BfcmVmID0gZnVuY3Rpb24gKGFyZzApIHtcbiAgICAgICAgICAgICAgICB0YWtlT2JqZWN0KGFyZzApO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGltcG9ydHMud2JnLl9fd2JnX3dyaXRlYnl0ZV8xMTFmZTkzYzJiMDEyNmZlID0gZnVuY3Rpb24gKGFyZzAsIGFyZzEsIGFyZzIpIHtcbiAgICAgICAgICAgICAgICAoMCwgbWFyaW5lX2pzX2pzXzEud3JpdGVfYnl0ZSkoZ2V0T2JqZWN0KGFyZzApLCBhcmcxID4+PiAwLCBhcmcyKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpbXBvcnRzLndiZy5fX3diZ19jYWxsZXhwb3J0XzYzMzYzMGI5MTMyZTIwYTQgPSBmdW5jdGlvbiAoYXJnMCwgYXJnMSwgYXJnMiwgYXJnMywgYXJnNCwgYXJnNSkge1xuICAgICAgICAgICAgICAgIHZhciByZXQgPSAoMCwgbWFyaW5lX2pzX2pzXzEuY2FsbF9leHBvcnQpKGdldE9iamVjdChhcmcxKSwgZ2V0U3RyaW5nRnJvbVdhc20wKGFyZzIsIGFyZzMpLCBnZXRTdHJpbmdGcm9tV2FzbTAoYXJnNCwgYXJnNSkpO1xuICAgICAgICAgICAgICAgIHZhciBwdHIwID0gcGFzc1N0cmluZ1RvV2FzbTAocmV0LCB3YXNtLl9fd2JpbmRnZW5fbWFsbG9jLCB3YXNtLl9fd2JpbmRnZW5fcmVhbGxvYyk7XG4gICAgICAgICAgICAgICAgdmFyIGxlbjAgPSBXQVNNX1ZFQ1RPUl9MRU47XG4gICAgICAgICAgICAgICAgZ2V0SW50MzJNZW1vcnkwKClbYXJnMCAvIDQgKyAxXSA9IGxlbjA7XG4gICAgICAgICAgICAgICAgZ2V0SW50MzJNZW1vcnkwKClbYXJnMCAvIDQgKyAwXSA9IHB0cjA7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIGltcG9ydHM7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gaW5pdE1lbW9yeShpbXBvcnRzLCBtYXliZV9tZW1vcnkpIHtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBmaW5hbGl6ZUluaXQoaW5zdGFuY2UsIG1vZHVsZSkge1xuICAgICAgICAgICAgd2FzbSA9IGluc3RhbmNlLmV4cG9ydHM7XG4gICAgICAgICAgICBpbml0Ll9fd2JpbmRnZW5fd2FzbV9tb2R1bGUgPSBtb2R1bGU7XG4gICAgICAgICAgICBjYWNoZWRJbnQzMk1lbW9yeTAgPSBuZXcgSW50MzJBcnJheSgpO1xuICAgICAgICAgICAgY2FjaGVkVWludDhNZW1vcnkwID0gbmV3IFVpbnQ4QXJyYXkoKTtcbiAgICAgICAgICAgIC8vIGNhbGxzIG1haW4oKSBmdW5jdGlvbi4gVXNlZCB0byBzZXQgdXBcbiAgICAgICAgICAgIHdhc20uX193YmluZGdlbl9zdGFydCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdhc207XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gaW5pdCh3YXNtTW9kdWxlKSB7XG4gICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGltcG9ydHMsIGluc3RhbmNlO1xuICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydHMgPSBnZXRJbXBvcnRzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5pdE1lbW9yeShpbXBvcnRzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBXZWJBc3NlbWJseS5pbnN0YW50aWF0ZSh3YXNtTW9kdWxlLCBpbXBvcnRzKV07XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2UgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIGZpbmFsaXplSW5pdChpbnN0YW5jZSwgbW9kdWxlKV07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHZhciB3YXNtLCBoZWFwLCBoZWFwX25leHQsIGNhY2hlZFRleHREZWNvZGVyLCBjYWNoZWRVaW50OE1lbW9yeTAsIFdBU01fVkVDVE9SX0xFTiwgY2FjaGVkVGV4dEVuY29kZXIsIGVuY29kZVN0cmluZywgY2FjaGVkSW50MzJNZW1vcnkwO1xuICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICBoZWFwID0gbmV3IEFycmF5KDMyKS5maWxsKHVuZGVmaW5lZCk7XG4gICAgICAgICAgICAgICAgICAgIGhlYXAucHVzaCh1bmRlZmluZWQsIG51bGwsIHRydWUsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgaGVhcF9uZXh0ID0gaGVhcC5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIGNhY2hlZFRleHREZWNvZGVyID0gbmV3IFRleHREZWNvZGVyKCd1dGYtOCcsIHsgaWdub3JlQk9NOiB0cnVlLCBmYXRhbDogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgY2FjaGVkVGV4dERlY29kZXIuZGVjb2RlKCk7XG4gICAgICAgICAgICAgICAgICAgIGNhY2hlZFVpbnQ4TWVtb3J5MCA9IG5ldyBVaW50OEFycmF5KCk7XG4gICAgICAgICAgICAgICAgICAgIFdBU01fVkVDVE9SX0xFTiA9IDA7XG4gICAgICAgICAgICAgICAgICAgIGNhY2hlZFRleHRFbmNvZGVyID0gbmV3IFRleHRFbmNvZGVyKCd1dGYtOCcpO1xuICAgICAgICAgICAgICAgICAgICBlbmNvZGVTdHJpbmcgPSAodHlwZW9mIGNhY2hlZFRleHRFbmNvZGVyLmVuY29kZUludG8gPT09ICdmdW5jdGlvbidcbiAgICAgICAgICAgICAgICAgICAgICAgID8gZnVuY3Rpb24gKGFyZywgdmlldykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWNoZWRUZXh0RW5jb2Rlci5lbmNvZGVJbnRvKGFyZywgdmlldyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICA6IGZ1bmN0aW9uIChhcmcsIHZpZXcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYnVmID0gY2FjaGVkVGV4dEVuY29kZXIuZW5jb2RlKGFyZyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlldy5zZXQoYnVmKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkOiBhcmcubGVuZ3RoLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0dGVuOiBidWYubGVuZ3RoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBjYWNoZWRJbnQzMk1lbW9yeTAgPSBuZXcgSW50MzJBcnJheSgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBpbml0KG1vZHVsZSldO1xuICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhc206IHdhc20sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnaXN0ZXJfbW9kdWxlOiByZWdpc3Rlcl9tb2R1bGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbF9tb2R1bGU6IGNhbGxfbW9kdWxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgfV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuZXhwb3J0cy5pbml0ID0gaW5pdDtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL0BmbHVlbmNlbGFicyttYXJpbmUtanNAMC4zLjM4L25vZGVfbW9kdWxlcy9AZmx1ZW5jZWxhYnMvbWFyaW5lLWpzL2Rpc3QvbWFyaW5lX2pzLmpzPyIpOwoKLyoqKi8gfSksCgovKioqLyAiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmbHVlbmNlbGFicyttYXJpbmUtanNAMC4zLjM4L25vZGVfbW9kdWxlcy9AZmx1ZW5jZWxhYnMvbWFyaW5lLWpzL2Rpc3Qvc25pcHBldHMvbWFyaW5lLWpzLTZmYWE2N2I4YWY5Y2MxNzMvbWFyaW5lLWpzLmpzIjoKLyohKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlwKICAhKioqIC9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9AZmx1ZW5jZWxhYnMrbWFyaW5lLWpzQDAuMy4zOC9ub2RlX21vZHVsZXMvQGZsdWVuY2VsYWJzL21hcmluZS1qcy9kaXN0L3NuaXBwZXRzL21hcmluZS1qcy02ZmFhNjdiOGFmOWNjMTczL21hcmluZS1qcy5qcyAqKiohCiAgXCoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKiEgbm8gc3RhdGljIGV4cG9ydHMgZm91bmQgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwpldmFsKCJcbi8qXG4gKiBDb3B5cmlnaHQgMjAyMiBGbHVlbmNlIExhYnMgTGltaXRlZFxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5yZWFkX2J5dGVfcmFuZ2UgPSBleHBvcnRzLndyaXRlX2J5dGVfcmFuZ2UgPSBleHBvcnRzLndyaXRlX2J5dGUgPSBleHBvcnRzLnJlYWRfYnl0ZSA9IGV4cG9ydHMuZ2V0X21lbW9yeV9zaXplID0gZXhwb3J0cy5jYWxsX2V4cG9ydCA9IHZvaWQgMDtcbi8vIEludGVybmFsIEFQSSBpZiBtYXJpbmUtd2ViLiBPbmx5IHRoZXNlIGZ1bmN0aW9ucyBhcmUgdXNlZCBmb3IgaW50ZXJhY3Rpbmcgd2l0aCBXZWJBc3NlbWJseS5JbnN0YW5jZVxuLy8gTm9uZSBvZiB0aGUgZnVuY3Rpb25zIGJlbG93IHBlcmZvcm1zIGVycm9yLWNoZWNraW5nXG4vLyBJdCBpcyBjYWxsZXIncyByZXNwb25zaWJpbGl0eSB0byBlbnN1cmUgdGhhdCB0aGUgaW5zdGFuY2UgaXMgdmFsaWQgYW5kIGhhcyBhbGwgdGhlIGV4cG9ydHMgYW5kIHJlcXVpcmVkIG1lbW9yeSBzaXplXG4vKipcbiAqIENhbGxzIGFuIGV4cG9ydCBmdW5jdGlvbiBmcm9tIHdhc20gbW9kdWxlXG4gKlxuICogQHBhcmFtIHtXZWJBc3NlbWJseS5JbnN0YW5jZX0gaW5zdGFuY2UgaW5zdGFuY2Ugd2hpY2ggd2lsbCBiZSBjYWxsZWRcbiAqIEBwYXJhbSB7c3RyaW5nfSBleHBvcnRfbmFtZSBuYW1lIG9mIHRoZSBleHBvcnRcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcmdzIEpTT04gYXJyYXkgb2YgYXJnc1xuICogQHJldHVybnMge3N0cmluZ30gSlNPTiBhcnJheSBvZiByZXN1bHRzXG4gKiAqL1xuZnVuY3Rpb24gY2FsbF9leHBvcnQoaW5zdGFuY2UsIGV4cG9ydF9uYW1lLCBhcmdzKSB7XG4gICAgdmFyIF9hO1xuICAgIHZhciBwYXJzZWRfYXJncyA9IEpTT04ucGFyc2UoYXJncyk7XG4gICAgdmFyIHByZXBhcmVkX2FyZ3MgPSBbXTtcbiAgICBmb3IgKHZhciBhcmdfaW5kZXggPSAwOyBhcmdfaW5kZXggPCBwYXJzZWRfYXJncy5sZW5ndGg7IGFyZ19pbmRleCsrKSB7XG4gICAgICAgIHZhciBhcmcgPSBwYXJzZWRfYXJnc1thcmdfaW5kZXhdO1xuICAgICAgICBpZiAoYXJnW1wiSTMyXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHByZXBhcmVkX2FyZ3MucHVzaChhcmdbXCJJMzJcIl0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChhcmdbXCJJNjRcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgO1xuICAgICAgICAgICAgdmFyIHZhbCA9IEJpZ0ludChhcmdbXCJJNjRcIl0pO1xuICAgICAgICAgICAgcHJlcGFyZWRfYXJncy5wdXNoKHZhbCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGFyZ1tcIkYzMlwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBwcmVwYXJlZF9hcmdzLnB1c2goYXJnW1wiRjMyXCJdKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYXJnW1wiRjY0XCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHByZXBhcmVkX2FyZ3MucHVzaChhcmdbXCJGNjRcIl0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHZhciByZXN1bHQgPSAoX2EgPSBpbnN0YW5jZS5leHBvcnRzKVtleHBvcnRfbmFtZV0uYXBwbHkoX2EsIHByZXBhcmVkX2FyZ3MpO1xuICAgIHZhciBqc29uX3Jlc3VsdCA9IFwiW11cIjtcbiAgICBpZiAocmVzdWx0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgaWYgKHR5cGVvZiByZXN1bHQgPT0gXCJiaWdpbnRcIikge1xuICAgICAgICAgICAganNvbl9yZXN1bHQgPSBcIltcIiArIHJlc3VsdC50b1N0cmluZygpICsgXCJdXCI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBqc29uX3Jlc3VsdCA9IFwiW1wiICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0KSArIFwiXVwiO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBqc29uX3Jlc3VsdDtcbn1cbmV4cG9ydHMuY2FsbF9leHBvcnQgPSBjYWxsX2V4cG9ydDtcbi8qKlxuICogR2V0cyBzaXplIG9mIHRoZSB3YXNtIG1lbW9yeVxuICpcbiAqIEBwYXJhbSB7V2ViQXNzZW1ibHkuSW5zdGFuY2V9IGluc3RhbmNlIGluc3RhbmNlIHdoaWNoIHdpbGwgYmUgY2FsbGVkXG4gKiBAcmV0dXJucyB7bnVtYmVyfSBzaXplIG9mIGRhdGFcbiAqICovXG5mdW5jdGlvbiBnZXRfbWVtb3J5X3NpemUoaW5zdGFuY2UpIHtcbiAgICB2YXIgYnVmID0gbmV3IFVpbnQ4QXJyYXkoaW5zdGFuY2UuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKTtcbiAgICByZXR1cm4gYnVmLmJ5dGVMZW5ndGg7XG59XG5leHBvcnRzLmdldF9tZW1vcnlfc2l6ZSA9IGdldF9tZW1vcnlfc2l6ZTtcbi8qKlxuICogUmVhZHMgb25lIGJ5dGUgZnJvbSB3YXNtIG1lbW9yeVxuICpcbiAqIEBwYXJhbSB7V2ViQXNzZW1ibHkuSW5zdGFuY2V9IGluc3RhbmNlIGluc3RhbmNlIHdoaWNoIHdpbGwgYmUgdXNlZFxuICogQHBhcmFtIHtudW1iZXJ9IG9mZnNldCBvZmZzZXQgaW4gd2FzbSBtZW1vcnlcbiAqIEByZXR1cm5zIHtudW1iZXJ9IGJ5dGUgZnJvbSB3YXNtIG1lbW9yeVxuICogKi9cbmZ1bmN0aW9uIHJlYWRfYnl0ZShpbnN0YW5jZSwgb2Zmc2V0KSB7XG4gICAgdmFyIGJ1ZiA9IG5ldyBVaW50OEFycmF5KGluc3RhbmNlLmV4cG9ydHMubWVtb3J5LmJ1ZmZlcik7XG4gICAgcmV0dXJuIGJ1ZltvZmZzZXRdO1xufVxuZXhwb3J0cy5yZWFkX2J5dGUgPSByZWFkX2J5dGU7XG4vKipcbiAqIFdyaXRlcyBvbmUgYnl0ZSB0byB3YXNtIG1lbW9yeVxuICpcbiAqIEBwYXJhbSB7V2ViQXNzZW1ibHkuSW5zdGFuY2V9IGluc3RhbmNlIGluc3RhbmNlIHdoaWNoIHdpbGwgYmUgdXNlZFxuICogQHBhcmFtIHtudW1iZXJ9IG9mZnNldCBvZmZzZXQgaW4gd2FzbSBtZW1vcnlcbiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSB2YWx1ZSB0byB3cml0ZSBpbiBtZW1vcnlcbiAqICovXG5mdW5jdGlvbiB3cml0ZV9ieXRlKGluc3RhbmNlLCBvZmZzZXQsIHZhbHVlKSB7XG4gICAgdmFyIGJ1ZiA9IG5ldyBVaW50OEFycmF5KGluc3RhbmNlLmV4cG9ydHMubWVtb3J5LmJ1ZmZlcik7XG4gICAgYnVmW29mZnNldF0gPSB2YWx1ZTtcbn1cbmV4cG9ydHMud3JpdGVfYnl0ZSA9IHdyaXRlX2J5dGU7XG4vKipcbiAqIFdyaXRlcyBieXRlIHJhbmdlIHRvIHdhc20gbWVtb3J5XG4gKlxuICogQHBhcmFtIHtXZWJBc3NlbWJseS5JbnN0YW5jZX0gaW5zdGFuY2UgaW5zdGFuY2Ugd2hpY2ggd2lsbCBiZSB1c2VkXG4gKiBAcGFyYW0ge251bWJlcn0gb2Zmc2V0IG9mZnNldCBpbiB3YXNtIG1lbW9yeVxuICogQHBhcmFtIHtVaW50OEFycmF5fSBzbGljZSBhcnJheSB3aXRoIGJ5dGVzIHRvIHdyaXRlIGludG8gbWVtb3J5XG4gKiAqL1xuZnVuY3Rpb24gd3JpdGVfYnl0ZV9yYW5nZShpbnN0YW5jZSwgb2Zmc2V0LCBzbGljZSkge1xuICAgIHZhciBidWYgPSBuZXcgVWludDhBcnJheShpbnN0YW5jZS5leHBvcnRzLm1lbW9yeS5idWZmZXIpO1xuICAgIGZvciAodmFyIGJ5dGVfaW5kZXggPSAwOyBieXRlX2luZGV4IDwgc2xpY2UubGVuZ3RoOyBieXRlX2luZGV4KyspIHtcbiAgICAgICAgYnVmW29mZnNldCArIGJ5dGVfaW5kZXhdID0gc2xpY2VbYnl0ZV9pbmRleF07XG4gICAgfVxufVxuZXhwb3J0cy53cml0ZV9ieXRlX3JhbmdlID0gd3JpdGVfYnl0ZV9yYW5nZTtcbi8qKlxuICogUmVhZHMgYnl0ZSByYW5nZSBmcm9tIHdhc20gbWVtb3J5XG4gKlxuICogQHBhcmFtIHtXZWJBc3NlbWJseS5JbnN0YW5jZX0gaW5zdGFuY2UgaW5zdGFuY2Ugd2hpY2ggd2lsbCBiZSB1c2VkXG4gKiBAcGFyYW0ge251bWJlcn0gb2Zmc2V0IG9mZnNldCBpbiB3YXNtIG1lbW9yeVxuICogQHBhcmFtIHtVaW50OEFycmF5fSBzbGljZSBhcnJheSB0byBwbGFjZSByZWFkIGJ5dGVzXG4gKiAqL1xuZnVuY3Rpb24gcmVhZF9ieXRlX3JhbmdlKGluc3RhbmNlLCBvZmZzZXQsIHNsaWNlKSB7XG4gICAgdmFyIGJ1ZiA9IG5ldyBVaW50OEFycmF5KGluc3RhbmNlLmV4cG9ydHMubWVtb3J5LmJ1ZmZlcik7XG4gICAgZm9yICh2YXIgYnl0ZV9pbmRleCA9IDA7IGJ5dGVfaW5kZXggPCBzbGljZS5sZW5ndGg7IGJ5dGVfaW5kZXgrKykge1xuICAgICAgICBzbGljZVtieXRlX2luZGV4XSA9IGJ1ZltvZmZzZXQgKyBieXRlX2luZGV4XTtcbiAgICB9XG59XG5leHBvcnRzLnJlYWRfYnl0ZV9yYW5nZSA9IHJlYWRfYnl0ZV9yYW5nZTtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL0BmbHVlbmNlbGFicyttYXJpbmUtanNAMC4zLjM4L25vZGVfbW9kdWxlcy9AZmx1ZW5jZWxhYnMvbWFyaW5lLWpzL2Rpc3Qvc25pcHBldHMvbWFyaW5lLWpzLTZmYWE2N2I4YWY5Y2MxNzMvbWFyaW5lLWpzLmpzPyIpOwoKLyoqKi8gfSksCgovKioqLyAiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmbHVlbmNlbGFicyttYXJpbmUtanNAMC4zLjM4L25vZGVfbW9kdWxlcy9AZmx1ZW5jZWxhYnMvbWFyaW5lLWpzL2Rpc3QvdHlwZXMuanMiOgovKiEqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqISpcCiAgISoqKiAvaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vQGZsdWVuY2VsYWJzK21hcmluZS1qc0AwLjMuMzgvbm9kZV9tb2R1bGVzL0BmbHVlbmNlbGFicy9tYXJpbmUtanMvZGlzdC90eXBlcy5qcyAqKiohCiAgXCoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CmV2YWwoIlxuLypcbiAqIENvcHlyaWdodCAyMDIyIEZsdWVuY2UgTGFicyBMaW1pdGVkXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmxvZ0xldmVsVG9FbnYgPSBleHBvcnRzLmlzTG9nTGV2ZWwgPSBleHBvcnRzLmxvZ0xldmVscyA9IHZvaWQgMDtcbmV4cG9ydHMubG9nTGV2ZWxzID0gWyd0cmFjZScsICdkZWJ1ZycsICdpbmZvJywgJ3dhcm4nLCAnZXJyb3InXTtcbnZhciBpc0xvZ0xldmVsID0gZnVuY3Rpb24gKHVua25vd24pIHsgcmV0dXJuIGV4cG9ydHMubG9nTGV2ZWxzLnNvbWUoZnVuY3Rpb24gKHZhbCkgeyByZXR1cm4gdW5rbm93biA9PT0gdmFsOyB9KTsgfTtcbmV4cG9ydHMuaXNMb2dMZXZlbCA9IGlzTG9nTGV2ZWw7XG52YXIgbG9nTGV2ZWxUb0VudiA9IGZ1bmN0aW9uIChsZXZlbCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIFdBU01fTE9HOiBsZXZlbCxcbiAgICB9O1xufTtcbmV4cG9ydHMubG9nTGV2ZWxUb0VudiA9IGxvZ0xldmVsVG9FbnY7XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9AZmx1ZW5jZWxhYnMrbWFyaW5lLWpzQDAuMy4zOC9ub2RlX21vZHVsZXMvQGZsdWVuY2VsYWJzL21hcmluZS1qcy9kaXN0L3R5cGVzLmpzPyIpOwoKLyoqKi8gfSksCgovKioqLyAiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0B3YXNtZXIrd2FzaUAwLjEyLjAvbm9kZV9tb2R1bGVzL0B3YXNtZXIvd2FzaS9saWIvYmluZGluZ3MvYnJvd3Nlci5qcyI6Ci8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiEqXAogICEqKiogL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL0B3YXNtZXIrd2FzaUAwLjEyLjAvbm9kZV9tb2R1bGVzL0B3YXNtZXIvd2FzaS9saWIvYmluZGluZ3MvYnJvd3Nlci5qcyAqKiohCiAgXCoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKZXZhbCgiXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG4vLyBAdHMtaWdub3JlXG52YXIgcmFuZG9tZmlsbCA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIHJhbmRvbWZpbGwgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vcmFuZG9tZmlsbEAxLjAuNC9ub2RlX21vZHVsZXMvcmFuZG9tZmlsbC9icm93c2VyLmpzXCIpO1xudmFyIGJyb3dzZXJfaHJ0aW1lXzEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuLi9wb2x5ZmlsbHMvYnJvd3Nlci1ocnRpbWUgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vQHdhc21lcit3YXNpQDAuMTIuMC9ub2RlX21vZHVsZXMvQHdhc21lci93YXNpL2xpYi9wb2x5ZmlsbHMvYnJvd3Nlci1ocnRpbWUuanNcIik7XG4vLyBAdHMtaWdub3JlXG52YXIgcGF0aCA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIHBhdGgtYnJvd3NlcmlmeSAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9wYXRoLWJyb3dzZXJpZnlAMS4wLjEvbm9kZV9tb2R1bGVzL3BhdGgtYnJvd3NlcmlmeS9pbmRleC5qc1wiKTtcbnZhciBpbmRleF8xID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi4vaW5kZXggKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vQHdhc21lcit3YXNpQDAuMTIuMC9ub2RlX21vZHVsZXMvQHdhc21lci93YXNpL2xpYi9pbmRleC5qc1wiKTtcbnZhciBocnRpbWVfYmlnaW50XzEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuLi9wb2x5ZmlsbHMvaHJ0aW1lLmJpZ2ludCAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9Ad2FzbWVyK3dhc2lAMC4xMi4wL25vZGVfbW9kdWxlcy9Ad2FzbWVyL3dhc2kvbGliL3BvbHlmaWxscy9ocnRpbWUuYmlnaW50LmpzXCIpO1xudmFyIGJpbmRpbmdzID0ge1xuICAgIGhydGltZTogaHJ0aW1lX2JpZ2ludF8xLmRlZmF1bHQoYnJvd3Nlcl9ocnRpbWVfMS5kZWZhdWx0KSxcbiAgICBleGl0OiBmdW5jdGlvbiAoY29kZSkge1xuICAgICAgICB0aHJvdyBuZXcgaW5kZXhfMS5XQVNJRXhpdEVycm9yKGNvZGUpO1xuICAgIH0sXG4gICAga2lsbDogZnVuY3Rpb24gKHNpZ25hbCkge1xuICAgICAgICB0aHJvdyBuZXcgaW5kZXhfMS5XQVNJS2lsbEVycm9yKHNpZ25hbCk7XG4gICAgfSxcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgcmFuZG9tRmlsbFN5bmM6IHJhbmRvbWZpbGwucmFuZG9tRmlsbFN5bmMsXG4gICAgaXNUVFk6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRydWU7IH0sXG4gICAgcGF0aDogcGF0aCxcbiAgICAvLyBMZXQgdGhlIHVzZXIgYXR0YWNoIHRoZSBmcyBhdCBydW50aW1lXG4gICAgZnM6IG51bGxcbn07XG5leHBvcnRzLmRlZmF1bHQgPSBiaW5kaW5ncztcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL0B3YXNtZXIrd2FzaUAwLjEyLjAvbm9kZV9tb2R1bGVzL0B3YXNtZXIvd2FzaS9saWIvYmluZGluZ3MvYnJvd3Nlci5qcz8iKTsKCi8qKiovIH0pLAoKLyoqKi8gIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9Ad2FzbWVyK3dhc2lAMC4xMi4wL25vZGVfbW9kdWxlcy9Ad2FzbWVyL3dhc2kvbGliL2NvbnN0YW50cy5qcyI6Ci8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqISpcCiAgISoqKiAvaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vQHdhc21lcit3YXNpQDAuMTIuMC9ub2RlX21vZHVsZXMvQHdhc21lci93YXNpL2xpYi9jb25zdGFudHMuanMgKioqIQogIFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKZXZhbCgiXG52YXIgX2E7XG4vKlxuXG5UaGlzIHByb2plY3QgaXMgYmFzZWQgZnJvbSB0aGUgTm9kZSBpbXBsZW1lbnRhdGlvbiBtYWRlIGJ5IEd1cyBDYXBsYW5cbmh0dHBzOi8vZ2l0aHViLmNvbS9kZXZzbmVrL25vZGUtd2FzaVxuSG93ZXZlciwgSmF2YVNjcmlwdCBXQVNJIGlzIGZvY3VzZWQgb246XG4gKiBCcmluZ2luZyBXQVNJIHRvIHRoZSBCcm93c2Vyc1xuICogTWFrZSBlYXN5IHRvIHBsdWcgZGlmZmVyZW50IGZpbGVzeXN0ZW1zXG4gKiBQcm92aWRlIGEgdHlwZS1zYWZlIGFwaSB1c2luZyBUeXBlc2NyaXB0XG5cblxuQ29weXJpZ2h0IDIwMTkgR3VzIENhcGxhblxuXG5QZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG5vZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0b1xuZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGVcbnJpZ2h0cyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vclxuc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG5cblRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluXG5hbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cblxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG5GSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HXG5GUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTXG5JTiBUSEUgU09GVFdBUkUuXG5cbiAqL1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIGJpZ2ludF8xID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9wb2x5ZmlsbHMvYmlnaW50ICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0B3YXNtZXIrd2FzaUAwLjEyLjAvbm9kZV9tb2R1bGVzL0B3YXNtZXIvd2FzaS9saWIvcG9seWZpbGxzL2JpZ2ludC5qc1wiKTtcbmV4cG9ydHMuV0FTSV9FU1VDQ0VTUyA9IDA7XG5leHBvcnRzLldBU0lfRTJCSUcgPSAxO1xuZXhwb3J0cy5XQVNJX0VBQ0NFUyA9IDI7XG5leHBvcnRzLldBU0lfRUFERFJJTlVTRSA9IDM7XG5leHBvcnRzLldBU0lfRUFERFJOT1RBVkFJTCA9IDQ7XG5leHBvcnRzLldBU0lfRUFGTk9TVVBQT1JUID0gNTtcbmV4cG9ydHMuV0FTSV9FQUdBSU4gPSA2O1xuZXhwb3J0cy5XQVNJX0VBTFJFQURZID0gNztcbmV4cG9ydHMuV0FTSV9FQkFERiA9IDg7XG5leHBvcnRzLldBU0lfRUJBRE1TRyA9IDk7XG5leHBvcnRzLldBU0lfRUJVU1kgPSAxMDtcbmV4cG9ydHMuV0FTSV9FQ0FOQ0VMRUQgPSAxMTtcbmV4cG9ydHMuV0FTSV9FQ0hJTEQgPSAxMjtcbmV4cG9ydHMuV0FTSV9FQ09OTkFCT1JURUQgPSAxMztcbmV4cG9ydHMuV0FTSV9FQ09OTlJFRlVTRUQgPSAxNDtcbmV4cG9ydHMuV0FTSV9FQ09OTlJFU0VUID0gMTU7XG5leHBvcnRzLldBU0lfRURFQURMSyA9IDE2O1xuZXhwb3J0cy5XQVNJX0VERVNUQUREUlJFUSA9IDE3O1xuZXhwb3J0cy5XQVNJX0VET00gPSAxODtcbmV4cG9ydHMuV0FTSV9FRFFVT1QgPSAxOTtcbmV4cG9ydHMuV0FTSV9FRVhJU1QgPSAyMDtcbmV4cG9ydHMuV0FTSV9FRkFVTFQgPSAyMTtcbmV4cG9ydHMuV0FTSV9FRkJJRyA9IDIyO1xuZXhwb3J0cy5XQVNJX0VIT1NUVU5SRUFDSCA9IDIzO1xuZXhwb3J0cy5XQVNJX0VJRFJNID0gMjQ7XG5leHBvcnRzLldBU0lfRUlMU0VRID0gMjU7XG5leHBvcnRzLldBU0lfRUlOUFJPR1JFU1MgPSAyNjtcbmV4cG9ydHMuV0FTSV9FSU5UUiA9IDI3O1xuZXhwb3J0cy5XQVNJX0VJTlZBTCA9IDI4O1xuZXhwb3J0cy5XQVNJX0VJTyA9IDI5O1xuZXhwb3J0cy5XQVNJX0VJU0NPTk4gPSAzMDtcbmV4cG9ydHMuV0FTSV9FSVNESVIgPSAzMTtcbmV4cG9ydHMuV0FTSV9FTE9PUCA9IDMyO1xuZXhwb3J0cy5XQVNJX0VNRklMRSA9IDMzO1xuZXhwb3J0cy5XQVNJX0VNTElOSyA9IDM0O1xuZXhwb3J0cy5XQVNJX0VNU0dTSVpFID0gMzU7XG5leHBvcnRzLldBU0lfRU1VTFRJSE9QID0gMzY7XG5leHBvcnRzLldBU0lfRU5BTUVUT09MT05HID0gMzc7XG5leHBvcnRzLldBU0lfRU5FVERPV04gPSAzODtcbmV4cG9ydHMuV0FTSV9FTkVUUkVTRVQgPSAzOTtcbmV4cG9ydHMuV0FTSV9FTkVUVU5SRUFDSCA9IDQwO1xuZXhwb3J0cy5XQVNJX0VORklMRSA9IDQxO1xuZXhwb3J0cy5XQVNJX0VOT0JVRlMgPSA0MjtcbmV4cG9ydHMuV0FTSV9FTk9ERVYgPSA0MztcbmV4cG9ydHMuV0FTSV9FTk9FTlQgPSA0NDtcbmV4cG9ydHMuV0FTSV9FTk9FWEVDID0gNDU7XG5leHBvcnRzLldBU0lfRU5PTENLID0gNDY7XG5leHBvcnRzLldBU0lfRU5PTElOSyA9IDQ3O1xuZXhwb3J0cy5XQVNJX0VOT01FTSA9IDQ4O1xuZXhwb3J0cy5XQVNJX0VOT01TRyA9IDQ5O1xuZXhwb3J0cy5XQVNJX0VOT1BST1RPT1BUID0gNTA7XG5leHBvcnRzLldBU0lfRU5PU1BDID0gNTE7XG5leHBvcnRzLldBU0lfRU5PU1lTID0gNTI7XG5leHBvcnRzLldBU0lfRU5PVENPTk4gPSA1MztcbmV4cG9ydHMuV0FTSV9FTk9URElSID0gNTQ7XG5leHBvcnRzLldBU0lfRU5PVEVNUFRZID0gNTU7XG5leHBvcnRzLldBU0lfRU5PVFJFQ09WRVJBQkxFID0gNTY7XG5leHBvcnRzLldBU0lfRU5PVFNPQ0sgPSA1NztcbmV4cG9ydHMuV0FTSV9FTk9UU1VQID0gNTg7XG5leHBvcnRzLldBU0lfRU5PVFRZID0gNTk7XG5leHBvcnRzLldBU0lfRU5YSU8gPSA2MDtcbmV4cG9ydHMuV0FTSV9FT1ZFUkZMT1cgPSA2MTtcbmV4cG9ydHMuV0FTSV9FT1dORVJERUFEID0gNjI7XG5leHBvcnRzLldBU0lfRVBFUk0gPSA2MztcbmV4cG9ydHMuV0FTSV9FUElQRSA9IDY0O1xuZXhwb3J0cy5XQVNJX0VQUk9UTyA9IDY1O1xuZXhwb3J0cy5XQVNJX0VQUk9UT05PU1VQUE9SVCA9IDY2O1xuZXhwb3J0cy5XQVNJX0VQUk9UT1RZUEUgPSA2NztcbmV4cG9ydHMuV0FTSV9FUkFOR0UgPSA2ODtcbmV4cG9ydHMuV0FTSV9FUk9GUyA9IDY5O1xuZXhwb3J0cy5XQVNJX0VTUElQRSA9IDcwO1xuZXhwb3J0cy5XQVNJX0VTUkNIID0gNzE7XG5leHBvcnRzLldBU0lfRVNUQUxFID0gNzI7XG5leHBvcnRzLldBU0lfRVRJTUVET1VUID0gNzM7XG5leHBvcnRzLldBU0lfRVRYVEJTWSA9IDc0O1xuZXhwb3J0cy5XQVNJX0VYREVWID0gNzU7XG5leHBvcnRzLldBU0lfRU5PVENBUEFCTEUgPSA3NjtcbmV4cG9ydHMuV0FTSV9TSUdBQlJUID0gMDtcbmV4cG9ydHMuV0FTSV9TSUdBTFJNID0gMTtcbmV4cG9ydHMuV0FTSV9TSUdCVVMgPSAyO1xuZXhwb3J0cy5XQVNJX1NJR0NITEQgPSAzO1xuZXhwb3J0cy5XQVNJX1NJR0NPTlQgPSA0O1xuZXhwb3J0cy5XQVNJX1NJR0ZQRSA9IDU7XG5leHBvcnRzLldBU0lfU0lHSFVQID0gNjtcbmV4cG9ydHMuV0FTSV9TSUdJTEwgPSA3O1xuZXhwb3J0cy5XQVNJX1NJR0lOVCA9IDg7XG5leHBvcnRzLldBU0lfU0lHS0lMTCA9IDk7XG5leHBvcnRzLldBU0lfU0lHUElQRSA9IDEwO1xuZXhwb3J0cy5XQVNJX1NJR1FVSVQgPSAxMTtcbmV4cG9ydHMuV0FTSV9TSUdTRUdWID0gMTI7XG5leHBvcnRzLldBU0lfU0lHU1RPUCA9IDEzO1xuZXhwb3J0cy5XQVNJX1NJR1RFUk0gPSAxNDtcbmV4cG9ydHMuV0FTSV9TSUdUUkFQID0gMTU7XG5leHBvcnRzLldBU0lfU0lHVFNUUCA9IDE2O1xuZXhwb3J0cy5XQVNJX1NJR1RUSU4gPSAxNztcbmV4cG9ydHMuV0FTSV9TSUdUVE9VID0gMTg7XG5leHBvcnRzLldBU0lfU0lHVVJHID0gMTk7XG5leHBvcnRzLldBU0lfU0lHVVNSMSA9IDIwO1xuZXhwb3J0cy5XQVNJX1NJR1VTUjIgPSAyMTtcbmV4cG9ydHMuV0FTSV9TSUdWVEFMUk0gPSAyMjtcbmV4cG9ydHMuV0FTSV9TSUdYQ1BVID0gMjM7XG5leHBvcnRzLldBU0lfU0lHWEZTWiA9IDI0O1xuZXhwb3J0cy5XQVNJX0ZJTEVUWVBFX1VOS05PV04gPSAwO1xuZXhwb3J0cy5XQVNJX0ZJTEVUWVBFX0JMT0NLX0RFVklDRSA9IDE7XG5leHBvcnRzLldBU0lfRklMRVRZUEVfQ0hBUkFDVEVSX0RFVklDRSA9IDI7XG5leHBvcnRzLldBU0lfRklMRVRZUEVfRElSRUNUT1JZID0gMztcbmV4cG9ydHMuV0FTSV9GSUxFVFlQRV9SRUdVTEFSX0ZJTEUgPSA0O1xuZXhwb3J0cy5XQVNJX0ZJTEVUWVBFX1NPQ0tFVF9ER1JBTSA9IDU7XG5leHBvcnRzLldBU0lfRklMRVRZUEVfU09DS0VUX1NUUkVBTSA9IDY7XG5leHBvcnRzLldBU0lfRklMRVRZUEVfU1lNQk9MSUNfTElOSyA9IDc7XG5leHBvcnRzLldBU0lfRkRGTEFHX0FQUEVORCA9IDB4MDAwMTtcbmV4cG9ydHMuV0FTSV9GREZMQUdfRFNZTkMgPSAweDAwMDI7XG5leHBvcnRzLldBU0lfRkRGTEFHX05PTkJMT0NLID0gMHgwMDA0O1xuZXhwb3J0cy5XQVNJX0ZERkxBR19SU1lOQyA9IDB4MDAwODtcbmV4cG9ydHMuV0FTSV9GREZMQUdfU1lOQyA9IDB4MDAxMDtcbmV4cG9ydHMuV0FTSV9SSUdIVF9GRF9EQVRBU1lOQyA9IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKDB4MDAwMDAwMDAwMDAwMDAwMSk7XG5leHBvcnRzLldBU0lfUklHSFRfRkRfUkVBRCA9IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKDB4MDAwMDAwMDAwMDAwMDAwMik7XG5leHBvcnRzLldBU0lfUklHSFRfRkRfU0VFSyA9IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKDB4MDAwMDAwMDAwMDAwMDAwNCk7XG5leHBvcnRzLldBU0lfUklHSFRfRkRfRkRTVEFUX1NFVF9GTEFHUyA9IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKDB4MDAwMDAwMDAwMDAwMDAwOCk7XG5leHBvcnRzLldBU0lfUklHSFRfRkRfU1lOQyA9IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKDB4MDAwMDAwMDAwMDAwMDAxMCk7XG5leHBvcnRzLldBU0lfUklHSFRfRkRfVEVMTCA9IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKDB4MDAwMDAwMDAwMDAwMDAyMCk7XG5leHBvcnRzLldBU0lfUklHSFRfRkRfV1JJVEUgPSBiaWdpbnRfMS5CaWdJbnRQb2x5ZmlsbCgweDAwMDAwMDAwMDAwMDAwNDApO1xuZXhwb3J0cy5XQVNJX1JJR0hUX0ZEX0FEVklTRSA9IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKDB4MDAwMDAwMDAwMDAwMDA4MCk7XG5leHBvcnRzLldBU0lfUklHSFRfRkRfQUxMT0NBVEUgPSBiaWdpbnRfMS5CaWdJbnRQb2x5ZmlsbCgweDAwMDAwMDAwMDAwMDAxMDApO1xuZXhwb3J0cy5XQVNJX1JJR0hUX1BBVEhfQ1JFQVRFX0RJUkVDVE9SWSA9IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKDB4MDAwMDAwMDAwMDAwMDIwMCk7XG5leHBvcnRzLldBU0lfUklHSFRfUEFUSF9DUkVBVEVfRklMRSA9IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKDB4MDAwMDAwMDAwMDAwMDQwMCk7XG5leHBvcnRzLldBU0lfUklHSFRfUEFUSF9MSU5LX1NPVVJDRSA9IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKDB4MDAwMDAwMDAwMDAwMDgwMCk7XG5leHBvcnRzLldBU0lfUklHSFRfUEFUSF9MSU5LX1RBUkdFVCA9IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKDB4MDAwMDAwMDAwMDAwMTAwMCk7XG5leHBvcnRzLldBU0lfUklHSFRfUEFUSF9PUEVOID0gYmlnaW50XzEuQmlnSW50UG9seWZpbGwoMHgwMDAwMDAwMDAwMDAyMDAwKTtcbmV4cG9ydHMuV0FTSV9SSUdIVF9GRF9SRUFERElSID0gYmlnaW50XzEuQmlnSW50UG9seWZpbGwoMHgwMDAwMDAwMDAwMDA0MDAwKTtcbmV4cG9ydHMuV0FTSV9SSUdIVF9QQVRIX1JFQURMSU5LID0gYmlnaW50XzEuQmlnSW50UG9seWZpbGwoMHgwMDAwMDAwMDAwMDA4MDAwKTtcbmV4cG9ydHMuV0FTSV9SSUdIVF9QQVRIX1JFTkFNRV9TT1VSQ0UgPSBiaWdpbnRfMS5CaWdJbnRQb2x5ZmlsbCgweDAwMDAwMDAwMDAwMTAwMDApO1xuZXhwb3J0cy5XQVNJX1JJR0hUX1BBVEhfUkVOQU1FX1RBUkdFVCA9IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKDB4MDAwMDAwMDAwMDAyMDAwMCk7XG5leHBvcnRzLldBU0lfUklHSFRfUEFUSF9GSUxFU1RBVF9HRVQgPSBiaWdpbnRfMS5CaWdJbnRQb2x5ZmlsbCgweDAwMDAwMDAwMDAwNDAwMDApO1xuZXhwb3J0cy5XQVNJX1JJR0hUX1BBVEhfRklMRVNUQVRfU0VUX1NJWkUgPSBiaWdpbnRfMS5CaWdJbnRQb2x5ZmlsbCgweDAwMDAwMDAwMDAwODAwMDApO1xuZXhwb3J0cy5XQVNJX1JJR0hUX1BBVEhfRklMRVNUQVRfU0VUX1RJTUVTID0gYmlnaW50XzEuQmlnSW50UG9seWZpbGwoMHgwMDAwMDAwMDAwMTAwMDAwKTtcbmV4cG9ydHMuV0FTSV9SSUdIVF9GRF9GSUxFU1RBVF9HRVQgPSBiaWdpbnRfMS5CaWdJbnRQb2x5ZmlsbCgweDAwMDAwMDAwMDAyMDAwMDApO1xuZXhwb3J0cy5XQVNJX1JJR0hUX0ZEX0ZJTEVTVEFUX1NFVF9TSVpFID0gYmlnaW50XzEuQmlnSW50UG9seWZpbGwoMHgwMDAwMDAwMDAwNDAwMDAwKTtcbmV4cG9ydHMuV0FTSV9SSUdIVF9GRF9GSUxFU1RBVF9TRVRfVElNRVMgPSBiaWdpbnRfMS5CaWdJbnRQb2x5ZmlsbCgweDAwMDAwMDAwMDA4MDAwMDApO1xuZXhwb3J0cy5XQVNJX1JJR0hUX1BBVEhfU1lNTElOSyA9IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKDB4MDAwMDAwMDAwMTAwMDAwMCk7XG5leHBvcnRzLldBU0lfUklHSFRfUEFUSF9SRU1PVkVfRElSRUNUT1JZID0gYmlnaW50XzEuQmlnSW50UG9seWZpbGwoMHgwMDAwMDAwMDAyMDAwMDAwKTtcbmV4cG9ydHMuV0FTSV9SSUdIVF9QQVRIX1VOTElOS19GSUxFID0gYmlnaW50XzEuQmlnSW50UG9seWZpbGwoMHgwMDAwMDAwMDA0MDAwMDAwKTtcbmV4cG9ydHMuV0FTSV9SSUdIVF9QT0xMX0ZEX1JFQURXUklURSA9IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKDB4MDAwMDAwMDAwODAwMDAwMCk7XG5leHBvcnRzLldBU0lfUklHSFRfU09DS19TSFVURE9XTiA9IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKDB4MDAwMDAwMDAxMDAwMDAwMCk7XG5leHBvcnRzLlJJR0hUU19BTEwgPSBleHBvcnRzLldBU0lfUklHSFRfRkRfREFUQVNZTkMgfFxuICAgIGV4cG9ydHMuV0FTSV9SSUdIVF9GRF9SRUFEIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfRkRfU0VFSyB8XG4gICAgZXhwb3J0cy5XQVNJX1JJR0hUX0ZEX0ZEU1RBVF9TRVRfRkxBR1MgfFxuICAgIGV4cG9ydHMuV0FTSV9SSUdIVF9GRF9TWU5DIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfRkRfVEVMTCB8XG4gICAgZXhwb3J0cy5XQVNJX1JJR0hUX0ZEX1dSSVRFIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfRkRfQURWSVNFIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfRkRfQUxMT0NBVEUgfFxuICAgIGV4cG9ydHMuV0FTSV9SSUdIVF9QQVRIX0NSRUFURV9ESVJFQ1RPUlkgfFxuICAgIGV4cG9ydHMuV0FTSV9SSUdIVF9QQVRIX0NSRUFURV9GSUxFIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfUEFUSF9MSU5LX1NPVVJDRSB8XG4gICAgZXhwb3J0cy5XQVNJX1JJR0hUX1BBVEhfTElOS19UQVJHRVQgfFxuICAgIGV4cG9ydHMuV0FTSV9SSUdIVF9QQVRIX09QRU4gfFxuICAgIGV4cG9ydHMuV0FTSV9SSUdIVF9GRF9SRUFERElSIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfUEFUSF9SRUFETElOSyB8XG4gICAgZXhwb3J0cy5XQVNJX1JJR0hUX1BBVEhfUkVOQU1FX1NPVVJDRSB8XG4gICAgZXhwb3J0cy5XQVNJX1JJR0hUX1BBVEhfUkVOQU1FX1RBUkdFVCB8XG4gICAgZXhwb3J0cy5XQVNJX1JJR0hUX1BBVEhfRklMRVNUQVRfR0VUIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfUEFUSF9GSUxFU1RBVF9TRVRfU0laRSB8XG4gICAgZXhwb3J0cy5XQVNJX1JJR0hUX1BBVEhfRklMRVNUQVRfU0VUX1RJTUVTIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfRkRfRklMRVNUQVRfR0VUIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfRkRfRklMRVNUQVRfU0VUX1RJTUVTIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfRkRfRklMRVNUQVRfU0VUX1NJWkUgfFxuICAgIGV4cG9ydHMuV0FTSV9SSUdIVF9QQVRIX1NZTUxJTksgfFxuICAgIGV4cG9ydHMuV0FTSV9SSUdIVF9QQVRIX1VOTElOS19GSUxFIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfUEFUSF9SRU1PVkVfRElSRUNUT1JZIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfUE9MTF9GRF9SRUFEV1JJVEUgfFxuICAgIGV4cG9ydHMuV0FTSV9SSUdIVF9TT0NLX1NIVVRET1dOO1xuZXhwb3J0cy5SSUdIVFNfQkxPQ0tfREVWSUNFX0JBU0UgPSBleHBvcnRzLlJJR0hUU19BTEw7XG5leHBvcnRzLlJJR0hUU19CTE9DS19ERVZJQ0VfSU5IRVJJVElORyA9IGV4cG9ydHMuUklHSFRTX0FMTDtcbmV4cG9ydHMuUklHSFRTX0NIQVJBQ1RFUl9ERVZJQ0VfQkFTRSA9IGV4cG9ydHMuUklHSFRTX0FMTDtcbmV4cG9ydHMuUklHSFRTX0NIQVJBQ1RFUl9ERVZJQ0VfSU5IRVJJVElORyA9IGV4cG9ydHMuUklHSFRTX0FMTDtcbmV4cG9ydHMuUklHSFRTX1JFR1VMQVJfRklMRV9CQVNFID0gZXhwb3J0cy5XQVNJX1JJR0hUX0ZEX0RBVEFTWU5DIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfRkRfUkVBRCB8XG4gICAgZXhwb3J0cy5XQVNJX1JJR0hUX0ZEX1NFRUsgfFxuICAgIGV4cG9ydHMuV0FTSV9SSUdIVF9GRF9GRFNUQVRfU0VUX0ZMQUdTIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfRkRfU1lOQyB8XG4gICAgZXhwb3J0cy5XQVNJX1JJR0hUX0ZEX1RFTEwgfFxuICAgIGV4cG9ydHMuV0FTSV9SSUdIVF9GRF9XUklURSB8XG4gICAgZXhwb3J0cy5XQVNJX1JJR0hUX0ZEX0FEVklTRSB8XG4gICAgZXhwb3J0cy5XQVNJX1JJR0hUX0ZEX0FMTE9DQVRFIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfRkRfRklMRVNUQVRfR0VUIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfRkRfRklMRVNUQVRfU0VUX1NJWkUgfFxuICAgIGV4cG9ydHMuV0FTSV9SSUdIVF9GRF9GSUxFU1RBVF9TRVRfVElNRVMgfFxuICAgIGV4cG9ydHMuV0FTSV9SSUdIVF9QT0xMX0ZEX1JFQURXUklURTtcbmV4cG9ydHMuUklHSFRTX1JFR1VMQVJfRklMRV9JTkhFUklUSU5HID0gYmlnaW50XzEuQmlnSW50UG9seWZpbGwoMCk7XG5leHBvcnRzLlJJR0hUU19ESVJFQ1RPUllfQkFTRSA9IGV4cG9ydHMuV0FTSV9SSUdIVF9GRF9GRFNUQVRfU0VUX0ZMQUdTIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfRkRfU1lOQyB8XG4gICAgZXhwb3J0cy5XQVNJX1JJR0hUX0ZEX0FEVklTRSB8XG4gICAgZXhwb3J0cy5XQVNJX1JJR0hUX1BBVEhfQ1JFQVRFX0RJUkVDVE9SWSB8XG4gICAgZXhwb3J0cy5XQVNJX1JJR0hUX1BBVEhfQ1JFQVRFX0ZJTEUgfFxuICAgIGV4cG9ydHMuV0FTSV9SSUdIVF9QQVRIX0xJTktfU09VUkNFIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfUEFUSF9MSU5LX1RBUkdFVCB8XG4gICAgZXhwb3J0cy5XQVNJX1JJR0hUX1BBVEhfT1BFTiB8XG4gICAgZXhwb3J0cy5XQVNJX1JJR0hUX0ZEX1JFQURESVIgfFxuICAgIGV4cG9ydHMuV0FTSV9SSUdIVF9QQVRIX1JFQURMSU5LIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfUEFUSF9SRU5BTUVfU09VUkNFIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfUEFUSF9SRU5BTUVfVEFSR0VUIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfUEFUSF9GSUxFU1RBVF9HRVQgfFxuICAgIGV4cG9ydHMuV0FTSV9SSUdIVF9QQVRIX0ZJTEVTVEFUX1NFVF9TSVpFIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfUEFUSF9GSUxFU1RBVF9TRVRfVElNRVMgfFxuICAgIGV4cG9ydHMuV0FTSV9SSUdIVF9GRF9GSUxFU1RBVF9HRVQgfFxuICAgIGV4cG9ydHMuV0FTSV9SSUdIVF9GRF9GSUxFU1RBVF9TRVRfVElNRVMgfFxuICAgIGV4cG9ydHMuV0FTSV9SSUdIVF9QQVRIX1NZTUxJTksgfFxuICAgIGV4cG9ydHMuV0FTSV9SSUdIVF9QQVRIX1VOTElOS19GSUxFIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfUEFUSF9SRU1PVkVfRElSRUNUT1JZIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfUE9MTF9GRF9SRUFEV1JJVEU7XG5leHBvcnRzLlJJR0hUU19ESVJFQ1RPUllfSU5IRVJJVElORyA9IGV4cG9ydHMuUklHSFRTX0RJUkVDVE9SWV9CQVNFIHwgZXhwb3J0cy5SSUdIVFNfUkVHVUxBUl9GSUxFX0JBU0U7XG5leHBvcnRzLlJJR0hUU19TT0NLRVRfQkFTRSA9IGV4cG9ydHMuV0FTSV9SSUdIVF9GRF9SRUFEIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfRkRfRkRTVEFUX1NFVF9GTEFHUyB8XG4gICAgZXhwb3J0cy5XQVNJX1JJR0hUX0ZEX1dSSVRFIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfRkRfRklMRVNUQVRfR0VUIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfUE9MTF9GRF9SRUFEV1JJVEUgfFxuICAgIGV4cG9ydHMuV0FTSV9SSUdIVF9TT0NLX1NIVVRET1dOO1xuZXhwb3J0cy5SSUdIVFNfU09DS0VUX0lOSEVSSVRJTkcgPSBleHBvcnRzLlJJR0hUU19BTEw7XG5leHBvcnRzLlJJR0hUU19UVFlfQkFTRSA9IGV4cG9ydHMuV0FTSV9SSUdIVF9GRF9SRUFEIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfRkRfRkRTVEFUX1NFVF9GTEFHUyB8XG4gICAgZXhwb3J0cy5XQVNJX1JJR0hUX0ZEX1dSSVRFIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfRkRfRklMRVNUQVRfR0VUIHxcbiAgICBleHBvcnRzLldBU0lfUklHSFRfUE9MTF9GRF9SRUFEV1JJVEU7XG5leHBvcnRzLlJJR0hUU19UVFlfSU5IRVJJVElORyA9IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKDApO1xuZXhwb3J0cy5XQVNJX0NMT0NLX1JFQUxUSU1FID0gMDtcbmV4cG9ydHMuV0FTSV9DTE9DS19NT05PVE9OSUMgPSAxO1xuZXhwb3J0cy5XQVNJX0NMT0NLX1BST0NFU1NfQ1BVVElNRV9JRCA9IDI7XG5leHBvcnRzLldBU0lfQ0xPQ0tfVEhSRUFEX0NQVVRJTUVfSUQgPSAzO1xuZXhwb3J0cy5XQVNJX0VWRU5UVFlQRV9DTE9DSyA9IDA7XG5leHBvcnRzLldBU0lfRVZFTlRUWVBFX0ZEX1JFQUQgPSAxO1xuZXhwb3J0cy5XQVNJX0VWRU5UVFlQRV9GRF9XUklURSA9IDI7XG5leHBvcnRzLldBU0lfRklMRVNUQVRfU0VUX0FUSU0gPSAxIDw8IDA7XG5leHBvcnRzLldBU0lfRklMRVNUQVRfU0VUX0FUSU1fTk9XID0gMSA8PCAxO1xuZXhwb3J0cy5XQVNJX0ZJTEVTVEFUX1NFVF9NVElNID0gMSA8PCAyO1xuZXhwb3J0cy5XQVNJX0ZJTEVTVEFUX1NFVF9NVElNX05PVyA9IDEgPDwgMztcbmV4cG9ydHMuV0FTSV9PX0NSRUFUID0gMSA8PCAwO1xuZXhwb3J0cy5XQVNJX09fRElSRUNUT1JZID0gMSA8PCAxO1xuZXhwb3J0cy5XQVNJX09fRVhDTCA9IDEgPDwgMjtcbmV4cG9ydHMuV0FTSV9PX1RSVU5DID0gMSA8PCAzO1xuZXhwb3J0cy5XQVNJX1BSRU9QRU5UWVBFX0RJUiA9IDA7XG5leHBvcnRzLldBU0lfRElSQ09PS0lFX1NUQVJUID0gMDtcbmV4cG9ydHMuV0FTSV9TVERJTl9GSUxFTk8gPSAwO1xuZXhwb3J0cy5XQVNJX1NURE9VVF9GSUxFTk8gPSAxO1xuZXhwb3J0cy5XQVNJX1NUREVSUl9GSUxFTk8gPSAyO1xuZXhwb3J0cy5XQVNJX1dIRU5DRV9TRVQgPSAwO1xuZXhwb3J0cy5XQVNJX1dIRU5DRV9DVVIgPSAxO1xuZXhwb3J0cy5XQVNJX1dIRU5DRV9FTkQgPSAyO1xuLy8gaHR0cDovL21hbjcub3JnL2xpbnV4L21hbi1wYWdlcy9tYW4zL2Vycm5vLjMuaHRtbFxuZXhwb3J0cy5FUlJPUl9NQVAgPSB7XG4gICAgRTJCSUc6IGV4cG9ydHMuV0FTSV9FMkJJRyxcbiAgICBFQUNDRVM6IGV4cG9ydHMuV0FTSV9FQUNDRVMsXG4gICAgRUFERFJJTlVTRTogZXhwb3J0cy5XQVNJX0VBRERSSU5VU0UsXG4gICAgRUFERFJOT1RBVkFJTDogZXhwb3J0cy5XQVNJX0VBRERSTk9UQVZBSUwsXG4gICAgRUFGTk9TVVBQT1JUOiBleHBvcnRzLldBU0lfRUFGTk9TVVBQT1JULFxuICAgIEVBTFJFQURZOiBleHBvcnRzLldBU0lfRUFMUkVBRFksXG4gICAgRUFHQUlOOiBleHBvcnRzLldBU0lfRUFHQUlOLFxuICAgIC8vIEVCQURFOiBXQVNJX0VCQURFLFxuICAgIEVCQURGOiBleHBvcnRzLldBU0lfRUJBREYsXG4gICAgLy8gRUJBREZEOiBXQVNJX0VCQURGRCxcbiAgICBFQkFETVNHOiBleHBvcnRzLldBU0lfRUJBRE1TRyxcbiAgICAvLyBFQkFEUjogV0FTSV9FQkFEUixcbiAgICAvLyBFQkFEUlFDOiBXQVNJX0VCQURSUUMsXG4gICAgLy8gRUJBRFNMVDogV0FTSV9FQkFEU0xULFxuICAgIEVCVVNZOiBleHBvcnRzLldBU0lfRUJVU1ksXG4gICAgRUNBTkNFTEVEOiBleHBvcnRzLldBU0lfRUNBTkNFTEVELFxuICAgIEVDSElMRDogZXhwb3J0cy5XQVNJX0VDSElMRCxcbiAgICAvLyBFQ0hSTkc6IFdBU0lfRUNIUk5HLFxuICAgIC8vIEVDT01NOiBXQVNJX0VDT01NLFxuICAgIEVDT05OQUJPUlRFRDogZXhwb3J0cy5XQVNJX0VDT05OQUJPUlRFRCxcbiAgICBFQ09OTlJFRlVTRUQ6IGV4cG9ydHMuV0FTSV9FQ09OTlJFRlVTRUQsXG4gICAgRUNPTk5SRVNFVDogZXhwb3J0cy5XQVNJX0VDT05OUkVTRVQsXG4gICAgRURFQURMT0NLOiBleHBvcnRzLldBU0lfRURFQURMSyxcbiAgICBFREVTVEFERFJSRVE6IGV4cG9ydHMuV0FTSV9FREVTVEFERFJSRVEsXG4gICAgRURPTTogZXhwb3J0cy5XQVNJX0VET00sXG4gICAgRURRVU9UOiBleHBvcnRzLldBU0lfRURRVU9ULFxuICAgIEVFWElTVDogZXhwb3J0cy5XQVNJX0VFWElTVCxcbiAgICBFRkFVTFQ6IGV4cG9ydHMuV0FTSV9FRkFVTFQsXG4gICAgRUZCSUc6IGV4cG9ydHMuV0FTSV9FRkJJRyxcbiAgICBFSE9TVERPV046IGV4cG9ydHMuV0FTSV9FSE9TVFVOUkVBQ0gsXG4gICAgRUhPU1RVTlJFQUNIOiBleHBvcnRzLldBU0lfRUhPU1RVTlJFQUNILFxuICAgIC8vIEVIV1BPSVNPTjogV0FTSV9FSFdQT0lTT04sXG4gICAgRUlEUk06IGV4cG9ydHMuV0FTSV9FSURSTSxcbiAgICBFSUxTRVE6IGV4cG9ydHMuV0FTSV9FSUxTRVEsXG4gICAgRUlOUFJPR1JFU1M6IGV4cG9ydHMuV0FTSV9FSU5QUk9HUkVTUyxcbiAgICBFSU5UUjogZXhwb3J0cy5XQVNJX0VJTlRSLFxuICAgIEVJTlZBTDogZXhwb3J0cy5XQVNJX0VJTlZBTCxcbiAgICBFSU86IGV4cG9ydHMuV0FTSV9FSU8sXG4gICAgRUlTQ09OTjogZXhwb3J0cy5XQVNJX0VJU0NPTk4sXG4gICAgRUlTRElSOiBleHBvcnRzLldBU0lfRUlTRElSLFxuICAgIEVMT09QOiBleHBvcnRzLldBU0lfRUxPT1AsXG4gICAgRU1GSUxFOiBleHBvcnRzLldBU0lfRU1GSUxFLFxuICAgIEVNTElOSzogZXhwb3J0cy5XQVNJX0VNTElOSyxcbiAgICBFTVNHU0laRTogZXhwb3J0cy5XQVNJX0VNU0dTSVpFLFxuICAgIEVNVUxUSUhPUDogZXhwb3J0cy5XQVNJX0VNVUxUSUhPUCxcbiAgICBFTkFNRVRPT0xPTkc6IGV4cG9ydHMuV0FTSV9FTkFNRVRPT0xPTkcsXG4gICAgRU5FVERPV046IGV4cG9ydHMuV0FTSV9FTkVURE9XTixcbiAgICBFTkVUUkVTRVQ6IGV4cG9ydHMuV0FTSV9FTkVUUkVTRVQsXG4gICAgRU5FVFVOUkVBQ0g6IGV4cG9ydHMuV0FTSV9FTkVUVU5SRUFDSCxcbiAgICBFTkZJTEU6IGV4cG9ydHMuV0FTSV9FTkZJTEUsXG4gICAgRU5PQlVGUzogZXhwb3J0cy5XQVNJX0VOT0JVRlMsXG4gICAgRU5PREVWOiBleHBvcnRzLldBU0lfRU5PREVWLFxuICAgIEVOT0VOVDogZXhwb3J0cy5XQVNJX0VOT0VOVCxcbiAgICBFTk9FWEVDOiBleHBvcnRzLldBU0lfRU5PRVhFQyxcbiAgICBFTk9MQ0s6IGV4cG9ydHMuV0FTSV9FTk9MQ0ssXG4gICAgRU5PTElOSzogZXhwb3J0cy5XQVNJX0VOT0xJTkssXG4gICAgRU5PTUVNOiBleHBvcnRzLldBU0lfRU5PTUVNLFxuICAgIEVOT01TRzogZXhwb3J0cy5XQVNJX0VOT01TRyxcbiAgICBFTk9QUk9UT09QVDogZXhwb3J0cy5XQVNJX0VOT1BST1RPT1BULFxuICAgIEVOT1NQQzogZXhwb3J0cy5XQVNJX0VOT1NQQyxcbiAgICBFTk9TWVM6IGV4cG9ydHMuV0FTSV9FTk9TWVMsXG4gICAgRU5PVENPTk46IGV4cG9ydHMuV0FTSV9FTk9UQ09OTixcbiAgICBFTk9URElSOiBleHBvcnRzLldBU0lfRU5PVERJUixcbiAgICBFTk9URU1QVFk6IGV4cG9ydHMuV0FTSV9FTk9URU1QVFksXG4gICAgRU5PVFJFQ09WRVJBQkxFOiBleHBvcnRzLldBU0lfRU5PVFJFQ09WRVJBQkxFLFxuICAgIEVOT1RTT0NLOiBleHBvcnRzLldBU0lfRU5PVFNPQ0ssXG4gICAgRU5PVFRZOiBleHBvcnRzLldBU0lfRU5PVFRZLFxuICAgIEVOWElPOiBleHBvcnRzLldBU0lfRU5YSU8sXG4gICAgRU9WRVJGTE9XOiBleHBvcnRzLldBU0lfRU9WRVJGTE9XLFxuICAgIEVPV05FUkRFQUQ6IGV4cG9ydHMuV0FTSV9FT1dORVJERUFELFxuICAgIEVQRVJNOiBleHBvcnRzLldBU0lfRVBFUk0sXG4gICAgRVBJUEU6IGV4cG9ydHMuV0FTSV9FUElQRSxcbiAgICBFUFJPVE86IGV4cG9ydHMuV0FTSV9FUFJPVE8sXG4gICAgRVBST1RPTk9TVVBQT1JUOiBleHBvcnRzLldBU0lfRVBST1RPTk9TVVBQT1JULFxuICAgIEVQUk9UT1RZUEU6IGV4cG9ydHMuV0FTSV9FUFJPVE9UWVBFLFxuICAgIEVSQU5HRTogZXhwb3J0cy5XQVNJX0VSQU5HRSxcbiAgICBFUk9GUzogZXhwb3J0cy5XQVNJX0VST0ZTLFxuICAgIEVTUElQRTogZXhwb3J0cy5XQVNJX0VTUElQRSxcbiAgICBFU1JDSDogZXhwb3J0cy5XQVNJX0VTUkNILFxuICAgIEVTVEFMRTogZXhwb3J0cy5XQVNJX0VTVEFMRSxcbiAgICBFVElNRURPVVQ6IGV4cG9ydHMuV0FTSV9FVElNRURPVVQsXG4gICAgRVRYVEJTWTogZXhwb3J0cy5XQVNJX0VUWFRCU1ksXG4gICAgRVhERVY6IGV4cG9ydHMuV0FTSV9FWERFVlxufTtcbmV4cG9ydHMuU0lHTkFMX01BUCA9IChfYSA9IHt9LFxuICAgIF9hW2V4cG9ydHMuV0FTSV9TSUdIVVBdID0gXCJTSUdIVVBcIixcbiAgICBfYVtleHBvcnRzLldBU0lfU0lHSU5UXSA9IFwiU0lHSU5UXCIsXG4gICAgX2FbZXhwb3J0cy5XQVNJX1NJR1FVSVRdID0gXCJTSUdRVUlUXCIsXG4gICAgX2FbZXhwb3J0cy5XQVNJX1NJR0lMTF0gPSBcIlNJR0lMTFwiLFxuICAgIF9hW2V4cG9ydHMuV0FTSV9TSUdUUkFQXSA9IFwiU0lHVFJBUFwiLFxuICAgIF9hW2V4cG9ydHMuV0FTSV9TSUdBQlJUXSA9IFwiU0lHQUJSVFwiLFxuICAgIF9hW2V4cG9ydHMuV0FTSV9TSUdCVVNdID0gXCJTSUdCVVNcIixcbiAgICBfYVtleHBvcnRzLldBU0lfU0lHRlBFXSA9IFwiU0lHRlBFXCIsXG4gICAgX2FbZXhwb3J0cy5XQVNJX1NJR0tJTExdID0gXCJTSUdLSUxMXCIsXG4gICAgX2FbZXhwb3J0cy5XQVNJX1NJR1VTUjFdID0gXCJTSUdVU1IxXCIsXG4gICAgX2FbZXhwb3J0cy5XQVNJX1NJR1NFR1ZdID0gXCJTSUdTRUdWXCIsXG4gICAgX2FbZXhwb3J0cy5XQVNJX1NJR1VTUjJdID0gXCJTSUdVU1IyXCIsXG4gICAgX2FbZXhwb3J0cy5XQVNJX1NJR1BJUEVdID0gXCJTSUdQSVBFXCIsXG4gICAgX2FbZXhwb3J0cy5XQVNJX1NJR0FMUk1dID0gXCJTSUdBTFJNXCIsXG4gICAgX2FbZXhwb3J0cy5XQVNJX1NJR1RFUk1dID0gXCJTSUdURVJNXCIsXG4gICAgX2FbZXhwb3J0cy5XQVNJX1NJR0NITERdID0gXCJTSUdDSExEXCIsXG4gICAgX2FbZXhwb3J0cy5XQVNJX1NJR0NPTlRdID0gXCJTSUdDT05UXCIsXG4gICAgX2FbZXhwb3J0cy5XQVNJX1NJR1NUT1BdID0gXCJTSUdTVE9QXCIsXG4gICAgX2FbZXhwb3J0cy5XQVNJX1NJR1RTVFBdID0gXCJTSUdUU1RQXCIsXG4gICAgX2FbZXhwb3J0cy5XQVNJX1NJR1RUSU5dID0gXCJTSUdUVElOXCIsXG4gICAgX2FbZXhwb3J0cy5XQVNJX1NJR1RUT1VdID0gXCJTSUdUVE9VXCIsXG4gICAgX2FbZXhwb3J0cy5XQVNJX1NJR1VSR10gPSBcIlNJR1VSR1wiLFxuICAgIF9hW2V4cG9ydHMuV0FTSV9TSUdYQ1BVXSA9IFwiU0lHWENQVVwiLFxuICAgIF9hW2V4cG9ydHMuV0FTSV9TSUdYRlNaXSA9IFwiU0lHWEZTWlwiLFxuICAgIF9hW2V4cG9ydHMuV0FTSV9TSUdWVEFMUk1dID0gXCJTSUdWVEFMUk1cIixcbiAgICBfYSk7XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9Ad2FzbWVyK3dhc2lAMC4xMi4wL25vZGVfbW9kdWxlcy9Ad2FzbWVyL3dhc2kvbGliL2NvbnN0YW50cy5qcz8iKTsKCi8qKiovIH0pLAoKLyoqKi8gIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9Ad2FzbWVyK3dhc2lAMC4xMi4wL25vZGVfbW9kdWxlcy9Ad2FzbWVyL3dhc2kvbGliL2luZGV4LmVzbS5qcyI6Ci8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqISpcCiAgISoqKiAvaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vQHdhc21lcit3YXNpQDAuMTIuMC9ub2RlX21vZHVsZXMvQHdhc21lci93YXNpL2xpYi9pbmRleC5lc20uanMgKioqIQogIFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKZXZhbCgiLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovKGZ1bmN0aW9uKGdsb2JhbCkge1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5XQVNJS2lsbEVycm9yID0gZXhwb3J0cy5XQVNJRXhpdEVycm9yID0gZXhwb3J0cy5XQVNJRXJyb3IgPSBleHBvcnRzLldBU0kgPSB2b2lkIDA7XG4vKlxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG5Db3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZVxudGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGVcbkxpY2Vuc2UgYXQgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblRISVMgQ09ERSBJUyBQUk9WSURFRCBPTiBBTiAqQVMgSVMqIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbktJTkQsIEVJVEhFUiBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBXSVRIT1VUIExJTUlUQVRJT04gQU5ZIElNUExJRURcbldBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBUSVRMRSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UsXG5NRVJDSEFOVEFCTElUWSBPUiBOT04tSU5GUklOR0VNRU5ULlxuXG5TZWUgdGhlIEFwYWNoZSBWZXJzaW9uIDIuMCBMaWNlbnNlIGZvciBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnNcbmFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuZnVuY3Rpb24gYWEoYSwgYikgeyBhYSA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCB7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChhLCBiKSB7IGEuX19wcm90b19fID0gYjsgfSB8fCBmdW5jdGlvbiAoYSwgYikgeyBmb3IgKHZhciBjIGluIGIpXG4gICAgYi5oYXNPd25Qcm9wZXJ0eShjKSAmJiAoYVtjXSA9IGJbY10pOyB9OyByZXR1cm4gYWEoYSwgYik7IH1cbmZ1bmN0aW9uIGJhKGEsIGIpIHsgZnVuY3Rpb24gYygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGE7IH0gYWEoYSwgYik7IGEucHJvdG90eXBlID0gbnVsbCA9PT0gYiA/IE9iamVjdC5jcmVhdGUoYikgOiAoYy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IGMpOyB9XG5mdW5jdGlvbiBjYShhKSB7IHZhciBiID0gXCJmdW5jdGlvblwiID09PSB0eXBlb2YgU3ltYm9sICYmIGFbU3ltYm9sLml0ZXJhdG9yXSwgYyA9IDA7IHJldHVybiBiID8gYi5jYWxsKGEpIDogeyBuZXh0OiBmdW5jdGlvbiAoKSB7IGEgJiYgYyA+PSBhLmxlbmd0aCAmJiAoYSA9IHZvaWQgMCk7IHJldHVybiB7IHZhbHVlOiBhICYmIGFbYysrXSwgZG9uZTogIWEgfTsgfSB9OyB9XG5mdW5jdGlvbiBkYShhLCBiKSB7IHZhciBjID0gXCJmdW5jdGlvblwiID09PSB0eXBlb2YgU3ltYm9sICYmIGFbU3ltYm9sLml0ZXJhdG9yXTsgaWYgKCFjKVxuICAgIHJldHVybiBhOyBhID0gYy5jYWxsKGEpOyB2YXIgZCwgZSA9IFtdOyB0cnkge1xuICAgIGZvciAoOyAodm9pZCAwID09PSBiIHx8IDAgPCBiLS0pICYmICEoZCA9IGEubmV4dCgpKS5kb25lOylcbiAgICAgICAgZS5wdXNoKGQudmFsdWUpO1xufVxuY2F0Y2ggKGcpIHtcbiAgICB2YXIgZiA9IHsgZXJyb3I6IGcgfTtcbn1cbmZpbmFsbHkge1xuICAgIHRyeSB7XG4gICAgICAgIGQgJiYgIWQuZG9uZSAmJiAoYyA9IGFbXCJyZXR1cm5cIl0pICYmIGMuY2FsbChhKTtcbiAgICB9XG4gICAgZmluYWxseSB7XG4gICAgICAgIGlmIChmKVxuICAgICAgICAgICAgdGhyb3cgZi5lcnJvcjtcbiAgICB9XG59IHJldHVybiBlOyB9XG5mdW5jdGlvbiBmYSgpIHsgZm9yICh2YXIgYSA9IFtdLCBiID0gMDsgYiA8IGFyZ3VtZW50cy5sZW5ndGg7IGIrKylcbiAgICBhID0gYS5jb25jYXQoZGEoYXJndW1lbnRzW2JdKSk7IHJldHVybiBhOyB9XG52YXIgaGEgPSBcInVuZGVmaW5lZFwiICE9PSB0eXBlb2YgZ2xvYmFsVGhpcyA/IGdsb2JhbFRoaXMgOiBcInVuZGVmaW5lZFwiICE9PSB0eXBlb2YgZ2xvYmFsID8gZ2xvYmFsIDoge30sIGsgPSBcInVuZGVmaW5lZFwiICE9PSB0eXBlb2YgQmlnSW50ID8gQmlnSW50IDogaGEuQmlnSW50IHx8IE51bWJlciwgaWEgPSBEYXRhVmlldztcbmlhLnByb3RvdHlwZS5zZXRCaWdVaW50NjQgfHwgKGlhLnByb3RvdHlwZS5zZXRCaWdVaW50NjQgPSBmdW5jdGlvbiAoYSwgYiwgYykgeyBpZiAoYiA8IE1hdGgucG93KDIsIDMyKSkge1xuICAgIGIgPSBOdW1iZXIoYik7XG4gICAgdmFyIGQgPSAwO1xufVxuZWxzZSB7XG4gICAgZCA9IGIudG9TdHJpbmcoMik7XG4gICAgYiA9IFwiXCI7XG4gICAgZm9yICh2YXIgZSA9IDA7IGUgPCA2NCAtIGQubGVuZ3RoOyBlKyspXG4gICAgICAgIGIgKz0gXCIwXCI7XG4gICAgYiArPSBkO1xuICAgIGQgPSBwYXJzZUludChiLnN1YnN0cmluZygwLCAzMiksIDIpO1xuICAgIGIgPSBwYXJzZUludChiLnN1YnN0cmluZygzMiksIDIpO1xufSB0aGlzLnNldFVpbnQzMihhICsgKGMgPyAwIDogNCksIGIsIGMpOyB0aGlzLnNldFVpbnQzMihhICsgKGMgPyA0IDogMCksIGQsIGMpOyB9LCBpYS5wcm90b3R5cGUuZ2V0QmlnVWludDY0ID0gZnVuY3Rpb24gKGEsIGIpIHsgdmFyIGMgPSB0aGlzLmdldFVpbnQzMihhICsgKGIgPyAwIDogNCksIGIpOyBhID0gdGhpcy5nZXRVaW50MzIoYSArIChiID8gNCA6IDApLCBiKTsgYyA9IGMudG9TdHJpbmcoMik7IGEgPSBhLnRvU3RyaW5nKDIpOyBiID0gXCJcIjsgZm9yICh2YXIgZCA9IDA7IGQgPCAzMiAtIGMubGVuZ3RoOyBkKyspXG4gICAgYiArPSBcIjBcIjsgcmV0dXJuIGsoXCIwYlwiICsgYSArIChiICsgYykpOyB9KTtcbnZhciBqYSA9IFwidW5kZWZpbmVkXCIgIT09IHR5cGVvZiBnbG9iYWwgPyBnbG9iYWwgOiBcInVuZGVmaW5lZFwiICE9PSB0eXBlb2Ygc2VsZiA/IHNlbGYgOiBcInVuZGVmaW5lZFwiICE9PSB0eXBlb2Ygd2luZG93ID8gd2luZG93IDoge30sIG0gPSBbXSwgdSA9IFtdLCBrYSA9IFwidW5kZWZpbmVkXCIgIT09IHR5cGVvZiBVaW50OEFycmF5ID8gVWludDhBcnJheSA6IEFycmF5LCBsYSA9ICExO1xuZnVuY3Rpb24gbWEoKSB7IGxhID0gITA7IGZvciAodmFyIGEgPSAwOyA2NCA+IGE7ICsrYSlcbiAgICBtW2FdID0gXCJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvXCJbYV0sIHVbXCJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvXCIuY2hhckNvZGVBdChhKV0gPSBhOyB1WzQ1XSA9IDYyOyB1Wzk1XSA9IDYzOyB9XG5mdW5jdGlvbiBuYShhLCBiLCBjKSB7IGZvciAodmFyIGQgPSBbXSwgZSA9IGI7IGUgPCBjOyBlICs9IDMpXG4gICAgYiA9IChhW2VdIDw8IDE2KSArIChhW2UgKyAxXSA8PCA4KSArIGFbZSArIDJdLCBkLnB1c2gobVtiID4+IDE4ICYgNjNdICsgbVtiID4+IDEyICYgNjNdICsgbVtiID4+IDYgJiA2M10gKyBtW2IgJiA2M10pOyByZXR1cm4gZC5qb2luKFwiXCIpOyB9XG5mdW5jdGlvbiBvYShhKSB7IGxhIHx8IG1hKCk7IGZvciAodmFyIGIgPSBhLmxlbmd0aCwgYyA9IGIgJSAzLCBkID0gXCJcIiwgZSA9IFtdLCBmID0gMCwgZyA9IGIgLSBjOyBmIDwgZzsgZiArPSAxNjM4MylcbiAgICBlLnB1c2gobmEoYSwgZiwgZiArIDE2MzgzID4gZyA/IGcgOiBmICsgMTYzODMpKTsgMSA9PT0gYyA/IChhID0gYVtiIC0gMV0sIGQgKz0gbVthID4+IDJdLCBkICs9IG1bYSA8PCA0ICYgNjNdLCBkICs9IFwiPT1cIikgOiAyID09PSBjICYmIChhID0gKGFbYiAtIDJdIDw8IDgpICsgYVtiIC0gMV0sIGQgKz0gbVthID4+IDEwXSwgZCArPSBtW2EgPj4gNCAmIDYzXSwgZCArPSBtW2EgPDwgMiAmIDYzXSwgZCArPSBcIj1cIik7IGUucHVzaChkKTsgcmV0dXJuIGUuam9pbihcIlwiKTsgfVxuZnVuY3Rpb24gcGEoYSwgYiwgYywgZCwgZSkgeyB2YXIgZiA9IDggKiBlIC0gZCAtIDE7IHZhciBnID0gKDEgPDwgZikgLSAxLCBoID0gZyA+PiAxLCBsID0gLTc7IGUgPSBjID8gZSAtIDEgOiAwOyB2YXIgbiA9IGMgPyAtMSA6IDEsIHIgPSBhW2IgKyBlXTsgZSArPSBuOyBjID0gciAmICgxIDw8IC1sKSAtIDE7IHIgPj49IC1sOyBmb3IgKGwgKz0gZjsgMCA8IGw7IGMgPSAyNTYgKiBjICsgYVtiICsgZV0sIGUgKz0gbiwgbCAtPSA4KVxuICAgIDsgZiA9IGMgJiAoMSA8PCAtbCkgLSAxOyBjID4+PSAtbDsgZm9yIChsICs9IGQ7IDAgPCBsOyBmID0gMjU2ICogZiArIGFbYiArIGVdLCBlICs9IG4sIGwgLT0gOClcbiAgICA7IGlmICgwID09PSBjKVxuICAgIGMgPSAxIC0gaDtcbmVsc2Uge1xuICAgIGlmIChjID09PSBnKVxuICAgICAgICByZXR1cm4gZiA/IE5hTiA6IEluZmluaXR5ICogKHIgPyAtMSA6IDEpO1xuICAgIGYgKz0gTWF0aC5wb3coMiwgZCk7XG4gICAgYyAtPSBoO1xufSByZXR1cm4gKHIgPyAtMSA6IDEpICogZiAqIE1hdGgucG93KDIsIGMgLSBkKTsgfVxuZnVuY3Rpb24gcWEoYSwgYiwgYywgZCwgZSwgZikge1xuICAgIHZhciBnLCBoID0gOCAqIGYgLSBlIC0gMSwgbCA9ICgxIDw8IGgpIC0gMSwgbiA9IGwgPj4gMSwgciA9IDIzID09PSBlID8gTWF0aC5wb3coMiwgLTI0KSAtIE1hdGgucG93KDIsIC03NykgOiAwO1xuICAgIGYgPSBkID8gMCA6IGYgLSAxO1xuICAgIHZhciBwID0gZCA/IDEgOiAtMSwgeSA9IDAgPiBiIHx8IDAgPT09IGIgJiYgMCA+IDEgLyBiID8gMSA6IDA7XG4gICAgYiA9IE1hdGguYWJzKGIpO1xuICAgIGlzTmFOKGIpIHx8IEluZmluaXR5ID09PSBiID8gKGIgPSBpc05hTihiKSA/IDEgOiAwLCBkID0gbCkgOiAoZCA9IE1hdGguZmxvb3IoTWF0aC5sb2coYikgLyBNYXRoLkxOMiksIDEgPiBiICogKGcgPSBNYXRoLnBvdygyLCAtZCkpICYmIChkLS0sIGcgKj0gMiksIGIgPSAxIDw9IGQgKyBuID8gYiArIHIgLyBnIDogYiArIHIgKiBNYXRoLnBvdygyLCAxIC0gbiksIDIgPD0gYiAqIGcgJiYgKGQrKywgZyAvPSAyKSwgZCArIG4gPj0gbCA/IChiID0gMCwgZCA9IGwpIDogMSA8PSBkICsgbiA/IChiID0gKGIgKiBnIC0gMSkgKiBNYXRoLnBvdygyLCBlKSwgZCArPSBuKSA6IChiID0gYiAqIE1hdGgucG93KDIsIG4gLSAxKSAqIE1hdGgucG93KDIsIGUpLCBkID0gMCkpO1xuICAgIGZvciAoOyA4IDw9IGU7IGFbYyArIGZdID0gYiAmIDI1NSwgZiArPSBwLCBiIC89IDI1NiwgZSAtPSA4KVxuICAgICAgICA7XG4gICAgZCA9IGQgPDwgZSB8IGI7XG4gICAgZm9yIChoICs9IGU7IDAgPCBoOyBhW2MgKyBmXSA9IGQgJiAyNTUsXG4gICAgICAgIGYgKz0gcCwgZCAvPSAyNTYsIGggLT0gOClcbiAgICAgICAgO1xuICAgIGFbYyArIGYgLSBwXSB8PSAxMjggKiB5O1xufVxudmFyIHJhID0ge30udG9TdHJpbmcsIHNhID0gQXJyYXkuaXNBcnJheSB8fCBmdW5jdGlvbiAoYSkgeyByZXR1cm4gXCJbb2JqZWN0IEFycmF5XVwiID09IHJhLmNhbGwoYSk7IH07XG52LlRZUEVEX0FSUkFZX1NVUFBPUlQgPSB2b2lkIDAgIT09IGphLlRZUEVEX0FSUkFZX1NVUFBPUlQgPyBqYS5UWVBFRF9BUlJBWV9TVVBQT1JUIDogITA7XG52YXIgdGEgPSB2LlRZUEVEX0FSUkFZX1NVUFBPUlQgPyAyMTQ3NDgzNjQ3IDogMTA3Mzc0MTgyMztcbmZ1bmN0aW9uIHcoYSwgYikgeyBpZiAoKHYuVFlQRURfQVJSQVlfU1VQUE9SVCA/IDIxNDc0ODM2NDcgOiAxMDczNzQxODIzKSA8IGIpXG4gICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJJbnZhbGlkIHR5cGVkIGFycmF5IGxlbmd0aFwiKTsgdi5UWVBFRF9BUlJBWV9TVVBQT1JUID8gKGEgPSBuZXcgVWludDhBcnJheShiKSwgYS5fX3Byb3RvX18gPSB2LnByb3RvdHlwZSkgOiAobnVsbCA9PT0gYSAmJiAoYSA9IG5ldyB2KGIpKSwgYS5sZW5ndGggPSBiKTsgcmV0dXJuIGE7IH1cbmZ1bmN0aW9uIHYoYSwgYiwgYykgeyBpZiAoISh2LlRZUEVEX0FSUkFZX1NVUFBPUlQgfHwgdGhpcyBpbnN0YW5jZW9mIHYpKVxuICAgIHJldHVybiBuZXcgdihhLCBiLCBjKTsgaWYgKFwibnVtYmVyXCIgPT09IHR5cGVvZiBhKSB7XG4gICAgaWYgKFwic3RyaW5nXCIgPT09IHR5cGVvZiBiKVxuICAgICAgICB0aHJvdyBFcnJvcihcIklmIGVuY29kaW5nIGlzIHNwZWNpZmllZCB0aGVuIHRoZSBmaXJzdCBhcmd1bWVudCBtdXN0IGJlIGEgc3RyaW5nXCIpO1xuICAgIHJldHVybiB2YSh0aGlzLCBhKTtcbn0gcmV0dXJuIHdhKHRoaXMsIGEsIGIsIGMpOyB9XG52LnBvb2xTaXplID0gODE5MjtcbnYuX2F1Z21lbnQgPSBmdW5jdGlvbiAoYSkgeyBhLl9fcHJvdG9fXyA9IHYucHJvdG90eXBlOyByZXR1cm4gYTsgfTtcbmZ1bmN0aW9uIHdhKGEsIGIsIGMsIGQpIHtcbiAgICBpZiAoXCJudW1iZXJcIiA9PT0gdHlwZW9mIGIpXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1widmFsdWVcIiBhcmd1bWVudCBtdXN0IG5vdCBiZSBhIG51bWJlcicpO1xuICAgIGlmIChcInVuZGVmaW5lZFwiICE9PSB0eXBlb2YgQXJyYXlCdWZmZXIgJiYgYiBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSB7XG4gICAgICAgIGIuYnl0ZUxlbmd0aDtcbiAgICAgICAgaWYgKDAgPiBjIHx8IGIuYnl0ZUxlbmd0aCA8IGMpXG4gICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIidvZmZzZXQnIGlzIG91dCBvZiBib3VuZHNcIik7XG4gICAgICAgIGlmIChiLmJ5dGVMZW5ndGggPCBjICsgKGQgfHwgMCkpXG4gICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIidsZW5ndGgnIGlzIG91dCBvZiBib3VuZHNcIik7XG4gICAgICAgIGIgPSB2b2lkIDAgPT09IGMgJiYgdm9pZCAwID09PSBkID8gbmV3IFVpbnQ4QXJyYXkoYikgOiB2b2lkIDAgPT09IGQgPyBuZXcgVWludDhBcnJheShiLCBjKSA6IG5ldyBVaW50OEFycmF5KGIsIGMsIGQpO1xuICAgICAgICB2LlRZUEVEX0FSUkFZX1NVUFBPUlQgPyAoYSA9IGIsIGEuX19wcm90b19fID0gdi5wcm90b3R5cGUpIDogYSA9IHhhKGEsIGIpO1xuICAgICAgICByZXR1cm4gYTtcbiAgICB9XG4gICAgaWYgKFwic3RyaW5nXCIgPT09XG4gICAgICAgIHR5cGVvZiBiKSB7XG4gICAgICAgIGQgPSBhO1xuICAgICAgICBhID0gYztcbiAgICAgICAgaWYgKFwic3RyaW5nXCIgIT09IHR5cGVvZiBhIHx8IFwiXCIgPT09IGEpXG4gICAgICAgICAgICBhID0gXCJ1dGY4XCI7XG4gICAgICAgIGlmICghdi5pc0VuY29kaW5nKGEpKVxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignXCJlbmNvZGluZ1wiIG11c3QgYmUgYSB2YWxpZCBzdHJpbmcgZW5jb2RpbmcnKTtcbiAgICAgICAgYyA9IHlhKGIsIGEpIHwgMDtcbiAgICAgICAgZCA9IHcoZCwgYyk7XG4gICAgICAgIGIgPSBkLndyaXRlKGIsIGEpO1xuICAgICAgICBiICE9PSBjICYmIChkID0gZC5zbGljZSgwLCBiKSk7XG4gICAgICAgIHJldHVybiBkO1xuICAgIH1cbiAgICByZXR1cm4gemEoYSwgYik7XG59XG52LmZyb20gPSBmdW5jdGlvbiAoYSwgYiwgYykgeyByZXR1cm4gd2EobnVsbCwgYSwgYiwgYyk7IH07XG52LlRZUEVEX0FSUkFZX1NVUFBPUlQgJiYgKHYucHJvdG90eXBlLl9fcHJvdG9fXyA9IFVpbnQ4QXJyYXkucHJvdG90eXBlLCB2Ll9fcHJvdG9fXyA9IFVpbnQ4QXJyYXkpO1xuZnVuY3Rpb24gQWEoYSkgeyBpZiAoXCJudW1iZXJcIiAhPT0gdHlwZW9mIGEpXG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcignXCJzaXplXCIgYXJndW1lbnQgbXVzdCBiZSBhIG51bWJlcicpOyBpZiAoMCA+IGEpXG4gICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ1wic2l6ZVwiIGFyZ3VtZW50IG11c3Qgbm90IGJlIG5lZ2F0aXZlJyk7IH1cbnYuYWxsb2MgPSBmdW5jdGlvbiAoYSwgYiwgYykgeyBBYShhKTsgYSA9IDAgPj0gYSA/IHcobnVsbCwgYSkgOiB2b2lkIDAgIT09IGIgPyBcInN0cmluZ1wiID09PSB0eXBlb2YgYyA/IHcobnVsbCwgYSkuZmlsbChiLCBjKSA6IHcobnVsbCwgYSkuZmlsbChiKSA6IHcobnVsbCwgYSk7IHJldHVybiBhOyB9O1xuZnVuY3Rpb24gdmEoYSwgYikgeyBBYShiKTsgYSA9IHcoYSwgMCA+IGIgPyAwIDogQmEoYikgfCAwKTsgaWYgKCF2LlRZUEVEX0FSUkFZX1NVUFBPUlQpXG4gICAgZm9yICh2YXIgYyA9IDA7IGMgPCBiOyArK2MpXG4gICAgICAgIGFbY10gPSAwOyByZXR1cm4gYTsgfVxudi5hbGxvY1Vuc2FmZSA9IGZ1bmN0aW9uIChhKSB7IHJldHVybiB2YShudWxsLCBhKTsgfTtcbnYuYWxsb2NVbnNhZmVTbG93ID0gZnVuY3Rpb24gKGEpIHsgcmV0dXJuIHZhKG51bGwsIGEpOyB9O1xuZnVuY3Rpb24geGEoYSwgYikgeyB2YXIgYyA9IDAgPiBiLmxlbmd0aCA/IDAgOiBCYShiLmxlbmd0aCkgfCAwOyBhID0gdyhhLCBjKTsgZm9yICh2YXIgZCA9IDA7IGQgPCBjOyBkICs9IDEpXG4gICAgYVtkXSA9IGJbZF0gJiAyNTU7IHJldHVybiBhOyB9XG5mdW5jdGlvbiB6YShhLCBiKSB7IGlmICh6KGIpKSB7XG4gICAgdmFyIGMgPSBCYShiLmxlbmd0aCkgfCAwO1xuICAgIGEgPSB3KGEsIGMpO1xuICAgIGlmICgwID09PSBhLmxlbmd0aClcbiAgICAgICAgcmV0dXJuIGE7XG4gICAgYi5jb3B5KGEsIDAsIDAsIGMpO1xuICAgIHJldHVybiBhO1xufSBpZiAoYikge1xuICAgIGlmIChcInVuZGVmaW5lZFwiICE9PSB0eXBlb2YgQXJyYXlCdWZmZXIgJiYgYi5idWZmZXIgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlciB8fCBcImxlbmd0aFwiIGluIGIpXG4gICAgICAgIHJldHVybiAoYyA9IFwibnVtYmVyXCIgIT09IHR5cGVvZiBiLmxlbmd0aCkgfHwgKGMgPSBiLmxlbmd0aCwgYyA9IGMgIT09IGMpLCBjID8gdyhhLCAwKSA6IHhhKGEsIGIpO1xuICAgIGlmIChcIkJ1ZmZlclwiID09PSBiLnR5cGUgJiYgc2EoYi5kYXRhKSlcbiAgICAgICAgcmV0dXJuIHhhKGEsIGIuZGF0YSk7XG59IHRocm93IG5ldyBUeXBlRXJyb3IoXCJGaXJzdCBhcmd1bWVudCBtdXN0IGJlIGEgc3RyaW5nLCBCdWZmZXIsIEFycmF5QnVmZmVyLCBBcnJheSwgb3IgYXJyYXktbGlrZSBvYmplY3QuXCIpOyB9XG5mdW5jdGlvbiBCYShhKSB7IGlmIChhID49ICh2LlRZUEVEX0FSUkFZX1NVUFBPUlQgPyAyMTQ3NDgzNjQ3IDogMTA3Mzc0MTgyMykpXG4gICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJBdHRlbXB0IHRvIGFsbG9jYXRlIEJ1ZmZlciBsYXJnZXIgdGhhbiBtYXhpbXVtIHNpemU6IDB4XCIgKyAodi5UWVBFRF9BUlJBWV9TVVBQT1JUID8gMjE0NzQ4MzY0NyA6IDEwNzM3NDE4MjMpLnRvU3RyaW5nKDE2KSArIFwiIGJ5dGVzXCIpOyByZXR1cm4gYSB8IDA7IH1cbnYuaXNCdWZmZXIgPSBDYTtcbmZ1bmN0aW9uIHooYSkgeyByZXR1cm4gIShudWxsID09IGEgfHwgIWEuX2lzQnVmZmVyKTsgfVxudi5jb21wYXJlID0gZnVuY3Rpb24gKGEsIGIpIHsgaWYgKCF6KGEpIHx8ICF6KGIpKVxuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJBcmd1bWVudHMgbXVzdCBiZSBCdWZmZXJzXCIpOyBpZiAoYSA9PT0gYilcbiAgICByZXR1cm4gMDsgZm9yICh2YXIgYyA9IGEubGVuZ3RoLCBkID0gYi5sZW5ndGgsIGUgPSAwLCBmID0gTWF0aC5taW4oYywgZCk7IGUgPCBmOyArK2UpXG4gICAgaWYgKGFbZV0gIT09IGJbZV0pIHtcbiAgICAgICAgYyA9IGFbZV07XG4gICAgICAgIGQgPSBiW2VdO1xuICAgICAgICBicmVhaztcbiAgICB9IHJldHVybiBjIDwgZCA/IC0xIDogZCA8IGMgPyAxIDogMDsgfTtcbnYuaXNFbmNvZGluZyA9IGZ1bmN0aW9uIChhKSB7IHN3aXRjaCAoU3RyaW5nKGEpLnRvTG93ZXJDYXNlKCkpIHtcbiAgICBjYXNlIFwiaGV4XCI6XG4gICAgY2FzZSBcInV0ZjhcIjpcbiAgICBjYXNlIFwidXRmLThcIjpcbiAgICBjYXNlIFwiYXNjaWlcIjpcbiAgICBjYXNlIFwibGF0aW4xXCI6XG4gICAgY2FzZSBcImJpbmFyeVwiOlxuICAgIGNhc2UgXCJiYXNlNjRcIjpcbiAgICBjYXNlIFwidWNzMlwiOlxuICAgIGNhc2UgXCJ1Y3MtMlwiOlxuICAgIGNhc2UgXCJ1dGYxNmxlXCI6XG4gICAgY2FzZSBcInV0Zi0xNmxlXCI6IHJldHVybiAhMDtcbiAgICBkZWZhdWx0OiByZXR1cm4gITE7XG59IH07XG52LmNvbmNhdCA9IGZ1bmN0aW9uIChhLCBiKSB7IGlmICghc2EoYSkpXG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcignXCJsaXN0XCIgYXJndW1lbnQgbXVzdCBiZSBhbiBBcnJheSBvZiBCdWZmZXJzJyk7IGlmICgwID09PSBhLmxlbmd0aClcbiAgICByZXR1cm4gdi5hbGxvYygwKTsgdmFyIGM7IGlmICh2b2lkIDAgPT09IGIpXG4gICAgZm9yIChjID0gYiA9IDA7IGMgPCBhLmxlbmd0aDsgKytjKVxuICAgICAgICBiICs9IGFbY10ubGVuZ3RoOyBiID0gdi5hbGxvY1Vuc2FmZShiKTsgdmFyIGQgPSAwOyBmb3IgKGMgPSAwOyBjIDwgYS5sZW5ndGg7ICsrYykge1xuICAgIHZhciBlID0gYVtjXTtcbiAgICBpZiAoIXooZSkpXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1wibGlzdFwiIGFyZ3VtZW50IG11c3QgYmUgYW4gQXJyYXkgb2YgQnVmZmVycycpO1xuICAgIGUuY29weShiLCBkKTtcbiAgICBkICs9IGUubGVuZ3RoO1xufSByZXR1cm4gYjsgfTtcbmZ1bmN0aW9uIHlhKGEsIGIpIHtcbiAgICBpZiAoeihhKSlcbiAgICAgICAgcmV0dXJuIGEubGVuZ3RoO1xuICAgIGlmIChcInVuZGVmaW5lZFwiICE9PSB0eXBlb2YgQXJyYXlCdWZmZXIgJiYgXCJmdW5jdGlvblwiID09PSB0eXBlb2YgQXJyYXlCdWZmZXIuaXNWaWV3ICYmIChBcnJheUJ1ZmZlci5pc1ZpZXcoYSkgfHwgYSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSlcbiAgICAgICAgcmV0dXJuIGEuYnl0ZUxlbmd0aDtcbiAgICBcInN0cmluZ1wiICE9PSB0eXBlb2YgYSAmJiAoYSA9IFwiXCIgKyBhKTtcbiAgICB2YXIgYyA9IGEubGVuZ3RoO1xuICAgIGlmICgwID09PSBjKVxuICAgICAgICByZXR1cm4gMDtcbiAgICBmb3IgKHZhciBkID0gITE7OylcbiAgICAgICAgc3dpdGNoIChiKSB7XG4gICAgICAgICAgICBjYXNlIFwiYXNjaWlcIjpcbiAgICAgICAgICAgIGNhc2UgXCJsYXRpbjFcIjpcbiAgICAgICAgICAgIGNhc2UgXCJiaW5hcnlcIjogcmV0dXJuIGM7XG4gICAgICAgICAgICBjYXNlIFwidXRmOFwiOlxuICAgICAgICAgICAgY2FzZSBcInV0Zi04XCI6XG4gICAgICAgICAgICBjYXNlIHZvaWQgMDogcmV0dXJuIERhKGEpLmxlbmd0aDtcbiAgICAgICAgICAgIGNhc2UgXCJ1Y3MyXCI6XG4gICAgICAgICAgICBjYXNlIFwidWNzLTJcIjpcbiAgICAgICAgICAgIGNhc2UgXCJ1dGYxNmxlXCI6XG4gICAgICAgICAgICBjYXNlIFwidXRmLTE2bGVcIjogcmV0dXJuIDIgKiBjO1xuICAgICAgICAgICAgY2FzZSBcImhleFwiOiByZXR1cm4gYyA+Pj4gMTtcbiAgICAgICAgICAgIGNhc2UgXCJiYXNlNjRcIjogcmV0dXJuIEVhKGEpLmxlbmd0aDtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgaWYgKGQpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBEYShhKS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgYiA9IChcIlwiICsgYikudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICBkID0gITA7XG4gICAgICAgIH1cbn1cbnYuYnl0ZUxlbmd0aCA9IHlhO1xuZnVuY3Rpb24gRmEoYSwgYiwgYykge1xuICAgIHZhciBkID0gITE7XG4gICAgaWYgKHZvaWQgMCA9PT0gYiB8fCAwID4gYilcbiAgICAgICAgYiA9IDA7XG4gICAgaWYgKGIgPiB0aGlzLmxlbmd0aClcbiAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgaWYgKHZvaWQgMCA9PT0gYyB8fCBjID4gdGhpcy5sZW5ndGgpXG4gICAgICAgIGMgPSB0aGlzLmxlbmd0aDtcbiAgICBpZiAoMCA+PSBjKVxuICAgICAgICByZXR1cm4gXCJcIjtcbiAgICBjID4+Pj0gMDtcbiAgICBiID4+Pj0gMDtcbiAgICBpZiAoYyA8PSBiKVxuICAgICAgICByZXR1cm4gXCJcIjtcbiAgICBmb3IgKGEgfHwgKGEgPSBcInV0ZjhcIik7OylcbiAgICAgICAgc3dpdGNoIChhKSB7XG4gICAgICAgICAgICBjYXNlIFwiaGV4XCI6XG4gICAgICAgICAgICAgICAgYSA9IGI7XG4gICAgICAgICAgICAgICAgYiA9IGM7XG4gICAgICAgICAgICAgICAgYyA9IHRoaXMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIGlmICghYSB8fCAwID4gYSlcbiAgICAgICAgICAgICAgICAgICAgYSA9IDA7XG4gICAgICAgICAgICAgICAgaWYgKCFiIHx8IDAgPiBiIHx8IGIgPiBjKVxuICAgICAgICAgICAgICAgICAgICBiID0gYztcbiAgICAgICAgICAgICAgICBkID0gXCJcIjtcbiAgICAgICAgICAgICAgICBmb3IgKGMgPSBhOyBjIDwgYjsgKytjKVxuICAgICAgICAgICAgICAgICAgICBhID0gZCwgZCA9IHRoaXNbY10sIGQgPSAxNiA+IGQgPyBcIjBcIiArIGQudG9TdHJpbmcoMTYpIDogZC50b1N0cmluZygxNiksIGQgPSBhICsgZDtcbiAgICAgICAgICAgICAgICByZXR1cm4gZDtcbiAgICAgICAgICAgIGNhc2UgXCJ1dGY4XCI6XG4gICAgICAgICAgICBjYXNlIFwidXRmLThcIjogcmV0dXJuIEdhKHRoaXMsIGIsIGMpO1xuICAgICAgICAgICAgY2FzZSBcImFzY2lpXCI6XG4gICAgICAgICAgICAgICAgYSA9IFwiXCI7XG4gICAgICAgICAgICAgICAgZm9yIChjID0gTWF0aC5taW4odGhpcy5sZW5ndGgsIGMpOyBiIDwgYzsgKytiKVxuICAgICAgICAgICAgICAgICAgICBhICs9IFN0cmluZy5mcm9tQ2hhckNvZGUodGhpc1tiXSAmIDEyNyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGE7XG4gICAgICAgICAgICBjYXNlIFwibGF0aW4xXCI6XG4gICAgICAgICAgICBjYXNlIFwiYmluYXJ5XCI6XG4gICAgICAgICAgICAgICAgYSA9IFwiXCI7XG4gICAgICAgICAgICAgICAgZm9yIChjID0gTWF0aC5taW4odGhpcy5sZW5ndGgsIGMpOyBiIDwgYzsgKytiKVxuICAgICAgICAgICAgICAgICAgICBhICs9IFN0cmluZy5mcm9tQ2hhckNvZGUodGhpc1tiXSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGE7XG4gICAgICAgICAgICBjYXNlIFwiYmFzZTY0XCI6IHJldHVybiBiID0gMCA9PT0gYiAmJiBjID09PSB0aGlzLmxlbmd0aCA/IG9hKHRoaXMpIDogb2EodGhpcy5zbGljZShiLCBjKSksIGI7XG4gICAgICAgICAgICBjYXNlIFwidWNzMlwiOlxuICAgICAgICAgICAgY2FzZSBcInVjcy0yXCI6XG4gICAgICAgICAgICBjYXNlIFwidXRmMTZsZVwiOlxuICAgICAgICAgICAgY2FzZSBcInV0Zi0xNmxlXCI6XG4gICAgICAgICAgICAgICAgYiA9IHRoaXMuc2xpY2UoYiwgYyk7XG4gICAgICAgICAgICAgICAgYyA9IFwiXCI7XG4gICAgICAgICAgICAgICAgZm9yIChhID0gMDsgYSA8IGIubGVuZ3RoOyBhICs9IDIpXG4gICAgICAgICAgICAgICAgICAgIGMgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShiW2FdICsgMjU2ICogYlthICsgMV0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBjO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBpZiAoZClcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlVua25vd24gZW5jb2Rpbmc6IFwiICsgYSk7XG4gICAgICAgICAgICAgICAgYSA9IChhICsgXCJcIikudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICBkID0gITA7XG4gICAgICAgIH1cbn1cbnYucHJvdG90eXBlLl9pc0J1ZmZlciA9ICEwO1xuZnVuY3Rpb24gQShhLCBiLCBjKSB7IHZhciBkID0gYVtiXTsgYVtiXSA9IGFbY107IGFbY10gPSBkOyB9XG52LnByb3RvdHlwZS5zd2FwMTYgPSBmdW5jdGlvbiAoKSB7IHZhciBhID0gdGhpcy5sZW5ndGg7IGlmICgwICE9PSBhICUgMilcbiAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIkJ1ZmZlciBzaXplIG11c3QgYmUgYSBtdWx0aXBsZSBvZiAxNi1iaXRzXCIpOyBmb3IgKHZhciBiID0gMDsgYiA8IGE7IGIgKz0gMilcbiAgICBBKHRoaXMsIGIsIGIgKyAxKTsgcmV0dXJuIHRoaXM7IH07XG52LnByb3RvdHlwZS5zd2FwMzIgPSBmdW5jdGlvbiAoKSB7IHZhciBhID0gdGhpcy5sZW5ndGg7IGlmICgwICE9PSBhICUgNClcbiAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIkJ1ZmZlciBzaXplIG11c3QgYmUgYSBtdWx0aXBsZSBvZiAzMi1iaXRzXCIpOyBmb3IgKHZhciBiID0gMDsgYiA8IGE7IGIgKz0gNClcbiAgICBBKHRoaXMsIGIsIGIgKyAzKSwgQSh0aGlzLCBiICsgMSwgYiArIDIpOyByZXR1cm4gdGhpczsgfTtcbnYucHJvdG90eXBlLnN3YXA2NCA9IGZ1bmN0aW9uICgpIHsgdmFyIGEgPSB0aGlzLmxlbmd0aDsgaWYgKDAgIT09IGEgJSA4KVxuICAgIHRocm93IG5ldyBSYW5nZUVycm9yKFwiQnVmZmVyIHNpemUgbXVzdCBiZSBhIG11bHRpcGxlIG9mIDY0LWJpdHNcIik7IGZvciAodmFyIGIgPSAwOyBiIDwgYTsgYiArPSA4KVxuICAgIEEodGhpcywgYiwgYiArIDcpLCBBKHRoaXMsIGIgKyAxLCBiICsgNiksIEEodGhpcywgYiArIDIsIGIgKyA1KSwgQSh0aGlzLCBiICsgMywgYiArIDQpOyByZXR1cm4gdGhpczsgfTtcbnYucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgeyB2YXIgYSA9IHRoaXMubGVuZ3RoIHwgMDsgcmV0dXJuIDAgPT09IGEgPyBcIlwiIDogMCA9PT0gYXJndW1lbnRzLmxlbmd0aCA/IEdhKHRoaXMsIDAsIGEpIDogRmEuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfTtcbnYucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uIChhKSB7IGlmICgheihhKSlcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQXJndW1lbnQgbXVzdCBiZSBhIEJ1ZmZlclwiKTsgcmV0dXJuIHRoaXMgPT09IGEgPyAhMCA6IDAgPT09IHYuY29tcGFyZSh0aGlzLCBhKTsgfTtcbnYucHJvdG90eXBlLmluc3BlY3QgPSBmdW5jdGlvbiAoKSB7IHZhciBhID0gXCJcIjsgMCA8IHRoaXMubGVuZ3RoICYmIChhID0gdGhpcy50b1N0cmluZyhcImhleFwiLCAwLCA1MCkubWF0Y2goLy57Mn0vZykuam9pbihcIiBcIiksIDUwIDwgdGhpcy5sZW5ndGggJiYgKGEgKz0gXCIgLi4uIFwiKSk7IHJldHVybiBcIjxCdWZmZXIgXCIgKyBhICsgXCI+XCI7IH07XG52LnByb3RvdHlwZS5jb21wYXJlID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQsIGUpIHtcbiAgICBpZiAoIXooYSkpXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJBcmd1bWVudCBtdXN0IGJlIGEgQnVmZmVyXCIpO1xuICAgIHZvaWQgMCA9PT0gYiAmJiAoYiA9IDApO1xuICAgIHZvaWQgMCA9PT0gYyAmJiAoYyA9IGEgPyBhLmxlbmd0aCA6IDApO1xuICAgIHZvaWQgMCA9PT0gZCAmJiAoZCA9IDApO1xuICAgIHZvaWQgMCA9PT0gZSAmJiAoZSA9IHRoaXMubGVuZ3RoKTtcbiAgICBpZiAoMCA+IGIgfHwgYyA+IGEubGVuZ3RoIHx8IDAgPiBkIHx8IGUgPiB0aGlzLmxlbmd0aClcbiAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJvdXQgb2YgcmFuZ2UgaW5kZXhcIik7XG4gICAgaWYgKGQgPj0gZSAmJiBiID49IGMpXG4gICAgICAgIHJldHVybiAwO1xuICAgIGlmIChkID49IGUpXG4gICAgICAgIHJldHVybiAtMTtcbiAgICBpZiAoYiA+PSBjKVxuICAgICAgICByZXR1cm4gMTtcbiAgICBiID4+Pj0gMDtcbiAgICBjID4+Pj0gMDtcbiAgICBkID4+Pj0gMDtcbiAgICBlID4+Pj0gMDtcbiAgICBpZiAodGhpcyA9PT0gYSlcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgdmFyIGYgPSBlIC0gZCwgZyA9IGMgLSBiLCBoID0gTWF0aC5taW4oZiwgZyk7XG4gICAgZCA9IHRoaXMuc2xpY2UoZCwgZSk7XG4gICAgYSA9IGEuc2xpY2UoYiwgYyk7XG4gICAgZm9yIChiID0gMDsgYiA8IGg7ICsrYilcbiAgICAgICAgaWYgKGRbYl0gIT09IGFbYl0pIHtcbiAgICAgICAgICAgIGYgPSBkW2JdO1xuICAgICAgICAgICAgZyA9IGFbYl07XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIHJldHVybiBmIDxcbiAgICAgICAgZyA/IC0xIDogZyA8IGYgPyAxIDogMDtcbn07XG5mdW5jdGlvbiBIYShhLCBiLCBjLCBkLCBlKSB7XG4gICAgaWYgKDAgPT09IGEubGVuZ3RoKVxuICAgICAgICByZXR1cm4gLTE7XG4gICAgXCJzdHJpbmdcIiA9PT0gdHlwZW9mIGMgPyAoZCA9IGMsIGMgPSAwKSA6IDIxNDc0ODM2NDcgPCBjID8gYyA9IDIxNDc0ODM2NDcgOiAtMjE0NzQ4MzY0OCA+IGMgJiYgKGMgPSAtMjE0NzQ4MzY0OCk7XG4gICAgYyA9ICtjO1xuICAgIGlzTmFOKGMpICYmIChjID0gZSA/IDAgOiBhLmxlbmd0aCAtIDEpO1xuICAgIDAgPiBjICYmIChjID0gYS5sZW5ndGggKyBjKTtcbiAgICBpZiAoYyA+PSBhLmxlbmd0aCkge1xuICAgICAgICBpZiAoZSlcbiAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgYyA9IGEubGVuZ3RoIC0gMTtcbiAgICB9XG4gICAgZWxzZSBpZiAoMCA+IGMpXG4gICAgICAgIGlmIChlKVxuICAgICAgICAgICAgYyA9IDA7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICBcInN0cmluZ1wiID09PSB0eXBlb2YgYiAmJiAoYiA9IHYuZnJvbShiLCBkKSk7XG4gICAgaWYgKHooYikpXG4gICAgICAgIHJldHVybiAwID09PSBiLmxlbmd0aCA/IC0xIDogSWEoYSwgYiwgYywgZCwgZSk7XG4gICAgaWYgKFwibnVtYmVyXCIgPT09IHR5cGVvZiBiKVxuICAgICAgICByZXR1cm4gYiAmPSAyNTUsIHYuVFlQRURfQVJSQVlfU1VQUE9SVCAmJiBcImZ1bmN0aW9uXCIgPT09IHR5cGVvZiBVaW50OEFycmF5LnByb3RvdHlwZS5pbmRleE9mID8gZSA/IFVpbnQ4QXJyYXkucHJvdG90eXBlLmluZGV4T2YuY2FsbChhLCBiLCBjKSA6XG4gICAgICAgICAgICBVaW50OEFycmF5LnByb3RvdHlwZS5sYXN0SW5kZXhPZi5jYWxsKGEsIGIsIGMpIDogSWEoYSwgW2JdLCBjLCBkLCBlKTtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwidmFsIG11c3QgYmUgc3RyaW5nLCBudW1iZXIgb3IgQnVmZmVyXCIpO1xufVxuZnVuY3Rpb24gSWEoYSwgYiwgYywgZCwgZSkgeyBmdW5jdGlvbiBmKGEsIGIpIHsgcmV0dXJuIDEgPT09IGcgPyBhW2JdIDogYS5yZWFkVUludDE2QkUoYiAqIGcpOyB9IHZhciBnID0gMSwgaCA9IGEubGVuZ3RoLCBsID0gYi5sZW5ndGg7IGlmICh2b2lkIDAgIT09IGQgJiYgKGQgPSBTdHJpbmcoZCkudG9Mb3dlckNhc2UoKSwgXCJ1Y3MyXCIgPT09IGQgfHwgXCJ1Y3MtMlwiID09PSBkIHx8IFwidXRmMTZsZVwiID09PSBkIHx8IFwidXRmLTE2bGVcIiA9PT0gZCkpIHtcbiAgICBpZiAoMiA+IGEubGVuZ3RoIHx8IDIgPiBiLmxlbmd0aClcbiAgICAgICAgcmV0dXJuIC0xO1xuICAgIGcgPSAyO1xuICAgIGggLz0gMjtcbiAgICBsIC89IDI7XG4gICAgYyAvPSAyO1xufSBpZiAoZSlcbiAgICBmb3IgKGQgPSAtMTsgYyA8IGg7IGMrKylcbiAgICAgICAgaWYgKGYoYSwgYykgPT09IGYoYiwgLTEgPT09IGQgPyAwIDogYyAtIGQpKSB7XG4gICAgICAgICAgICBpZiAoLTEgPT09IGQgJiYgKGQgPSBjKSwgYyAtIGQgKyAxID09PSBsKVxuICAgICAgICAgICAgICAgIHJldHVybiBkICogZztcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICAtMSAhPT0gZCAmJiAoYyAtPSBjIC0gZCksIGQgPSAtMTtcbmVsc2VcbiAgICBmb3IgKGMgKyBsID4gaCAmJiAoYyA9IGggLSBsKTsgMCA8PSBjOyBjLS0pIHtcbiAgICAgICAgaCA9ICEwO1xuICAgICAgICBmb3IgKGQgPSAwOyBkIDwgbDsgZCsrKVxuICAgICAgICAgICAgaWYgKGYoYSwgYyArIGQpICE9PSBmKGIsIGQpKSB7XG4gICAgICAgICAgICAgICAgaCA9ICExO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICBpZiAoaClcbiAgICAgICAgICAgIHJldHVybiBjO1xuICAgIH0gcmV0dXJuIC0xOyB9XG52LnByb3RvdHlwZS5pbmNsdWRlcyA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IHJldHVybiAtMSAhPT0gdGhpcy5pbmRleE9mKGEsIGIsIGMpOyB9O1xudi5wcm90b3R5cGUuaW5kZXhPZiA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IHJldHVybiBIYSh0aGlzLCBhLCBiLCBjLCAhMCk7IH07XG52LnByb3RvdHlwZS5sYXN0SW5kZXhPZiA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IHJldHVybiBIYSh0aGlzLCBhLCBiLCBjLCAhMSk7IH07XG52LnByb3RvdHlwZS53cml0ZSA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkKSB7XG4gICAgaWYgKHZvaWQgMCA9PT0gYilcbiAgICAgICAgZCA9IFwidXRmOFwiLCBjID0gdGhpcy5sZW5ndGgsIGIgPSAwO1xuICAgIGVsc2UgaWYgKHZvaWQgMCA9PT0gYyAmJiBcInN0cmluZ1wiID09PSB0eXBlb2YgYilcbiAgICAgICAgZCA9IGIsIGMgPSB0aGlzLmxlbmd0aCwgYiA9IDA7XG4gICAgZWxzZSBpZiAoaXNGaW5pdGUoYikpXG4gICAgICAgIGIgfD0gMCwgaXNGaW5pdGUoYykgPyAoYyB8PSAwLCB2b2lkIDAgPT09IGQgJiYgKGQgPSBcInV0ZjhcIikpIDogKGQgPSBjLCBjID0gdm9pZCAwKTtcbiAgICBlbHNlXG4gICAgICAgIHRocm93IEVycm9yKFwiQnVmZmVyLndyaXRlKHN0cmluZywgZW5jb2RpbmcsIG9mZnNldFssIGxlbmd0aF0pIGlzIG5vIGxvbmdlciBzdXBwb3J0ZWRcIik7XG4gICAgdmFyIGUgPSB0aGlzLmxlbmd0aCAtIGI7XG4gICAgaWYgKHZvaWQgMCA9PT0gYyB8fCBjID4gZSlcbiAgICAgICAgYyA9IGU7XG4gICAgaWYgKDAgPCBhLmxlbmd0aCAmJiAoMCA+IGMgfHwgMCA+IGIpIHx8IGIgPiB0aGlzLmxlbmd0aClcbiAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJBdHRlbXB0IHRvIHdyaXRlIG91dHNpZGUgYnVmZmVyIGJvdW5kc1wiKTtcbiAgICBkIHx8IChkID0gXCJ1dGY4XCIpO1xuICAgIGZvciAoZSA9ICExOzspXG4gICAgICAgIHN3aXRjaCAoZCkge1xuICAgICAgICAgICAgY2FzZSBcImhleFwiOlxuICAgICAgICAgICAgICAgIGE6IHtcbiAgICAgICAgICAgICAgICAgICAgYiA9XG4gICAgICAgICAgICAgICAgICAgICAgICBOdW1iZXIoYikgfHwgMDtcbiAgICAgICAgICAgICAgICAgICAgZCA9IHRoaXMubGVuZ3RoIC0gYjtcbiAgICAgICAgICAgICAgICAgICAgYyA/IChjID0gTnVtYmVyKGMpLCBjID4gZCAmJiAoYyA9IGQpKSA6IGMgPSBkO1xuICAgICAgICAgICAgICAgICAgICBkID0gYS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIGlmICgwICE9PSBkICUgMilcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJJbnZhbGlkIGhleCBzdHJpbmdcIik7XG4gICAgICAgICAgICAgICAgICAgIGMgPiBkIC8gMiAmJiAoYyA9IGQgLyAyKTtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChkID0gMDsgZCA8IGM7ICsrZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZSA9IHBhcnNlSW50KGEuc3Vic3RyKDIgKiBkLCAyKSwgMTYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzTmFOKGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYSA9IGQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgYTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNbYiArIGRdID0gZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBhID0gZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGE7XG4gICAgICAgICAgICBjYXNlIFwidXRmOFwiOlxuICAgICAgICAgICAgY2FzZSBcInV0Zi04XCI6IHJldHVybiBKYShEYShhLCB0aGlzLmxlbmd0aCAtIGIpLCB0aGlzLCBiLCBjKTtcbiAgICAgICAgICAgIGNhc2UgXCJhc2NpaVwiOiByZXR1cm4gSmEoS2EoYSksIHRoaXMsIGIsIGMpO1xuICAgICAgICAgICAgY2FzZSBcImxhdGluMVwiOlxuICAgICAgICAgICAgY2FzZSBcImJpbmFyeVwiOiByZXR1cm4gSmEoS2EoYSksIHRoaXMsIGIsIGMpO1xuICAgICAgICAgICAgY2FzZSBcImJhc2U2NFwiOiByZXR1cm4gSmEoRWEoYSksIHRoaXMsIGIsIGMpO1xuICAgICAgICAgICAgY2FzZSBcInVjczJcIjpcbiAgICAgICAgICAgIGNhc2UgXCJ1Y3MtMlwiOlxuICAgICAgICAgICAgY2FzZSBcInV0ZjE2bGVcIjpcbiAgICAgICAgICAgIGNhc2UgXCJ1dGYtMTZsZVwiOlxuICAgICAgICAgICAgICAgIGQgPSBhO1xuICAgICAgICAgICAgICAgIGUgPSB0aGlzLmxlbmd0aCAtXG4gICAgICAgICAgICAgICAgICAgIGI7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgZiA9IFtdLCBnID0gMDsgZyA8IGQubGVuZ3RoICYmICEoMCA+IChlIC09IDIpKTsgKytnKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBoID0gZC5jaGFyQ29kZUF0KGcpO1xuICAgICAgICAgICAgICAgICAgICBhID0gaCA+PiA4O1xuICAgICAgICAgICAgICAgICAgICBoICU9IDI1NjtcbiAgICAgICAgICAgICAgICAgICAgZi5wdXNoKGgpO1xuICAgICAgICAgICAgICAgICAgICBmLnB1c2goYSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBKYShmLCB0aGlzLCBiLCBjKTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgaWYgKGUpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJVbmtub3duIGVuY29kaW5nOiBcIiArIGQpO1xuICAgICAgICAgICAgICAgIGQgPSAoXCJcIiArIGQpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgZSA9ICEwO1xuICAgICAgICB9XG59O1xudi5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gKCkgeyByZXR1cm4geyB0eXBlOiBcIkJ1ZmZlclwiLCBkYXRhOiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbCh0aGlzLl9hcnIgfHwgdGhpcywgMCkgfTsgfTtcbmZ1bmN0aW9uIEdhKGEsIGIsIGMpIHtcbiAgICBjID0gTWF0aC5taW4oYS5sZW5ndGgsIGMpO1xuICAgIGZvciAodmFyIGQgPSBbXTsgYiA8IGM7KSB7XG4gICAgICAgIHZhciBlID0gYVtiXSwgZiA9IG51bGwsIGcgPSAyMzkgPCBlID8gNCA6IDIyMyA8IGUgPyAzIDogMTkxIDwgZSA/IDIgOiAxO1xuICAgICAgICBpZiAoYiArIGcgPD0gYylcbiAgICAgICAgICAgIHN3aXRjaCAoZykge1xuICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgMTI4ID4gZSAmJiAoZiA9IGUpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgIHZhciBoID0gYVtiICsgMV07XG4gICAgICAgICAgICAgICAgICAgIDEyOCA9PT0gKGggJiAxOTIpICYmIChlID0gKGUgJiAzMSkgPDwgNiB8IGggJiA2MywgMTI3IDwgZSAmJiAoZiA9IGUpKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICBoID0gYVtiICsgMV07XG4gICAgICAgICAgICAgICAgICAgIHZhciBsID0gYVtiICsgMl07XG4gICAgICAgICAgICAgICAgICAgIDEyOCA9PT0gKGggJiAxOTIpICYmIDEyOCA9PT0gKGwgJiAxOTIpICYmIChlID0gKGUgJiAxNSkgPDwgMTIgfCAoaCAmIDYzKSA8PCA2IHwgbCAmIDYzLCAyMDQ3IDwgZSAmJiAoNTUyOTYgPiBlIHx8IDU3MzQzIDwgZSkgJiYgKGYgPSBlKSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAgICAgaCA9IGFbYiArIDFdO1xuICAgICAgICAgICAgICAgICAgICBsID0gYVtiICsgMl07XG4gICAgICAgICAgICAgICAgICAgIHZhciBuID0gYVtiICsgM107XG4gICAgICAgICAgICAgICAgICAgIDEyOCA9PT0gKGggJiAxOTIpICYmIDEyOCA9PT0gKGwgJiAxOTIpICYmIDEyOCA9PT0gKG4gJiAxOTIpICYmIChlID0gKGUgJiAxNSkgPDwgMTggfCAoaCAmIDYzKSA8PCAxMiB8IChsICYgNjMpIDw8IDYgfCBuICYgNjMsIDY1NTM1IDwgZSAmJiAxMTE0MTEyID4gZSAmJiAoZiA9XG4gICAgICAgICAgICAgICAgICAgICAgICBlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIG51bGwgPT09IGYgPyAoZiA9IDY1NTMzLCBnID0gMSkgOiA2NTUzNSA8IGYgJiYgKGYgLT0gNjU1MzYsIGQucHVzaChmID4+PiAxMCAmIDEwMjMgfCA1NTI5NiksIGYgPSA1NjMyMCB8IGYgJiAxMDIzKTtcbiAgICAgICAgZC5wdXNoKGYpO1xuICAgICAgICBiICs9IGc7XG4gICAgfVxuICAgIGEgPSBkLmxlbmd0aDtcbiAgICBpZiAoYSA8PSBMYSlcbiAgICAgICAgZCA9IFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkoU3RyaW5nLCBkKTtcbiAgICBlbHNlIHtcbiAgICAgICAgYyA9IFwiXCI7XG4gICAgICAgIGZvciAoYiA9IDA7IGIgPCBhOylcbiAgICAgICAgICAgIGMgKz0gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShTdHJpbmcsIGQuc2xpY2UoYiwgYiArPSBMYSkpO1xuICAgICAgICBkID0gYztcbiAgICB9XG4gICAgcmV0dXJuIGQ7XG59XG52YXIgTGEgPSA0MDk2O1xudi5wcm90b3R5cGUuc2xpY2UgPSBmdW5jdGlvbiAoYSwgYikgeyB2YXIgYyA9IHRoaXMubGVuZ3RoOyBhID0gfn5hOyBiID0gdm9pZCAwID09PSBiID8gYyA6IH5+YjsgMCA+IGEgPyAoYSArPSBjLCAwID4gYSAmJiAoYSA9IDApKSA6IGEgPiBjICYmIChhID0gYyk7IDAgPiBiID8gKGIgKz0gYywgMCA+IGIgJiYgKGIgPSAwKSkgOiBiID4gYyAmJiAoYiA9IGMpOyBiIDwgYSAmJiAoYiA9IGEpOyBpZiAodi5UWVBFRF9BUlJBWV9TVVBQT1JUKVxuICAgIGIgPSB0aGlzLnN1YmFycmF5KGEsIGIpLCBiLl9fcHJvdG9fXyA9IHYucHJvdG90eXBlO1xuZWxzZSB7XG4gICAgYyA9IGIgLSBhO1xuICAgIGIgPSBuZXcgdihjLCB2b2lkIDApO1xuICAgIGZvciAodmFyIGQgPSAwOyBkIDwgYzsgKytkKVxuICAgICAgICBiW2RdID0gdGhpc1tkICsgYV07XG59IHJldHVybiBiOyB9O1xuZnVuY3Rpb24gQyhhLCBiLCBjKSB7IGlmICgwICE9PSBhICUgMSB8fCAwID4gYSlcbiAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIm9mZnNldCBpcyBub3QgdWludFwiKTsgaWYgKGEgKyBiID4gYylcbiAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlRyeWluZyB0byBhY2Nlc3MgYmV5b25kIGJ1ZmZlciBsZW5ndGhcIik7IH1cbnYucHJvdG90eXBlLnJlYWRVSW50TEUgPSBmdW5jdGlvbiAoYSwgYiwgYykgeyBhIHw9IDA7IGIgfD0gMDsgYyB8fCBDKGEsIGIsIHRoaXMubGVuZ3RoKTsgYyA9IHRoaXNbYV07IGZvciAodmFyIGQgPSAxLCBlID0gMDsgKytlIDwgYiAmJiAoZCAqPSAyNTYpOylcbiAgICBjICs9IHRoaXNbYSArIGVdICogZDsgcmV0dXJuIGM7IH07XG52LnByb3RvdHlwZS5yZWFkVUludEJFID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsgYSB8PSAwOyBiIHw9IDA7IGMgfHwgQyhhLCBiLCB0aGlzLmxlbmd0aCk7IGMgPSB0aGlzW2EgKyAtLWJdOyBmb3IgKHZhciBkID0gMTsgMCA8IGIgJiYgKGQgKj0gMjU2KTspXG4gICAgYyArPSB0aGlzW2EgKyAtLWJdICogZDsgcmV0dXJuIGM7IH07XG52LnByb3RvdHlwZS5yZWFkVUludDggPSBmdW5jdGlvbiAoYSwgYikgeyBiIHx8IEMoYSwgMSwgdGhpcy5sZW5ndGgpOyByZXR1cm4gdGhpc1thXTsgfTtcbnYucHJvdG90eXBlLnJlYWRVSW50MTZMRSA9IGZ1bmN0aW9uIChhLCBiKSB7IGIgfHwgQyhhLCAyLCB0aGlzLmxlbmd0aCk7IHJldHVybiB0aGlzW2FdIHwgdGhpc1thICsgMV0gPDwgODsgfTtcbnYucHJvdG90eXBlLnJlYWRVSW50MTZCRSA9IGZ1bmN0aW9uIChhLCBiKSB7IGIgfHwgQyhhLCAyLCB0aGlzLmxlbmd0aCk7IHJldHVybiB0aGlzW2FdIDw8IDggfCB0aGlzW2EgKyAxXTsgfTtcbnYucHJvdG90eXBlLnJlYWRVSW50MzJMRSA9IGZ1bmN0aW9uIChhLCBiKSB7IGIgfHwgQyhhLCA0LCB0aGlzLmxlbmd0aCk7IHJldHVybiAodGhpc1thXSB8IHRoaXNbYSArIDFdIDw8IDggfCB0aGlzW2EgKyAyXSA8PCAxNikgKyAxNjc3NzIxNiAqIHRoaXNbYSArIDNdOyB9O1xudi5wcm90b3R5cGUucmVhZFVJbnQzMkJFID0gZnVuY3Rpb24gKGEsIGIpIHsgYiB8fCBDKGEsIDQsIHRoaXMubGVuZ3RoKTsgcmV0dXJuIDE2Nzc3MjE2ICogdGhpc1thXSArICh0aGlzW2EgKyAxXSA8PCAxNiB8IHRoaXNbYSArIDJdIDw8IDggfCB0aGlzW2EgKyAzXSk7IH07XG52LnByb3RvdHlwZS5yZWFkSW50TEUgPSBmdW5jdGlvbiAoYSwgYiwgYykgeyBhIHw9IDA7IGIgfD0gMDsgYyB8fCBDKGEsIGIsIHRoaXMubGVuZ3RoKTsgYyA9IHRoaXNbYV07IGZvciAodmFyIGQgPSAxLCBlID0gMDsgKytlIDwgYiAmJiAoZCAqPSAyNTYpOylcbiAgICBjICs9IHRoaXNbYSArIGVdICogZDsgYyA+PSAxMjggKiBkICYmIChjIC09IE1hdGgucG93KDIsIDggKiBiKSk7IHJldHVybiBjOyB9O1xudi5wcm90b3R5cGUucmVhZEludEJFID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsgYSB8PSAwOyBiIHw9IDA7IGMgfHwgQyhhLCBiLCB0aGlzLmxlbmd0aCk7IGMgPSBiOyBmb3IgKHZhciBkID0gMSwgZSA9IHRoaXNbYSArIC0tY107IDAgPCBjICYmIChkICo9IDI1Nik7KVxuICAgIGUgKz0gdGhpc1thICsgLS1jXSAqIGQ7IGUgPj0gMTI4ICogZCAmJiAoZSAtPSBNYXRoLnBvdygyLCA4ICogYikpOyByZXR1cm4gZTsgfTtcbnYucHJvdG90eXBlLnJlYWRJbnQ4ID0gZnVuY3Rpb24gKGEsIGIpIHsgYiB8fCBDKGEsIDEsIHRoaXMubGVuZ3RoKTsgcmV0dXJuIHRoaXNbYV0gJiAxMjggPyAtMSAqICgyNTUgLSB0aGlzW2FdICsgMSkgOiB0aGlzW2FdOyB9O1xudi5wcm90b3R5cGUucmVhZEludDE2TEUgPSBmdW5jdGlvbiAoYSwgYikgeyBiIHx8IEMoYSwgMiwgdGhpcy5sZW5ndGgpOyBhID0gdGhpc1thXSB8IHRoaXNbYSArIDFdIDw8IDg7IHJldHVybiBhICYgMzI3NjggPyBhIHwgNDI5NDkwMTc2MCA6IGE7IH07XG52LnByb3RvdHlwZS5yZWFkSW50MTZCRSA9IGZ1bmN0aW9uIChhLCBiKSB7IGIgfHwgQyhhLCAyLCB0aGlzLmxlbmd0aCk7IGEgPSB0aGlzW2EgKyAxXSB8IHRoaXNbYV0gPDwgODsgcmV0dXJuIGEgJiAzMjc2OCA/IGEgfCA0Mjk0OTAxNzYwIDogYTsgfTtcbnYucHJvdG90eXBlLnJlYWRJbnQzMkxFID0gZnVuY3Rpb24gKGEsIGIpIHsgYiB8fCBDKGEsIDQsIHRoaXMubGVuZ3RoKTsgcmV0dXJuIHRoaXNbYV0gfCB0aGlzW2EgKyAxXSA8PCA4IHwgdGhpc1thICsgMl0gPDwgMTYgfCB0aGlzW2EgKyAzXSA8PCAyNDsgfTtcbnYucHJvdG90eXBlLnJlYWRJbnQzMkJFID0gZnVuY3Rpb24gKGEsIGIpIHsgYiB8fCBDKGEsIDQsIHRoaXMubGVuZ3RoKTsgcmV0dXJuIHRoaXNbYV0gPDwgMjQgfCB0aGlzW2EgKyAxXSA8PCAxNiB8IHRoaXNbYSArIDJdIDw8IDggfCB0aGlzW2EgKyAzXTsgfTtcbnYucHJvdG90eXBlLnJlYWRGbG9hdExFID0gZnVuY3Rpb24gKGEsIGIpIHsgYiB8fCBDKGEsIDQsIHRoaXMubGVuZ3RoKTsgcmV0dXJuIHBhKHRoaXMsIGEsICEwLCAyMywgNCk7IH07XG52LnByb3RvdHlwZS5yZWFkRmxvYXRCRSA9IGZ1bmN0aW9uIChhLCBiKSB7IGIgfHwgQyhhLCA0LCB0aGlzLmxlbmd0aCk7IHJldHVybiBwYSh0aGlzLCBhLCAhMSwgMjMsIDQpOyB9O1xudi5wcm90b3R5cGUucmVhZERvdWJsZUxFID0gZnVuY3Rpb24gKGEsIGIpIHsgYiB8fCBDKGEsIDgsIHRoaXMubGVuZ3RoKTsgcmV0dXJuIHBhKHRoaXMsIGEsICEwLCA1MiwgOCk7IH07XG52LnByb3RvdHlwZS5yZWFkRG91YmxlQkUgPSBmdW5jdGlvbiAoYSwgYikgeyBiIHx8IEMoYSwgOCwgdGhpcy5sZW5ndGgpOyByZXR1cm4gcGEodGhpcywgYSwgITEsIDUyLCA4KTsgfTtcbmZ1bmN0aW9uIEQoYSwgYiwgYywgZCwgZSwgZikgeyBpZiAoIXooYSkpXG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcignXCJidWZmZXJcIiBhcmd1bWVudCBtdXN0IGJlIGEgQnVmZmVyIGluc3RhbmNlJyk7IGlmIChiID4gZSB8fCBiIDwgZilcbiAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignXCJ2YWx1ZVwiIGFyZ3VtZW50IGlzIG91dCBvZiBib3VuZHMnKTsgaWYgKGMgKyBkID4gYS5sZW5ndGgpXG4gICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJJbmRleCBvdXQgb2YgcmFuZ2VcIik7IH1cbnYucHJvdG90eXBlLndyaXRlVUludExFID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsgYSA9ICthOyBiIHw9IDA7IGMgfD0gMDsgZCB8fCBEKHRoaXMsIGEsIGIsIGMsIE1hdGgucG93KDIsIDggKiBjKSAtIDEsIDApOyBkID0gMTsgdmFyIGUgPSAwOyBmb3IgKHRoaXNbYl0gPSBhICYgMjU1OyArK2UgPCBjICYmIChkICo9IDI1Nik7KVxuICAgIHRoaXNbYiArIGVdID0gYSAvIGQgJiAyNTU7IHJldHVybiBiICsgYzsgfTtcbnYucHJvdG90eXBlLndyaXRlVUludEJFID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsgYSA9ICthOyBiIHw9IDA7IGMgfD0gMDsgZCB8fCBEKHRoaXMsIGEsIGIsIGMsIE1hdGgucG93KDIsIDggKiBjKSAtIDEsIDApOyBkID0gYyAtIDE7IHZhciBlID0gMTsgZm9yICh0aGlzW2IgKyBkXSA9IGEgJiAyNTU7IDAgPD0gLS1kICYmIChlICo9IDI1Nik7KVxuICAgIHRoaXNbYiArIGRdID0gYSAvIGUgJiAyNTU7IHJldHVybiBiICsgYzsgfTtcbnYucHJvdG90eXBlLndyaXRlVUludDggPSBmdW5jdGlvbiAoYSwgYiwgYykgeyBhID0gK2E7IGIgfD0gMDsgYyB8fCBEKHRoaXMsIGEsIGIsIDEsIDI1NSwgMCk7IHYuVFlQRURfQVJSQVlfU1VQUE9SVCB8fCAoYSA9IE1hdGguZmxvb3IoYSkpOyB0aGlzW2JdID0gYSAmIDI1NTsgcmV0dXJuIGIgKyAxOyB9O1xuZnVuY3Rpb24gTWEoYSwgYiwgYywgZCkgeyAwID4gYiAmJiAoYiA9IDY1NTM1ICsgYiArIDEpOyBmb3IgKHZhciBlID0gMCwgZiA9IE1hdGgubWluKGEubGVuZ3RoIC0gYywgMik7IGUgPCBmOyArK2UpXG4gICAgYVtjICsgZV0gPSAoYiAmIDI1NSA8PCA4ICogKGQgPyBlIDogMSAtIGUpKSA+Pj4gOCAqIChkID8gZSA6IDEgLSBlKTsgfVxudi5wcm90b3R5cGUud3JpdGVVSW50MTZMRSA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IGEgPSArYTsgYiB8PSAwOyBjIHx8IEQodGhpcywgYSwgYiwgMiwgNjU1MzUsIDApOyB2LlRZUEVEX0FSUkFZX1NVUFBPUlQgPyAodGhpc1tiXSA9IGEgJiAyNTUsIHRoaXNbYiArIDFdID0gYSA+Pj4gOCkgOiBNYSh0aGlzLCBhLCBiLCAhMCk7IHJldHVybiBiICsgMjsgfTtcbnYucHJvdG90eXBlLndyaXRlVUludDE2QkUgPSBmdW5jdGlvbiAoYSwgYiwgYykgeyBhID0gK2E7IGIgfD0gMDsgYyB8fCBEKHRoaXMsIGEsIGIsIDIsIDY1NTM1LCAwKTsgdi5UWVBFRF9BUlJBWV9TVVBQT1JUID8gKHRoaXNbYl0gPSBhID4+PiA4LCB0aGlzW2IgKyAxXSA9IGEgJiAyNTUpIDogTWEodGhpcywgYSwgYiwgITEpOyByZXR1cm4gYiArIDI7IH07XG5mdW5jdGlvbiBOYShhLCBiLCBjLCBkKSB7IDAgPiBiICYmIChiID0gNDI5NDk2NzI5NSArIGIgKyAxKTsgZm9yICh2YXIgZSA9IDAsIGYgPSBNYXRoLm1pbihhLmxlbmd0aCAtIGMsIDQpOyBlIDwgZjsgKytlKVxuICAgIGFbYyArIGVdID0gYiA+Pj4gOCAqIChkID8gZSA6IDMgLSBlKSAmIDI1NTsgfVxudi5wcm90b3R5cGUud3JpdGVVSW50MzJMRSA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IGEgPSArYTsgYiB8PSAwOyBjIHx8IEQodGhpcywgYSwgYiwgNCwgNDI5NDk2NzI5NSwgMCk7IHYuVFlQRURfQVJSQVlfU1VQUE9SVCA/ICh0aGlzW2IgKyAzXSA9IGEgPj4+IDI0LCB0aGlzW2IgKyAyXSA9IGEgPj4+IDE2LCB0aGlzW2IgKyAxXSA9IGEgPj4+IDgsIHRoaXNbYl0gPSBhICYgMjU1KSA6IE5hKHRoaXMsIGEsIGIsICEwKTsgcmV0dXJuIGIgKyA0OyB9O1xudi5wcm90b3R5cGUud3JpdGVVSW50MzJCRSA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IGEgPSArYTsgYiB8PSAwOyBjIHx8IEQodGhpcywgYSwgYiwgNCwgNDI5NDk2NzI5NSwgMCk7IHYuVFlQRURfQVJSQVlfU1VQUE9SVCA/ICh0aGlzW2JdID0gYSA+Pj4gMjQsIHRoaXNbYiArIDFdID0gYSA+Pj4gMTYsIHRoaXNbYiArIDJdID0gYSA+Pj4gOCwgdGhpc1tiICsgM10gPSBhICYgMjU1KSA6IE5hKHRoaXMsIGEsIGIsICExKTsgcmV0dXJuIGIgKyA0OyB9O1xudi5wcm90b3R5cGUud3JpdGVJbnRMRSA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkKSB7IGEgPSArYTsgYiB8PSAwOyBkIHx8IChkID0gTWF0aC5wb3coMiwgOCAqIGMgLSAxKSwgRCh0aGlzLCBhLCBiLCBjLCBkIC0gMSwgLWQpKTsgZCA9IDA7IHZhciBlID0gMSwgZiA9IDA7IGZvciAodGhpc1tiXSA9IGEgJiAyNTU7ICsrZCA8IGMgJiYgKGUgKj0gMjU2KTspXG4gICAgMCA+IGEgJiYgMCA9PT0gZiAmJiAwICE9PSB0aGlzW2IgKyBkIC0gMV0gJiYgKGYgPSAxKSwgdGhpc1tiICsgZF0gPSAoYSAvIGUgPj4gMCkgLSBmICYgMjU1OyByZXR1cm4gYiArIGM7IH07XG52LnByb3RvdHlwZS53cml0ZUludEJFID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsgYSA9ICthOyBiIHw9IDA7IGQgfHwgKGQgPSBNYXRoLnBvdygyLCA4ICogYyAtIDEpLCBEKHRoaXMsIGEsIGIsIGMsIGQgLSAxLCAtZCkpOyBkID0gYyAtIDE7IHZhciBlID0gMSwgZiA9IDA7IGZvciAodGhpc1tiICsgZF0gPSBhICYgMjU1OyAwIDw9IC0tZCAmJiAoZSAqPSAyNTYpOylcbiAgICAwID4gYSAmJiAwID09PSBmICYmIDAgIT09IHRoaXNbYiArIGQgKyAxXSAmJiAoZiA9IDEpLCB0aGlzW2IgKyBkXSA9IChhIC8gZSA+PiAwKSAtIGYgJiAyNTU7IHJldHVybiBiICsgYzsgfTtcbnYucHJvdG90eXBlLndyaXRlSW50OCA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IGEgPSArYTsgYiB8PSAwOyBjIHx8IEQodGhpcywgYSwgYiwgMSwgMTI3LCAtMTI4KTsgdi5UWVBFRF9BUlJBWV9TVVBQT1JUIHx8IChhID0gTWF0aC5mbG9vcihhKSk7IDAgPiBhICYmIChhID0gMjU1ICsgYSArIDEpOyB0aGlzW2JdID0gYSAmIDI1NTsgcmV0dXJuIGIgKyAxOyB9O1xudi5wcm90b3R5cGUud3JpdGVJbnQxNkxFID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsgYSA9ICthOyBiIHw9IDA7IGMgfHwgRCh0aGlzLCBhLCBiLCAyLCAzMjc2NywgLTMyNzY4KTsgdi5UWVBFRF9BUlJBWV9TVVBQT1JUID8gKHRoaXNbYl0gPSBhICYgMjU1LCB0aGlzW2IgKyAxXSA9IGEgPj4+IDgpIDogTWEodGhpcywgYSwgYiwgITApOyByZXR1cm4gYiArIDI7IH07XG52LnByb3RvdHlwZS53cml0ZUludDE2QkUgPSBmdW5jdGlvbiAoYSwgYiwgYykgeyBhID0gK2E7IGIgfD0gMDsgYyB8fCBEKHRoaXMsIGEsIGIsIDIsIDMyNzY3LCAtMzI3NjgpOyB2LlRZUEVEX0FSUkFZX1NVUFBPUlQgPyAodGhpc1tiXSA9IGEgPj4+IDgsIHRoaXNbYiArIDFdID0gYSAmIDI1NSkgOiBNYSh0aGlzLCBhLCBiLCAhMSk7IHJldHVybiBiICsgMjsgfTtcbnYucHJvdG90eXBlLndyaXRlSW50MzJMRSA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IGEgPSArYTsgYiB8PSAwOyBjIHx8IEQodGhpcywgYSwgYiwgNCwgMjE0NzQ4MzY0NywgLTIxNDc0ODM2NDgpOyB2LlRZUEVEX0FSUkFZX1NVUFBPUlQgPyAodGhpc1tiXSA9IGEgJiAyNTUsIHRoaXNbYiArIDFdID0gYSA+Pj4gOCwgdGhpc1tiICsgMl0gPSBhID4+PiAxNiwgdGhpc1tiICsgM10gPSBhID4+PiAyNCkgOiBOYSh0aGlzLCBhLCBiLCAhMCk7IHJldHVybiBiICsgNDsgfTtcbnYucHJvdG90eXBlLndyaXRlSW50MzJCRSA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IGEgPSArYTsgYiB8PSAwOyBjIHx8IEQodGhpcywgYSwgYiwgNCwgMjE0NzQ4MzY0NywgLTIxNDc0ODM2NDgpOyAwID4gYSAmJiAoYSA9IDQyOTQ5NjcyOTUgKyBhICsgMSk7IHYuVFlQRURfQVJSQVlfU1VQUE9SVCA/ICh0aGlzW2JdID0gYSA+Pj4gMjQsIHRoaXNbYiArIDFdID0gYSA+Pj4gMTYsIHRoaXNbYiArIDJdID0gYSA+Pj4gOCwgdGhpc1tiICsgM10gPSBhICYgMjU1KSA6IE5hKHRoaXMsIGEsIGIsICExKTsgcmV0dXJuIGIgKyA0OyB9O1xuZnVuY3Rpb24gT2EoYSwgYiwgYywgZCkgeyBpZiAoYyArIGQgPiBhLmxlbmd0aClcbiAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIkluZGV4IG91dCBvZiByYW5nZVwiKTsgaWYgKDAgPiBjKVxuICAgIHRocm93IG5ldyBSYW5nZUVycm9yKFwiSW5kZXggb3V0IG9mIHJhbmdlXCIpOyB9XG52LnByb3RvdHlwZS53cml0ZUZsb2F0TEUgPSBmdW5jdGlvbiAoYSwgYiwgYykgeyBjIHx8IE9hKHRoaXMsIGEsIGIsIDQpOyBxYSh0aGlzLCBhLCBiLCAhMCwgMjMsIDQpOyByZXR1cm4gYiArIDQ7IH07XG52LnByb3RvdHlwZS53cml0ZUZsb2F0QkUgPSBmdW5jdGlvbiAoYSwgYiwgYykgeyBjIHx8IE9hKHRoaXMsIGEsIGIsIDQpOyBxYSh0aGlzLCBhLCBiLCAhMSwgMjMsIDQpOyByZXR1cm4gYiArIDQ7IH07XG52LnByb3RvdHlwZS53cml0ZURvdWJsZUxFID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsgYyB8fCBPYSh0aGlzLCBhLCBiLCA4KTsgcWEodGhpcywgYSwgYiwgITAsIDUyLCA4KTsgcmV0dXJuIGIgKyA4OyB9O1xudi5wcm90b3R5cGUud3JpdGVEb3VibGVCRSA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IGMgfHwgT2EodGhpcywgYSwgYiwgOCk7IHFhKHRoaXMsIGEsIGIsICExLCA1MiwgOCk7IHJldHVybiBiICsgODsgfTtcbnYucHJvdG90eXBlLmNvcHkgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCkge1xuICAgIGMgfHwgKGMgPSAwKTtcbiAgICBkIHx8IDAgPT09IGQgfHwgKGQgPSB0aGlzLmxlbmd0aCk7XG4gICAgYiA+PSBhLmxlbmd0aCAmJiAoYiA9IGEubGVuZ3RoKTtcbiAgICBiIHx8IChiID0gMCk7XG4gICAgMCA8IGQgJiYgZCA8IGMgJiYgKGQgPSBjKTtcbiAgICBpZiAoZCA9PT0gYyB8fCAwID09PSBhLmxlbmd0aCB8fCAwID09PSB0aGlzLmxlbmd0aClcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgaWYgKDAgPiBiKVxuICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcihcInRhcmdldFN0YXJ0IG91dCBvZiBib3VuZHNcIik7XG4gICAgaWYgKDAgPiBjIHx8IGMgPj0gdGhpcy5sZW5ndGgpXG4gICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKFwic291cmNlU3RhcnQgb3V0IG9mIGJvdW5kc1wiKTtcbiAgICBpZiAoMCA+IGQpXG4gICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKFwic291cmNlRW5kIG91dCBvZiBib3VuZHNcIik7XG4gICAgZCA+IHRoaXMubGVuZ3RoICYmIChkID0gdGhpcy5sZW5ndGgpO1xuICAgIGEubGVuZ3RoIC0gYiA8IGQgLSBjICYmIChkID0gYS5sZW5ndGggLSBiICsgYyk7XG4gICAgdmFyIGUgPSBkIC0gYztcbiAgICBpZiAodGhpcyA9PT0gYSAmJiBjIDwgYiAmJiBiIDwgZClcbiAgICAgICAgZm9yIChkID0gZSAtIDE7IDAgPD0gZDsgLS1kKVxuICAgICAgICAgICAgYVtkICsgYl0gPSB0aGlzW2QgKyBjXTtcbiAgICBlbHNlIGlmICgxRTMgPiBlIHx8XG4gICAgICAgICF2LlRZUEVEX0FSUkFZX1NVUFBPUlQpXG4gICAgICAgIGZvciAoZCA9IDA7IGQgPCBlOyArK2QpXG4gICAgICAgICAgICBhW2QgKyBiXSA9IHRoaXNbZCArIGNdO1xuICAgIGVsc2VcbiAgICAgICAgVWludDhBcnJheS5wcm90b3R5cGUuc2V0LmNhbGwoYSwgdGhpcy5zdWJhcnJheShjLCBjICsgZSksIGIpO1xuICAgIHJldHVybiBlO1xufTtcbnYucHJvdG90eXBlLmZpbGwgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCkge1xuICAgIGlmIChcInN0cmluZ1wiID09PSB0eXBlb2YgYSkge1xuICAgICAgICBcInN0cmluZ1wiID09PSB0eXBlb2YgYiA/IChkID0gYiwgYiA9IDAsIGMgPSB0aGlzLmxlbmd0aCkgOiBcInN0cmluZ1wiID09PSB0eXBlb2YgYyAmJiAoZCA9IGMsIGMgPSB0aGlzLmxlbmd0aCk7XG4gICAgICAgIGlmICgxID09PSBhLmxlbmd0aCkge1xuICAgICAgICAgICAgdmFyIGUgPSBhLmNoYXJDb2RlQXQoMCk7XG4gICAgICAgICAgICAyNTYgPiBlICYmIChhID0gZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHZvaWQgMCAhPT0gZCAmJiBcInN0cmluZ1wiICE9PSB0eXBlb2YgZClcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJlbmNvZGluZyBtdXN0IGJlIGEgc3RyaW5nXCIpO1xuICAgICAgICBpZiAoXCJzdHJpbmdcIiA9PT0gdHlwZW9mIGQgJiYgIXYuaXNFbmNvZGluZyhkKSlcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJVbmtub3duIGVuY29kaW5nOiBcIiArIGQpO1xuICAgIH1cbiAgICBlbHNlXG4gICAgICAgIFwibnVtYmVyXCIgPT09IHR5cGVvZiBhICYmIChhICY9IDI1NSk7XG4gICAgaWYgKDAgPiBiIHx8IHRoaXMubGVuZ3RoIDwgYiB8fCB0aGlzLmxlbmd0aCA8IGMpXG4gICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKFwiT3V0IG9mIHJhbmdlIGluZGV4XCIpO1xuICAgIGlmIChjIDw9IGIpXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIGIgPj4+PVxuICAgICAgICAwO1xuICAgIGMgPSB2b2lkIDAgPT09IGMgPyB0aGlzLmxlbmd0aCA6IGMgPj4+IDA7XG4gICAgYSB8fCAoYSA9IDApO1xuICAgIGlmIChcIm51bWJlclwiID09PSB0eXBlb2YgYSlcbiAgICAgICAgZm9yIChkID0gYjsgZCA8IGM7ICsrZClcbiAgICAgICAgICAgIHRoaXNbZF0gPSBhO1xuICAgIGVsc2VcbiAgICAgICAgZm9yIChhID0geihhKSA/IGEgOiBEYSgobmV3IHYoYSwgZCkpLnRvU3RyaW5nKCkpLCBlID0gYS5sZW5ndGgsIGQgPSAwOyBkIDwgYyAtIGI7ICsrZClcbiAgICAgICAgICAgIHRoaXNbZCArIGJdID0gYVtkICUgZV07XG4gICAgcmV0dXJuIHRoaXM7XG59O1xudmFyIFBhID0gL1teK1xcLzAtOUEtWmEtei1fXS9nO1xuZnVuY3Rpb24gRGEoYSwgYikge1xuICAgIGIgPSBiIHx8IEluZmluaXR5O1xuICAgIGZvciAodmFyIGMsIGQgPSBhLmxlbmd0aCwgZSA9IG51bGwsIGYgPSBbXSwgZyA9IDA7IGcgPCBkOyArK2cpIHtcbiAgICAgICAgYyA9IGEuY2hhckNvZGVBdChnKTtcbiAgICAgICAgaWYgKDU1Mjk1IDwgYyAmJiA1NzM0NCA+IGMpIHtcbiAgICAgICAgICAgIGlmICghZSkge1xuICAgICAgICAgICAgICAgIGlmICg1NjMxOSA8IGMpIHtcbiAgICAgICAgICAgICAgICAgICAgLTEgPCAoYiAtPSAzKSAmJiBmLnB1c2goMjM5LCAxOTEsIDE4OSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChnICsgMSA9PT0gZCkge1xuICAgICAgICAgICAgICAgICAgICAtMSA8IChiIC09IDMpICYmIGYucHVzaCgyMzksIDE5MSwgMTg5KTtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGUgPSBjO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKDU2MzIwID4gYykge1xuICAgICAgICAgICAgICAgIC0xIDwgKGIgLT0gMykgJiYgZi5wdXNoKDIzOSwgMTkxLCAxODkpO1xuICAgICAgICAgICAgICAgIGUgPSBjO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYyA9IChlIC0gNTUyOTYgPDwgMTAgfCBjIC0gNTYzMjApICsgNjU1MzY7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgZSAmJiAtMSA8IChiIC09IDMpICYmIGYucHVzaCgyMzksIDE5MSwgMTg5KTtcbiAgICAgICAgZSA9IG51bGw7XG4gICAgICAgIGlmICgxMjggPiBjKSB7XG4gICAgICAgICAgICBpZiAoMCA+IC0tYilcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGYucHVzaChjKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICgyMDQ4ID4gYykge1xuICAgICAgICAgICAgaWYgKDAgPiAoYiAtPSAyKSlcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGYucHVzaChjID4+IDYgfCAxOTIsIGMgJiA2MyB8IDEyOCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoNjU1MzYgPiBjKSB7XG4gICAgICAgICAgICBpZiAoMCA+IChiIC09IDMpKVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZi5wdXNoKGMgPj4gMTIgfCAyMjQsIGMgPj4gNiAmIDYzIHwgMTI4LCBjICYgNjMgfCAxMjgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKDExMTQxMTIgPiBjKSB7XG4gICAgICAgICAgICBpZiAoMCA+IChiIC09IDQpKVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZi5wdXNoKGMgPj4gMTggfCAyNDAsIGMgPj4gMTIgJiA2MyB8IDEyOCwgYyA+PiA2ICYgNjMgfCAxMjgsIGMgJiA2MyB8IDEyOCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhyb3cgRXJyb3IoXCJJbnZhbGlkIGNvZGUgcG9pbnRcIik7XG4gICAgfVxuICAgIHJldHVybiBmO1xufVxuZnVuY3Rpb24gS2EoYSkgeyBmb3IgKHZhciBiID0gW10sIGMgPSAwOyBjIDwgYS5sZW5ndGg7ICsrYylcbiAgICBiLnB1c2goYS5jaGFyQ29kZUF0KGMpICYgMjU1KTsgcmV0dXJuIGI7IH1cbmZ1bmN0aW9uIEVhKGEpIHtcbiAgICBhID0gKGEudHJpbSA/IGEudHJpbSgpIDogYS5yZXBsYWNlKC9eXFxzK3xcXHMrJC9nLCBcIlwiKSkucmVwbGFjZShQYSwgXCJcIik7XG4gICAgaWYgKDIgPiBhLmxlbmd0aClcbiAgICAgICAgYSA9IFwiXCI7XG4gICAgZWxzZVxuICAgICAgICBmb3IgKDsgMCAhPT0gYS5sZW5ndGggJSA0OylcbiAgICAgICAgICAgIGEgKz0gXCI9XCI7XG4gICAgbGEgfHwgbWEoKTtcbiAgICB2YXIgYiA9IGEubGVuZ3RoO1xuICAgIGlmICgwIDwgYiAlIDQpXG4gICAgICAgIHRocm93IEVycm9yKFwiSW52YWxpZCBzdHJpbmcuIExlbmd0aCBtdXN0IGJlIGEgbXVsdGlwbGUgb2YgNFwiKTtcbiAgICB2YXIgYyA9IFwiPVwiID09PSBhW2IgLSAyXSA/IDIgOiBcIj1cIiA9PT0gYVtiIC0gMV0gPyAxIDogMDtcbiAgICB2YXIgZCA9IG5ldyBrYSgzICogYiAvIDQgLSBjKTtcbiAgICB2YXIgZSA9IDAgPCBjID8gYiAtIDQgOiBiO1xuICAgIHZhciBmID0gMDtcbiAgICBmb3IgKGIgPSAwOyBiIDwgZTsgYiArPSA0KSB7XG4gICAgICAgIHZhciBnID0gdVthLmNoYXJDb2RlQXQoYildIDw8IDE4IHwgdVthLmNoYXJDb2RlQXQoYiArIDEpXSA8PCAxMiB8IHVbYS5jaGFyQ29kZUF0KGIgKyAyKV0gPDwgNiB8IHVbYS5jaGFyQ29kZUF0KGIgKyAzKV07XG4gICAgICAgIGRbZisrXSA9IGcgPj4gMTYgJiAyNTU7XG4gICAgICAgIGRbZisrXSA9IGcgPj4gOCAmIDI1NTtcbiAgICAgICAgZFtmKytdID0gZyAmIDI1NTtcbiAgICB9XG4gICAgMiA9PT0gYyA/IChnID0gdVthLmNoYXJDb2RlQXQoYildIDw8IDIgfFxuICAgICAgICB1W2EuY2hhckNvZGVBdChiICsgMSldID4+IDQsIGRbZisrXSA9IGcgJiAyNTUpIDogMSA9PT0gYyAmJiAoZyA9IHVbYS5jaGFyQ29kZUF0KGIpXSA8PCAxMCB8IHVbYS5jaGFyQ29kZUF0KGIgKyAxKV0gPDwgNCB8IHVbYS5jaGFyQ29kZUF0KGIgKyAyKV0gPj4gMiwgZFtmKytdID0gZyA+PiA4ICYgMjU1LCBkW2YrK10gPSBnICYgMjU1KTtcbiAgICByZXR1cm4gZDtcbn1cbmZ1bmN0aW9uIEphKGEsIGIsIGMsIGQpIHsgZm9yICh2YXIgZSA9IDA7IGUgPCBkICYmICEoZSArIGMgPj0gYi5sZW5ndGggfHwgZSA+PSBhLmxlbmd0aCk7ICsrZSlcbiAgICBiW2UgKyBjXSA9IGFbZV07IHJldHVybiBlOyB9XG5mdW5jdGlvbiBDYShhKSB7IHJldHVybiBudWxsICE9IGEgJiYgKCEhYS5faXNCdWZmZXIgfHwgUWEoYSkgfHwgXCJmdW5jdGlvblwiID09PSB0eXBlb2YgYS5yZWFkRmxvYXRMRSAmJiBcImZ1bmN0aW9uXCIgPT09IHR5cGVvZiBhLnNsaWNlICYmIFFhKGEuc2xpY2UoMCwgMCkpKTsgfVxuZnVuY3Rpb24gUWEoYSkgeyByZXR1cm4gISFhLmNvbnN0cnVjdG9yICYmIFwiZnVuY3Rpb25cIiA9PT0gdHlwZW9mIGEuY29uc3RydWN0b3IuaXNCdWZmZXIgJiYgYS5jb25zdHJ1Y3Rvci5pc0J1ZmZlcihhKTsgfVxudmFyIFJhID0gT2JqZWN0LmZyZWV6ZSh7IF9fcHJvdG9fXzogbnVsbCwgSU5TUEVDVF9NQVhfQllURVM6IDUwLCBrTWF4TGVuZ3RoOiB0YSwgQnVmZmVyOiB2LCBTbG93QnVmZmVyOiBmdW5jdGlvbiAoYSkgeyArYSAhPSBhICYmIChhID0gMCk7IHJldHVybiB2LmFsbG9jKCthKTsgfSwgaXNCdWZmZXI6IENhIH0pLCBFID0gdiwgU2EgPSBcInVuZGVmaW5lZFwiICE9PSB0eXBlb2YgZ2xvYmFsVGhpcyA/IGdsb2JhbFRoaXMgOiBcInVuZGVmaW5lZFwiICE9PSB0eXBlb2Ygd2luZG93ID8gd2luZG93IDogXCJ1bmRlZmluZWRcIiAhPT0gdHlwZW9mIGdsb2JhbCA/IGdsb2JhbCA6IFwidW5kZWZpbmVkXCIgIT09IHR5cGVvZiBzZWxmID8gc2VsZiA6IHt9O1xuZnVuY3Rpb24gVGEoYSwgYikgeyByZXR1cm4gYiA9IHsgZXhwb3J0czoge30gfSwgYShiLCBiLmV4cG9ydHMpLCBiLmV4cG9ydHM7IH1cbmZ1bmN0aW9uIFVhKCkgeyB0aHJvdyBFcnJvcihcInNldFRpbWVvdXQgaGFzIG5vdCBiZWVuIGRlZmluZWRcIik7IH1cbmZ1bmN0aW9uIFZhKCkgeyB0aHJvdyBFcnJvcihcImNsZWFyVGltZW91dCBoYXMgbm90IGJlZW4gZGVmaW5lZFwiKTsgfVxudmFyIEYgPSBVYSwgRyA9IFZhO1xuXCJmdW5jdGlvblwiID09PSB0eXBlb2YgamEuc2V0VGltZW91dCAmJiAoRiA9IHNldFRpbWVvdXQpO1xuXCJmdW5jdGlvblwiID09PSB0eXBlb2YgamEuY2xlYXJUaW1lb3V0ICYmIChHID0gY2xlYXJUaW1lb3V0KTtcbmZ1bmN0aW9uIFdhKGEpIHsgaWYgKEYgPT09IHNldFRpbWVvdXQpXG4gICAgcmV0dXJuIHNldFRpbWVvdXQoYSwgMCk7IGlmICgoRiA9PT0gVWEgfHwgIUYpICYmIHNldFRpbWVvdXQpXG4gICAgcmV0dXJuIEYgPSBzZXRUaW1lb3V0LCBzZXRUaW1lb3V0KGEsIDApOyB0cnkge1xuICAgIHJldHVybiBGKGEsIDApO1xufVxuY2F0Y2ggKGIpIHtcbiAgICB0cnkge1xuICAgICAgICByZXR1cm4gRi5jYWxsKG51bGwsIGEsIDApO1xuICAgIH1cbiAgICBjYXRjaCAoYykge1xuICAgICAgICByZXR1cm4gRi5jYWxsKHRoaXMsIGEsIDApO1xuICAgIH1cbn0gfVxuZnVuY3Rpb24gWGEoYSkgeyBpZiAoRyA9PT0gY2xlYXJUaW1lb3V0KVxuICAgIHJldHVybiBjbGVhclRpbWVvdXQoYSk7IGlmICgoRyA9PT0gVmEgfHwgIUcpICYmIGNsZWFyVGltZW91dClcbiAgICByZXR1cm4gRyA9IGNsZWFyVGltZW91dCwgY2xlYXJUaW1lb3V0KGEpOyB0cnkge1xuICAgIHJldHVybiBHKGEpO1xufVxuY2F0Y2ggKGIpIHtcbiAgICB0cnkge1xuICAgICAgICByZXR1cm4gRy5jYWxsKG51bGwsIGEpO1xuICAgIH1cbiAgICBjYXRjaCAoYykge1xuICAgICAgICByZXR1cm4gRy5jYWxsKHRoaXMsIGEpO1xuICAgIH1cbn0gfVxudmFyIEggPSBbXSwgSSA9ICExLCBKLCBZYSA9IC0xO1xuZnVuY3Rpb24gWmEoKSB7IEkgJiYgSiAmJiAoSSA9ICExLCBKLmxlbmd0aCA/IEggPSBKLmNvbmNhdChIKSA6IFlhID0gLTEsIEgubGVuZ3RoICYmICRhKCkpOyB9XG5mdW5jdGlvbiAkYSgpIHsgaWYgKCFJKSB7XG4gICAgdmFyIGEgPSBXYShaYSk7XG4gICAgSSA9ICEwO1xuICAgIGZvciAodmFyIGIgPSBILmxlbmd0aDsgYjspIHtcbiAgICAgICAgSiA9IEg7XG4gICAgICAgIGZvciAoSCA9IFtdOyArK1lhIDwgYjspXG4gICAgICAgICAgICBKICYmIEpbWWFdLnJ1bigpO1xuICAgICAgICBZYSA9IC0xO1xuICAgICAgICBiID0gSC5sZW5ndGg7XG4gICAgfVxuICAgIEogPSBudWxsO1xuICAgIEkgPSAhMTtcbiAgICBYYShhKTtcbn0gfVxuZnVuY3Rpb24gYWIoYSkgeyB2YXIgYiA9IEFycmF5KGFyZ3VtZW50cy5sZW5ndGggLSAxKTsgaWYgKDEgPCBhcmd1bWVudHMubGVuZ3RoKVxuICAgIGZvciAodmFyIGMgPSAxOyBjIDwgYXJndW1lbnRzLmxlbmd0aDsgYysrKVxuICAgICAgICBiW2MgLSAxXSA9IGFyZ3VtZW50c1tjXTsgSC5wdXNoKG5ldyBiYihhLCBiKSk7IDEgIT09IEgubGVuZ3RoIHx8IEkgfHwgV2EoJGEpOyB9XG5mdW5jdGlvbiBiYihhLCBiKSB7IHRoaXMuZnVuID0gYTsgdGhpcy5hcnJheSA9IGI7IH1cbmJiLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbiAoKSB7IHRoaXMuZnVuLmFwcGx5KG51bGwsIHRoaXMuYXJyYXkpOyB9O1xuZnVuY3Rpb24gSygpIHsgfVxudmFyIEwgPSBqYS5wZXJmb3JtYW5jZSB8fCB7fSwgY2IgPSBMLm5vdyB8fCBMLm1vek5vdyB8fCBMLm1zTm93IHx8IEwub05vdyB8fCBMLndlYmtpdE5vdyB8fCBmdW5jdGlvbiAoKSB7IHJldHVybiAobmV3IERhdGUpLmdldFRpbWUoKTsgfSwgZGIgPSBuZXcgRGF0ZSwgZWIgPSB7IG5leHRUaWNrOiBhYiwgdGl0bGU6IFwiYnJvd3NlclwiLCBicm93c2VyOiAhMCwgZW52OiB7fSwgYXJndjogW10sIHZlcnNpb246IFwiXCIsIHZlcnNpb25zOiB7fSwgb246IEssIGFkZExpc3RlbmVyOiBLLCBvbmNlOiBLLCBvZmY6IEssIHJlbW92ZUxpc3RlbmVyOiBLLCByZW1vdmVBbGxMaXN0ZW5lcnM6IEssIGVtaXQ6IEssIGJpbmRpbmc6IGZ1bmN0aW9uICgpIHsgdGhyb3cgRXJyb3IoXCJwcm9jZXNzLmJpbmRpbmcgaXMgbm90IHN1cHBvcnRlZFwiKTsgfSwgY3dkOiBmdW5jdGlvbiAoKSB7IHJldHVybiBcIi9cIjsgfSwgY2hkaXI6IGZ1bmN0aW9uICgpIHsgdGhyb3cgRXJyb3IoXCJwcm9jZXNzLmNoZGlyIGlzIG5vdCBzdXBwb3J0ZWRcIik7IH0sIHVtYXNrOiBmdW5jdGlvbiAoKSB7IHJldHVybiAwOyB9LCBocnRpbWU6IGZ1bmN0aW9uIChhKSB7XG4gICAgICAgIHZhciBiID0gLjAwMSAqXG4gICAgICAgICAgICBjYi5jYWxsKEwpLCBjID0gTWF0aC5mbG9vcihiKTtcbiAgICAgICAgYiA9IE1hdGguZmxvb3IoYiAlIDEgKiAxRTkpO1xuICAgICAgICBhICYmIChjIC09IGFbMF0sIGIgLT0gYVsxXSwgMCA+IGIgJiYgKGMtLSwgYiArPSAxRTkpKTtcbiAgICAgICAgcmV0dXJuIFtjLCBiXTtcbiAgICB9LCBwbGF0Zm9ybTogXCJicm93c2VyXCIsIHJlbGVhc2U6IHt9LCBjb25maWc6IHt9LCB1cHRpbWU6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIChuZXcgRGF0ZSAtIGRiKSAvIDFFMzsgfSB9LCBmYiA9IFRhKGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgZnVuY3Rpb24gYyhhLCBiKSB7IGZvciAodmFyIGMgaW4gYSlcbiAgICAgICAgYltjXSA9IGFbY107IH1cbiAgICBmdW5jdGlvbiBkKGEsIGIsIGMpIHsgcmV0dXJuIGUoYSwgYiwgYyk7IH1cbiAgICB2YXIgZSA9IFJhLkJ1ZmZlcjtcbiAgICBlLmZyb20gJiYgZS5hbGxvYyAmJiBlLmFsbG9jVW5zYWZlICYmIGUuYWxsb2NVbnNhZmVTbG93ID8gYS5leHBvcnRzID0gUmEgOiAoYyhSYSwgYiksIGIuQnVmZmVyID0gZCk7XG4gICAgZC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKGUucHJvdG90eXBlKTtcbiAgICBjKGUsIGQpO1xuICAgIGQuZnJvbSA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7XG4gICAgICAgIGlmIChcIm51bWJlclwiID09PSB0eXBlb2YgYSlcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJBcmd1bWVudCBtdXN0IG5vdCBiZSBhIG51bWJlclwiKTtcbiAgICAgICAgcmV0dXJuIGUoYSwgYiwgYyk7XG4gICAgfTtcbiAgICBkLmFsbG9jID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsgaWYgKFwibnVtYmVyXCIgIT09IHR5cGVvZiBhKVxuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQXJndW1lbnQgbXVzdCBiZSBhIG51bWJlclwiKTsgYSA9IGUoYSk7IHZvaWQgMCAhPT0gYiA/IFwic3RyaW5nXCIgPT09IHR5cGVvZiBjID8gYS5maWxsKGIsIGMpIDogYS5maWxsKGIpIDogYS5maWxsKDApOyByZXR1cm4gYTsgfTtcbiAgICBkLmFsbG9jVW5zYWZlID0gZnVuY3Rpb24gKGEpIHsgaWYgKFwibnVtYmVyXCIgIT09IHR5cGVvZiBhKVxuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQXJndW1lbnQgbXVzdCBiZSBhIG51bWJlclwiKTsgcmV0dXJuIGUoYSk7IH07XG4gICAgZC5hbGxvY1Vuc2FmZVNsb3cgPSBmdW5jdGlvbiAoYSkgeyBpZiAoXCJudW1iZXJcIiAhPT0gdHlwZW9mIGEpXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJBcmd1bWVudCBtdXN0IGJlIGEgbnVtYmVyXCIpOyByZXR1cm4gUmEuU2xvd0J1ZmZlcihhKTsgfTtcbn0pLCBnYiA9IFRhKGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgZnVuY3Rpb24gYygpIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoXCJzZWN1cmUgcmFuZG9tIG51bWJlciBnZW5lcmF0aW9uIG5vdCBzdXBwb3J0ZWQgYnkgdGhpcyBicm93c2VyXFxudXNlIGNocm9tZSwgRmlyZUZveCBvciBJbnRlcm5ldCBFeHBsb3JlciAxMVwiKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZChhLCBiKSB7IGlmIChcIm51bWJlclwiICE9PSB0eXBlb2YgYSB8fCBhICE9PSBhKVxuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwib2Zmc2V0IG11c3QgYmUgYSBudW1iZXJcIik7IGlmIChhID4gcCB8fCAwID4gYSlcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIm9mZnNldCBtdXN0IGJlIGEgdWludDMyXCIpOyBpZiAoYSA+IG4gfHwgYSA+IGIpXG4gICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKFwib2Zmc2V0IG91dCBvZiByYW5nZVwiKTsgfVxuICAgIGZ1bmN0aW9uIGUoYSwgYiwgYykgeyBpZiAoXCJudW1iZXJcIiAhPT0gdHlwZW9mIGEgfHwgYSAhPT0gYSlcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcInNpemUgbXVzdCBiZSBhIG51bWJlclwiKTsgaWYgKGEgPiBwIHx8IDAgPiBhKVxuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwic2l6ZSBtdXN0IGJlIGEgdWludDMyXCIpOyBpZiAoYSArIGIgPiBjIHx8IGEgPiBuKVxuICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcihcImJ1ZmZlciB0b28gc21hbGxcIik7IH1cbiAgICBmdW5jdGlvbiBmKGEsIGIsIGMsIGYpIHtcbiAgICAgICAgaWYgKCEobC5pc0J1ZmZlcihhKSB8fCBhIGluc3RhbmNlb2YgU2EuVWludDhBcnJheSkpXG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdcImJ1ZlwiIGFyZ3VtZW50IG11c3QgYmUgYSBCdWZmZXIgb3IgVWludDhBcnJheScpO1xuICAgICAgICBpZiAoXCJmdW5jdGlvblwiID09PSB0eXBlb2YgYilcbiAgICAgICAgICAgIGYgPSBiLCBiID0gMCwgYyA9IGEubGVuZ3RoO1xuICAgICAgICBlbHNlIGlmIChcImZ1bmN0aW9uXCIgPT09IHR5cGVvZiBjKVxuICAgICAgICAgICAgZiA9IGMsIGMgPSBhLmxlbmd0aCAtIGI7XG4gICAgICAgIGVsc2UgaWYgKFwiZnVuY3Rpb25cIiAhPT0gdHlwZW9mIGYpXG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdcImNiXCIgYXJndW1lbnQgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7XG4gICAgICAgIGQoYiwgYS5sZW5ndGgpO1xuICAgICAgICBlKGMsIGIsIGEubGVuZ3RoKTtcbiAgICAgICAgcmV0dXJuIGcoYSwgYiwgYywgZik7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGcoYSwgYiwgYywgZCkgeyBiID0gbmV3IFVpbnQ4QXJyYXkoYS5idWZmZXIsIGIsIGMpOyByLmdldFJhbmRvbVZhbHVlcyhiKTsgaWYgKGQpXG4gICAgICAgIGFiKGZ1bmN0aW9uICgpIHsgZChudWxsLCBhKTsgfSk7XG4gICAgZWxzZVxuICAgICAgICByZXR1cm4gYTsgfVxuICAgIGZ1bmN0aW9uIGgoYSwgYiwgYykge1xuICAgICAgICBcInVuZGVmaW5lZFwiID09PSB0eXBlb2YgYiAmJiAoYiA9IDApO1xuICAgICAgICBpZiAoIShsLmlzQnVmZmVyKGEpIHx8IGEgaW5zdGFuY2VvZiBTYS5VaW50OEFycmF5KSlcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1wiYnVmXCIgYXJndW1lbnQgbXVzdCBiZSBhIEJ1ZmZlciBvciBVaW50OEFycmF5Jyk7XG4gICAgICAgIGQoYiwgYS5sZW5ndGgpO1xuICAgICAgICB2b2lkIDAgPT09IGMgJiYgKGMgPSBhLmxlbmd0aCAtIGIpO1xuICAgICAgICBlKGMsIGIsIGEubGVuZ3RoKTtcbiAgICAgICAgcmV0dXJuIGcoYSwgYiwgYyk7XG4gICAgfVxuICAgIHZhciBsID0gZmIuQnVmZmVyLCBuID0gZmIua01heExlbmd0aCwgciA9IFNhLmNyeXB0byB8fCBTYS5tc0NyeXB0bywgcCA9IE1hdGgucG93KDIsIDMyKSAtIDE7XG4gICAgciAmJiByLmdldFJhbmRvbVZhbHVlcyA/IChiLnJhbmRvbUZpbGwgPSBmLCBiLnJhbmRvbUZpbGxTeW5jID0gaCkgOiAoYi5yYW5kb21GaWxsID0gYywgYi5yYW5kb21GaWxsU3luYyA9IGMpO1xufSksIGhiID0gVGEoZnVuY3Rpb24gKGEpIHsgYS5leHBvcnRzID0gZ2I7IH0pLnJhbmRvbUZpbGxTeW5jLCBpYiA9IE1hdGguZmxvb3IoLjAwMSAqIChEYXRlLm5vdygpIC0gcGVyZm9ybWFuY2Uubm93KCkpKTtcbmZ1bmN0aW9uIE0oYSkgeyBpZiAoXCJzdHJpbmdcIiAhPT0gdHlwZW9mIGEpXG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlBhdGggbXVzdCBiZSBhIHN0cmluZy4gUmVjZWl2ZWQgXCIgKyBKU09OLnN0cmluZ2lmeShhKSk7IH1cbmZ1bmN0aW9uIGpiKGEsIGIpIHtcbiAgICBmb3IgKHZhciBjID0gXCJcIiwgZCA9IDAsIGUgPSAtMSwgZiA9IDAsIGcsIGggPSAwOyBoIDw9IGEubGVuZ3RoOyArK2gpIHtcbiAgICAgICAgaWYgKGggPCBhLmxlbmd0aClcbiAgICAgICAgICAgIGcgPSBhLmNoYXJDb2RlQXQoaCk7XG4gICAgICAgIGVsc2UgaWYgKDQ3ID09PSBnKVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGcgPSA0NztcbiAgICAgICAgaWYgKDQ3ID09PSBnKSB7XG4gICAgICAgICAgICBpZiAoZSAhPT0gaCAtIDEgJiYgMSAhPT0gZilcbiAgICAgICAgICAgICAgICBpZiAoZSAhPT0gaCAtIDEgJiYgMiA9PT0gZikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoMiA+IGMubGVuZ3RoIHx8IDIgIT09IGQgfHwgNDYgIT09IGMuY2hhckNvZGVBdChjLmxlbmd0aCAtIDEpIHx8IDQ2ICE9PSBjLmNoYXJDb2RlQXQoYy5sZW5ndGggLSAyKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgyIDwgYy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZSA9IGMubGFzdEluZGV4T2YoXCIvXCIpLCBlICE9PSBjLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLTEgPT09IGUgPyAoYyA9IFwiXCIsIGQgPSAwKSA6IChjID0gYy5zbGljZSgwLCBlKSwgZCA9IGMubGVuZ3RoIC0gMSAtIGMubGFzdEluZGV4T2YoXCIvXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICgyID09PSBjLmxlbmd0aCB8fCAxID09PSBjLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBoO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBiICYmIChjID0gMCA8IGMubGVuZ3RoID8gYyArIFwiLy4uXCIgOiBcIi4uXCIsIGQgPSAyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICBjID1cbiAgICAgICAgICAgICAgICAgICAgICAgIDAgPCBjLmxlbmd0aCA/IGMgKyAoXCIvXCIgKyBhLnNsaWNlKGUgKyAxLCBoKSkgOiBhLnNsaWNlKGUgKyAxLCBoKSwgZCA9IGggLSBlIC0gMTtcbiAgICAgICAgICAgIGUgPSBoO1xuICAgICAgICAgICAgZiA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgNDYgPT09IGcgJiYgLTEgIT09IGYgPyArK2YgOiBmID0gLTE7XG4gICAgfVxuICAgIHJldHVybiBjO1xufVxudmFyIGtiID0geyByZXNvbHZlOiBmdW5jdGlvbiAoKSB7IGZvciAodmFyIGEgPSBcIlwiLCBiID0gITEsIGMsIGQgPSBhcmd1bWVudHMubGVuZ3RoIC0gMTsgLTEgPD0gZCAmJiAhYjsgZC0tKSB7XG4gICAgICAgIGlmICgwIDw9IGQpXG4gICAgICAgICAgICB2YXIgZSA9IGFyZ3VtZW50c1tkXTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdm9pZCAwID09PSBjICYmIChjID0gZWIuY3dkKCkpLCBlID0gYztcbiAgICAgICAgTShlKTtcbiAgICAgICAgMCAhPT0gZS5sZW5ndGggJiYgKGEgPSBlICsgXCIvXCIgKyBhLCBiID0gNDcgPT09IGUuY2hhckNvZGVBdCgwKSk7XG4gICAgfSBhID0gamIoYSwgIWIpOyByZXR1cm4gYiA/IDAgPCBhLmxlbmd0aCA/IFwiL1wiICsgYSA6IFwiL1wiIDogMCA8IGEubGVuZ3RoID8gYSA6IFwiLlwiOyB9LCBub3JtYWxpemU6IGZ1bmN0aW9uIChhKSB7IE0oYSk7IGlmICgwID09PSBhLmxlbmd0aClcbiAgICAgICAgcmV0dXJuIFwiLlwiOyB2YXIgYiA9IDQ3ID09PSBhLmNoYXJDb2RlQXQoMCksIGMgPSA0NyA9PT0gYS5jaGFyQ29kZUF0KGEubGVuZ3RoIC0gMSk7IGEgPSBqYihhLCAhYik7IDAgIT09IGEubGVuZ3RoIHx8IGIgfHwgKGEgPSBcIi5cIik7IDAgPCBhLmxlbmd0aCAmJiBjICYmIChhICs9IFwiL1wiKTsgcmV0dXJuIGIgPyBcIi9cIiArIGEgOiBhOyB9LCBpc0Fic29sdXRlOiBmdW5jdGlvbiAoYSkgeyBNKGEpOyByZXR1cm4gMCA8IGEubGVuZ3RoICYmIDQ3ID09PSBhLmNoYXJDb2RlQXQoMCk7IH0sXG4gICAgam9pbjogZnVuY3Rpb24gKCkgeyBpZiAoMCA9PT0gYXJndW1lbnRzLmxlbmd0aClcbiAgICAgICAgcmV0dXJuIFwiLlwiOyBmb3IgKHZhciBhLCBiID0gMDsgYiA8IGFyZ3VtZW50cy5sZW5ndGg7ICsrYikge1xuICAgICAgICB2YXIgYyA9IGFyZ3VtZW50c1tiXTtcbiAgICAgICAgTShjKTtcbiAgICAgICAgMCA8IGMubGVuZ3RoICYmIChhID0gdm9pZCAwID09PSBhID8gYyA6IGEgKyAoXCIvXCIgKyBjKSk7XG4gICAgfSByZXR1cm4gdm9pZCAwID09PSBhID8gXCIuXCIgOiBrYi5ub3JtYWxpemUoYSk7IH0sIHJlbGF0aXZlOiBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICBNKGEpO1xuICAgICAgICBNKGIpO1xuICAgICAgICBpZiAoYSA9PT0gYilcbiAgICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgICBhID0ga2IucmVzb2x2ZShhKTtcbiAgICAgICAgYiA9IGtiLnJlc29sdmUoYik7XG4gICAgICAgIGlmIChhID09PSBiKVxuICAgICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICAgIGZvciAodmFyIGMgPSAxOyBjIDwgYS5sZW5ndGggJiYgNDcgPT09IGEuY2hhckNvZGVBdChjKTsgKytjKVxuICAgICAgICAgICAgO1xuICAgICAgICBmb3IgKHZhciBkID0gYS5sZW5ndGgsIGUgPSBkIC0gYywgZiA9IDE7IGYgPCBiLmxlbmd0aCAmJiA0NyA9PT0gYi5jaGFyQ29kZUF0KGYpOyArK2YpXG4gICAgICAgICAgICA7XG4gICAgICAgIGZvciAodmFyIGcgPSBiLmxlbmd0aCAtIGYsIGggPSBlIDwgZyA/IGUgOiBnLCBsID0gLTEsIG4gPSAwOyBuIDw9IGg7ICsrbikge1xuICAgICAgICAgICAgaWYgKG4gPT09IGgpIHtcbiAgICAgICAgICAgICAgICBpZiAoZyA+IGgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKDQ3ID09PSBiLmNoYXJDb2RlQXQoZiArIG4pKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIuc2xpY2UoZiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbiArIDEpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoMCA9PT0gbilcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBiLnNsaWNlKGYgKyBuKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICBlID4gaCAmJiAoNDcgPT09IGEuY2hhckNvZGVBdChjICsgbikgPyBsID0gbiA6IDAgPT09IG4gJiYgKGwgPSAwKSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgciA9IGEuY2hhckNvZGVBdChjICsgbiksIHAgPSBiLmNoYXJDb2RlQXQoZiArIG4pO1xuICAgICAgICAgICAgaWYgKHIgIT09IHApXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgNDcgPT09IHIgJiYgKGwgPSBuKTtcbiAgICAgICAgfVxuICAgICAgICBlID0gXCJcIjtcbiAgICAgICAgZm9yIChuID0gYyArIGwgKyAxOyBuIDw9IGQ7ICsrbilcbiAgICAgICAgICAgIGlmIChuID09PSBkIHx8IDQ3ID09PSBhLmNoYXJDb2RlQXQobikpXG4gICAgICAgICAgICAgICAgZSA9IDAgPT09IGUubGVuZ3RoID8gZSArIFwiLi5cIiA6IGUgKyBcIi8uLlwiO1xuICAgICAgICBpZiAoMCA8IGUubGVuZ3RoKVxuICAgICAgICAgICAgcmV0dXJuIGUgKyBiLnNsaWNlKGYgKyBsKTtcbiAgICAgICAgZiArPSBsO1xuICAgICAgICA0NyA9PT0gYi5jaGFyQ29kZUF0KGYpICYmICsrZjtcbiAgICAgICAgcmV0dXJuIGIuc2xpY2UoZik7XG4gICAgfSwgX21ha2VMb25nOiBmdW5jdGlvbiAoYSkgeyByZXR1cm4gYTsgfSwgZGlybmFtZTogZnVuY3Rpb24gKGEpIHtcbiAgICAgICAgTShhKTtcbiAgICAgICAgaWYgKDAgPT09IGEubGVuZ3RoKVxuICAgICAgICAgICAgcmV0dXJuIFwiLlwiO1xuICAgICAgICBmb3IgKHZhciBiID0gYS5jaGFyQ29kZUF0KDApLCBjID0gNDcgPT09IGIsIGQgPSAtMSwgZSA9ICEwLCBmID0gYS5sZW5ndGggLSAxOyAxIDw9IGY7IC0tZilcbiAgICAgICAgICAgIGlmIChiID0gYS5jaGFyQ29kZUF0KGYpLFxuICAgICAgICAgICAgICAgIDQ3ID09PSBiKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFlKSB7XG4gICAgICAgICAgICAgICAgICAgIGQgPSBmO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgZSA9ICExO1xuICAgICAgICByZXR1cm4gLTEgPT09IGQgPyBjID8gXCIvXCIgOiBcIi5cIiA6IGMgJiYgMSA9PT0gZCA/IFwiLy9cIiA6IGEuc2xpY2UoMCwgZCk7XG4gICAgfSwgYmFzZW5hbWU6IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgIGlmICh2b2lkIDAgIT09IGIgJiYgXCJzdHJpbmdcIiAhPT0gdHlwZW9mIGIpXG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdcImV4dFwiIGFyZ3VtZW50IG11c3QgYmUgYSBzdHJpbmcnKTtcbiAgICAgICAgTShhKTtcbiAgICAgICAgdmFyIGMgPSAwLCBkID0gLTEsIGUgPSAhMCwgZjtcbiAgICAgICAgaWYgKHZvaWQgMCAhPT0gYiAmJiAwIDwgYi5sZW5ndGggJiYgYi5sZW5ndGggPD0gYS5sZW5ndGgpIHtcbiAgICAgICAgICAgIGlmIChiLmxlbmd0aCA9PT0gYS5sZW5ndGggJiYgYiA9PT0gYSlcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJcIjtcbiAgICAgICAgICAgIHZhciBnID0gYi5sZW5ndGggLSAxLCBoID0gLTE7XG4gICAgICAgICAgICBmb3IgKGYgPSBhLmxlbmd0aCAtIDE7IDAgPD0gZjsgLS1mKSB7XG4gICAgICAgICAgICAgICAgdmFyIGwgPSBhLmNoYXJDb2RlQXQoZik7XG4gICAgICAgICAgICAgICAgaWYgKDQ3ID09PSBsKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGYgKyAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAtMSA9PT0gaCAmJiAoZSA9ICExLCBoID0gZiArIDEpLCAwIDw9IGcgJiYgKGwgPT09IGIuY2hhckNvZGVBdChnKSA/IC0xID09PSAtLWcgJiYgKGQgPSBmKSA6IChnID0gLTEsIGQgPSBoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjID09PSBkID8gZCA9XG4gICAgICAgICAgICAgICAgaCA6IC0xID09PSBkICYmIChkID0gYS5sZW5ndGgpO1xuICAgICAgICAgICAgcmV0dXJuIGEuc2xpY2UoYywgZCk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChmID0gYS5sZW5ndGggLSAxOyAwIDw9IGY7IC0tZilcbiAgICAgICAgICAgIGlmICg0NyA9PT0gYS5jaGFyQ29kZUF0KGYpKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFlKSB7XG4gICAgICAgICAgICAgICAgICAgIGMgPSBmICsgMTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIC0xID09PSBkICYmIChlID0gITEsIGQgPSBmICsgMSk7XG4gICAgICAgIHJldHVybiAtMSA9PT0gZCA/IFwiXCIgOiBhLnNsaWNlKGMsIGQpO1xuICAgIH0sIGV4dG5hbWU6IGZ1bmN0aW9uIChhKSB7IE0oYSk7IGZvciAodmFyIGIgPSAtMSwgYyA9IDAsIGQgPSAtMSwgZSA9ICEwLCBmID0gMCwgZyA9IGEubGVuZ3RoIC0gMTsgMCA8PSBnOyAtLWcpIHtcbiAgICAgICAgdmFyIGggPSBhLmNoYXJDb2RlQXQoZyk7XG4gICAgICAgIGlmICg0NyA9PT0gaCkge1xuICAgICAgICAgICAgaWYgKCFlKSB7XG4gICAgICAgICAgICAgICAgYyA9IGcgKyAxO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIC0xID09PSBkICYmIChlID0gITEsIGQgPSBnICsgMSksIDQ2ID09PSBoID8gLTEgPT09IGIgPyBiID0gZyA6IDEgIT09IGYgJiYgKGYgPSAxKSA6IC0xICE9PSBiICYmIChmID0gLTEpO1xuICAgIH0gcmV0dXJuIC0xID09PSBiIHx8IC0xID09PSBkIHx8IDAgPT09IGYgfHwgMSA9PT0gZiAmJiBiID09PSBkIC0gMSAmJiBiID09PSBjICsgMSA/IFwiXCIgOiBhLnNsaWNlKGIsIGQpOyB9LCBmb3JtYXQ6IGZ1bmN0aW9uIChhKSB7XG4gICAgICAgIGlmIChudWxsID09PSBhIHx8IFwib2JqZWN0XCIgIT09IHR5cGVvZiBhKVxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVGhlIFwicGF0aE9iamVjdFwiIGFyZ3VtZW50IG11c3QgYmUgb2YgdHlwZSBPYmplY3QuIFJlY2VpdmVkIHR5cGUgJyArXG4gICAgICAgICAgICAgICAgdHlwZW9mIGEpO1xuICAgICAgICB2YXIgYiA9IGEuZGlyIHx8IGEucm9vdCwgYyA9IGEuYmFzZSB8fCAoYS5uYW1lIHx8IFwiXCIpICsgKGEuZXh0IHx8IFwiXCIpO1xuICAgICAgICBhID0gYiA/IGIgPT09IGEucm9vdCA/IGIgKyBjIDogYiArIFwiL1wiICsgYyA6IGM7XG4gICAgICAgIHJldHVybiBhO1xuICAgIH0sIHBhcnNlOiBmdW5jdGlvbiAoYSkge1xuICAgICAgICBNKGEpO1xuICAgICAgICB2YXIgYiA9IHsgcm9vdDogXCJcIiwgZGlyOiBcIlwiLCBiYXNlOiBcIlwiLCBleHQ6IFwiXCIsIG5hbWU6IFwiXCIgfTtcbiAgICAgICAgaWYgKDAgPT09IGEubGVuZ3RoKVxuICAgICAgICAgICAgcmV0dXJuIGI7XG4gICAgICAgIHZhciBjID0gYS5jaGFyQ29kZUF0KDApLCBkID0gNDcgPT09IGM7XG4gICAgICAgIGlmIChkKSB7XG4gICAgICAgICAgICBiLnJvb3QgPSBcIi9cIjtcbiAgICAgICAgICAgIHZhciBlID0gMTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBlID0gMDtcbiAgICAgICAgZm9yICh2YXIgZiA9IC0xLCBnID0gMCwgaCA9IC0xLCBsID0gITAsIG4gPSBhLmxlbmd0aCAtIDEsIHIgPSAwOyBuID49IGU7IC0tbilcbiAgICAgICAgICAgIGlmIChjID0gYS5jaGFyQ29kZUF0KG4pLCA0NyA9PT0gYykge1xuICAgICAgICAgICAgICAgIGlmICghbCkge1xuICAgICAgICAgICAgICAgICAgICBnID0gbiArIDE7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAtMSA9PT0gaCAmJiAobCA9ICExLCBoID0gbiArIDEpLCA0NiA9PT0gYyA/IC0xID09PSBmID8gZiA9IG4gOiAxICE9PSByICYmIChyID0gMSkgOiAtMSAhPT0gZiAmJiAociA9IC0xKTtcbiAgICAgICAgLTEgPT09IGYgfHwgLTEgPT09IGggfHwgMCA9PT0gciB8fCAxID09PSByICYmIGYgPT09IGggLSAxICYmIGYgPT09IGcgKyAxID8gLTEgIT09IGggJiYgKGIuYmFzZSA9IDAgPT09XG4gICAgICAgICAgICBnICYmIGQgPyBiLm5hbWUgPSBhLnNsaWNlKDEsIGgpIDogYi5uYW1lID0gYS5zbGljZShnLCBoKSkgOiAoMCA9PT0gZyAmJiBkID8gKGIubmFtZSA9IGEuc2xpY2UoMSwgZiksIGIuYmFzZSA9IGEuc2xpY2UoMSwgaCkpIDogKGIubmFtZSA9IGEuc2xpY2UoZywgZiksIGIuYmFzZSA9IGEuc2xpY2UoZywgaCkpLCBiLmV4dCA9IGEuc2xpY2UoZiwgaCkpO1xuICAgICAgICAwIDwgZyA/IGIuZGlyID0gYS5zbGljZSgwLCBnIC0gMSkgOiBkICYmIChiLmRpciA9IFwiL1wiKTtcbiAgICAgICAgcmV0dXJuIGI7XG4gICAgfSwgc2VwOiBcIi9cIiwgZGVsaW1pdGVyOiBcIjpcIiwgd2luMzI6IG51bGwsIHBvc2l4OiBudWxsIH0sIGxiID0ga2IucG9zaXggPSBrYiwgbWIgPSBPYmplY3QuZnJlZXplKHsgX19wcm90b19fOiBudWxsLCBcImRlZmF1bHRcIjogbGIsIF9fbW9kdWxlRXhwb3J0czogbGIgfSksIHBiID0geyBocnRpbWU6IGZ1bmN0aW9uIChhKSB7IHJldHVybiBmdW5jdGlvbiAoYikgeyBiID0gYShiKTsgcmV0dXJuIDFFOSAqIGJbMF0gKyBiWzFdOyB9OyB9KGZ1bmN0aW9uIChhKSB7XG4gICAgICAgIHZhciBiID0gLjAwMSAqIHBlcmZvcm1hbmNlLm5vdygpLCBjID0gTWF0aC5mbG9vcihiKSArIGliO1xuICAgICAgICBiID0gTWF0aC5mbG9vcihiICUgMSAqIDFFOSk7XG4gICAgICAgIGEgJiYgKGMgLT0gYVswXSxcbiAgICAgICAgICAgIGIgLT0gYVsxXSwgMCA+IGIgJiYgKGMtLSwgYiArPSAxRTkpKTtcbiAgICAgICAgcmV0dXJuIFtjLCBiXTtcbiAgICB9KSwgZXhpdDogZnVuY3Rpb24gKGEpIHsgdGhyb3cgbmV3IG5iKGEpOyB9LCBraWxsOiBmdW5jdGlvbiAoYSkgeyB0aHJvdyBuZXcgb2IoYSk7IH0sIHJhbmRvbUZpbGxTeW5jOiBoYiwgaXNUVFk6IGZ1bmN0aW9uICgpIHsgcmV0dXJuICEwOyB9LCBwYXRoOiBtYiwgZnM6IG51bGwgfSwgTiwgTyA9IGsoMSksIFAgPSBrKDIpLCBRID0gayg0KSwgUiA9IGsoOCksIFMgPSBrKDE2KSwgcWIgPSBrKDMyKSwgVCA9IGsoNjQpLCBWID0gaygxMjgpLCBzYiA9IGsoMjU2KSwgdGIgPSBrKDUxMiksIHViID0gaygxMDI0KSwgdmIgPSBrKDIwNDgpLCB3YiA9IGsoNDA5NiksIHhiID0gayg4MTkyKSwgeWIgPSBrKDE2Mzg0KSwgemIgPSBrKDMyNzY4KSwgQWIgPSBrKDY1NTM2KSwgQmIgPSBrKDEzMTA3MiksIENiID0gaygyNjIxNDQpLCBEYiA9IGsoNTI0Mjg4KSwgRWIgPSBrKDEwNDg1NzYpLCBXID0gaygyMDk3MTUyKSwgSWIgPSBrKDQxOTQzMDQpLCBKYiA9IGsoODM4ODYwOCksIEtiID0gaygxNjc3NzIxNiksIExiID0gaygzMzU1NDQzMiksIE1iID0gayg2NzEwODg2NCksIFggPSBrKDEzNDIxNzcyOCksIE5iID0gaygyNjg0MzU0NTYpLCBPYiA9IE8gfCBQIHwgUSB8IFIgfCBTIHwgcWIgfCBUIHwgViB8IHNiIHwgdGIgfCB1YiB8IHZiIHwgd2IgfCB4YiB8IHliIHwgemIgfCBBYiB8IEJiIHwgQ2IgfCBEYiB8IEViIHwgVyB8IEpiIHwgSWIgfCBLYiB8IE1iIHwgTGIgfCBYIHwgTmIsIFBiID0gTyB8IFAgfCBRIHwgUiB8IFMgfCBxYiB8IFQgfCBWIHwgc2IgfCBXIHwgSWIgfCBKYiB8IFgsIFFiID0gaygwKSwgUmIgPSBSIHwgUyB8IFYgfCB0YiB8IHViIHwgdmIgfCB3YiB8IHhiIHwgeWIgfCB6YiB8IEFiIHwgQmIgfCBDYiB8IERiIHwgRWIgfCBXIHwgSmIgfCBLYiB8IE1iIHwgTGIgfCBYLCBTYiA9IFJiIHwgUGIsIFRiID0gUCB8IFIgfCBUIHwgVyB8IFggfCBOYiwgVWIgPSBQIHwgUiB8IFQgfCBXIHwgWCwgVmIgPSBrKDApLCBXYiA9IHsgRTJCSUc6IDEsIEVBQ0NFUzogMiwgRUFERFJJTlVTRTogMywgRUFERFJOT1RBVkFJTDogNCwgRUFGTk9TVVBQT1JUOiA1LCBFQUxSRUFEWTogNywgRUFHQUlOOiA2LCBFQkFERjogOCwgRUJBRE1TRzogOSwgRUJVU1k6IDEwLCBFQ0FOQ0VMRUQ6IDExLCBFQ0hJTEQ6IDEyLCBFQ09OTkFCT1JURUQ6IDEzLCBFQ09OTlJFRlVTRUQ6IDE0LCBFQ09OTlJFU0VUOiAxNSwgRURFQURMT0NLOiAxNiwgRURFU1RBRERSUkVROiAxNywgRURPTTogMTgsIEVEUVVPVDogMTksIEVFWElTVDogMjAsIEVGQVVMVDogMjEsIEVGQklHOiAyMiwgRUhPU1RET1dOOiAyMywgRUhPU1RVTlJFQUNIOiAyMyxcbiAgICBFSURSTTogMjQsIEVJTFNFUTogMjUsIEVJTlBST0dSRVNTOiAyNiwgRUlOVFI6IDI3LCBFSU5WQUw6IDI4LCBFSU86IDI5LCBFSVNDT05OOiAzMCwgRUlTRElSOiAzMSwgRUxPT1A6IDMyLCBFTUZJTEU6IDMzLCBFTUxJTks6IDM0LCBFTVNHU0laRTogMzUsIEVNVUxUSUhPUDogMzYsIEVOQU1FVE9PTE9ORzogMzcsIEVORVRET1dOOiAzOCwgRU5FVFJFU0VUOiAzOSwgRU5FVFVOUkVBQ0g6IDQwLCBFTkZJTEU6IDQxLCBFTk9CVUZTOiA0MiwgRU5PREVWOiA0MywgRU5PRU5UOiA0NCwgRU5PRVhFQzogNDUsIEVOT0xDSzogNDYsIEVOT0xJTks6IDQ3LCBFTk9NRU06IDQ4LCBFTk9NU0c6IDQ5LCBFTk9QUk9UT09QVDogNTAsIEVOT1NQQzogNTEsIEVOT1NZUzogNTIsIEVOT1RDT05OOiA1MywgRU5PVERJUjogNTQsIEVOT1RFTVBUWTogNTUsIEVOT1RSRUNPVkVSQUJMRTogNTYsIEVOT1RTT0NLOiA1NywgRU5PVFRZOiA1OSwgRU5YSU86IDYwLCBFT1ZFUkZMT1c6IDYxLCBFT1dORVJERUFEOiA2MiwgRVBFUk06IDYzLCBFUElQRTogNjQsIEVQUk9UTzogNjUsIEVQUk9UT05PU1VQUE9SVDogNjYsIEVQUk9UT1RZUEU6IDY3LCBFUkFOR0U6IDY4LFxuICAgIEVST0ZTOiA2OSwgRVNQSVBFOiA3MCwgRVNSQ0g6IDcxLCBFU1RBTEU6IDcyLCBFVElNRURPVVQ6IDczLCBFVFhUQlNZOiA3NCwgRVhERVY6IDc1IH0sIFhiID0gKE4gPSB7fSwgTls2XSA9IFwiU0lHSFVQXCIsIE5bOF0gPSBcIlNJR0lOVFwiLCBOWzExXSA9IFwiU0lHUVVJVFwiLCBOWzddID0gXCJTSUdJTExcIiwgTlsxNV0gPSBcIlNJR1RSQVBcIiwgTlswXSA9IFwiU0lHQUJSVFwiLCBOWzJdID0gXCJTSUdCVVNcIiwgTls1XSA9IFwiU0lHRlBFXCIsIE5bOV0gPSBcIlNJR0tJTExcIiwgTlsyMF0gPSBcIlNJR1VTUjFcIiwgTlsxMl0gPSBcIlNJR1NFR1ZcIiwgTlsyMV0gPSBcIlNJR1VTUjJcIiwgTlsxMF0gPSBcIlNJR1BJUEVcIiwgTlsxXSA9IFwiU0lHQUxSTVwiLCBOWzE0XSA9IFwiU0lHVEVSTVwiLCBOWzNdID0gXCJTSUdDSExEXCIsIE5bNF0gPSBcIlNJR0NPTlRcIiwgTlsxM10gPSBcIlNJR1NUT1BcIiwgTlsxNl0gPSBcIlNJR1RTVFBcIiwgTlsxN10gPSBcIlNJR1RUSU5cIiwgTlsxOF0gPSBcIlNJR1RUT1VcIiwgTlsxOV0gPSBcIlNJR1VSR1wiLCBOWzIzXSA9IFwiU0lHWENQVVwiLCBOWzI0XSA9IFwiU0lHWEZTWlwiLCBOWzIyXSA9IFwiU0lHVlRBTFJNXCIsIE4pLCBZYiA9IE8gfCBQIHwgUyB8IFYgfCBXIHwgWCwgWmIgPSBPIHwgVCB8IFMgfCBWIHwgVyB8IFg7XG5mdW5jdGlvbiBZKGEpIHsgdmFyIGIgPSBNYXRoLnRydW5jKGEpOyBhID0gayhNYXRoLnJvdW5kKDFFNiAqIChhIC0gYikpKTsgcmV0dXJuIGsoYikgKiBrKDFFNikgKyBhOyB9XG5mdW5jdGlvbiAkYihhKSB7IFwibnVtYmVyXCIgPT09IHR5cGVvZiBhICYmIChhID0gTWF0aC50cnVuYyhhKSk7IGEgPSBrKGEpOyByZXR1cm4gTnVtYmVyKGEgLyBrKDFFNikpOyB9XG5mdW5jdGlvbiBaKGEpIHsgcmV0dXJuIGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgYiA9IFtdLCBjID0gMDsgYyA8IGFyZ3VtZW50cy5sZW5ndGg7IGMrKylcbiAgICBiW2NdID0gYXJndW1lbnRzW2NdOyB0cnkge1xuICAgIHJldHVybiBhLmFwcGx5KHZvaWQgMCwgZmEoYikpO1xufVxuY2F0Y2ggKGQpIHtcbiAgICBpZiAoZCAmJiBkLmNvZGUgJiYgXCJzdHJpbmdcIiA9PT0gdHlwZW9mIGQuY29kZSlcbiAgICAgICAgcmV0dXJuIFdiW2QuY29kZV0gfHwgMjg7XG4gICAgaWYgKGQgaW5zdGFuY2VvZiBhYylcbiAgICAgICAgcmV0dXJuIGQuZXJybm87XG4gICAgdGhyb3cgZDtcbn0gfTsgfVxuZnVuY3Rpb24gYmMoYSwgYikgeyB2YXIgYyA9IGEuRkRfTUFQLmdldChiKTsgaWYgKCFjKVxuICAgIHRocm93IG5ldyBhYyg4KTsgaWYgKHZvaWQgMCA9PT0gYy5maWxldHlwZSkge1xuICAgIHZhciBkID0gYS5iaW5kaW5ncy5mcy5mc3RhdFN5bmMoYy5yZWFsKTtcbiAgICBhID0gY2MoYSwgYiwgZCk7XG4gICAgYiA9IGEucmlnaHRzQmFzZTtcbiAgICBkID0gYS5yaWdodHNJbmhlcml0aW5nO1xuICAgIGMuZmlsZXR5cGUgPSBhLmZpbGV0eXBlO1xuICAgIGMucmlnaHRzIHx8IChjLnJpZ2h0cyA9IHsgYmFzZTogYiwgaW5oZXJpdGluZzogZCB9KTtcbn0gcmV0dXJuIGM7IH1cbmZ1bmN0aW9uIGNjKGEsIGIsIGMpIHtcbiAgICBzd2l0Y2ggKCEwKSB7XG4gICAgICAgIGNhc2UgYy5pc0Jsb2NrRGV2aWNlKCk6IHJldHVybiB7IGZpbGV0eXBlOiAxLCByaWdodHNCYXNlOiBPYiwgcmlnaHRzSW5oZXJpdGluZzogT2IgfTtcbiAgICAgICAgY2FzZSBjLmlzQ2hhcmFjdGVyRGV2aWNlKCk6IHJldHVybiB2b2lkIDAgIT09IGIgJiYgYS5iaW5kaW5ncy5pc1RUWShiKSA/IHsgZmlsZXR5cGU6IDIsIHJpZ2h0c0Jhc2U6IFViLCByaWdodHNJbmhlcml0aW5nOiBWYiB9IDogeyBmaWxldHlwZTogMiwgcmlnaHRzQmFzZTogT2IsIHJpZ2h0c0luaGVyaXRpbmc6IE9iIH07XG4gICAgICAgIGNhc2UgYy5pc0RpcmVjdG9yeSgpOiByZXR1cm4geyBmaWxldHlwZTogMywgcmlnaHRzQmFzZTogUmIsIHJpZ2h0c0luaGVyaXRpbmc6IFNiIH07XG4gICAgICAgIGNhc2UgYy5pc0ZJRk8oKTogcmV0dXJuIHsgZmlsZXR5cGU6IDYsIHJpZ2h0c0Jhc2U6IFRiLCByaWdodHNJbmhlcml0aW5nOiBPYiB9O1xuICAgICAgICBjYXNlIGMuaXNGaWxlKCk6IHJldHVybiB7IGZpbGV0eXBlOiA0LCByaWdodHNCYXNlOiBQYiwgcmlnaHRzSW5oZXJpdGluZzogUWIgfTtcbiAgICAgICAgY2FzZSBjLmlzU29ja2V0KCk6IHJldHVybiB7IGZpbGV0eXBlOiA2LFxuICAgICAgICAgICAgcmlnaHRzQmFzZTogVGIsIHJpZ2h0c0luaGVyaXRpbmc6IE9iIH07XG4gICAgICAgIGNhc2UgYy5pc1N5bWJvbGljTGluaygpOiByZXR1cm4geyBmaWxldHlwZTogNywgcmlnaHRzQmFzZTogaygwKSwgcmlnaHRzSW5oZXJpdGluZzogaygwKSB9O1xuICAgICAgICBkZWZhdWx0OiByZXR1cm4geyBmaWxldHlwZTogMCwgcmlnaHRzQmFzZTogaygwKSwgcmlnaHRzSW5oZXJpdGluZzogaygwKSB9O1xuICAgIH1cbn1cbnZhciBhYyA9IGZ1bmN0aW9uIChhKSB7IGZ1bmN0aW9uIGIoYykgeyB2YXIgZCA9IGEuY2FsbCh0aGlzKSB8fCB0aGlzOyBkLmVycm5vID0gYzsgT2JqZWN0LnNldFByb3RvdHlwZU9mKGQsIGIucHJvdG90eXBlKTsgcmV0dXJuIGQ7IH0gYmEoYiwgYSk7IHJldHVybiBiOyB9KEVycm9yKSwgbmIgPSBmdW5jdGlvbiAoYSkgeyBmdW5jdGlvbiBiKGMpIHsgdmFyIGQgPSBhLmNhbGwodGhpcywgXCJXQVNJIEV4aXQgZXJyb3I6IFwiICsgYykgfHwgdGhpczsgZC5jb2RlID0gYzsgT2JqZWN0LnNldFByb3RvdHlwZU9mKGQsIGIucHJvdG90eXBlKTsgcmV0dXJuIGQ7IH0gYmEoYiwgYSk7IHJldHVybiBiOyB9KEVycm9yKSwgb2IgPSBmdW5jdGlvbiAoYSkgeyBmdW5jdGlvbiBiKGMpIHsgdmFyIGQgPSBhLmNhbGwodGhpcywgXCJXQVNJIEtpbGwgc2lnbmFsOiBcIiArIGMpIHx8IHRoaXM7IGQuc2lnbmFsID0gYzsgT2JqZWN0LnNldFByb3RvdHlwZU9mKGQsIGIucHJvdG90eXBlKTsgcmV0dXJuIGQ7IH0gYmEoYiwgYSk7IHJldHVybiBiOyB9KEVycm9yKSwgZGMgPSBmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gYShhKSB7XG4gICAgICAgIGZ1bmN0aW9uIGIoYSkge1xuICAgICAgICAgICAgc3dpdGNoIChhKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAxOiByZXR1cm4gci5ocnRpbWUoKTtcbiAgICAgICAgICAgICAgICBjYXNlIDA6IHJldHVybiBZKERhdGUubm93KCkpO1xuICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICBjYXNlIDM6IHJldHVybiByLmhydGltZSgpIC0gZWM7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDogcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZChhLCBiKSB7IGEgPSBiYyhnLCBhKTsgaWYgKGIgIT09IGsoMCkgJiYgKGEucmlnaHRzLmJhc2UgJiBiKSA9PT0gaygwKSlcbiAgICAgICAgICAgIHRocm93IG5ldyBhYyg2Myk7IHJldHVybiBhOyB9XG4gICAgICAgIGZ1bmN0aW9uIGUoYSwgYikgeyBnLnJlZnJlc2hNZW1vcnkoKTsgcmV0dXJuIEFycmF5LmZyb20oeyBsZW5ndGg6IGIgfSwgZnVuY3Rpb24gKGIsIGMpIHsgYyA9IGEgKyA4ICogYzsgYiA9IGcudmlldy5nZXRVaW50MzIoYywgITApOyBjID0gZy52aWV3LmdldFVpbnQzMihjICsgNCwgITApOyByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoZy5tZW1vcnkuYnVmZmVyLCBiLCBjKTsgfSk7IH1cbiAgICAgICAgdmFyIGYsIGcgPSB0aGlzLCBoID0ge307XG4gICAgICAgIGEgJiYgYS5wcmVvcGVucyA/IGggPSBhLnByZW9wZW5zIDogYSAmJiBhLnByZW9wZW5EaXJlY3RvcmllcyAmJiAoaCA9IGEucHJlb3BlbkRpcmVjdG9yaWVzKTtcbiAgICAgICAgdmFyIGwgPSB7fTtcbiAgICAgICAgYSAmJiBhLmVudiAmJiAobCA9IGEuZW52KTtcbiAgICAgICAgdmFyIG4gPSBbXTtcbiAgICAgICAgYSAmJiBhLmFyZ3MgJiYgKG4gPVxuICAgICAgICAgICAgYS5hcmdzKTtcbiAgICAgICAgdmFyIHIgPSBwYjtcbiAgICAgICAgYSAmJiBhLmJpbmRpbmdzICYmIChyID0gYS5iaW5kaW5ncyk7XG4gICAgICAgIHRoaXMudmlldyA9IHRoaXMubWVtb3J5ID0gdm9pZCAwO1xuICAgICAgICB0aGlzLmJpbmRpbmdzID0gcjtcbiAgICAgICAgdGhpcy5GRF9NQVAgPSBuZXcgTWFwKFtbMCwgeyByZWFsOiAwLCBmaWxldHlwZTogMiwgcmlnaHRzOiB7IGJhc2U6IFliLCBpbmhlcml0aW5nOiBrKDApIH0sIHBhdGg6IHZvaWQgMCB9XSwgWzEsIHsgcmVhbDogMSwgZmlsZXR5cGU6IDIsIHJpZ2h0czogeyBiYXNlOiBaYiwgaW5oZXJpdGluZzogaygwKSB9LCBwYXRoOiB2b2lkIDAgfV0sIFsyLCB7IHJlYWw6IDIsIGZpbGV0eXBlOiAyLCByaWdodHM6IHsgYmFzZTogWmIsIGluaGVyaXRpbmc6IGsoMCkgfSwgcGF0aDogdm9pZCAwIH1dXSk7XG4gICAgICAgIHZhciBwID0gdGhpcy5iaW5kaW5ncy5mcywgeSA9IHRoaXMuYmluZGluZ3MucGF0aDtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGZvciAodmFyIHVhID0gY2EoT2JqZWN0LmVudHJpZXMoaCkpLCBlYSA9IHVhLm5leHQoKTsgIWVhLmRvbmU7IGVhID0gdWEubmV4dCgpKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJiID0gZGEoZWEudmFsdWUsIDIpLCBmYyA9IHJiWzBdLCBGYiA9IHJiWzFdLCBnYyA9IHAub3BlblN5bmMoRmIsIHAuY29uc3RhbnRzLk9fUkRPTkxZKSwgaGMgPSBmYSh0aGlzLkZEX01BUC5rZXlzKCkpLnJldmVyc2UoKVswXSArIDE7XG4gICAgICAgICAgICAgICAgdGhpcy5GRF9NQVAuc2V0KGhjLCB7IHJlYWw6IGdjLCBmaWxldHlwZTogMywgcmlnaHRzOiB7IGJhc2U6IFJiLCBpbmhlcml0aW5nOiBTYiB9LCBmYWtlUGF0aDogZmMsIHBhdGg6IEZiIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoICh0KSB7XG4gICAgICAgICAgICB2YXIgR2IgPSB7IGVycm9yOiB0IH07XG4gICAgICAgIH1cbiAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGVhICYmICFlYS5kb25lICYmIChmID0gdWEucmV0dXJuKSAmJiBmLmNhbGwodWEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICAgICAgaWYgKEdiKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBHYi5lcnJvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB2YXIgZWMgPSByLmhydGltZSgpO1xuICAgICAgICB0aGlzLndhc2lJbXBvcnQgPSB7IGFyZ3NfZ2V0OiBmdW5jdGlvbiAoYSwgYikgeyBnLnJlZnJlc2hNZW1vcnkoKTsgdmFyIGMgPSBhLCBkID0gYjsgbi5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7IGcudmlldy5zZXRVaW50MzIoYywgZCwgITApOyBjICs9IDQ7IGQgKz0gRS5mcm9tKGcubWVtb3J5LmJ1ZmZlcikud3JpdGUoYSArIFwiXFx4MDBcIiwgZCk7IH0pOyByZXR1cm4gMDsgfSwgYXJnc19zaXplc19nZXQ6IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICAgICAgZy5yZWZyZXNoTWVtb3J5KCk7XG4gICAgICAgICAgICAgICAgZy52aWV3LnNldFVpbnQzMihhLCBuLmxlbmd0aCwgITApO1xuICAgICAgICAgICAgICAgIGEgPSBuLnJlZHVjZShmdW5jdGlvbiAoYSwgYikgeyByZXR1cm4gYSArIEUuYnl0ZUxlbmd0aChiKSArIDE7IH0sIDApO1xuICAgICAgICAgICAgICAgIGcudmlldy5zZXRVaW50MzIoYiwgYSwgITApO1xuICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgfSwgZW52aXJvbl9nZXQ6IGZ1bmN0aW9uIChhLCBiKSB7IGcucmVmcmVzaE1lbW9yeSgpOyB2YXIgYyA9IGEsIGQgPSBiOyBPYmplY3QuZW50cmllcyhsKS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7IHZhciBiID0gZGEoYSwgMik7IGEgPSBiWzBdOyBiID0gYlsxXTsgZy52aWV3LnNldFVpbnQzMihjLCBkLCAhMCk7IGMgKz0gNDsgZCArPSBFLmZyb20oZy5tZW1vcnkuYnVmZmVyKS53cml0ZShhICsgXCI9XCIgKyBiICsgXCJcXHgwMFwiLCBkKTsgfSk7IHJldHVybiAwOyB9LCBlbnZpcm9uX3NpemVzX2dldDogZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgICAgICAgICBnLnJlZnJlc2hNZW1vcnkoKTtcbiAgICAgICAgICAgICAgICB2YXIgYyA9IE9iamVjdC5lbnRyaWVzKGwpLm1hcChmdW5jdGlvbiAoYSkgeyBhID0gZGEoYSwgMik7IHJldHVybiBhWzBdICsgXCI9XCIgKyBhWzFdICsgXCJcXHgwMFwiOyB9KSwgZCA9IGMucmVkdWNlKGZ1bmN0aW9uIChhLCBiKSB7IHJldHVybiBhICsgRS5ieXRlTGVuZ3RoKGIpOyB9LCAwKTtcbiAgICAgICAgICAgICAgICBnLnZpZXcuc2V0VWludDMyKGEsIGMubGVuZ3RoLCAhMCk7XG4gICAgICAgICAgICAgICAgZy52aWV3LnNldFVpbnQzMihiLCBkLCAhMCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICB9LCBjbG9ja19yZXNfZ2V0OiBmdW5jdGlvbiAoYSwgYikgeyBzd2l0Y2ggKGEpIHtcbiAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBrKDEpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDA6IGMgPSBrKDFFMyk7XG4gICAgICAgICAgICB9IGcudmlldy5zZXRCaWdVaW50NjQoYiwgYyk7IHJldHVybiAwOyB9LCBjbG9ja190aW1lX2dldDogZnVuY3Rpb24gKGEsIGMsIGQpIHsgZy5yZWZyZXNoTWVtb3J5KCk7IGEgPSBiKGEpOyBpZiAobnVsbCA9PT0gYSlcbiAgICAgICAgICAgICAgICByZXR1cm4gMjg7IGcudmlldy5zZXRCaWdVaW50NjQoZCwgayhhKSwgITApOyByZXR1cm4gMDsgfSwgZmRfYWR2aXNlOiBaKGZ1bmN0aW9uIChhKSB7IGQoYSwgVik7IHJldHVybiA1MjsgfSksIGZkX2FsbG9jYXRlOiBaKGZ1bmN0aW9uIChhKSB7IGQoYSwgc2IpOyByZXR1cm4gNTI7IH0pLCBmZF9jbG9zZTogWihmdW5jdGlvbiAoYSkgeyB2YXIgYiA9IGQoYSwgaygwKSk7IHAuY2xvc2VTeW5jKGIucmVhbCk7IGcuRkRfTUFQLmRlbGV0ZShhKTsgcmV0dXJuIDA7IH0pLCBmZF9kYXRhc3luYzogWihmdW5jdGlvbiAoYSkge1xuICAgICAgICAgICAgICAgIGEgPVxuICAgICAgICAgICAgICAgICAgICBkKGEsIE8pO1xuICAgICAgICAgICAgICAgIHAuZmRhdGFzeW5jU3luYyhhLnJlYWwpO1xuICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgfSksIGZkX2Zkc3RhdF9nZXQ6IFooZnVuY3Rpb24gKGEsIGIpIHsgYSA9IGQoYSwgaygwKSk7IGcucmVmcmVzaE1lbW9yeSgpOyBnLnZpZXcuc2V0VWludDgoYiwgYS5maWxldHlwZSk7IGcudmlldy5zZXRVaW50MTYoYiArIDIsIDAsICEwKTsgZy52aWV3LnNldFVpbnQxNihiICsgNCwgMCwgITApOyBnLnZpZXcuc2V0QmlnVWludDY0KGIgKyA4LCBrKGEucmlnaHRzLmJhc2UpLCAhMCk7IGcudmlldy5zZXRCaWdVaW50NjQoYiArIDggKyA4LCBrKGEucmlnaHRzLmluaGVyaXRpbmcpLCAhMCk7IHJldHVybiAwOyB9KSwgZmRfZmRzdGF0X3NldF9mbGFnczogWihmdW5jdGlvbiAoYSkgeyBkKGEsIFIpOyByZXR1cm4gNTI7IH0pLCBmZF9mZHN0YXRfc2V0X3JpZ2h0czogWihmdW5jdGlvbiAoYSwgYiwgYykge1xuICAgICAgICAgICAgICAgIGEgPSBkKGEsIGsoMCkpO1xuICAgICAgICAgICAgICAgIGlmICgoYS5yaWdodHMuYmFzZSB8IGIpID4gYS5yaWdodHMuYmFzZSB8fCAoYS5yaWdodHMuaW5oZXJpdGluZyB8IGMpID4gYS5yaWdodHMuaW5oZXJpdGluZylcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDYzO1xuICAgICAgICAgICAgICAgIGEucmlnaHRzLmJhc2UgPVxuICAgICAgICAgICAgICAgICAgICBiO1xuICAgICAgICAgICAgICAgIGEucmlnaHRzLmluaGVyaXRpbmcgPSBjO1xuICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgfSksIGZkX2ZpbGVzdGF0X2dldDogWihmdW5jdGlvbiAoYSwgYikgeyBhID0gZChhLCBXKTsgdmFyIGMgPSBwLmZzdGF0U3luYyhhLnJlYWwpOyBnLnJlZnJlc2hNZW1vcnkoKTsgZy52aWV3LnNldEJpZ1VpbnQ2NChiLCBrKGMuZGV2KSwgITApOyBiICs9IDg7IGcudmlldy5zZXRCaWdVaW50NjQoYiwgayhjLmlubyksICEwKTsgYiArPSA4OyBnLnZpZXcuc2V0VWludDgoYiwgYS5maWxldHlwZSk7IGIgKz0gODsgZy52aWV3LnNldEJpZ1VpbnQ2NChiLCBrKGMubmxpbmspLCAhMCk7IGIgKz0gODsgZy52aWV3LnNldEJpZ1VpbnQ2NChiLCBrKGMuc2l6ZSksICEwKTsgYiArPSA4OyBnLnZpZXcuc2V0QmlnVWludDY0KGIsIFkoYy5hdGltZU1zKSwgITApOyBiICs9IDg7IGcudmlldy5zZXRCaWdVaW50NjQoYiwgWShjLm10aW1lTXMpLCAhMCk7IGcudmlldy5zZXRCaWdVaW50NjQoYiArIDgsIFkoYy5jdGltZU1zKSwgITApOyByZXR1cm4gMDsgfSksIGZkX2ZpbGVzdGF0X3NldF9zaXplOiBaKGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICAgICAgYSA9IGQoYSwgSWIpO1xuICAgICAgICAgICAgICAgIHAuZnRydW5jYXRlU3luYyhhLnJlYWwsIE51bWJlcihiKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICB9KSwgZmRfZmlsZXN0YXRfc2V0X3RpbWVzOiBaKGZ1bmN0aW9uIChhLCBjLCBlLCBnKSB7IGEgPSBkKGEsIEpiKTsgdmFyIGYgPSBwLmZzdGF0U3luYyhhLnJlYWwpLCB0ID0gZi5hdGltZTsgZiA9IGYubXRpbWU7IHZhciBxID0gJGIoYigwKSk7IGlmICgzID09PSAoZyAmIDMpIHx8IDEyID09PSAoZyAmIDEyKSlcbiAgICAgICAgICAgICAgICByZXR1cm4gMjg7IDEgPT09IChnICYgMSkgPyB0ID0gJGIoYykgOiAyID09PSAoZyAmIDIpICYmICh0ID0gcSk7IDQgPT09IChnICYgNCkgPyBmID0gJGIoZSkgOiA4ID09PSAoZyAmIDgpICYmIChmID0gcSk7IHAuZnV0aW1lc1N5bmMoYS5yZWFsLCBuZXcgRGF0ZSh0KSwgbmV3IERhdGUoZikpOyByZXR1cm4gMDsgfSksIGZkX3ByZXN0YXRfZ2V0OiBaKGZ1bmN0aW9uIChhLCBiKSB7IGEgPSBkKGEsIGsoMCkpOyBpZiAoIWEucGF0aClcbiAgICAgICAgICAgICAgICByZXR1cm4gMjg7IGcucmVmcmVzaE1lbW9yeSgpOyBnLnZpZXcuc2V0VWludDgoYiwgMCk7IGcudmlldy5zZXRVaW50MzIoYiArIDQsIEUuYnl0ZUxlbmd0aChhLmZha2VQYXRoKSwgITApOyByZXR1cm4gMDsgfSksIGZkX3ByZXN0YXRfZGlyX25hbWU6IFooZnVuY3Rpb24gKGEsIGIsIGMpIHtcbiAgICAgICAgICAgICAgICBhID1cbiAgICAgICAgICAgICAgICAgICAgZChhLCBrKDApKTtcbiAgICAgICAgICAgICAgICBpZiAoIWEucGF0aClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDI4O1xuICAgICAgICAgICAgICAgIGcucmVmcmVzaE1lbW9yeSgpO1xuICAgICAgICAgICAgICAgIEUuZnJvbShnLm1lbW9yeS5idWZmZXIpLndyaXRlKGEuZmFrZVBhdGgsIGIsIGMsIFwidXRmOFwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgIH0pLCBmZF9wd3JpdGU6IFooZnVuY3Rpb24gKGEsIGIsIGMsIGYsIGgpIHsgdmFyIHQgPSBkKGEsIFQgfCBRKSwgcSA9IDA7IGUoYiwgYykuZm9yRWFjaChmdW5jdGlvbiAoYSkgeyBmb3IgKHZhciBiID0gMDsgYiA8IGEuYnl0ZUxlbmd0aDspXG4gICAgICAgICAgICAgICAgYiArPSBwLndyaXRlU3luYyh0LnJlYWwsIGEsIGIsIGEuYnl0ZUxlbmd0aCAtIGIsIE51bWJlcihmKSArIHEgKyBiKTsgcSArPSBiOyB9KTsgZy52aWV3LnNldFVpbnQzMihoLCBxLCAhMCk7IHJldHVybiAwOyB9KSwgZmRfd3JpdGU6IFooZnVuY3Rpb24gKGEsIGIsIGMsIGYpIHtcbiAgICAgICAgICAgICAgICB2YXIgdCA9IGQoYSwgVCksIHEgPSAwO1xuICAgICAgICAgICAgICAgIGUoYiwgYykuZm9yRWFjaChmdW5jdGlvbiAoYSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBiID0gMDsgYiA8IGEuYnl0ZUxlbmd0aDspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gcC53cml0ZVN5bmModC5yZWFsLCBhLCBiLCBhLmJ5dGVMZW5ndGggLSBiLCB0Lm9mZnNldCA/IE51bWJlcih0Lm9mZnNldCkgOiBudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHQub2Zmc2V0ICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKHQub2Zmc2V0ICs9IGsoYykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYiArPSBjO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHEgKz0gYjtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBnLnZpZXcuc2V0VWludDMyKGYsIHEsICEwKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgIH0pLCBmZF9wcmVhZDogWihmdW5jdGlvbiAoYSwgYiwgYywgZiwgaCkgeyB2YXIgdDsgYSA9IGQoYSwgUCB8IFEpOyB2YXIgcSA9IDA7IHRyeSB7XG4gICAgICAgICAgICAgICAgdmFyIHggPSBjYShlKGIsIGMpKSwgbCA9IHgubmV4dCgpO1xuICAgICAgICAgICAgICAgIGE6IGZvciAoOyAhbC5kb25lOyBsID0geC5uZXh0KCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSBsLnZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGIgPSAwOyBiIDwgbi5ieXRlTGVuZ3RoOykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGljID0gbi5ieXRlTGVuZ3RoIC0gYiwgQiA9IHAucmVhZFN5bmMoYS5yZWFsLCBuLCBiLCBuLmJ5dGVMZW5ndGggLSBiLCBOdW1iZXIoZikgKyBxICsgYik7XG4gICAgICAgICAgICAgICAgICAgICAgICBiICs9IEI7XG4gICAgICAgICAgICAgICAgICAgICAgICBxICs9IEI7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoMCA9PT0gQiB8fCBCIDwgaWMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgYTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBxICs9IGI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKFUpIHtcbiAgICAgICAgICAgICAgICB2YXIgciA9IHsgZXJyb3I6IFUgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGwgJiYgIWwuZG9uZSAmJiAodCA9IHgucmV0dXJuKSAmJiB0LmNhbGwoeCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocilcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IHIuZXJyb3I7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBnLnZpZXcuc2V0VWludDMyKGgsIHEsICEwKTsgcmV0dXJuIDA7IH0pLCBmZF9yZWFkOiBaKGZ1bmN0aW9uIChhLCBiLCBjLCBmKSB7XG4gICAgICAgICAgICAgICAgdmFyIHQ7XG4gICAgICAgICAgICAgICAgYSA9IGQoYSwgUCk7XG4gICAgICAgICAgICAgICAgdmFyIHEgPSAwID09PSBhLnJlYWwsIGggPSAwO1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB4ID0gY2EoZShiLCBjKSksIGwgPSB4Lm5leHQoKTtcbiAgICAgICAgICAgICAgICAgICAgYTogZm9yICg7ICFsLmRvbmU7IGwgPSB4Lm5leHQoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSBsLnZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChiID0gMDsgYiA8IG4uYnl0ZUxlbmd0aDspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgQiA9IG4uYnl0ZUxlbmd0aCAtIGIsIHIgPSBwLnJlYWRTeW5jKGEucmVhbCwgbiwgYiwgQiwgcSB8fCB2b2lkIDAgPT09IGEub2Zmc2V0ID8gbnVsbCA6IE51bWJlcihhLm9mZnNldCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEgfHwgKGEub2Zmc2V0ID0gKGEub2Zmc2V0ID8gYS5vZmZzZXQgOiBrKDApKSArIGsocikpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgKz0gcjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoICs9IHI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDAgPT09IHIgfHwgciA8IEIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIGE7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKFUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHkgPSB7IGVycm9yOiBVIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbCAmJiAhbC5kb25lICYmICh0ID0geC5yZXR1cm4pICYmIHQuY2FsbCh4KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh5KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IHkuZXJyb3I7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZy52aWV3LnNldFVpbnQzMihmLCBoLCAhMCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICB9KSwgZmRfcmVhZGRpcjogWihmdW5jdGlvbiAoYSwgYiwgYywgZSwgZikge1xuICAgICAgICAgICAgICAgIGEgPSBkKGEsIHliKTtcbiAgICAgICAgICAgICAgICBnLnJlZnJlc2hNZW1vcnkoKTtcbiAgICAgICAgICAgICAgICB2YXIgdCA9IHAucmVhZGRpclN5bmMoYS5wYXRoLCB7IHdpdGhGaWxlVHlwZXM6ICEwIH0pLCBxID0gYjtcbiAgICAgICAgICAgICAgICBmb3IgKGUgPSBOdW1iZXIoZSk7IGUgPCB0Lmxlbmd0aDsgZSArPSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBoID0gdFtlXSwgeCA9IEUuYnl0ZUxlbmd0aChoLm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYiAtIHEgPiBjKVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGcudmlldy5zZXRCaWdVaW50NjQoYiwgayhlICsgMSksICEwKTtcbiAgICAgICAgICAgICAgICAgICAgYiArPSA4O1xuICAgICAgICAgICAgICAgICAgICBpZiAoYiAtIHEgPiBjKVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIHZhciBsID0gcC5zdGF0U3luYyh5LnJlc29sdmUoYS5wYXRoLCBoLm5hbWUpKTtcbiAgICAgICAgICAgICAgICAgICAgZy52aWV3LnNldEJpZ1VpbnQ2NChiLCBrKGwuaW5vKSwgITApO1xuICAgICAgICAgICAgICAgICAgICBiICs9IDg7XG4gICAgICAgICAgICAgICAgICAgIGlmIChiIC0gcSA+IGMpXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZy52aWV3LnNldFVpbnQzMihiLCB4LCAhMCk7XG4gICAgICAgICAgICAgICAgICAgIGIgKz0gNDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGIgLSBxID4gYylcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKCEwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIGwuaXNCbG9ja0RldmljZSgpOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwgPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBsLmlzQ2hhcmFjdGVyRGV2aWNlKCk6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9IDI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIGwuaXNEaXJlY3RvcnkoKTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gMztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgbC5pc0ZJRk8oKTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gNjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgbC5pc0ZpbGUoKTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gNDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgbC5pc1NvY2tldCgpOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwgPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA2O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBsLmlzU3ltYm9saWNMaW5rKCk6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9IDc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiBsID0gMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBnLnZpZXcuc2V0VWludDgoYiwgbCk7XG4gICAgICAgICAgICAgICAgICAgIGIgKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgYiArPSAzO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYiArIHggPj0gcSArIGMpXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgRS5mcm9tKGcubWVtb3J5LmJ1ZmZlcikud3JpdGUoaC5uYW1lLCBiKTtcbiAgICAgICAgICAgICAgICAgICAgYiArPSB4O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBnLnZpZXcuc2V0VWludDMyKGYsIE1hdGgubWluKGIgLSBxLCBjKSwgITApO1xuICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgfSksIGZkX3JlbnVtYmVyOiBaKGZ1bmN0aW9uIChhLCBiKSB7IGQoYSwgaygwKSk7IGQoYiwgaygwKSk7IHAuY2xvc2VTeW5jKGcuRkRfTUFQLmdldChhKS5yZWFsKTsgZy5GRF9NQVAuc2V0KGEsIGcuRkRfTUFQLmdldChiKSk7IGcuRkRfTUFQLmRlbGV0ZShiKTsgcmV0dXJuIDA7IH0pLCBmZF9zZWVrOiBaKGZ1bmN0aW9uIChhLCBiLCBjLCBlKSB7XG4gICAgICAgICAgICAgICAgYSA9IGQoYSwgUSk7XG4gICAgICAgICAgICAgICAgZy5yZWZyZXNoTWVtb3J5KCk7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChjKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIGEub2Zmc2V0ID0gKGEub2Zmc2V0ID8gYS5vZmZzZXQgOiBrKDApKSArIGsoYik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHAuZnN0YXRTeW5jKGEucmVhbCkuc2l6ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGEub2Zmc2V0ID1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrKGMpICsgayhiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6IGEub2Zmc2V0ID0gayhiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZy52aWV3LnNldEJpZ1VpbnQ2NChlLCBhLm9mZnNldCwgITApO1xuICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgfSksIGZkX3RlbGw6IFooZnVuY3Rpb24gKGEsIGIpIHsgYSA9IGQoYSwgcWIpOyBnLnJlZnJlc2hNZW1vcnkoKTsgYS5vZmZzZXQgfHwgKGEub2Zmc2V0ID0gaygwKSk7IGcudmlldy5zZXRCaWdVaW50NjQoYiwgYS5vZmZzZXQsICEwKTsgcmV0dXJuIDA7IH0pLCBmZF9zeW5jOiBaKGZ1bmN0aW9uIChhKSB7IGEgPSBkKGEsIFMpOyBwLmZzeW5jU3luYyhhLnJlYWwpOyByZXR1cm4gMDsgfSksIHBhdGhfY3JlYXRlX2RpcmVjdG9yeTogWihmdW5jdGlvbiAoYSwgYiwgYykgeyBhID0gZChhLCB0Yik7IGlmICghYS5wYXRoKVxuICAgICAgICAgICAgICAgIHJldHVybiAyODsgZy5yZWZyZXNoTWVtb3J5KCk7IGIgPSBFLmZyb20oZy5tZW1vcnkuYnVmZmVyLCBiLCBjKS50b1N0cmluZygpOyBwLm1rZGlyU3luYyh5LnJlc29sdmUoYS5wYXRoLCBiKSk7IHJldHVybiAwOyB9KSwgcGF0aF9maWxlc3RhdF9nZXQ6IFooZnVuY3Rpb24gKGEsIGIsIGMsIGUsIGYpIHtcbiAgICAgICAgICAgICAgICBhID0gZChhLCBDYik7XG4gICAgICAgICAgICAgICAgaWYgKCFhLnBhdGgpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAyODtcbiAgICAgICAgICAgICAgICBnLnJlZnJlc2hNZW1vcnkoKTtcbiAgICAgICAgICAgICAgICBjID0gRS5mcm9tKGcubWVtb3J5LmJ1ZmZlciwgYywgZSkudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICBjID0gcC5zdGF0U3luYyh5LnJlc29sdmUoYS5wYXRoLCBjKSk7XG4gICAgICAgICAgICAgICAgZy52aWV3LnNldEJpZ1VpbnQ2NChmLCBrKGMuZGV2KSwgITApO1xuICAgICAgICAgICAgICAgIGYgKz0gODtcbiAgICAgICAgICAgICAgICBnLnZpZXcuc2V0QmlnVWludDY0KGYsIGsoYy5pbm8pLCAhMCk7XG4gICAgICAgICAgICAgICAgZiArPSA4O1xuICAgICAgICAgICAgICAgIGcudmlldy5zZXRVaW50OChmLCBjYyhnLCB2b2lkIDAsIGMpLmZpbGV0eXBlKTtcbiAgICAgICAgICAgICAgICBmICs9IDg7XG4gICAgICAgICAgICAgICAgZy52aWV3LnNldEJpZ1VpbnQ2NChmLCBrKGMubmxpbmspLCAhMCk7XG4gICAgICAgICAgICAgICAgZiArPSA4O1xuICAgICAgICAgICAgICAgIGcudmlldy5zZXRCaWdVaW50NjQoZiwgayhjLnNpemUpLCAhMCk7XG4gICAgICAgICAgICAgICAgZiArPSA4O1xuICAgICAgICAgICAgICAgIGcudmlldy5zZXRCaWdVaW50NjQoZiwgWShjLmF0aW1lTXMpLCAhMCk7XG4gICAgICAgICAgICAgICAgZiArPSA4O1xuICAgICAgICAgICAgICAgIGcudmlldy5zZXRCaWdVaW50NjQoZiwgWShjLm10aW1lTXMpLCAhMCk7XG4gICAgICAgICAgICAgICAgZy52aWV3LnNldEJpZ1VpbnQ2NChmICsgOCwgWShjLmN0aW1lTXMpLCAhMCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICB9KSwgcGF0aF9maWxlc3RhdF9zZXRfdGltZXM6IFooZnVuY3Rpb24gKGEsIGMsIGUsIGYsIGgsIGwsIG4pIHtcbiAgICAgICAgICAgICAgICBhID0gZChhLCBFYik7XG4gICAgICAgICAgICAgICAgaWYgKCFhLnBhdGgpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAyODtcbiAgICAgICAgICAgICAgICBnLnJlZnJlc2hNZW1vcnkoKTtcbiAgICAgICAgICAgICAgICB2YXIgdCA9IHAuZnN0YXRTeW5jKGEucmVhbCk7XG4gICAgICAgICAgICAgICAgYyA9IHQuYXRpbWU7XG4gICAgICAgICAgICAgICAgdCA9IHQubXRpbWU7XG4gICAgICAgICAgICAgICAgdmFyIHEgPSAkYihiKDApKTtcbiAgICAgICAgICAgICAgICBpZiAoMyA9PT0gKG4gJiAzKSB8fCAxMiA9PT0gKG4gJiAxMikpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAyODtcbiAgICAgICAgICAgICAgICAxID09PSAobiAmIDEpID8gYyA9ICRiKGgpIDogMiA9PT0gKG4gJiAyKSAmJiAoYyA9IHEpO1xuICAgICAgICAgICAgICAgIDQgPT09IChuICYgNCkgPyB0ID0gJGIobCkgOiA4ID09PSAobiAmIDgpICYmICh0ID0gcSk7XG4gICAgICAgICAgICAgICAgZSA9IEUuZnJvbShnLm1lbW9yeS5idWZmZXIsIGUsIGYpLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgcC51dGltZXNTeW5jKHkucmVzb2x2ZShhLnBhdGgsIGUpLCBuZXcgRGF0ZShjKSwgbmV3IERhdGUodCkpO1xuICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgfSksIHBhdGhfbGluazogWihmdW5jdGlvbiAoYSwgYiwgYywgZSwgZiwgaCwgbCkge1xuICAgICAgICAgICAgICAgIGEgPSBkKGEsIHZiKTtcbiAgICAgICAgICAgICAgICBmID0gZChmLCB3Yik7XG4gICAgICAgICAgICAgICAgaWYgKCFhLnBhdGggfHwgIWYucGF0aClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDI4O1xuICAgICAgICAgICAgICAgIGcucmVmcmVzaE1lbW9yeSgpO1xuICAgICAgICAgICAgICAgIGMgPSBFLmZyb20oZy5tZW1vcnkuYnVmZmVyLCBjLCBlKS50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgIGggPSBFLmZyb20oZy5tZW1vcnkuYnVmZmVyLCBoLCBsKS50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgIHAubGlua1N5bmMoeS5yZXNvbHZlKGEucGF0aCwgYyksIHkucmVzb2x2ZShmLnBhdGgsIGgpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgIH0pLCBwYXRoX29wZW46IFooZnVuY3Rpb24gKGEsIGIsIGMsIGUsIGYsIGgsIGwsIG4sIHIpIHtcbiAgICAgICAgICAgICAgICBiID0gZChhLCB4Yik7XG4gICAgICAgICAgICAgICAgaCA9IGsoaCk7XG4gICAgICAgICAgICAgICAgbCA9IGsobCk7XG4gICAgICAgICAgICAgICAgYSA9IChoICYgKFAgfCB5YikpICE9PSBrKDApO1xuICAgICAgICAgICAgICAgIHZhciB0ID0gKGggJiAoTyB8IFQgfCBzYiB8IEliKSkgIT09IGsoMCk7XG4gICAgICAgICAgICAgICAgaWYgKHQgJiYgYSlcbiAgICAgICAgICAgICAgICAgICAgdmFyIHEgPSBwLmNvbnN0YW50cy5PX1JEV1I7XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICBhID8gcSA9IHAuY29uc3RhbnRzLk9fUkRPTkxZIDogdCAmJiAocSA9IHAuY29uc3RhbnRzLk9fV1JPTkxZKTtcbiAgICAgICAgICAgICAgICBhID0gaCB8IHhiO1xuICAgICAgICAgICAgICAgIGggfD0gbDtcbiAgICAgICAgICAgICAgICAwICE9PSAoZiAmIDEpICYmIChxIHw9IHAuY29uc3RhbnRzLk9fQ1JFQVQsIGEgfD0gdWIpO1xuICAgICAgICAgICAgICAgIDAgIT09IChmICYgMikgJiYgKHEgfD0gcC5jb25zdGFudHMuT19ESVJFQ1RPUlkpO1xuICAgICAgICAgICAgICAgIDAgIT09IChmICYgNCkgJiYgKHEgfD0gcC5jb25zdGFudHMuT19FWENMKTtcbiAgICAgICAgICAgICAgICAwICE9PSAoZiAmIDgpICYmIChxIHw9IHAuY29uc3RhbnRzLk9fVFJVTkMsIGEgfD0gRGIpO1xuICAgICAgICAgICAgICAgIDAgIT09IChuICYgMSkgJiYgKHEgfD0gcC5jb25zdGFudHMuT19BUFBFTkQpO1xuICAgICAgICAgICAgICAgIDAgIT09IChuICYgMikgJiYgKHEgPSBwLmNvbnN0YW50cy5PX0RTWU5DID8gcSB8IHAuY29uc3RhbnRzLk9fRFNZTkMgOlxuICAgICAgICAgICAgICAgICAgICBxIHwgcC5jb25zdGFudHMuT19TWU5DLCBoIHw9IE8pO1xuICAgICAgICAgICAgICAgIDAgIT09IChuICYgNCkgJiYgKHEgfD0gcC5jb25zdGFudHMuT19OT05CTE9DSyk7XG4gICAgICAgICAgICAgICAgMCAhPT0gKG4gJiA4KSAmJiAocSA9IHAuY29uc3RhbnRzLk9fUlNZTkMgPyBxIHwgcC5jb25zdGFudHMuT19SU1lOQyA6IHEgfCBwLmNvbnN0YW50cy5PX1NZTkMsIGggfD0gUyk7XG4gICAgICAgICAgICAgICAgMCAhPT0gKG4gJiAxNikgJiYgKHEgfD0gcC5jb25zdGFudHMuT19TWU5DLCBoIHw9IFMpO1xuICAgICAgICAgICAgICAgIHQgJiYgMCA9PT0gKHEgJiAocC5jb25zdGFudHMuT19BUFBFTkQgfCBwLmNvbnN0YW50cy5PX1RSVU5DKSkgJiYgKGggfD0gUSk7XG4gICAgICAgICAgICAgICAgZy5yZWZyZXNoTWVtb3J5KCk7XG4gICAgICAgICAgICAgICAgYyA9IEUuZnJvbShnLm1lbW9yeS5idWZmZXIsIGMsIGUpLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgYyA9IHkucmVzb2x2ZShiLnBhdGgsIGMpO1xuICAgICAgICAgICAgICAgIGlmICh5LnJlbGF0aXZlKGIucGF0aCwgYykuc3RhcnRzV2l0aChcIi4uXCIpKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gNzY7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHggPSBwLnJlYWxwYXRoU3luYyhjKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHkucmVsYXRpdmUoYi5wYXRoLCB4KS5zdGFydHNXaXRoKFwiLi5cIikpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gNzY7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChVKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChcIkVOT0VOVFwiID09PSBVLmNvZGUpXG4gICAgICAgICAgICAgICAgICAgICAgICB4ID0gYztcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgVTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIEIgPSBwLnN0YXRTeW5jKHgpLmlzRGlyZWN0b3J5KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChVKSB7IH1cbiAgICAgICAgICAgICAgICBxID0gIXQgJiYgQiA/IHAub3BlblN5bmMoeCwgcC5jb25zdGFudHMuT19SRE9OTFkpIDogcC5vcGVuU3luYyh4LCBxKTtcbiAgICAgICAgICAgICAgICBCID0gZmEoZy5GRF9NQVAua2V5cygpKS5yZXZlcnNlKClbMF0gKyAxO1xuICAgICAgICAgICAgICAgIGcuRkRfTUFQLnNldChCLCB7IHJlYWw6IHEsIGZpbGV0eXBlOiB2b2lkIDAsIHJpZ2h0czogeyBiYXNlOiBhLCBpbmhlcml0aW5nOiBoIH0sIHBhdGg6IHggfSk7XG4gICAgICAgICAgICAgICAgYmMoZywgQik7XG4gICAgICAgICAgICAgICAgZy52aWV3LnNldFVpbnQzMihyLCBCLCAhMCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICB9KSwgcGF0aF9yZWFkbGluazogWihmdW5jdGlvbiAoYSwgYiwgYywgZSwgZiwgaCkgeyBhID0gZChhLCB6Yik7IGlmICghYS5wYXRoKVxuICAgICAgICAgICAgICAgIHJldHVybiAyODsgZy5yZWZyZXNoTWVtb3J5KCk7IGIgPSBFLmZyb20oZy5tZW1vcnkuYnVmZmVyLCBiLCBjKS50b1N0cmluZygpOyBiID0geS5yZXNvbHZlKGEucGF0aCwgYik7IGIgPSBwLnJlYWRsaW5rU3luYyhiKTsgZSA9IEUuZnJvbShnLm1lbW9yeS5idWZmZXIpLndyaXRlKGIsIGUsIGYpOyBnLnZpZXcuc2V0VWludDMyKGgsIGUsICEwKTsgcmV0dXJuIDA7IH0pLFxuICAgICAgICAgICAgcGF0aF9yZW1vdmVfZGlyZWN0b3J5OiBaKGZ1bmN0aW9uIChhLCBiLCBjKSB7IGEgPSBkKGEsIExiKTsgaWYgKCFhLnBhdGgpXG4gICAgICAgICAgICAgICAgcmV0dXJuIDI4OyBnLnJlZnJlc2hNZW1vcnkoKTsgYiA9IEUuZnJvbShnLm1lbW9yeS5idWZmZXIsIGIsIGMpLnRvU3RyaW5nKCk7IHAucm1kaXJTeW5jKHkucmVzb2x2ZShhLnBhdGgsIGIpKTsgcmV0dXJuIDA7IH0pLCBwYXRoX3JlbmFtZTogWihmdW5jdGlvbiAoYSwgYiwgYywgZSwgZiwgaCkgeyBhID0gZChhLCBBYik7IGUgPSBkKGUsIEJiKTsgaWYgKCFhLnBhdGggfHwgIWUucGF0aClcbiAgICAgICAgICAgICAgICByZXR1cm4gMjg7IGcucmVmcmVzaE1lbW9yeSgpOyBiID0gRS5mcm9tKGcubWVtb3J5LmJ1ZmZlciwgYiwgYykudG9TdHJpbmcoKTsgZiA9IEUuZnJvbShnLm1lbW9yeS5idWZmZXIsIGYsIGgpLnRvU3RyaW5nKCk7IHAucmVuYW1lU3luYyh5LnJlc29sdmUoYS5wYXRoLCBiKSwgeS5yZXNvbHZlKGUucGF0aCwgZikpOyByZXR1cm4gMDsgfSksIHBhdGhfc3ltbGluazogWihmdW5jdGlvbiAoYSwgYiwgYywgZSwgZikge1xuICAgICAgICAgICAgICAgIGMgPSBkKGMsIEtiKTtcbiAgICAgICAgICAgICAgICBpZiAoIWMucGF0aClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDI4O1xuICAgICAgICAgICAgICAgIGcucmVmcmVzaE1lbW9yeSgpO1xuICAgICAgICAgICAgICAgIGEgPSBFLmZyb20oZy5tZW1vcnkuYnVmZmVyLCBhLCBiKS50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgIGUgPSBFLmZyb20oZy5tZW1vcnkuYnVmZmVyLCBlLCBmKS50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgIHAuc3ltbGlua1N5bmMoYSwgeS5yZXNvbHZlKGMucGF0aCwgZSkpO1xuICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgfSksIHBhdGhfdW5saW5rX2ZpbGU6IFooZnVuY3Rpb24gKGEsIGIsIGMpIHsgYSA9IGQoYSwgTWIpOyBpZiAoIWEucGF0aClcbiAgICAgICAgICAgICAgICByZXR1cm4gMjg7IGcucmVmcmVzaE1lbW9yeSgpOyBiID0gRS5mcm9tKGcubWVtb3J5LmJ1ZmZlciwgYiwgYykudG9TdHJpbmcoKTsgcC51bmxpbmtTeW5jKHkucmVzb2x2ZShhLnBhdGgsIGIpKTsgcmV0dXJuIDA7IH0pLCBwb2xsX29uZW9mZjogZnVuY3Rpb24gKGEsIGMsIGQsIGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgZiA9IDAsIGggPSAwO1xuICAgICAgICAgICAgICAgIGcucmVmcmVzaE1lbW9yeSgpO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGwgPSAwOyBsIDwgZDsgbCArPSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBuID0gZy52aWV3LmdldEJpZ1VpbnQ2NChhLCAhMCk7XG4gICAgICAgICAgICAgICAgICAgIGEgKz0gODtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHAgPSBnLnZpZXcuZ2V0VWludDgoYSk7XG4gICAgICAgICAgICAgICAgICAgIGEgKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYSArPSA3O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcudmlldy5nZXRCaWdVaW50NjQoYSwgITApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgKz0gODtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcSA9IGcudmlldy5nZXRVaW50MzIoYSwgITApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgKz0gNDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhICs9IDQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcCA9IGcudmlldy5nZXRCaWdVaW50NjQoYSwgITApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgKz0gODtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLnZpZXcuZ2V0QmlnVWludDY0KGEsICEwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhICs9IDg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHQgPSBnLnZpZXcuZ2V0VWludDE2KGEsICEwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhICs9IDI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYSArPSA2O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB4ID0gMSA9PT0gdDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxID0gayhiKHEpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsID09PSBxID8gdCA9IDI4IDogKHAgPSB4ID8gcCA6IHEgKyBwLCBoID0gcCA+IGggPyBwIDogaCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZy52aWV3LnNldEJpZ1VpbnQ2NChjLCBuLCAhMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYyArPSA4O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcudmlldy5zZXRVaW50MTYoYywgdCwgITApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgKz0gMjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLnZpZXcuc2V0VWludDgoYywgMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYyArPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgKz0gNTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmICs9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYSArPSAzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcudmlldy5nZXRVaW50MzIoYSwgITApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgKz0gNDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLnZpZXcuc2V0QmlnVWludDY0KGMsIG4sICEwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjICs9IDg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZy52aWV3LnNldFVpbnQxNihjLCA1MiwgITApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgKz0gMjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLnZpZXcuc2V0VWludDgoYywgcCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYyArPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgKz0gNTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmICs9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiByZXR1cm4gMjg7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZm9yIChnLnZpZXcuc2V0VWludDMyKGUsIGYsICEwKTsgci5ocnRpbWUoKSA8IGg7KVxuICAgICAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICB9LCBwcm9jX2V4aXQ6IGZ1bmN0aW9uIChhKSB7IHIuZXhpdChhKTsgcmV0dXJuIDA7IH0sIHByb2NfcmFpc2U6IGZ1bmN0aW9uIChhKSB7IGlmICghKGEgaW4gWGIpKVxuICAgICAgICAgICAgICAgIHJldHVybiAyODsgci5raWxsKFhiW2FdKTsgcmV0dXJuIDA7IH0sIHJhbmRvbV9nZXQ6IGZ1bmN0aW9uIChhLCBiKSB7IGcucmVmcmVzaE1lbW9yeSgpOyByLnJhbmRvbUZpbGxTeW5jKG5ldyBVaW50OEFycmF5KGcubWVtb3J5LmJ1ZmZlciksIGEsIGIpOyByZXR1cm4gMDsgfSwgc2NoZWRfeWllbGQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIDA7IH0sIHNvY2tfcmVjdjogZnVuY3Rpb24gKCkgeyByZXR1cm4gNTI7IH0sIHNvY2tfc2VuZDogZnVuY3Rpb24gKCkgeyByZXR1cm4gNTI7IH0sIHNvY2tfc2h1dGRvd246IGZ1bmN0aW9uICgpIHsgcmV0dXJuIDUyOyB9IH07XG4gICAgICAgIGEudHJhY2VTeXNjYWxscyAmJiBPYmplY3Qua2V5cyh0aGlzLndhc2lJbXBvcnQpLmZvckVhY2goZnVuY3Rpb24gKGEpIHtcbiAgICAgICAgICAgIHZhciBiID0gZy53YXNpSW1wb3J0W2FdO1xuICAgICAgICAgICAgZy53YXNpSW1wb3J0W2FdID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGMgPSBbXSwgZCA9IDA7IGQgPCBhcmd1bWVudHMubGVuZ3RoOyBkKyspXG4gICAgICAgICAgICAgICAgICAgIGNbZF0gPSBhcmd1bWVudHNbZF07XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJXQVNJOiB3YXNpSW1wb3J0IGNhbGxlZDogXCIgKyBhICsgXCIgKFwiICsgYyArIFwiKVwiKTtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IGIuYXBwbHkodm9pZCAwLCBmYShjKSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiV0FTSTogID0+IFwiICsgZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXRjaCAoSGIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgY29uc29sZS5sb2coXCJDYXRjaGVkIGVycm9yOiBcIiArIEhiKSwgSGI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGEucHJvdG90eXBlLnJlZnJlc2hNZW1vcnkgPSBmdW5jdGlvbiAoKSB7IHRoaXMudmlldyAmJiAwICE9PSB0aGlzLnZpZXcuYnVmZmVyLmJ5dGVMZW5ndGggfHwgKHRoaXMudmlldyA9IG5ldyBpYSh0aGlzLm1lbW9yeS5idWZmZXIpKTsgfTtcbiAgICBhLnByb3RvdHlwZS5zZXRNZW1vcnkgPSBmdW5jdGlvbiAoYSkgeyB0aGlzLm1lbW9yeSA9IGE7IH07XG4gICAgYS5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbiAoYSkge1xuICAgICAgICBhID0gYS5leHBvcnRzO1xuICAgICAgICBpZiAobnVsbCA9PT0gYSB8fCBcIm9iamVjdFwiICE9PSB0eXBlb2YgYSlcbiAgICAgICAgICAgIHRocm93IEVycm9yKFwiaW5zdGFuY2UuZXhwb3J0cyBtdXN0IGJlIGFuIE9iamVjdC4gUmVjZWl2ZWQgXCIgK1xuICAgICAgICAgICAgICAgIGEgKyBcIi5cIik7XG4gICAgICAgIHZhciBiID0gYS5tZW1vcnk7XG4gICAgICAgIGlmICghKGIgaW5zdGFuY2VvZiBXZWJBc3NlbWJseS5NZW1vcnkpKVxuICAgICAgICAgICAgdGhyb3cgRXJyb3IoXCJpbnN0YW5jZS5leHBvcnRzLm1lbW9yeSBtdXN0IGJlIGEgV2ViQXNzZW1ibHkuTWVtb3J5LiBSZWNjZWl2ZWQgXCIgKyBiICsgXCIuXCIpO1xuICAgICAgICB0aGlzLnNldE1lbW9yeShiKTtcbiAgICAgICAgYS5fc3RhcnQgJiYgYS5fc3RhcnQoKTtcbiAgICB9O1xuICAgIGEucHJvdG90eXBlLmdldEltcG9ydE5hbWVzcGFjZSA9IGZ1bmN0aW9uIChhKSB7XG4gICAgICAgIHZhciBiLCBkID0gbnVsbDtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGZvciAodmFyIGUgPSBjYShXZWJBc3NlbWJseS5Nb2R1bGUuaW1wb3J0cyhhKSksIGYgPSBlLm5leHQoKTsgIWYuZG9uZTsgZiA9IGUubmV4dCgpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGcgPSBmLnZhbHVlO1xuICAgICAgICAgICAgICAgIGlmIChcImZ1bmN0aW9uXCIgPT09IGcua2luZCAmJiBnLm1vZHVsZS5zdGFydHNXaXRoKFwid2FzaV9cIikpXG4gICAgICAgICAgICAgICAgICAgIGlmICghZClcbiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBnLm1vZHVsZTtcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZCAhPT0gZy5tb2R1bGUpXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcihcIk11bHRpcGxlIG5hbWVzcGFjZXMgZGV0ZWN0ZWQuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChsKSB7XG4gICAgICAgICAgICB2YXIgaCA9IHsgZXJyb3I6IGwgfTtcbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgZiAmJlxuICAgICAgICAgICAgICAgICAgICAhZi5kb25lICYmIChiID0gZS5yZXR1cm4pICYmIGIuY2FsbChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgICAgIGlmIChoKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBoLmVycm9yO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkO1xuICAgIH07XG4gICAgYS5wcm90b3R5cGUuZ2V0SW1wb3J0cyA9IGZ1bmN0aW9uIChhKSB7IHN3aXRjaCAodGhpcy5nZXRJbXBvcnROYW1lc3BhY2UoYSkpIHtcbiAgICAgICAgY2FzZSBcIndhc2lfdW5zdGFibGVcIjogcmV0dXJuIHsgd2FzaV91bnN0YWJsZTogdGhpcy53YXNpSW1wb3J0IH07XG4gICAgICAgIGNhc2UgXCJ3YXNpX3NuYXBzaG90X3ByZXZpZXcxXCI6IHJldHVybiB7IHdhc2lfc25hcHNob3RfcHJldmlldzE6IHRoaXMud2FzaUltcG9ydCB9O1xuICAgICAgICBkZWZhdWx0OiB0aHJvdyBFcnJvcihcIkNhbid0IGRldGVjdCBhIFdBU0kgbmFtZXNwYWNlIGZvciB0aGUgV2ViQXNzZW1ibHkgTW9kdWxlXCIpO1xuICAgIH0gfTtcbiAgICBhLmRlZmF1bHRCaW5kaW5ncyA9IHBiO1xuICAgIHJldHVybiBhO1xufSgpO1xuZXhwb3J0cy5XQVNJRXJyb3IgPSBhYztcbmV4cG9ydHMuV0FTSUV4aXRFcnJvciA9IG5iO1xuZXhwb3J0cy5XQVNJS2lsbEVycm9yID0gb2I7XG5leHBvcnRzLldBU0kgPSBkYztcbmV4cG9ydHMuZGVmYXVsdCA9IGRjO1xuXG4vKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi99LmNhbGwodGhpcywgX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi8uLi8uLi8uLi8uLi8uLi93ZWJwYWNrQDQuNDYuMF93ZWJwYWNrLWNsaUA0LjEwLjAvbm9kZV9tb2R1bGVzL3dlYnBhY2svYnVpbGRpbi9nbG9iYWwuanMgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vd2VicGFja0A0LjQ2LjBfd2VicGFjay1jbGlANC4xMC4wL25vZGVfbW9kdWxlcy93ZWJwYWNrL2J1aWxkaW4vZ2xvYmFsLmpzXCIpKSlcblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9Ad2FzbWVyK3dhc2lAMC4xMi4wL25vZGVfbW9kdWxlcy9Ad2FzbWVyL3dhc2kvbGliL2luZGV4LmVzbS5qcz8iKTsKCi8qKiovIH0pLAoKLyoqKi8gIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9Ad2FzbWVyK3dhc2lAMC4xMi4wL25vZGVfbW9kdWxlcy9Ad2FzbWVyL3dhc2kvbGliL2luZGV4LmpzIjoKLyohKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiEqXAogICEqKiogL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL0B3YXNtZXIrd2FzaUAwLjEyLjAvbm9kZV9tb2R1bGVzL0B3YXNtZXIvd2FzaS9saWIvaW5kZXguanMgKioqIQogIFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKiEgbm8gc3RhdGljIGV4cG9ydHMgZm91bmQgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwpldmFsKCJcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChiLCBwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGlmICh0eXBlb2YgYiAhPT0gXCJmdW5jdGlvblwiICYmIGIgIT09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2xhc3MgZXh0ZW5kcyB2YWx1ZSBcIiArIFN0cmluZyhiKSArIFwiIGlzIG5vdCBhIGNvbnN0cnVjdG9yIG9yIG51bGxcIik7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG52YXIgX19zcHJlYWRBcnJheSA9ICh0aGlzICYmIHRoaXMuX19zcHJlYWRBcnJheSkgfHwgZnVuY3Rpb24gKHRvLCBmcm9tLCBwYWNrKSB7XG4gICAgaWYgKHBhY2sgfHwgYXJndW1lbnRzLmxlbmd0aCA9PT0gMikgZm9yICh2YXIgaSA9IDAsIGwgPSBmcm9tLmxlbmd0aCwgYXI7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgaWYgKGFyIHx8ICEoaSBpbiBmcm9tKSkge1xuICAgICAgICAgICAgaWYgKCFhcikgYXIgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChmcm9tLCAwLCBpKTtcbiAgICAgICAgICAgIGFyW2ldID0gZnJvbVtpXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdG8uY29uY2F0KGFyIHx8IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGZyb20pKTtcbn07XG4vKiBlc2xpbnQtZGlzYWJsZSBuby11bnVzZWQtdmFycyAqL1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIGJpZ2ludF8xID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9wb2x5ZmlsbHMvYmlnaW50ICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0B3YXNtZXIrd2FzaUAwLjEyLjAvbm9kZV9tb2R1bGVzL0B3YXNtZXIvd2FzaS9saWIvcG9seWZpbGxzL2JpZ2ludC5qc1wiKTtcbnZhciBkYXRhdmlld18xID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9wb2x5ZmlsbHMvZGF0YXZpZXcgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vQHdhc21lcit3YXNpQDAuMTIuMC9ub2RlX21vZHVsZXMvQHdhc21lci93YXNpL2xpYi9wb2x5ZmlsbHMvZGF0YXZpZXcuanNcIik7XG52YXIgYnVmZmVyXzEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL3BvbHlmaWxscy9idWZmZXIgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vQHdhc21lcit3YXNpQDAuMTIuMC9ub2RlX21vZHVsZXMvQHdhc21lci93YXNpL2xpYi9wb2x5ZmlsbHMvYnVmZmVyLmpzXCIpO1xuLy8gSW1wb3J0IG91ciBkZWZhdWx0IGJpbmRpbmdzIGRlcGVuZGluZyBvbiB0aGUgZW52aXJvbm1lbnRcbnZhciBkZWZhdWx0QmluZGluZ3M7XG4vKlJPTExVUF9SRVBMQUNFX05PREVcbmltcG9ydCBub2RlQmluZGluZ3MgZnJvbSBcIi4vYmluZGluZ3Mvbm9kZVwiO1xuZGVmYXVsdEJpbmRpbmdzID0gbm9kZUJpbmRpbmdzO1xuUk9MTFVQX1JFUExBQ0VfTk9ERSovXG4vKlJPTExVUF9SRVBMQUNFX0JST1dTRVJcbmltcG9ydCBicm93c2VyQmluZGluZ3MgZnJvbSBcIi4vYmluZGluZ3MvYnJvd3NlclwiO1xuZGVmYXVsdEJpbmRpbmdzID0gYnJvd3NlckJpbmRpbmdzO1xuUk9MTFVQX1JFUExBQ0VfQlJPV1NFUiovXG4vKlxuXG5UaGlzIHByb2plY3QgaXMgYmFzZWQgZnJvbSB0aGUgTm9kZSBpbXBsZW1lbnRhdGlvbiBtYWRlIGJ5IEd1cyBDYXBsYW5cbmh0dHBzOi8vZ2l0aHViLmNvbS9kZXZzbmVrL25vZGUtd2FzaVxuSG93ZXZlciwgSmF2YVNjcmlwdCBXQVNJIGlzIGZvY3VzZWQgb246XG4gKiBCcmluZ2luZyBXQVNJIHRvIHRoZSBCcm93c2Vyc1xuICogTWFrZSBlYXN5IHRvIHBsdWcgZGlmZmVyZW50IGZpbGVzeXN0ZW1zXG4gKiBQcm92aWRlIGEgdHlwZS1zYWZlIGFwaSB1c2luZyBUeXBlc2NyaXB0XG4gKiBQcm92aWRpbmcgbXVsdGlwbGUgb3V0cHV0IHRhcmdldHMgdG8gc3VwcG9ydCBib3RoIGJyb3dzZXJzIGFuZCBub2RlXG4gKiBUaGUgQVBJIGlzIGFkYXB0ZWQgdG8gdGhlIE5vZGUtV0FTSSBBUEk6IGh0dHBzOi8vZ2l0aHViLmNvbS9ub2RlanMvd2FzaS9ibG9iL3dhc2kvbGliL3dhc2kuanNcblxuQ29weXJpZ2h0IDIwMTkgR3VzIENhcGxhblxuXG5QZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG5vZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0b1xuZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGVcbnJpZ2h0cyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vclxuc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG5cblRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluXG5hbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cblxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG5GSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HXG5GUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTXG5JTiBUSEUgU09GVFdBUkUuXG5cbiAqL1xudmFyIGNvbnN0YW50c18xID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9jb25zdGFudHMgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vQHdhc21lcit3YXNpQDAuMTIuMC9ub2RlX21vZHVsZXMvQHdhc21lci93YXNpL2xpYi9jb25zdGFudHMuanNcIik7XG52YXIgU1RESU5fREVGQVVMVF9SSUdIVFMgPSBjb25zdGFudHNfMS5XQVNJX1JJR0hUX0ZEX0RBVEFTWU5DIHxcbiAgICBjb25zdGFudHNfMS5XQVNJX1JJR0hUX0ZEX1JFQUQgfFxuICAgIGNvbnN0YW50c18xLldBU0lfUklHSFRfRkRfU1lOQyB8XG4gICAgY29uc3RhbnRzXzEuV0FTSV9SSUdIVF9GRF9BRFZJU0UgfFxuICAgIGNvbnN0YW50c18xLldBU0lfUklHSFRfRkRfRklMRVNUQVRfR0VUIHxcbiAgICBjb25zdGFudHNfMS5XQVNJX1JJR0hUX1BPTExfRkRfUkVBRFdSSVRFO1xudmFyIFNURE9VVF9ERUZBVUxUX1JJR0hUUyA9IGNvbnN0YW50c18xLldBU0lfUklHSFRfRkRfREFUQVNZTkMgfFxuICAgIGNvbnN0YW50c18xLldBU0lfUklHSFRfRkRfV1JJVEUgfFxuICAgIGNvbnN0YW50c18xLldBU0lfUklHSFRfRkRfU1lOQyB8XG4gICAgY29uc3RhbnRzXzEuV0FTSV9SSUdIVF9GRF9BRFZJU0UgfFxuICAgIGNvbnN0YW50c18xLldBU0lfUklHSFRfRkRfRklMRVNUQVRfR0VUIHxcbiAgICBjb25zdGFudHNfMS5XQVNJX1JJR0hUX1BPTExfRkRfUkVBRFdSSVRFO1xudmFyIFNUREVSUl9ERUZBVUxUX1JJR0hUUyA9IFNURE9VVF9ERUZBVUxUX1JJR0hUUztcbnZhciBtc1RvTnMgPSBmdW5jdGlvbiAobXMpIHtcbiAgICB2YXIgbXNJbnQgPSBNYXRoLnRydW5jKG1zKTtcbiAgICB2YXIgZGVjaW1hbCA9IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKE1hdGgucm91bmQoKG1zIC0gbXNJbnQpICogMTAwMDAwMCkpO1xuICAgIHZhciBucyA9IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKG1zSW50KSAqIGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKDEwMDAwMDApO1xuICAgIHJldHVybiBucyArIGRlY2ltYWw7XG59O1xudmFyIG5zVG9NcyA9IGZ1bmN0aW9uIChucykge1xuICAgIGlmICh0eXBlb2YgbnMgPT09ICdudW1iZXInKSB7XG4gICAgICAgIG5zID0gTWF0aC50cnVuYyhucyk7XG4gICAgfVxuICAgIHZhciBuc0ludCA9IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKG5zKTtcbiAgICByZXR1cm4gTnVtYmVyKG5zSW50IC8gYmlnaW50XzEuQmlnSW50UG9seWZpbGwoMTAwMDAwMCkpO1xufTtcbnZhciB3cmFwID0gZnVuY3Rpb24gKGYpIHsgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgYXJncyA9IFtdO1xuICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzW19pXTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIGYuYXBwbHkodm9pZCAwLCBhcmdzKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgLy8gSWYgaXQncyBhbiBlcnJvciBmcm9tIHRoZSBmc1xuICAgICAgICBpZiAoZSAmJiBlLmNvZGUgJiYgdHlwZW9mIGUuY29kZSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgcmV0dXJuIGNvbnN0YW50c18xLkVSUk9SX01BUFtlLmNvZGVdIHx8IGNvbnN0YW50c18xLldBU0lfRUlOVkFMO1xuICAgICAgICB9XG4gICAgICAgIC8vIElmIGl0J3MgYSBXQVNJIGVycm9yLCB3ZSByZXR1cm4gaXQgZGlyZWN0bHlcbiAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBXQVNJRXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiBlLmVycm5vO1xuICAgICAgICB9XG4gICAgICAgIC8vIE90aGVyd2lzZSB3ZSBsZXQgdGhlIGVycm9yIGJ1YmJsZSB1cFxuICAgICAgICB0aHJvdyBlO1xuICAgIH1cbn07IH07XG52YXIgc3RhdCA9IGZ1bmN0aW9uICh3YXNpLCBmZCkge1xuICAgIHZhciBlbnRyeSA9IHdhc2kuRkRfTUFQLmdldChmZCk7XG4gICAgaWYgKCFlbnRyeSkge1xuICAgICAgICB0aHJvdyBuZXcgV0FTSUVycm9yKGNvbnN0YW50c18xLldBU0lfRUJBREYpO1xuICAgIH1cbiAgICBpZiAoZW50cnkuZmlsZXR5cGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB2YXIgc3RhdHMgPSB3YXNpLmJpbmRpbmdzLmZzLmZzdGF0U3luYyhlbnRyeS5yZWFsKTtcbiAgICAgICAgdmFyIF9hID0gdHJhbnNsYXRlRmlsZUF0dHJpYnV0ZXMod2FzaSwgZmQsIHN0YXRzKSwgZmlsZXR5cGUgPSBfYS5maWxldHlwZSwgcmlnaHRzQmFzZSA9IF9hLnJpZ2h0c0Jhc2UsIHJpZ2h0c0luaGVyaXRpbmcgPSBfYS5yaWdodHNJbmhlcml0aW5nO1xuICAgICAgICBlbnRyeS5maWxldHlwZSA9IGZpbGV0eXBlO1xuICAgICAgICBpZiAoIWVudHJ5LnJpZ2h0cykge1xuICAgICAgICAgICAgZW50cnkucmlnaHRzID0ge1xuICAgICAgICAgICAgICAgIGJhc2U6IHJpZ2h0c0Jhc2UsXG4gICAgICAgICAgICAgICAgaW5oZXJpdGluZzogcmlnaHRzSW5oZXJpdGluZ1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZW50cnk7XG59O1xudmFyIHRyYW5zbGF0ZUZpbGVBdHRyaWJ1dGVzID0gZnVuY3Rpb24gKHdhc2ksIGZkLCBzdGF0cykge1xuICAgIHN3aXRjaCAodHJ1ZSkge1xuICAgICAgICBjYXNlIHN0YXRzLmlzQmxvY2tEZXZpY2UoKTpcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgZmlsZXR5cGU6IGNvbnN0YW50c18xLldBU0lfRklMRVRZUEVfQkxPQ0tfREVWSUNFLFxuICAgICAgICAgICAgICAgIHJpZ2h0c0Jhc2U6IGNvbnN0YW50c18xLlJJR0hUU19CTE9DS19ERVZJQ0VfQkFTRSxcbiAgICAgICAgICAgICAgICByaWdodHNJbmhlcml0aW5nOiBjb25zdGFudHNfMS5SSUdIVFNfQkxPQ0tfREVWSUNFX0lOSEVSSVRJTkdcbiAgICAgICAgICAgIH07XG4gICAgICAgIGNhc2Ugc3RhdHMuaXNDaGFyYWN0ZXJEZXZpY2UoKToge1xuICAgICAgICAgICAgdmFyIGZpbGV0eXBlID0gY29uc3RhbnRzXzEuV0FTSV9GSUxFVFlQRV9DSEFSQUNURVJfREVWSUNFO1xuICAgICAgICAgICAgaWYgKGZkICE9PSB1bmRlZmluZWQgJiYgd2FzaS5iaW5kaW5ncy5pc1RUWShmZCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBmaWxldHlwZTogZmlsZXR5cGUsXG4gICAgICAgICAgICAgICAgICAgIHJpZ2h0c0Jhc2U6IGNvbnN0YW50c18xLlJJR0hUU19UVFlfQkFTRSxcbiAgICAgICAgICAgICAgICAgICAgcmlnaHRzSW5oZXJpdGluZzogY29uc3RhbnRzXzEuUklHSFRTX1RUWV9JTkhFUklUSU5HXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgZmlsZXR5cGU6IGZpbGV0eXBlLFxuICAgICAgICAgICAgICAgIHJpZ2h0c0Jhc2U6IGNvbnN0YW50c18xLlJJR0hUU19DSEFSQUNURVJfREVWSUNFX0JBU0UsXG4gICAgICAgICAgICAgICAgcmlnaHRzSW5oZXJpdGluZzogY29uc3RhbnRzXzEuUklHSFRTX0NIQVJBQ1RFUl9ERVZJQ0VfSU5IRVJJVElOR1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIHN0YXRzLmlzRGlyZWN0b3J5KCk6XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGZpbGV0eXBlOiBjb25zdGFudHNfMS5XQVNJX0ZJTEVUWVBFX0RJUkVDVE9SWSxcbiAgICAgICAgICAgICAgICByaWdodHNCYXNlOiBjb25zdGFudHNfMS5SSUdIVFNfRElSRUNUT1JZX0JBU0UsXG4gICAgICAgICAgICAgICAgcmlnaHRzSW5oZXJpdGluZzogY29uc3RhbnRzXzEuUklHSFRTX0RJUkVDVE9SWV9JTkhFUklUSU5HXG4gICAgICAgICAgICB9O1xuICAgICAgICBjYXNlIHN0YXRzLmlzRklGTygpOlxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBmaWxldHlwZTogY29uc3RhbnRzXzEuV0FTSV9GSUxFVFlQRV9TT0NLRVRfU1RSRUFNLFxuICAgICAgICAgICAgICAgIHJpZ2h0c0Jhc2U6IGNvbnN0YW50c18xLlJJR0hUU19TT0NLRVRfQkFTRSxcbiAgICAgICAgICAgICAgICByaWdodHNJbmhlcml0aW5nOiBjb25zdGFudHNfMS5SSUdIVFNfU09DS0VUX0lOSEVSSVRJTkdcbiAgICAgICAgICAgIH07XG4gICAgICAgIGNhc2Ugc3RhdHMuaXNGaWxlKCk6XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGZpbGV0eXBlOiBjb25zdGFudHNfMS5XQVNJX0ZJTEVUWVBFX1JFR1VMQVJfRklMRSxcbiAgICAgICAgICAgICAgICByaWdodHNCYXNlOiBjb25zdGFudHNfMS5SSUdIVFNfUkVHVUxBUl9GSUxFX0JBU0UsXG4gICAgICAgICAgICAgICAgcmlnaHRzSW5oZXJpdGluZzogY29uc3RhbnRzXzEuUklHSFRTX1JFR1VMQVJfRklMRV9JTkhFUklUSU5HXG4gICAgICAgICAgICB9O1xuICAgICAgICBjYXNlIHN0YXRzLmlzU29ja2V0KCk6XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGZpbGV0eXBlOiBjb25zdGFudHNfMS5XQVNJX0ZJTEVUWVBFX1NPQ0tFVF9TVFJFQU0sXG4gICAgICAgICAgICAgICAgcmlnaHRzQmFzZTogY29uc3RhbnRzXzEuUklHSFRTX1NPQ0tFVF9CQVNFLFxuICAgICAgICAgICAgICAgIHJpZ2h0c0luaGVyaXRpbmc6IGNvbnN0YW50c18xLlJJR0hUU19TT0NLRVRfSU5IRVJJVElOR1xuICAgICAgICAgICAgfTtcbiAgICAgICAgY2FzZSBzdGF0cy5pc1N5bWJvbGljTGluaygpOlxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBmaWxldHlwZTogY29uc3RhbnRzXzEuV0FTSV9GSUxFVFlQRV9TWU1CT0xJQ19MSU5LLFxuICAgICAgICAgICAgICAgIHJpZ2h0c0Jhc2U6IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKDApLFxuICAgICAgICAgICAgICAgIHJpZ2h0c0luaGVyaXRpbmc6IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKDApXG4gICAgICAgICAgICB9O1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBmaWxldHlwZTogY29uc3RhbnRzXzEuV0FTSV9GSUxFVFlQRV9VTktOT1dOLFxuICAgICAgICAgICAgICAgIHJpZ2h0c0Jhc2U6IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKDApLFxuICAgICAgICAgICAgICAgIHJpZ2h0c0luaGVyaXRpbmc6IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKDApXG4gICAgICAgICAgICB9O1xuICAgIH1cbn07XG52YXIgV0FTSUVycm9yID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhXQVNJRXJyb3IsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gV0FTSUVycm9yKGVycm5vKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLmVycm5vID0gZXJybm87XG4gICAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZihfdGhpcywgV0FTSUVycm9yLnByb3RvdHlwZSk7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIFdBU0lFcnJvcjtcbn0oRXJyb3IpKTtcbmV4cG9ydHMuV0FTSUVycm9yID0gV0FTSUVycm9yO1xudmFyIFdBU0lFeGl0RXJyb3IgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFdBU0lFeGl0RXJyb3IsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gV0FTSUV4aXRFcnJvcihjb2RlKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIFwiV0FTSSBFeGl0IGVycm9yOiBcIi5jb25jYXQoY29kZSkpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLmNvZGUgPSBjb2RlO1xuICAgICAgICBPYmplY3Quc2V0UHJvdG90eXBlT2YoX3RoaXMsIFdBU0lFeGl0RXJyb3IucHJvdG90eXBlKTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICByZXR1cm4gV0FTSUV4aXRFcnJvcjtcbn0oRXJyb3IpKTtcbmV4cG9ydHMuV0FTSUV4aXRFcnJvciA9IFdBU0lFeGl0RXJyb3I7XG52YXIgV0FTSUtpbGxFcnJvciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoV0FTSUtpbGxFcnJvciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBXQVNJS2lsbEVycm9yKHNpZ25hbCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBcIldBU0kgS2lsbCBzaWduYWw6IFwiLmNvbmNhdChzaWduYWwpKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5zaWduYWwgPSBzaWduYWw7XG4gICAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZihfdGhpcywgV0FTSUtpbGxFcnJvci5wcm90b3R5cGUpO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIHJldHVybiBXQVNJS2lsbEVycm9yO1xufShFcnJvcikpO1xuZXhwb3J0cy5XQVNJS2lsbEVycm9yID0gV0FTSUtpbGxFcnJvcjtcbnZhciBXQVNJRGVmYXVsdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBXQVNJRGVmYXVsdCh3YXNpQ29uZmlnKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIC8vIERlc3RydWN0dXJlIG91ciB3YXNpQ29uZmlnXG4gICAgICAgIHZhciBwcmVvcGVucyA9IHt9O1xuICAgICAgICBpZiAod2FzaUNvbmZpZyAmJiB3YXNpQ29uZmlnLnByZW9wZW5zKSB7XG4gICAgICAgICAgICBwcmVvcGVucyA9IHdhc2lDb25maWcucHJlb3BlbnM7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAod2FzaUNvbmZpZyAmJiB3YXNpQ29uZmlnLnByZW9wZW5EaXJlY3Rvcmllcykge1xuICAgICAgICAgICAgcHJlb3BlbnMgPSB3YXNpQ29uZmlnXG4gICAgICAgICAgICAgICAgLnByZW9wZW5EaXJlY3RvcmllcztcbiAgICAgICAgfVxuICAgICAgICB2YXIgZW52ID0ge307XG4gICAgICAgIGlmICh3YXNpQ29uZmlnICYmIHdhc2lDb25maWcuZW52KSB7XG4gICAgICAgICAgICBlbnYgPSB3YXNpQ29uZmlnLmVudjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgYXJncyA9IFtdO1xuICAgICAgICBpZiAod2FzaUNvbmZpZyAmJiB3YXNpQ29uZmlnLmFyZ3MpIHtcbiAgICAgICAgICAgIGFyZ3MgPSB3YXNpQ29uZmlnLmFyZ3M7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGJpbmRpbmdzID0gZGVmYXVsdEJpbmRpbmdzO1xuICAgICAgICBpZiAod2FzaUNvbmZpZyAmJiB3YXNpQ29uZmlnLmJpbmRpbmdzKSB7XG4gICAgICAgICAgICBiaW5kaW5ncyA9IHdhc2lDb25maWcuYmluZGluZ3M7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICB0aGlzLm1lbW9yeSA9IHVuZGVmaW5lZDtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICB0aGlzLnZpZXcgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuYmluZGluZ3MgPSBiaW5kaW5ncztcbiAgICAgICAgdGhpcy5GRF9NQVAgPSBuZXcgTWFwKFtcbiAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICBjb25zdGFudHNfMS5XQVNJX1NURElOX0ZJTEVOTyxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHJlYWw6IDAsXG4gICAgICAgICAgICAgICAgICAgIGZpbGV0eXBlOiBjb25zdGFudHNfMS5XQVNJX0ZJTEVUWVBFX0NIQVJBQ1RFUl9ERVZJQ0UsXG4gICAgICAgICAgICAgICAgICAgIC8vIG9mZnNldDogQmlnSW50KDApLFxuICAgICAgICAgICAgICAgICAgICByaWdodHM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhc2U6IFNURElOX0RFRkFVTFRfUklHSFRTLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW5oZXJpdGluZzogYmlnaW50XzEuQmlnSW50UG9seWZpbGwoMClcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgcGF0aDogdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICBjb25zdGFudHNfMS5XQVNJX1NURE9VVF9GSUxFTk8sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICByZWFsOiAxLFxuICAgICAgICAgICAgICAgICAgICBmaWxldHlwZTogY29uc3RhbnRzXzEuV0FTSV9GSUxFVFlQRV9DSEFSQUNURVJfREVWSUNFLFxuICAgICAgICAgICAgICAgICAgICAvLyBvZmZzZXQ6IEJpZ0ludCgwKSxcbiAgICAgICAgICAgICAgICAgICAgcmlnaHRzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBiYXNlOiBTVERPVVRfREVGQVVMVF9SSUdIVFMsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmhlcml0aW5nOiBiaWdpbnRfMS5CaWdJbnRQb2x5ZmlsbCgwKVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBwYXRoOiB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgIGNvbnN0YW50c18xLldBU0lfU1RERVJSX0ZJTEVOTyxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHJlYWw6IDIsXG4gICAgICAgICAgICAgICAgICAgIGZpbGV0eXBlOiBjb25zdGFudHNfMS5XQVNJX0ZJTEVUWVBFX0NIQVJBQ1RFUl9ERVZJQ0UsXG4gICAgICAgICAgICAgICAgICAgIC8vIG9mZnNldDogQmlnSW50KDApLFxuICAgICAgICAgICAgICAgICAgICByaWdodHM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhc2U6IFNUREVSUl9ERUZBVUxUX1JJR0hUUyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGluaGVyaXRpbmc6IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKDApXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHBhdGg6IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF1cbiAgICAgICAgXSk7XG4gICAgICAgIHZhciBmcyA9IHRoaXMuYmluZGluZ3MuZnM7XG4gICAgICAgIHZhciBwYXRoID0gdGhpcy5iaW5kaW5ncy5wYXRoO1xuICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gT2JqZWN0LmVudHJpZXMocHJlb3BlbnMpOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgdmFyIF9iID0gX2FbX2ldLCBrID0gX2JbMF0sIHYgPSBfYlsxXTtcbiAgICAgICAgICAgIHZhciByZWFsID0gZnMub3BlblN5bmModiwgZnMuY29uc3RhbnRzLk9fUkRPTkxZKTtcbiAgICAgICAgICAgIHZhciBuZXdmZCA9IF9fc3ByZWFkQXJyYXkoW10sIHRoaXMuRkRfTUFQLmtleXMoKSwgdHJ1ZSkucmV2ZXJzZSgpWzBdICsgMTtcbiAgICAgICAgICAgIHRoaXMuRkRfTUFQLnNldChuZXdmZCwge1xuICAgICAgICAgICAgICAgIHJlYWw6IHJlYWwsXG4gICAgICAgICAgICAgICAgZmlsZXR5cGU6IGNvbnN0YW50c18xLldBU0lfRklMRVRZUEVfRElSRUNUT1JZLFxuICAgICAgICAgICAgICAgIC8vIG9mZnNldDogQmlnSW50KDApLFxuICAgICAgICAgICAgICAgIHJpZ2h0czoge1xuICAgICAgICAgICAgICAgICAgICBiYXNlOiBjb25zdGFudHNfMS5SSUdIVFNfRElSRUNUT1JZX0JBU0UsXG4gICAgICAgICAgICAgICAgICAgIGluaGVyaXRpbmc6IGNvbnN0YW50c18xLlJJR0hUU19ESVJFQ1RPUllfSU5IRVJJVElOR1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZmFrZVBhdGg6IGssXG4gICAgICAgICAgICAgICAgcGF0aDogdlxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGdldGlvdnMgPSBmdW5jdGlvbiAoaW92cywgaW92c0xlbikge1xuICAgICAgICAgICAgLy8gaW92cyogLT4gW2lvdiwgaW92LCAuLi5dXG4gICAgICAgICAgICAvLyBfX3dhc2lfY2lvdmVjX3Qge1xuICAgICAgICAgICAgLy8gICB2b2lkKiBidWYsXG4gICAgICAgICAgICAvLyAgIHNpemVfdCBidWZfbGVuLFxuICAgICAgICAgICAgLy8gfVxuICAgICAgICAgICAgX3RoaXMucmVmcmVzaE1lbW9yeSgpO1xuICAgICAgICAgICAgdmFyIGJ1ZmZlcnMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiBpb3ZzTGVuIH0sIGZ1bmN0aW9uIChfLCBpKSB7XG4gICAgICAgICAgICAgICAgdmFyIHB0ciA9IGlvdnMgKyBpICogODtcbiAgICAgICAgICAgICAgICB2YXIgYnVmID0gX3RoaXMudmlldy5nZXRVaW50MzIocHRyLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB2YXIgYnVmTGVuID0gX3RoaXMudmlldy5nZXRVaW50MzIocHRyICsgNCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KF90aGlzLm1lbW9yeS5idWZmZXIsIGJ1ZiwgYnVmTGVuKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGJ1ZmZlcnM7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBDSEVDS19GRCA9IGZ1bmN0aW9uIChmZCwgcmlnaHRzKSB7XG4gICAgICAgICAgICB2YXIgc3RhdHMgPSBzdGF0KF90aGlzLCBmZCk7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhgQ0hFQ0tfRkQ6IHN0YXRzLnJlYWw6ICR7c3RhdHMucmVhbH0sIHN0YXRzLnBhdGg6YCwgc3RhdHMucGF0aCk7XG4gICAgICAgICAgICBpZiAocmlnaHRzICE9PSBiaWdpbnRfMS5CaWdJbnRQb2x5ZmlsbCgwKSAmJiAoc3RhdHMucmlnaHRzLmJhc2UgJiByaWdodHMpID09PSBiaWdpbnRfMS5CaWdJbnRQb2x5ZmlsbCgwKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBXQVNJRXJyb3IoY29uc3RhbnRzXzEuV0FTSV9FUEVSTSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gc3RhdHM7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBDUFVUSU1FX1NUQVJUID0gYmluZGluZ3MuaHJ0aW1lKCk7XG4gICAgICAgIHZhciBub3cgPSBmdW5jdGlvbiAoY2xvY2tJZCkge1xuICAgICAgICAgICAgc3dpdGNoIChjbG9ja0lkKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBjb25zdGFudHNfMS5XQVNJX0NMT0NLX01PTk9UT05JQzpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJpbmRpbmdzLmhydGltZSgpO1xuICAgICAgICAgICAgICAgIGNhc2UgY29uc3RhbnRzXzEuV0FTSV9DTE9DS19SRUFMVElNRTpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1zVG9OcyhEYXRlLm5vdygpKTtcbiAgICAgICAgICAgICAgICBjYXNlIGNvbnN0YW50c18xLldBU0lfQ0xPQ0tfUFJPQ0VTU19DUFVUSU1FX0lEOlxuICAgICAgICAgICAgICAgIGNhc2UgY29uc3RhbnRzXzEuV0FTSV9DTE9DS19USFJFQURfQ1BVVElNRV9JRDpcbiAgICAgICAgICAgICAgICAgICAgLy8gcmV0dXJuIGJpbmRpbmdzLmhydGltZShDUFVUSU1FX1NUQVJUKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYmluZGluZ3MuaHJ0aW1lKCkgLSBDUFVUSU1FX1NUQVJUO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLndhc2lJbXBvcnQgPSB7XG4gICAgICAgICAgICBhcmdzX2dldDogZnVuY3Rpb24gKGFyZ3YsIGFyZ3ZCdWYpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5yZWZyZXNoTWVtb3J5KCk7XG4gICAgICAgICAgICAgICAgdmFyIGNvZmZzZXQgPSBhcmd2O1xuICAgICAgICAgICAgICAgIHZhciBvZmZzZXQgPSBhcmd2QnVmO1xuICAgICAgICAgICAgICAgIGFyZ3MuZm9yRWFjaChmdW5jdGlvbiAoYSkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy52aWV3LnNldFVpbnQzMihjb2Zmc2V0LCBvZmZzZXQsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICBjb2Zmc2V0ICs9IDQ7XG4gICAgICAgICAgICAgICAgICAgIG9mZnNldCArPSBidWZmZXJfMS5kZWZhdWx0LmZyb20oX3RoaXMubWVtb3J5LmJ1ZmZlcikud3JpdGUoXCJcIi5jb25jYXQoYSwgXCJcXDBcIiksIG9mZnNldCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnN0YW50c18xLldBU0lfRVNVQ0NFU1M7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYXJnc19zaXplc19nZXQ6IGZ1bmN0aW9uIChhcmdjLCBhcmd2QnVmU2l6ZSkge1xuICAgICAgICAgICAgICAgIF90aGlzLnJlZnJlc2hNZW1vcnkoKTtcbiAgICAgICAgICAgICAgICBfdGhpcy52aWV3LnNldFVpbnQzMihhcmdjLCBhcmdzLmxlbmd0aCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgdmFyIHNpemUgPSBhcmdzLnJlZHVjZShmdW5jdGlvbiAoYWNjLCBhKSB7IHJldHVybiBhY2MgKyBidWZmZXJfMS5kZWZhdWx0LmJ5dGVMZW5ndGgoYSkgKyAxOyB9LCAwKTtcbiAgICAgICAgICAgICAgICBfdGhpcy52aWV3LnNldFVpbnQzMihhcmd2QnVmU2l6ZSwgc2l6ZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnN0YW50c18xLldBU0lfRVNVQ0NFU1M7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW52aXJvbl9nZXQ6IGZ1bmN0aW9uIChlbnZpcm9uLCBlbnZpcm9uQnVmKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMucmVmcmVzaE1lbW9yeSgpO1xuICAgICAgICAgICAgICAgIHZhciBjb2Zmc2V0ID0gZW52aXJvbjtcbiAgICAgICAgICAgICAgICB2YXIgb2Zmc2V0ID0gZW52aXJvbkJ1ZjtcbiAgICAgICAgICAgICAgICBPYmplY3QuZW50cmllcyhlbnYpLmZvckVhY2goZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBrZXkgPSBfYVswXSwgdmFsdWUgPSBfYVsxXTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMudmlldy5zZXRVaW50MzIoY29mZnNldCwgb2Zmc2V0LCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgY29mZnNldCArPSA0O1xuICAgICAgICAgICAgICAgICAgICBvZmZzZXQgKz0gYnVmZmVyXzEuZGVmYXVsdC5mcm9tKF90aGlzLm1lbW9yeS5idWZmZXIpLndyaXRlKFwiXCIuY29uY2F0KGtleSwgXCI9XCIpLmNvbmNhdCh2YWx1ZSwgXCJcXDBcIiksIG9mZnNldCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnN0YW50c18xLldBU0lfRVNVQ0NFU1M7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW52aXJvbl9zaXplc19nZXQ6IGZ1bmN0aW9uIChlbnZpcm9uQ291bnQsIGVudmlyb25CdWZTaXplKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMucmVmcmVzaE1lbW9yeSgpO1xuICAgICAgICAgICAgICAgIHZhciBlbnZQcm9jZXNzZWQgPSBPYmplY3QuZW50cmllcyhlbnYpLm1hcChmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGtleSA9IF9hWzBdLCB2YWx1ZSA9IF9hWzFdO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJcIi5jb25jYXQoa2V5LCBcIj1cIikuY29uY2F0KHZhbHVlLCBcIlxcMFwiKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB2YXIgc2l6ZSA9IGVudlByb2Nlc3NlZC5yZWR1Y2UoZnVuY3Rpb24gKGFjYywgZSkgeyByZXR1cm4gYWNjICsgYnVmZmVyXzEuZGVmYXVsdC5ieXRlTGVuZ3RoKGUpOyB9LCAwKTtcbiAgICAgICAgICAgICAgICBfdGhpcy52aWV3LnNldFVpbnQzMihlbnZpcm9uQ291bnQsIGVudlByb2Nlc3NlZC5sZW5ndGgsIHRydWUpO1xuICAgICAgICAgICAgICAgIF90aGlzLnZpZXcuc2V0VWludDMyKGVudmlyb25CdWZTaXplLCBzaXplLCB0cnVlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29uc3RhbnRzXzEuV0FTSV9FU1VDQ0VTUztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjbG9ja19yZXNfZ2V0OiBmdW5jdGlvbiAoY2xvY2tJZCwgcmVzb2x1dGlvbikge1xuICAgICAgICAgICAgICAgIHZhciByZXM7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChjbG9ja0lkKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgY29uc3RhbnRzXzEuV0FTSV9DTE9DS19NT05PVE9OSUM6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgY29uc3RhbnRzXzEuV0FTSV9DTE9DS19QUk9DRVNTX0NQVVRJTUVfSUQ6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgY29uc3RhbnRzXzEuV0FTSV9DTE9DS19USFJFQURfQ1BVVElNRV9JRDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzID0gYmlnaW50XzEuQmlnSW50UG9seWZpbGwoMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYXNlIGNvbnN0YW50c18xLldBU0lfQ0xPQ0tfUkVBTFRJTUU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcyA9IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKDEwMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgX3RoaXMudmlldy5zZXRCaWdVaW50NjQocmVzb2x1dGlvbiwgcmVzKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29uc3RhbnRzXzEuV0FTSV9FU1VDQ0VTUztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjbG9ja190aW1lX2dldDogZnVuY3Rpb24gKGNsb2NrSWQsIHByZWNpc2lvbiwgdGltZSkge1xuICAgICAgICAgICAgICAgIF90aGlzLnJlZnJlc2hNZW1vcnkoKTtcbiAgICAgICAgICAgICAgICB2YXIgbiA9IG5vdyhjbG9ja0lkKTtcbiAgICAgICAgICAgICAgICBpZiAobiA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29uc3RhbnRzXzEuV0FTSV9FSU5WQUw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF90aGlzLnZpZXcuc2V0QmlnVWludDY0KHRpbWUsIGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKG4pLCB0cnVlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29uc3RhbnRzXzEuV0FTSV9FU1VDQ0VTUztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmZF9hZHZpc2U6IHdyYXAoZnVuY3Rpb24gKGZkLCBvZmZzZXQsIGxlbiwgYWR2aWNlKSB7XG4gICAgICAgICAgICAgICAgQ0hFQ0tfRkQoZmQsIGNvbnN0YW50c18xLldBU0lfUklHSFRfRkRfQURWSVNFKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29uc3RhbnRzXzEuV0FTSV9FTk9TWVM7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIGZkX2FsbG9jYXRlOiB3cmFwKGZ1bmN0aW9uIChmZCwgb2Zmc2V0LCBsZW4pIHtcbiAgICAgICAgICAgICAgICBDSEVDS19GRChmZCwgY29uc3RhbnRzXzEuV0FTSV9SSUdIVF9GRF9BTExPQ0FURSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnN0YW50c18xLldBU0lfRU5PU1lTO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBmZF9jbG9zZTogd3JhcChmdW5jdGlvbiAoZmQpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RhdHMgPSBDSEVDS19GRChmZCwgYmlnaW50XzEuQmlnSW50UG9seWZpbGwoMCkpO1xuICAgICAgICAgICAgICAgIGZzLmNsb3NlU3luYyhzdGF0cy5yZWFsKTtcbiAgICAgICAgICAgICAgICBfdGhpcy5GRF9NQVAuZGVsZXRlKGZkKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29uc3RhbnRzXzEuV0FTSV9FU1VDQ0VTUztcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgZmRfZGF0YXN5bmM6IHdyYXAoZnVuY3Rpb24gKGZkKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0YXRzID0gQ0hFQ0tfRkQoZmQsIGNvbnN0YW50c18xLldBU0lfUklHSFRfRkRfREFUQVNZTkMpO1xuICAgICAgICAgICAgICAgIGZzLmZkYXRhc3luY1N5bmMoc3RhdHMucmVhbCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnN0YW50c18xLldBU0lfRVNVQ0NFU1M7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIGZkX2Zkc3RhdF9nZXQ6IHdyYXAoZnVuY3Rpb24gKGZkLCBidWZQdHIpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RhdHMgPSBDSEVDS19GRChmZCwgYmlnaW50XzEuQmlnSW50UG9seWZpbGwoMCkpO1xuICAgICAgICAgICAgICAgIF90aGlzLnJlZnJlc2hNZW1vcnkoKTtcbiAgICAgICAgICAgICAgICBfdGhpcy52aWV3LnNldFVpbnQ4KGJ1ZlB0ciwgc3RhdHMuZmlsZXR5cGUpOyAvLyBGSUxFVFlQRSB1OFxuICAgICAgICAgICAgICAgIF90aGlzLnZpZXcuc2V0VWludDE2KGJ1ZlB0ciArIDIsIDAsIHRydWUpOyAvLyBGREZMQUcgdTE2XG4gICAgICAgICAgICAgICAgX3RoaXMudmlldy5zZXRVaW50MTYoYnVmUHRyICsgNCwgMCwgdHJ1ZSk7IC8vIEZERkxBRyB1MTZcbiAgICAgICAgICAgICAgICBfdGhpcy52aWV3LnNldEJpZ1VpbnQ2NChidWZQdHIgKyA4LCBiaWdpbnRfMS5CaWdJbnRQb2x5ZmlsbChzdGF0cy5yaWdodHMuYmFzZSksIHRydWUpOyAvLyB1NjRcbiAgICAgICAgICAgICAgICBfdGhpcy52aWV3LnNldEJpZ1VpbnQ2NChidWZQdHIgKyA4ICsgOCwgYmlnaW50XzEuQmlnSW50UG9seWZpbGwoc3RhdHMucmlnaHRzLmluaGVyaXRpbmcpLCB0cnVlKTsgLy8gdTY0XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnN0YW50c18xLldBU0lfRVNVQ0NFU1M7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIGZkX2Zkc3RhdF9zZXRfZmxhZ3M6IHdyYXAoZnVuY3Rpb24gKGZkLCBmbGFncykge1xuICAgICAgICAgICAgICAgIENIRUNLX0ZEKGZkLCBjb25zdGFudHNfMS5XQVNJX1JJR0hUX0ZEX0ZEU1RBVF9TRVRfRkxBR1MpO1xuICAgICAgICAgICAgICAgIHJldHVybiBjb25zdGFudHNfMS5XQVNJX0VOT1NZUztcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgZmRfZmRzdGF0X3NldF9yaWdodHM6IHdyYXAoZnVuY3Rpb24gKGZkLCBmc1JpZ2h0c0Jhc2UsIGZzUmlnaHRzSW5oZXJpdGluZykge1xuICAgICAgICAgICAgICAgIHZhciBzdGF0cyA9IENIRUNLX0ZEKGZkLCBiaWdpbnRfMS5CaWdJbnRQb2x5ZmlsbCgwKSk7XG4gICAgICAgICAgICAgICAgdmFyIG5yYiA9IHN0YXRzLnJpZ2h0cy5iYXNlIHwgZnNSaWdodHNCYXNlO1xuICAgICAgICAgICAgICAgIGlmIChucmIgPiBzdGF0cy5yaWdodHMuYmFzZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29uc3RhbnRzXzEuV0FTSV9FUEVSTTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIG5yaSA9IHN0YXRzLnJpZ2h0cy5pbmhlcml0aW5nIHwgZnNSaWdodHNJbmhlcml0aW5nO1xuICAgICAgICAgICAgICAgIGlmIChucmkgPiBzdGF0cy5yaWdodHMuaW5oZXJpdGluZykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29uc3RhbnRzXzEuV0FTSV9FUEVSTTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc3RhdHMucmlnaHRzLmJhc2UgPSBmc1JpZ2h0c0Jhc2U7XG4gICAgICAgICAgICAgICAgc3RhdHMucmlnaHRzLmluaGVyaXRpbmcgPSBmc1JpZ2h0c0luaGVyaXRpbmc7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnN0YW50c18xLldBU0lfRVNVQ0NFU1M7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIGZkX2ZpbGVzdGF0X2dldDogd3JhcChmdW5jdGlvbiAoZmQsIGJ1ZlB0cikge1xuICAgICAgICAgICAgICAgIHZhciBzdGF0cyA9IENIRUNLX0ZEKGZkLCBjb25zdGFudHNfMS5XQVNJX1JJR0hUX0ZEX0ZJTEVTVEFUX0dFVCk7XG4gICAgICAgICAgICAgICAgdmFyIHJzdGF0cyA9IGZzLmZzdGF0U3luYyhzdGF0cy5yZWFsKTtcbiAgICAgICAgICAgICAgICBfdGhpcy5yZWZyZXNoTWVtb3J5KCk7XG4gICAgICAgICAgICAgICAgX3RoaXMudmlldy5zZXRCaWdVaW50NjQoYnVmUHRyLCBiaWdpbnRfMS5CaWdJbnRQb2x5ZmlsbChyc3RhdHMuZGV2KSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgYnVmUHRyICs9IDg7XG4gICAgICAgICAgICAgICAgX3RoaXMudmlldy5zZXRCaWdVaW50NjQoYnVmUHRyLCBiaWdpbnRfMS5CaWdJbnRQb2x5ZmlsbChyc3RhdHMuaW5vKSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgYnVmUHRyICs9IDg7XG4gICAgICAgICAgICAgICAgX3RoaXMudmlldy5zZXRVaW50OChidWZQdHIsIHN0YXRzLmZpbGV0eXBlKTtcbiAgICAgICAgICAgICAgICBidWZQdHIgKz0gODtcbiAgICAgICAgICAgICAgICBfdGhpcy52aWV3LnNldEJpZ1VpbnQ2NChidWZQdHIsIGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKHJzdGF0cy5ubGluayksIHRydWUpO1xuICAgICAgICAgICAgICAgIGJ1ZlB0ciArPSA4O1xuICAgICAgICAgICAgICAgIF90aGlzLnZpZXcuc2V0QmlnVWludDY0KGJ1ZlB0ciwgYmlnaW50XzEuQmlnSW50UG9seWZpbGwocnN0YXRzLnNpemUpLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBidWZQdHIgKz0gODtcbiAgICAgICAgICAgICAgICBfdGhpcy52aWV3LnNldEJpZ1VpbnQ2NChidWZQdHIsIG1zVG9Ocyhyc3RhdHMuYXRpbWVNcyksIHRydWUpO1xuICAgICAgICAgICAgICAgIGJ1ZlB0ciArPSA4O1xuICAgICAgICAgICAgICAgIF90aGlzLnZpZXcuc2V0QmlnVWludDY0KGJ1ZlB0ciwgbXNUb05zKHJzdGF0cy5tdGltZU1zKSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgYnVmUHRyICs9IDg7XG4gICAgICAgICAgICAgICAgX3RoaXMudmlldy5zZXRCaWdVaW50NjQoYnVmUHRyLCBtc1RvTnMocnN0YXRzLmN0aW1lTXMpLCB0cnVlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29uc3RhbnRzXzEuV0FTSV9FU1VDQ0VTUztcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgZmRfZmlsZXN0YXRfc2V0X3NpemU6IHdyYXAoZnVuY3Rpb24gKGZkLCBzdFNpemUpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RhdHMgPSBDSEVDS19GRChmZCwgY29uc3RhbnRzXzEuV0FTSV9SSUdIVF9GRF9GSUxFU1RBVF9TRVRfU0laRSk7XG4gICAgICAgICAgICAgICAgZnMuZnRydW5jYXRlU3luYyhzdGF0cy5yZWFsLCBOdW1iZXIoc3RTaXplKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnN0YW50c18xLldBU0lfRVNVQ0NFU1M7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIGZkX2ZpbGVzdGF0X3NldF90aW1lczogd3JhcChmdW5jdGlvbiAoZmQsIHN0QXRpbSwgc3RNdGltLCBmc3RmbGFncykge1xuICAgICAgICAgICAgICAgIHZhciBzdGF0cyA9IENIRUNLX0ZEKGZkLCBjb25zdGFudHNfMS5XQVNJX1JJR0hUX0ZEX0ZJTEVTVEFUX1NFVF9USU1FUyk7XG4gICAgICAgICAgICAgICAgdmFyIHJzdGF0cyA9IGZzLmZzdGF0U3luYyhzdGF0cy5yZWFsKTtcbiAgICAgICAgICAgICAgICB2YXIgYXRpbSA9IHJzdGF0cy5hdGltZTtcbiAgICAgICAgICAgICAgICB2YXIgbXRpbSA9IHJzdGF0cy5tdGltZTtcbiAgICAgICAgICAgICAgICB2YXIgbiA9IG5zVG9Ncyhub3coY29uc3RhbnRzXzEuV0FTSV9DTE9DS19SRUFMVElNRSkpO1xuICAgICAgICAgICAgICAgIHZhciBhdGltZmxhZ3MgPSBjb25zdGFudHNfMS5XQVNJX0ZJTEVTVEFUX1NFVF9BVElNIHwgY29uc3RhbnRzXzEuV0FTSV9GSUxFU1RBVF9TRVRfQVRJTV9OT1c7XG4gICAgICAgICAgICAgICAgaWYgKChmc3RmbGFncyAmIGF0aW1mbGFncykgPT09IGF0aW1mbGFncykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29uc3RhbnRzXzEuV0FTSV9FSU5WQUw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBtdGltZmxhZ3MgPSBjb25zdGFudHNfMS5XQVNJX0ZJTEVTVEFUX1NFVF9NVElNIHwgY29uc3RhbnRzXzEuV0FTSV9GSUxFU1RBVF9TRVRfTVRJTV9OT1c7XG4gICAgICAgICAgICAgICAgaWYgKChmc3RmbGFncyAmIG10aW1mbGFncykgPT09IG10aW1mbGFncykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29uc3RhbnRzXzEuV0FTSV9FSU5WQUw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICgoZnN0ZmxhZ3MgJiBjb25zdGFudHNfMS5XQVNJX0ZJTEVTVEFUX1NFVF9BVElNKSA9PT0gY29uc3RhbnRzXzEuV0FTSV9GSUxFU1RBVF9TRVRfQVRJTSkge1xuICAgICAgICAgICAgICAgICAgICBhdGltID0gbnNUb01zKHN0QXRpbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKChmc3RmbGFncyAmIGNvbnN0YW50c18xLldBU0lfRklMRVNUQVRfU0VUX0FUSU1fTk9XKSA9PT0gY29uc3RhbnRzXzEuV0FTSV9GSUxFU1RBVF9TRVRfQVRJTV9OT1cpIHtcbiAgICAgICAgICAgICAgICAgICAgYXRpbSA9IG47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICgoZnN0ZmxhZ3MgJiBjb25zdGFudHNfMS5XQVNJX0ZJTEVTVEFUX1NFVF9NVElNKSA9PT0gY29uc3RhbnRzXzEuV0FTSV9GSUxFU1RBVF9TRVRfTVRJTSkge1xuICAgICAgICAgICAgICAgICAgICBtdGltID0gbnNUb01zKHN0TXRpbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKChmc3RmbGFncyAmIGNvbnN0YW50c18xLldBU0lfRklMRVNUQVRfU0VUX01USU1fTk9XKSA9PT0gY29uc3RhbnRzXzEuV0FTSV9GSUxFU1RBVF9TRVRfTVRJTV9OT1cpIHtcbiAgICAgICAgICAgICAgICAgICAgbXRpbSA9IG47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZzLmZ1dGltZXNTeW5jKHN0YXRzLnJlYWwsIG5ldyBEYXRlKGF0aW0pLCBuZXcgRGF0ZShtdGltKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnN0YW50c18xLldBU0lfRVNVQ0NFU1M7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIGZkX3ByZXN0YXRfZ2V0OiB3cmFwKGZ1bmN0aW9uIChmZCwgYnVmUHRyKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0YXRzID0gQ0hFQ0tfRkQoZmQsIGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKDApKTtcbiAgICAgICAgICAgICAgICBpZiAoIXN0YXRzLnBhdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbnN0YW50c18xLldBU0lfRUlOVkFMO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBfdGhpcy5yZWZyZXNoTWVtb3J5KCk7XG4gICAgICAgICAgICAgICAgX3RoaXMudmlldy5zZXRVaW50OChidWZQdHIsIGNvbnN0YW50c18xLldBU0lfUFJFT1BFTlRZUEVfRElSKTtcbiAgICAgICAgICAgICAgICBfdGhpcy52aWV3LnNldFVpbnQzMihidWZQdHIgKyA0LCBidWZmZXJfMS5kZWZhdWx0LmJ5dGVMZW5ndGgoc3RhdHMuZmFrZVBhdGgpLCB0cnVlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29uc3RhbnRzXzEuV0FTSV9FU1VDQ0VTUztcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgZmRfcHJlc3RhdF9kaXJfbmFtZTogd3JhcChmdW5jdGlvbiAoZmQsIHBhdGhQdHIsIHBhdGhMZW4pIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RhdHMgPSBDSEVDS19GRChmZCwgYmlnaW50XzEuQmlnSW50UG9seWZpbGwoMCkpO1xuICAgICAgICAgICAgICAgIGlmICghc3RhdHMucGF0aCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29uc3RhbnRzXzEuV0FTSV9FSU5WQUw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF90aGlzLnJlZnJlc2hNZW1vcnkoKTtcbiAgICAgICAgICAgICAgICBidWZmZXJfMS5kZWZhdWx0LmZyb20oX3RoaXMubWVtb3J5LmJ1ZmZlcikud3JpdGUoc3RhdHMuZmFrZVBhdGgsIHBhdGhQdHIsIHBhdGhMZW4sIFwidXRmOFwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29uc3RhbnRzXzEuV0FTSV9FU1VDQ0VTUztcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgZmRfcHdyaXRlOiB3cmFwKGZ1bmN0aW9uIChmZCwgaW92cywgaW92c0xlbiwgb2Zmc2V0LCBud3JpdHRlbikge1xuICAgICAgICAgICAgICAgIHZhciBzdGF0cyA9IENIRUNLX0ZEKGZkLCBjb25zdGFudHNfMS5XQVNJX1JJR0hUX0ZEX1dSSVRFIHwgY29uc3RhbnRzXzEuV0FTSV9SSUdIVF9GRF9TRUVLKTtcbiAgICAgICAgICAgICAgICB2YXIgd3JpdHRlbiA9IDA7XG4gICAgICAgICAgICAgICAgZ2V0aW92cyhpb3ZzLCBpb3ZzTGVuKS5mb3JFYWNoKGZ1bmN0aW9uIChpb3YpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHcgPSAwO1xuICAgICAgICAgICAgICAgICAgICB3aGlsZSAodyA8IGlvdi5ieXRlTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3ICs9IGZzLndyaXRlU3luYyhzdGF0cy5yZWFsLCBpb3YsIHcsIGlvdi5ieXRlTGVuZ3RoIC0gdywgTnVtYmVyKG9mZnNldCkgKyB3cml0dGVuICsgdyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgd3JpdHRlbiArPSB3O1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIF90aGlzLnZpZXcuc2V0VWludDMyKG53cml0dGVuLCB3cml0dGVuLCB0cnVlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29uc3RhbnRzXzEuV0FTSV9FU1VDQ0VTUztcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgZmRfd3JpdGU6IHdyYXAoZnVuY3Rpb24gKGZkLCBpb3ZzLCBpb3ZzTGVuLCBud3JpdHRlbikge1xuICAgICAgICAgICAgICAgIHZhciBzdGF0cyA9IENIRUNLX0ZEKGZkLCBjb25zdGFudHNfMS5XQVNJX1JJR0hUX0ZEX1dSSVRFKTtcbiAgICAgICAgICAgICAgICB2YXIgd3JpdHRlbiA9IDA7XG4gICAgICAgICAgICAgICAgZ2V0aW92cyhpb3ZzLCBpb3ZzTGVuKS5mb3JFYWNoKGZ1bmN0aW9uIChpb3YpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHcgPSAwO1xuICAgICAgICAgICAgICAgICAgICB3aGlsZSAodyA8IGlvdi5ieXRlTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IGZzLndyaXRlU3luYyhzdGF0cy5yZWFsLCBpb3YsIHcsIGlvdi5ieXRlTGVuZ3RoIC0gdywgc3RhdHMub2Zmc2V0ID8gTnVtYmVyKHN0YXRzLm9mZnNldCkgOiBudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0cy5vZmZzZXQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHMub2Zmc2V0ICs9IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKGkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdyArPSBpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHdyaXR0ZW4gKz0gdztcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBfdGhpcy52aWV3LnNldFVpbnQzMihud3JpdHRlbiwgd3JpdHRlbiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnN0YW50c18xLldBU0lfRVNVQ0NFU1M7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIGZkX3ByZWFkOiB3cmFwKGZ1bmN0aW9uIChmZCwgaW92cywgaW92c0xlbiwgb2Zmc2V0LCBucmVhZCkge1xuICAgICAgICAgICAgICAgIHZhciBzdGF0cyA9IENIRUNLX0ZEKGZkLCBjb25zdGFudHNfMS5XQVNJX1JJR0hUX0ZEX1JFQUQgfCBjb25zdGFudHNfMS5XQVNJX1JJR0hUX0ZEX1NFRUspO1xuICAgICAgICAgICAgICAgIHZhciByZWFkID0gMDtcbiAgICAgICAgICAgICAgICBvdXRlcjogZm9yICh2YXIgX2kgPSAwLCBfYSA9IGdldGlvdnMoaW92cywgaW92c0xlbik7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpb3YgPSBfYVtfaV07XG4gICAgICAgICAgICAgICAgICAgIHZhciByID0gMDtcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHIgPCBpb3YuYnl0ZUxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxlbmd0aF8xID0gaW92LmJ5dGVMZW5ndGggLSByO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJyID0gZnMucmVhZFN5bmMoc3RhdHMucmVhbCwgaW92LCByLCBpb3YuYnl0ZUxlbmd0aCAtIHIsIE51bWJlcihvZmZzZXQpICsgcmVhZCArIHIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgciArPSBycjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWQgKz0gcnI7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB3ZSBkb24ndCByZWFkIGFueXRoaW5nLCBvciB3ZSByZWNlaXZlIGxlc3MgdGhhbiByZXF1ZXN0ZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyciA9PT0gMCB8fCByciA8IGxlbmd0aF8xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgb3V0ZXI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmVhZCArPSByO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgICAgX3RoaXMudmlldy5zZXRVaW50MzIobnJlYWQsIHJlYWQsIHRydWUpO1xuICAgICAgICAgICAgICAgIHJldHVybiBjb25zdGFudHNfMS5XQVNJX0VTVUNDRVNTO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBmZF9yZWFkOiB3cmFwKGZ1bmN0aW9uIChmZCwgaW92cywgaW92c0xlbiwgbnJlYWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RhdHMgPSBDSEVDS19GRChmZCwgY29uc3RhbnRzXzEuV0FTSV9SSUdIVF9GRF9SRUFEKTtcbiAgICAgICAgICAgICAgICB2YXIgSVNfU1RESU4gPSBzdGF0cy5yZWFsID09PSAwO1xuICAgICAgICAgICAgICAgIHZhciByZWFkID0gMDtcbiAgICAgICAgICAgICAgICBvdXRlcjogZm9yICh2YXIgX2kgPSAwLCBfYSA9IGdldGlvdnMoaW92cywgaW92c0xlbik7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpb3YgPSBfYVtfaV07XG4gICAgICAgICAgICAgICAgICAgIHZhciByID0gMDtcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHIgPCBpb3YuYnl0ZUxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxlbmd0aF8yID0gaW92LmJ5dGVMZW5ndGggLSByO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBvc2l0aW9uID0gSVNfU1RESU4gfHwgc3RhdHMub2Zmc2V0ID09PSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IG51bGxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IE51bWJlcihzdGF0cy5vZmZzZXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJyID0gZnMucmVhZFN5bmMoc3RhdHMucmVhbCwgLy8gZmRcbiAgICAgICAgICAgICAgICAgICAgICAgIGlvdiwgLy8gYnVmZmVyXG4gICAgICAgICAgICAgICAgICAgICAgICByLCAvLyBvZmZzZXRcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlbmd0aF8yLCAvLyBsZW5ndGhcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uIC8vIHBvc2l0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFJU19TVERJTikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRzLm9mZnNldCA9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzdGF0cy5vZmZzZXQgPyBzdGF0cy5vZmZzZXQgOiBiaWdpbnRfMS5CaWdJbnRQb2x5ZmlsbCgwKSkgKyBiaWdpbnRfMS5CaWdJbnRQb2x5ZmlsbChycik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByICs9IHJyO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVhZCArPSBycjtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHdlIGRvbid0IHJlYWQgYW55dGhpbmcsIG9yIHdlIHJlY2VpdmUgbGVzcyB0aGFuIHJlcXVlc3RlZFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJyID09PSAwIHx8IHJyIDwgbGVuZ3RoXzIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhayBvdXRlcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBXZSBzaG91bGQgbm90IG1vZGlmeSB0aGUgb2Zmc2V0IG9mIHN0ZGluXG4gICAgICAgICAgICAgICAgX3RoaXMudmlldy5zZXRVaW50MzIobnJlYWQsIHJlYWQsIHRydWUpO1xuICAgICAgICAgICAgICAgIHJldHVybiBjb25zdGFudHNfMS5XQVNJX0VTVUNDRVNTO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBmZF9yZWFkZGlyOiB3cmFwKGZ1bmN0aW9uIChmZCwgYnVmUHRyLCBidWZMZW4sIGNvb2tpZSwgYnVmdXNlZFB0cikge1xuICAgICAgICAgICAgICAgIHZhciBzdGF0cyA9IENIRUNLX0ZEKGZkLCBjb25zdGFudHNfMS5XQVNJX1JJR0hUX0ZEX1JFQURESVIpO1xuICAgICAgICAgICAgICAgIF90aGlzLnJlZnJlc2hNZW1vcnkoKTtcbiAgICAgICAgICAgICAgICB2YXIgZW50cmllcyA9IGZzLnJlYWRkaXJTeW5jKHN0YXRzLnBhdGgsIHsgd2l0aEZpbGVUeXBlczogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICB2YXIgc3RhcnRQdHIgPSBidWZQdHI7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IE51bWJlcihjb29raWUpOyBpIDwgZW50cmllcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZW50cnkgPSBlbnRyaWVzW2ldO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZUxlbmd0aCA9IGJ1ZmZlcl8xLmRlZmF1bHQuYnl0ZUxlbmd0aChlbnRyeS5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJ1ZlB0ciAtIHN0YXJ0UHRyID4gYnVmTGVuKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBfdGhpcy52aWV3LnNldEJpZ1VpbnQ2NChidWZQdHIsIGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKGkgKyAxKSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGJ1ZlB0ciArPSA4O1xuICAgICAgICAgICAgICAgICAgICBpZiAoYnVmUHRyIC0gc3RhcnRQdHIgPiBidWZMZW4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZhciByc3RhdHMgPSBmcy5zdGF0U3luYyhwYXRoLnJlc29sdmUoc3RhdHMucGF0aCwgZW50cnkubmFtZSkpO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy52aWV3LnNldEJpZ1VpbnQ2NChidWZQdHIsIGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKHJzdGF0cy5pbm8pLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgYnVmUHRyICs9IDg7XG4gICAgICAgICAgICAgICAgICAgIGlmIChidWZQdHIgLSBzdGFydFB0ciA+IGJ1Zkxlbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMudmlldy5zZXRVaW50MzIoYnVmUHRyLCBuYW1lTGVuZ3RoLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgYnVmUHRyICs9IDQ7XG4gICAgICAgICAgICAgICAgICAgIGlmIChidWZQdHIgLSBzdGFydFB0ciA+IGJ1Zkxlbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdmFyIGZpbGV0eXBlID0gdm9pZCAwO1xuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgcnN0YXRzLmlzQmxvY2tEZXZpY2UoKTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxldHlwZSA9IGNvbnN0YW50c18xLldBU0lfRklMRVRZUEVfQkxPQ0tfREVWSUNFO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSByc3RhdHMuaXNDaGFyYWN0ZXJEZXZpY2UoKTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxldHlwZSA9IGNvbnN0YW50c18xLldBU0lfRklMRVRZUEVfQ0hBUkFDVEVSX0RFVklDRTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgcnN0YXRzLmlzRGlyZWN0b3J5KCk6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZXR5cGUgPSBjb25zdGFudHNfMS5XQVNJX0ZJTEVUWVBFX0RJUkVDVE9SWTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgcnN0YXRzLmlzRklGTygpOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGV0eXBlID0gY29uc3RhbnRzXzEuV0FTSV9GSUxFVFlQRV9TT0NLRVRfU1RSRUFNO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSByc3RhdHMuaXNGaWxlKCk6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZXR5cGUgPSBjb25zdGFudHNfMS5XQVNJX0ZJTEVUWVBFX1JFR1VMQVJfRklMRTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgcnN0YXRzLmlzU29ja2V0KCk6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZXR5cGUgPSBjb25zdGFudHNfMS5XQVNJX0ZJTEVUWVBFX1NPQ0tFVF9TVFJFQU07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIHJzdGF0cy5pc1N5bWJvbGljTGluaygpOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGV0eXBlID0gY29uc3RhbnRzXzEuV0FTSV9GSUxFVFlQRV9TWU1CT0xJQ19MSU5LO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxldHlwZSA9IGNvbnN0YW50c18xLldBU0lfRklMRVRZUEVfVU5LTk9XTjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBfdGhpcy52aWV3LnNldFVpbnQ4KGJ1ZlB0ciwgZmlsZXR5cGUpO1xuICAgICAgICAgICAgICAgICAgICBidWZQdHIgKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgYnVmUHRyICs9IDM7IC8vIHBhZGRpbmdcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJ1ZlB0ciArIG5hbWVMZW5ndGggPj0gc3RhcnRQdHIgKyBidWZMZW4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEl0IGRvZXNuJ3QgZml0IGluIHRoZSBidWZmZXJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZhciBtZW1vcnlfYnVmZmVyID0gYnVmZmVyXzEuZGVmYXVsdC5mcm9tKF90aGlzLm1lbW9yeS5idWZmZXIpO1xuICAgICAgICAgICAgICAgICAgICBtZW1vcnlfYnVmZmVyLndyaXRlKGVudHJ5Lm5hbWUsIGJ1ZlB0cik7XG4gICAgICAgICAgICAgICAgICAgIGJ1ZlB0ciArPSBuYW1lTGVuZ3RoO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgYnVmdXNlZCA9IGJ1ZlB0ciAtIHN0YXJ0UHRyO1xuICAgICAgICAgICAgICAgIF90aGlzLnZpZXcuc2V0VWludDMyKGJ1ZnVzZWRQdHIsIE1hdGgubWluKGJ1ZnVzZWQsIGJ1ZkxlbiksIHRydWUpO1xuICAgICAgICAgICAgICAgIHJldHVybiBjb25zdGFudHNfMS5XQVNJX0VTVUNDRVNTO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBmZF9yZW51bWJlcjogd3JhcChmdW5jdGlvbiAoZnJvbSwgdG8pIHtcbiAgICAgICAgICAgICAgICBDSEVDS19GRChmcm9tLCBiaWdpbnRfMS5CaWdJbnRQb2x5ZmlsbCgwKSk7XG4gICAgICAgICAgICAgICAgQ0hFQ0tfRkQodG8sIGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKDApKTtcbiAgICAgICAgICAgICAgICBmcy5jbG9zZVN5bmMoX3RoaXMuRkRfTUFQLmdldChmcm9tKS5yZWFsKTtcbiAgICAgICAgICAgICAgICBfdGhpcy5GRF9NQVAuc2V0KGZyb20sIF90aGlzLkZEX01BUC5nZXQodG8pKTtcbiAgICAgICAgICAgICAgICBfdGhpcy5GRF9NQVAuZGVsZXRlKHRvKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29uc3RhbnRzXzEuV0FTSV9FU1VDQ0VTUztcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgZmRfc2Vlazogd3JhcChmdW5jdGlvbiAoZmQsIG9mZnNldCwgd2hlbmNlLCBuZXdPZmZzZXRQdHIpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RhdHMgPSBDSEVDS19GRChmZCwgY29uc3RhbnRzXzEuV0FTSV9SSUdIVF9GRF9TRUVLKTtcbiAgICAgICAgICAgICAgICBfdGhpcy5yZWZyZXNoTWVtb3J5KCk7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh3aGVuY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBjb25zdGFudHNfMS5XQVNJX1dIRU5DRV9DVVI6XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0cy5vZmZzZXQgPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzdGF0cy5vZmZzZXQgPyBzdGF0cy5vZmZzZXQgOiBiaWdpbnRfMS5CaWdJbnRQb2x5ZmlsbCgwKSkgKyBiaWdpbnRfMS5CaWdJbnRQb2x5ZmlsbChvZmZzZXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgY29uc3RhbnRzXzEuV0FTSV9XSEVOQ0VfRU5EOlxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNpemUgPSBmcy5mc3RhdFN5bmMoc3RhdHMucmVhbCkuc2l6ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRzLm9mZnNldCA9IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKHNpemUpICsgYmlnaW50XzEuQmlnSW50UG9seWZpbGwob2Zmc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIGNvbnN0YW50c18xLldBU0lfV0hFTkNFX1NFVDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRzLm9mZnNldCA9IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKG9mZnNldCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgX3RoaXMudmlldy5zZXRCaWdVaW50NjQobmV3T2Zmc2V0UHRyLCBzdGF0cy5vZmZzZXQsIHRydWUpO1xuICAgICAgICAgICAgICAgIHJldHVybiBjb25zdGFudHNfMS5XQVNJX0VTVUNDRVNTO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBmZF90ZWxsOiB3cmFwKGZ1bmN0aW9uIChmZCwgb2Zmc2V0UHRyKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0YXRzID0gQ0hFQ0tfRkQoZmQsIGNvbnN0YW50c18xLldBU0lfUklHSFRfRkRfVEVMTCk7XG4gICAgICAgICAgICAgICAgX3RoaXMucmVmcmVzaE1lbW9yeSgpO1xuICAgICAgICAgICAgICAgIGlmICghc3RhdHMub2Zmc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXRzLm9mZnNldCA9IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBfdGhpcy52aWV3LnNldEJpZ1VpbnQ2NChvZmZzZXRQdHIsIHN0YXRzLm9mZnNldCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnN0YW50c18xLldBU0lfRVNVQ0NFU1M7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIGZkX3N5bmM6IHdyYXAoZnVuY3Rpb24gKGZkKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0YXRzID0gQ0hFQ0tfRkQoZmQsIGNvbnN0YW50c18xLldBU0lfUklHSFRfRkRfU1lOQyk7XG4gICAgICAgICAgICAgICAgZnMuZnN5bmNTeW5jKHN0YXRzLnJlYWwpO1xuICAgICAgICAgICAgICAgIHJldHVybiBjb25zdGFudHNfMS5XQVNJX0VTVUNDRVNTO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBwYXRoX2NyZWF0ZV9kaXJlY3Rvcnk6IHdyYXAoZnVuY3Rpb24gKGZkLCBwYXRoUHRyLCBwYXRoTGVuKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0YXRzID0gQ0hFQ0tfRkQoZmQsIGNvbnN0YW50c18xLldBU0lfUklHSFRfUEFUSF9DUkVBVEVfRElSRUNUT1JZKTtcbiAgICAgICAgICAgICAgICBpZiAoIXN0YXRzLnBhdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbnN0YW50c18xLldBU0lfRUlOVkFMO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBfdGhpcy5yZWZyZXNoTWVtb3J5KCk7XG4gICAgICAgICAgICAgICAgdmFyIHAgPSBidWZmZXJfMS5kZWZhdWx0LmZyb20oX3RoaXMubWVtb3J5LmJ1ZmZlciwgcGF0aFB0ciwgcGF0aExlbikudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICBmcy5ta2RpclN5bmMocGF0aC5yZXNvbHZlKHN0YXRzLnBhdGgsIHApKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29uc3RhbnRzXzEuV0FTSV9FU1VDQ0VTUztcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgcGF0aF9maWxlc3RhdF9nZXQ6IHdyYXAoZnVuY3Rpb24gKGZkLCBmbGFncywgcGF0aFB0ciwgcGF0aExlbiwgYnVmUHRyKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0YXRzID0gQ0hFQ0tfRkQoZmQsIGNvbnN0YW50c18xLldBU0lfUklHSFRfUEFUSF9GSUxFU1RBVF9HRVQpO1xuICAgICAgICAgICAgICAgIGlmICghc3RhdHMucGF0aCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29uc3RhbnRzXzEuV0FTSV9FSU5WQUw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF90aGlzLnJlZnJlc2hNZW1vcnkoKTtcbiAgICAgICAgICAgICAgICB2YXIgcCA9IGJ1ZmZlcl8xLmRlZmF1bHQuZnJvbShfdGhpcy5tZW1vcnkuYnVmZmVyLCBwYXRoUHRyLCBwYXRoTGVuKS50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgIHZhciByc3RhdHMgPSBmcy5zdGF0U3luYyhwYXRoLnJlc29sdmUoc3RhdHMucGF0aCwgcCkpO1xuICAgICAgICAgICAgICAgIF90aGlzLnZpZXcuc2V0QmlnVWludDY0KGJ1ZlB0ciwgYmlnaW50XzEuQmlnSW50UG9seWZpbGwocnN0YXRzLmRldiksIHRydWUpO1xuICAgICAgICAgICAgICAgIGJ1ZlB0ciArPSA4O1xuICAgICAgICAgICAgICAgIF90aGlzLnZpZXcuc2V0QmlnVWludDY0KGJ1ZlB0ciwgYmlnaW50XzEuQmlnSW50UG9seWZpbGwocnN0YXRzLmlubyksIHRydWUpO1xuICAgICAgICAgICAgICAgIGJ1ZlB0ciArPSA4O1xuICAgICAgICAgICAgICAgIF90aGlzLnZpZXcuc2V0VWludDgoYnVmUHRyLCB0cmFuc2xhdGVGaWxlQXR0cmlidXRlcyhfdGhpcywgdW5kZWZpbmVkLCByc3RhdHMpLmZpbGV0eXBlKTtcbiAgICAgICAgICAgICAgICBidWZQdHIgKz0gODtcbiAgICAgICAgICAgICAgICBfdGhpcy52aWV3LnNldEJpZ1VpbnQ2NChidWZQdHIsIGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKHJzdGF0cy5ubGluayksIHRydWUpO1xuICAgICAgICAgICAgICAgIGJ1ZlB0ciArPSA4O1xuICAgICAgICAgICAgICAgIF90aGlzLnZpZXcuc2V0QmlnVWludDY0KGJ1ZlB0ciwgYmlnaW50XzEuQmlnSW50UG9seWZpbGwocnN0YXRzLnNpemUpLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBidWZQdHIgKz0gODtcbiAgICAgICAgICAgICAgICBfdGhpcy52aWV3LnNldEJpZ1VpbnQ2NChidWZQdHIsIG1zVG9Ocyhyc3RhdHMuYXRpbWVNcyksIHRydWUpO1xuICAgICAgICAgICAgICAgIGJ1ZlB0ciArPSA4O1xuICAgICAgICAgICAgICAgIF90aGlzLnZpZXcuc2V0QmlnVWludDY0KGJ1ZlB0ciwgbXNUb05zKHJzdGF0cy5tdGltZU1zKSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgYnVmUHRyICs9IDg7XG4gICAgICAgICAgICAgICAgX3RoaXMudmlldy5zZXRCaWdVaW50NjQoYnVmUHRyLCBtc1RvTnMocnN0YXRzLmN0aW1lTXMpLCB0cnVlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29uc3RhbnRzXzEuV0FTSV9FU1VDQ0VTUztcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgcGF0aF9maWxlc3RhdF9zZXRfdGltZXM6IHdyYXAoZnVuY3Rpb24gKGZkLCBkaXJmbGFncywgcGF0aFB0ciwgcGF0aExlbiwgc3RBdGltLCBzdE10aW0sIGZzdGZsYWdzKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0YXRzID0gQ0hFQ0tfRkQoZmQsIGNvbnN0YW50c18xLldBU0lfUklHSFRfUEFUSF9GSUxFU1RBVF9TRVRfVElNRVMpO1xuICAgICAgICAgICAgICAgIGlmICghc3RhdHMucGF0aCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29uc3RhbnRzXzEuV0FTSV9FSU5WQUw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF90aGlzLnJlZnJlc2hNZW1vcnkoKTtcbiAgICAgICAgICAgICAgICB2YXIgcnN0YXRzID0gZnMuZnN0YXRTeW5jKHN0YXRzLnJlYWwpO1xuICAgICAgICAgICAgICAgIHZhciBhdGltID0gcnN0YXRzLmF0aW1lO1xuICAgICAgICAgICAgICAgIHZhciBtdGltID0gcnN0YXRzLm10aW1lO1xuICAgICAgICAgICAgICAgIHZhciBuID0gbnNUb01zKG5vdyhjb25zdGFudHNfMS5XQVNJX0NMT0NLX1JFQUxUSU1FKSk7XG4gICAgICAgICAgICAgICAgdmFyIGF0aW1mbGFncyA9IGNvbnN0YW50c18xLldBU0lfRklMRVNUQVRfU0VUX0FUSU0gfCBjb25zdGFudHNfMS5XQVNJX0ZJTEVTVEFUX1NFVF9BVElNX05PVztcbiAgICAgICAgICAgICAgICBpZiAoKGZzdGZsYWdzICYgYXRpbWZsYWdzKSA9PT0gYXRpbWZsYWdzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb25zdGFudHNfMS5XQVNJX0VJTlZBTDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIG10aW1mbGFncyA9IGNvbnN0YW50c18xLldBU0lfRklMRVNUQVRfU0VUX01USU0gfCBjb25zdGFudHNfMS5XQVNJX0ZJTEVTVEFUX1NFVF9NVElNX05PVztcbiAgICAgICAgICAgICAgICBpZiAoKGZzdGZsYWdzICYgbXRpbWZsYWdzKSA9PT0gbXRpbWZsYWdzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb25zdGFudHNfMS5XQVNJX0VJTlZBTDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKChmc3RmbGFncyAmIGNvbnN0YW50c18xLldBU0lfRklMRVNUQVRfU0VUX0FUSU0pID09PSBjb25zdGFudHNfMS5XQVNJX0ZJTEVTVEFUX1NFVF9BVElNKSB7XG4gICAgICAgICAgICAgICAgICAgIGF0aW0gPSBuc1RvTXMoc3RBdGltKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoKGZzdGZsYWdzICYgY29uc3RhbnRzXzEuV0FTSV9GSUxFU1RBVF9TRVRfQVRJTV9OT1cpID09PSBjb25zdGFudHNfMS5XQVNJX0ZJTEVTVEFUX1NFVF9BVElNX05PVykge1xuICAgICAgICAgICAgICAgICAgICBhdGltID0gbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKChmc3RmbGFncyAmIGNvbnN0YW50c18xLldBU0lfRklMRVNUQVRfU0VUX01USU0pID09PSBjb25zdGFudHNfMS5XQVNJX0ZJTEVTVEFUX1NFVF9NVElNKSB7XG4gICAgICAgICAgICAgICAgICAgIG10aW0gPSBuc1RvTXMoc3RNdGltKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoKGZzdGZsYWdzICYgY29uc3RhbnRzXzEuV0FTSV9GSUxFU1RBVF9TRVRfTVRJTV9OT1cpID09PSBjb25zdGFudHNfMS5XQVNJX0ZJTEVTVEFUX1NFVF9NVElNX05PVykge1xuICAgICAgICAgICAgICAgICAgICBtdGltID0gbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIHAgPSBidWZmZXJfMS5kZWZhdWx0LmZyb20oX3RoaXMubWVtb3J5LmJ1ZmZlciwgcGF0aFB0ciwgcGF0aExlbikudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICBmcy51dGltZXNTeW5jKHBhdGgucmVzb2x2ZShzdGF0cy5wYXRoLCBwKSwgbmV3IERhdGUoYXRpbSksIG5ldyBEYXRlKG10aW0pKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29uc3RhbnRzXzEuV0FTSV9FU1VDQ0VTUztcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgcGF0aF9saW5rOiB3cmFwKGZ1bmN0aW9uIChvbGRGZCwgb2xkRmxhZ3MsIG9sZFBhdGgsIG9sZFBhdGhMZW4sIG5ld0ZkLCBuZXdQYXRoLCBuZXdQYXRoTGVuKSB7XG4gICAgICAgICAgICAgICAgdmFyIG9zdGF0cyA9IENIRUNLX0ZEKG9sZEZkLCBjb25zdGFudHNfMS5XQVNJX1JJR0hUX1BBVEhfTElOS19TT1VSQ0UpO1xuICAgICAgICAgICAgICAgIHZhciBuc3RhdHMgPSBDSEVDS19GRChuZXdGZCwgY29uc3RhbnRzXzEuV0FTSV9SSUdIVF9QQVRIX0xJTktfVEFSR0VUKTtcbiAgICAgICAgICAgICAgICBpZiAoIW9zdGF0cy5wYXRoIHx8ICFuc3RhdHMucGF0aCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29uc3RhbnRzXzEuV0FTSV9FSU5WQUw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF90aGlzLnJlZnJlc2hNZW1vcnkoKTtcbiAgICAgICAgICAgICAgICB2YXIgb3AgPSBidWZmZXJfMS5kZWZhdWx0LmZyb20oX3RoaXMubWVtb3J5LmJ1ZmZlciwgb2xkUGF0aCwgb2xkUGF0aExlbikudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICB2YXIgbnAgPSBidWZmZXJfMS5kZWZhdWx0LmZyb20oX3RoaXMubWVtb3J5LmJ1ZmZlciwgbmV3UGF0aCwgbmV3UGF0aExlbikudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICBmcy5saW5rU3luYyhwYXRoLnJlc29sdmUob3N0YXRzLnBhdGgsIG9wKSwgcGF0aC5yZXNvbHZlKG5zdGF0cy5wYXRoLCBucCkpO1xuICAgICAgICAgICAgICAgIHJldHVybiBjb25zdGFudHNfMS5XQVNJX0VTVUNDRVNTO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBwYXRoX29wZW46IHdyYXAoZnVuY3Rpb24gKGRpcmZkLCBkaXJmbGFncywgcGF0aFB0ciwgcGF0aExlbiwgb2ZsYWdzLCBmc1JpZ2h0c0Jhc2UsIGZzUmlnaHRzSW5oZXJpdGluZywgZnNGbGFncywgZmQpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RhdHMgPSBDSEVDS19GRChkaXJmZCwgY29uc3RhbnRzXzEuV0FTSV9SSUdIVF9QQVRIX09QRU4pO1xuICAgICAgICAgICAgICAgIGZzUmlnaHRzQmFzZSA9IGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKGZzUmlnaHRzQmFzZSk7XG4gICAgICAgICAgICAgICAgZnNSaWdodHNJbmhlcml0aW5nID0gYmlnaW50XzEuQmlnSW50UG9seWZpbGwoZnNSaWdodHNJbmhlcml0aW5nKTtcbiAgICAgICAgICAgICAgICB2YXIgcmVhZCA9IChmc1JpZ2h0c0Jhc2UgJiAoY29uc3RhbnRzXzEuV0FTSV9SSUdIVF9GRF9SRUFEIHwgY29uc3RhbnRzXzEuV0FTSV9SSUdIVF9GRF9SRUFERElSKSkgIT09XG4gICAgICAgICAgICAgICAgICAgIGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKDApO1xuICAgICAgICAgICAgICAgIHZhciB3cml0ZSA9IChmc1JpZ2h0c0Jhc2UgJlxuICAgICAgICAgICAgICAgICAgICAoY29uc3RhbnRzXzEuV0FTSV9SSUdIVF9GRF9EQVRBU1lOQyB8XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdGFudHNfMS5XQVNJX1JJR0hUX0ZEX1dSSVRFIHxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0YW50c18xLldBU0lfUklHSFRfRkRfQUxMT0NBVEUgfFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3RhbnRzXzEuV0FTSV9SSUdIVF9GRF9GSUxFU1RBVF9TRVRfU0laRSkpICE9PVxuICAgICAgICAgICAgICAgICAgICBiaWdpbnRfMS5CaWdJbnRQb2x5ZmlsbCgwKTtcbiAgICAgICAgICAgICAgICB2YXIgbm9mbGFncztcbiAgICAgICAgICAgICAgICBpZiAod3JpdGUgJiYgcmVhZCkge1xuICAgICAgICAgICAgICAgICAgICBub2ZsYWdzID0gZnMuY29uc3RhbnRzLk9fUkRXUjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAocmVhZCkge1xuICAgICAgICAgICAgICAgICAgICBub2ZsYWdzID0gZnMuY29uc3RhbnRzLk9fUkRPTkxZO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh3cml0ZSkge1xuICAgICAgICAgICAgICAgICAgICBub2ZsYWdzID0gZnMuY29uc3RhbnRzLk9fV1JPTkxZO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBmc1JpZ2h0c0Jhc2UgaXMgbmVlZGVkIGhlcmUgYnV0IHBlcmhhcHMgd2Ugc2hvdWxkIGRvIGl0IGluIG5lZWRlZEluaGVyaXRpbmdcbiAgICAgICAgICAgICAgICB2YXIgbmVlZGVkQmFzZSA9IGZzUmlnaHRzQmFzZSB8IGNvbnN0YW50c18xLldBU0lfUklHSFRfUEFUSF9PUEVOO1xuICAgICAgICAgICAgICAgIHZhciBuZWVkZWRJbmhlcml0aW5nID0gZnNSaWdodHNCYXNlIHwgZnNSaWdodHNJbmhlcml0aW5nO1xuICAgICAgICAgICAgICAgIGlmICgob2ZsYWdzICYgY29uc3RhbnRzXzEuV0FTSV9PX0NSRUFUKSAhPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBub2ZsYWdzIHw9IGZzLmNvbnN0YW50cy5PX0NSRUFUO1xuICAgICAgICAgICAgICAgICAgICBuZWVkZWRCYXNlIHw9IGNvbnN0YW50c18xLldBU0lfUklHSFRfUEFUSF9DUkVBVEVfRklMRTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKChvZmxhZ3MgJiBjb25zdGFudHNfMS5XQVNJX09fRElSRUNUT1JZKSAhPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBub2ZsYWdzIHw9IGZzLmNvbnN0YW50cy5PX0RJUkVDVE9SWTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKChvZmxhZ3MgJiBjb25zdGFudHNfMS5XQVNJX09fRVhDTCkgIT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgbm9mbGFncyB8PSBmcy5jb25zdGFudHMuT19FWENMO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoKG9mbGFncyAmIGNvbnN0YW50c18xLldBU0lfT19UUlVOQykgIT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgbm9mbGFncyB8PSBmcy5jb25zdGFudHMuT19UUlVOQztcbiAgICAgICAgICAgICAgICAgICAgbmVlZGVkQmFzZSB8PSBjb25zdGFudHNfMS5XQVNJX1JJR0hUX1BBVEhfRklMRVNUQVRfU0VUX1NJWkU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIENvbnZlcnQgZmlsZSBkZXNjcmlwdG9yIGZsYWdzLlxuICAgICAgICAgICAgICAgIGlmICgoZnNGbGFncyAmIGNvbnN0YW50c18xLldBU0lfRkRGTEFHX0FQUEVORCkgIT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgbm9mbGFncyB8PSBmcy5jb25zdGFudHMuT19BUFBFTkQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICgoZnNGbGFncyAmIGNvbnN0YW50c18xLldBU0lfRkRGTEFHX0RTWU5DKSAhPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZnMuY29uc3RhbnRzLk9fRFNZTkMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZmxhZ3MgfD0gZnMuY29uc3RhbnRzLk9fRFNZTkM7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBub2ZsYWdzIHw9IGZzLmNvbnN0YW50cy5PX1NZTkM7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgbmVlZGVkSW5oZXJpdGluZyB8PSBjb25zdGFudHNfMS5XQVNJX1JJR0hUX0ZEX0RBVEFTWU5DO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoKGZzRmxhZ3MgJiBjb25zdGFudHNfMS5XQVNJX0ZERkxBR19OT05CTE9DSykgIT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgbm9mbGFncyB8PSBmcy5jb25zdGFudHMuT19OT05CTE9DSztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKChmc0ZsYWdzICYgY29uc3RhbnRzXzEuV0FTSV9GREZMQUdfUlNZTkMpICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmcy5jb25zdGFudHMuT19SU1lOQykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbm9mbGFncyB8PSBmcy5jb25zdGFudHMuT19SU1lOQztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZmxhZ3MgfD0gZnMuY29uc3RhbnRzLk9fU1lOQztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBuZWVkZWRJbmhlcml0aW5nIHw9IGNvbnN0YW50c18xLldBU0lfUklHSFRfRkRfU1lOQztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKChmc0ZsYWdzICYgY29uc3RhbnRzXzEuV0FTSV9GREZMQUdfU1lOQykgIT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgbm9mbGFncyB8PSBmcy5jb25zdGFudHMuT19TWU5DO1xuICAgICAgICAgICAgICAgICAgICBuZWVkZWRJbmhlcml0aW5nIHw9IGNvbnN0YW50c18xLldBU0lfUklHSFRfRkRfU1lOQztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHdyaXRlICYmXG4gICAgICAgICAgICAgICAgICAgIChub2ZsYWdzICYgKGZzLmNvbnN0YW50cy5PX0FQUEVORCB8IGZzLmNvbnN0YW50cy5PX1RSVU5DKSkgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgbmVlZGVkSW5oZXJpdGluZyB8PSBjb25zdGFudHNfMS5XQVNJX1JJR0hUX0ZEX1NFRUs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF90aGlzLnJlZnJlc2hNZW1vcnkoKTtcbiAgICAgICAgICAgICAgICB2YXIgcCA9IGJ1ZmZlcl8xLmRlZmF1bHQuZnJvbShfdGhpcy5tZW1vcnkuYnVmZmVyLCBwYXRoUHRyLCBwYXRoTGVuKS50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgIHZhciBmdWxsVW5yZXNvbHZlZCA9IHBhdGgucmVzb2x2ZShzdGF0cy5wYXRoLCBwKTtcbiAgICAgICAgICAgICAgICBpZiAocGF0aC5yZWxhdGl2ZShzdGF0cy5wYXRoLCBmdWxsVW5yZXNvbHZlZCkuc3RhcnRzV2l0aChcIi4uXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb25zdGFudHNfMS5XQVNJX0VOT1RDQVBBQkxFO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgZnVsbDtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBmdWxsID0gZnMucmVhbHBhdGhTeW5jKGZ1bGxVbnJlc29sdmVkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhdGgucmVsYXRpdmUoc3RhdHMucGF0aCwgZnVsbCkuc3RhcnRzV2l0aChcIi4uXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29uc3RhbnRzXzEuV0FTSV9FTk9UQ0FQQUJMRTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZS5jb2RlID09PSBcIkVOT0VOVFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmdWxsID0gZnVsbFVucmVzb2x2ZWQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8qIGNoZWNrIGlmIHRoZSBmaWxlIGlzIGEgZGlyZWN0b3J5ICh1bmxlc3Mgb3BlbmluZyBmb3Igd3JpdGUsXG4gICAgICAgICAgICAgICAgICogaW4gd2hpY2ggY2FzZSB0aGUgZmlsZSBtYXkgbm90IGV4aXN0IGFuZCBzaG91bGQgYmUgY3JlYXRlZCkgKi9cbiAgICAgICAgICAgICAgICB2YXIgaXNEaXJlY3Rvcnk7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgaXNEaXJlY3RvcnkgPSBmcy5zdGF0U3luYyhmdWxsKS5pc0RpcmVjdG9yeSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXRjaCAoZSkgeyB9XG4gICAgICAgICAgICAgICAgdmFyIHJlYWxmZDtcbiAgICAgICAgICAgICAgICBpZiAoIXdyaXRlICYmIGlzRGlyZWN0b3J5KSB7XG4gICAgICAgICAgICAgICAgICAgIHJlYWxmZCA9IGZzLm9wZW5TeW5jKGZ1bGwsIGZzLmNvbnN0YW50cy5PX1JET05MWSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZWFsZmQgPSBmcy5vcGVuU3luYyhmdWxsLCBub2ZsYWdzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIG5ld2ZkID0gX19zcHJlYWRBcnJheShbXSwgX3RoaXMuRkRfTUFQLmtleXMoKSwgdHJ1ZSkucmV2ZXJzZSgpWzBdICsgMTtcbiAgICAgICAgICAgICAgICBfdGhpcy5GRF9NQVAuc2V0KG5ld2ZkLCB7XG4gICAgICAgICAgICAgICAgICAgIHJlYWw6IHJlYWxmZCxcbiAgICAgICAgICAgICAgICAgICAgZmlsZXR5cGU6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgLy8gb2Zmc2V0OiBCaWdJbnQoMCksXG4gICAgICAgICAgICAgICAgICAgIHJpZ2h0czoge1xuICAgICAgICAgICAgICAgICAgICAgICAgYmFzZTogbmVlZGVkQmFzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGluaGVyaXRpbmc6IG5lZWRlZEluaGVyaXRpbmdcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgcGF0aDogZnVsbFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHN0YXQoX3RoaXMsIG5ld2ZkKTtcbiAgICAgICAgICAgICAgICBfdGhpcy52aWV3LnNldFVpbnQzMihmZCwgbmV3ZmQsIHRydWUpO1xuICAgICAgICAgICAgICAgIHJldHVybiBjb25zdGFudHNfMS5XQVNJX0VTVUNDRVNTO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBwYXRoX3JlYWRsaW5rOiB3cmFwKGZ1bmN0aW9uIChmZCwgcGF0aFB0ciwgcGF0aExlbiwgYnVmLCBidWZMZW4sIGJ1ZnVzZWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RhdHMgPSBDSEVDS19GRChmZCwgY29uc3RhbnRzXzEuV0FTSV9SSUdIVF9QQVRIX1JFQURMSU5LKTtcbiAgICAgICAgICAgICAgICBpZiAoIXN0YXRzLnBhdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbnN0YW50c18xLldBU0lfRUlOVkFMO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBfdGhpcy5yZWZyZXNoTWVtb3J5KCk7XG4gICAgICAgICAgICAgICAgdmFyIHAgPSBidWZmZXJfMS5kZWZhdWx0LmZyb20oX3RoaXMubWVtb3J5LmJ1ZmZlciwgcGF0aFB0ciwgcGF0aExlbikudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICB2YXIgZnVsbCA9IHBhdGgucmVzb2x2ZShzdGF0cy5wYXRoLCBwKTtcbiAgICAgICAgICAgICAgICB2YXIgciA9IGZzLnJlYWRsaW5rU3luYyhmdWxsKTtcbiAgICAgICAgICAgICAgICB2YXIgdXNlZCA9IGJ1ZmZlcl8xLmRlZmF1bHQuZnJvbShfdGhpcy5tZW1vcnkuYnVmZmVyKS53cml0ZShyLCBidWYsIGJ1Zkxlbik7XG4gICAgICAgICAgICAgICAgX3RoaXMudmlldy5zZXRVaW50MzIoYnVmdXNlZCwgdXNlZCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnN0YW50c18xLldBU0lfRVNVQ0NFU1M7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHBhdGhfcmVtb3ZlX2RpcmVjdG9yeTogd3JhcChmdW5jdGlvbiAoZmQsIHBhdGhQdHIsIHBhdGhMZW4pIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RhdHMgPSBDSEVDS19GRChmZCwgY29uc3RhbnRzXzEuV0FTSV9SSUdIVF9QQVRIX1JFTU9WRV9ESVJFQ1RPUlkpO1xuICAgICAgICAgICAgICAgIGlmICghc3RhdHMucGF0aCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29uc3RhbnRzXzEuV0FTSV9FSU5WQUw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF90aGlzLnJlZnJlc2hNZW1vcnkoKTtcbiAgICAgICAgICAgICAgICB2YXIgcCA9IGJ1ZmZlcl8xLmRlZmF1bHQuZnJvbShfdGhpcy5tZW1vcnkuYnVmZmVyLCBwYXRoUHRyLCBwYXRoTGVuKS50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgIGZzLnJtZGlyU3luYyhwYXRoLnJlc29sdmUoc3RhdHMucGF0aCwgcCkpO1xuICAgICAgICAgICAgICAgIHJldHVybiBjb25zdGFudHNfMS5XQVNJX0VTVUNDRVNTO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBwYXRoX3JlbmFtZTogd3JhcChmdW5jdGlvbiAob2xkRmQsIG9sZFBhdGgsIG9sZFBhdGhMZW4sIG5ld0ZkLCBuZXdQYXRoLCBuZXdQYXRoTGVuKSB7XG4gICAgICAgICAgICAgICAgdmFyIG9zdGF0cyA9IENIRUNLX0ZEKG9sZEZkLCBjb25zdGFudHNfMS5XQVNJX1JJR0hUX1BBVEhfUkVOQU1FX1NPVVJDRSk7XG4gICAgICAgICAgICAgICAgdmFyIG5zdGF0cyA9IENIRUNLX0ZEKG5ld0ZkLCBjb25zdGFudHNfMS5XQVNJX1JJR0hUX1BBVEhfUkVOQU1FX1RBUkdFVCk7XG4gICAgICAgICAgICAgICAgaWYgKCFvc3RhdHMucGF0aCB8fCAhbnN0YXRzLnBhdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbnN0YW50c18xLldBU0lfRUlOVkFMO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBfdGhpcy5yZWZyZXNoTWVtb3J5KCk7XG4gICAgICAgICAgICAgICAgdmFyIG9wID0gYnVmZmVyXzEuZGVmYXVsdC5mcm9tKF90aGlzLm1lbW9yeS5idWZmZXIsIG9sZFBhdGgsIG9sZFBhdGhMZW4pLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgdmFyIG5wID0gYnVmZmVyXzEuZGVmYXVsdC5mcm9tKF90aGlzLm1lbW9yeS5idWZmZXIsIG5ld1BhdGgsIG5ld1BhdGhMZW4pLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgZnMucmVuYW1lU3luYyhwYXRoLnJlc29sdmUob3N0YXRzLnBhdGgsIG9wKSwgcGF0aC5yZXNvbHZlKG5zdGF0cy5wYXRoLCBucCkpO1xuICAgICAgICAgICAgICAgIHJldHVybiBjb25zdGFudHNfMS5XQVNJX0VTVUNDRVNTO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBwYXRoX3N5bWxpbms6IHdyYXAoZnVuY3Rpb24gKG9sZFBhdGgsIG9sZFBhdGhMZW4sIGZkLCBuZXdQYXRoLCBuZXdQYXRoTGVuKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0YXRzID0gQ0hFQ0tfRkQoZmQsIGNvbnN0YW50c18xLldBU0lfUklHSFRfUEFUSF9TWU1MSU5LKTtcbiAgICAgICAgICAgICAgICBpZiAoIXN0YXRzLnBhdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbnN0YW50c18xLldBU0lfRUlOVkFMO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBfdGhpcy5yZWZyZXNoTWVtb3J5KCk7XG4gICAgICAgICAgICAgICAgdmFyIG9wID0gYnVmZmVyXzEuZGVmYXVsdC5mcm9tKF90aGlzLm1lbW9yeS5idWZmZXIsIG9sZFBhdGgsIG9sZFBhdGhMZW4pLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgdmFyIG5wID0gYnVmZmVyXzEuZGVmYXVsdC5mcm9tKF90aGlzLm1lbW9yeS5idWZmZXIsIG5ld1BhdGgsIG5ld1BhdGhMZW4pLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgZnMuc3ltbGlua1N5bmMob3AsIHBhdGgucmVzb2x2ZShzdGF0cy5wYXRoLCBucCkpO1xuICAgICAgICAgICAgICAgIHJldHVybiBjb25zdGFudHNfMS5XQVNJX0VTVUNDRVNTO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBwYXRoX3VubGlua19maWxlOiB3cmFwKGZ1bmN0aW9uIChmZCwgcGF0aFB0ciwgcGF0aExlbikge1xuICAgICAgICAgICAgICAgIHZhciBzdGF0cyA9IENIRUNLX0ZEKGZkLCBjb25zdGFudHNfMS5XQVNJX1JJR0hUX1BBVEhfVU5MSU5LX0ZJTEUpO1xuICAgICAgICAgICAgICAgIGlmICghc3RhdHMucGF0aCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29uc3RhbnRzXzEuV0FTSV9FSU5WQUw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF90aGlzLnJlZnJlc2hNZW1vcnkoKTtcbiAgICAgICAgICAgICAgICB2YXIgcCA9IGJ1ZmZlcl8xLmRlZmF1bHQuZnJvbShfdGhpcy5tZW1vcnkuYnVmZmVyLCBwYXRoUHRyLCBwYXRoTGVuKS50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgIGZzLnVubGlua1N5bmMocGF0aC5yZXNvbHZlKHN0YXRzLnBhdGgsIHApKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29uc3RhbnRzXzEuV0FTSV9FU1VDQ0VTUztcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgcG9sbF9vbmVvZmY6IGZ1bmN0aW9uIChzaW4sIHNvdXQsIG5zdWJzY3JpcHRpb25zLCBuZXZlbnRzKSB7XG4gICAgICAgICAgICAgICAgdmFyIGV2ZW50YyA9IDA7XG4gICAgICAgICAgICAgICAgdmFyIHdhaXRFbmQgPSAwO1xuICAgICAgICAgICAgICAgIF90aGlzLnJlZnJlc2hNZW1vcnkoKTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5zdWJzY3JpcHRpb25zOyBpICs9IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHVzZXJkYXRhID0gX3RoaXMudmlldy5nZXRCaWdVaW50NjQoc2luLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgc2luICs9IDg7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0eXBlID0gX3RoaXMudmlldy5nZXRVaW50OChzaW4pO1xuICAgICAgICAgICAgICAgICAgICBzaW4gKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIGNvbnN0YW50c18xLldBU0lfRVZFTlRUWVBFX0NMT0NLOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2luICs9IDc7IC8vIHBhZGRpbmdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWRlbnRpZmllciA9IF90aGlzLnZpZXcuZ2V0QmlnVWludDY0KHNpbiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2luICs9IDg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNsb2NraWQgPSBfdGhpcy52aWV3LmdldFVpbnQzMihzaW4sIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpbiArPSA0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpbiArPSA0OyAvLyBwYWRkaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRpbWVzdGFtcCA9IF90aGlzLnZpZXcuZ2V0QmlnVWludDY0KHNpbiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2luICs9IDg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByZWNpc2lvbiA9IF90aGlzLnZpZXcuZ2V0QmlnVWludDY0KHNpbiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2luICs9IDg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1YmNsb2NrZmxhZ3MgPSBfdGhpcy52aWV3LmdldFVpbnQxNihzaW4sIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpbiArPSAyO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpbiArPSA2OyAvLyBwYWRkaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFic29sdXRlID0gc3ViY2xvY2tmbGFncyA9PT0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IGNvbnN0YW50c18xLldBU0lfRVNVQ0NFU1M7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSBiaWdpbnRfMS5CaWdJbnRQb2x5ZmlsbChub3coY2xvY2tpZCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBjb25zdGFudHNfMS5XQVNJX0VJTlZBTDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbmQgPSBhYnNvbHV0ZSA/IHRpbWVzdGFtcCA6IG4gKyB0aW1lc3RhbXA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhaXRFbmQgPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kID4gd2FpdEVuZCA/IGVuZCA6IHdhaXRFbmQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnZpZXcuc2V0QmlnVWludDY0KHNvdXQsIHVzZXJkYXRhLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3V0ICs9IDg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMudmlldy5zZXRVaW50MTYoc291dCwgZSwgdHJ1ZSk7IC8vIGVycm9yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc291dCArPSAyOyAvLyBwYWQgb2Zmc2V0IDJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy52aWV3LnNldFVpbnQ4KHNvdXQsIGNvbnN0YW50c18xLldBU0lfRVZFTlRUWVBFX0NMT0NLKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3V0ICs9IDE7IC8vIHBhZCBvZmZzZXQgM1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXQgKz0gNTsgLy8gcGFkZGluZyB0byA4XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRjICs9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIGNvbnN0YW50c18xLldBU0lfRVZFTlRUWVBFX0ZEX1JFQUQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIGNvbnN0YW50c18xLldBU0lfRVZFTlRUWVBFX0ZEX1dSSVRFOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2luICs9IDM7IC8vIHBhZGRpbmdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmQgPSBfdGhpcy52aWV3LmdldFVpbnQzMihzaW4sIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpbiArPSA0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnZpZXcuc2V0QmlnVWludDY0KHNvdXQsIHVzZXJkYXRhLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3V0ICs9IDg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMudmlldy5zZXRVaW50MTYoc291dCwgY29uc3RhbnRzXzEuV0FTSV9FTk9TWVMsIHRydWUpOyAvLyBlcnJvclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXQgKz0gMjsgLy8gcGFkIG9mZnNldCAyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMudmlldy5zZXRVaW50OChzb3V0LCB0eXBlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3V0ICs9IDE7IC8vIHBhZCBvZmZzZXQgM1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXQgKz0gNTsgLy8gcGFkZGluZyB0byA4XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRjICs9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb25zdGFudHNfMS5XQVNJX0VJTlZBTDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBfdGhpcy52aWV3LnNldFVpbnQzMihuZXZlbnRzLCBldmVudGMsIHRydWUpO1xuICAgICAgICAgICAgICAgIHdoaWxlIChiaW5kaW5ncy5ocnRpbWUoKSA8IHdhaXRFbmQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gbm90aGluZ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gY29uc3RhbnRzXzEuV0FTSV9FU1VDQ0VTUztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwcm9jX2V4aXQ6IGZ1bmN0aW9uIChydmFsKSB7XG4gICAgICAgICAgICAgICAgYmluZGluZ3MuZXhpdChydmFsKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29uc3RhbnRzXzEuV0FTSV9FU1VDQ0VTUztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwcm9jX3JhaXNlOiBmdW5jdGlvbiAoc2lnKSB7XG4gICAgICAgICAgICAgICAgaWYgKCEoc2lnIGluIGNvbnN0YW50c18xLlNJR05BTF9NQVApKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb25zdGFudHNfMS5XQVNJX0VJTlZBTDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYmluZGluZ3Mua2lsbChjb25zdGFudHNfMS5TSUdOQUxfTUFQW3NpZ10pO1xuICAgICAgICAgICAgICAgIHJldHVybiBjb25zdGFudHNfMS5XQVNJX0VTVUNDRVNTO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJhbmRvbV9nZXQ6IGZ1bmN0aW9uIChidWZQdHIsIGJ1Zkxlbikge1xuICAgICAgICAgICAgICAgIF90aGlzLnJlZnJlc2hNZW1vcnkoKTtcbiAgICAgICAgICAgICAgICBiaW5kaW5ncy5yYW5kb21GaWxsU3luYyhuZXcgVWludDhBcnJheShfdGhpcy5tZW1vcnkuYnVmZmVyKSwgYnVmUHRyLCBidWZMZW4pO1xuICAgICAgICAgICAgICAgIHJldHVybiBjb25zdGFudHNfMS5XQVNJX0VTVUNDRVNTO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNjaGVkX3lpZWxkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgLy8gU2luZ2xlIHRocmVhZGVkIGVudmlyb25tZW50XG4gICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBhIG5vLW9wIGluIEpTXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnN0YW50c18xLldBU0lfRVNVQ0NFU1M7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc29ja19yZWN2OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnN0YW50c18xLldBU0lfRU5PU1lTO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNvY2tfc2VuZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjb25zdGFudHNfMS5XQVNJX0VOT1NZUztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzb2NrX3NodXRkb3duOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnN0YW50c18xLldBU0lfRU5PU1lTO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAvLyBXcmFwIGVhY2ggb2YgdGhlIGltcG9ydHMgdG8gc2hvdyB0aGUgY2FsbHMgaW4gdGhlIGNvbnNvbGVcbiAgICAgICAgaWYgKHdhc2lDb25maWcudHJhY2VTeXNjYWxscykge1xuICAgICAgICAgICAgT2JqZWN0LmtleXModGhpcy53YXNpSW1wb3J0KS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgICAgICB2YXIgcHJldkltcG9ydCA9IF90aGlzLndhc2lJbXBvcnRba2V5XTtcbiAgICAgICAgICAgICAgICBfdGhpcy53YXNpSW1wb3J0W2tleV0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhcmdzID0gW107XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzW19pXSA9IGFyZ3VtZW50c1tfaV07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJXQVNJOiB3YXNpSW1wb3J0IGNhbGxlZDogXCIuY29uY2F0KGtleSwgXCIgKFwiKS5jb25jYXQoYXJncywgXCIpXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBwcmV2SW1wb3J0LmFwcGx5KHZvaWQgMCwgYXJncyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIldBU0k6ICA9PiBcIi5jb25jYXQocmVzdWx0KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkNhdGNoZWQgZXJyb3I6IFwiLmNvbmNhdChlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIFdBU0lEZWZhdWx0LnByb3RvdHlwZS5yZWZyZXNoTWVtb3J5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIGlmICghdGhpcy52aWV3IHx8IHRoaXMudmlldy5idWZmZXIuYnl0ZUxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgdGhpcy52aWV3ID0gbmV3IGRhdGF2aWV3XzEuRGF0YVZpZXdQb2x5ZmlsbCh0aGlzLm1lbW9yeS5idWZmZXIpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBXQVNJRGVmYXVsdC5wcm90b3R5cGUuc2V0TWVtb3J5ID0gZnVuY3Rpb24gKG1lbW9yeSkge1xuICAgICAgICB0aGlzLm1lbW9yeSA9IG1lbW9yeTtcbiAgICB9O1xuICAgIFdBU0lEZWZhdWx0LnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uIChpbnN0YW5jZSkge1xuICAgICAgICB2YXIgZXhwb3J0cyA9IGluc3RhbmNlLmV4cG9ydHM7XG4gICAgICAgIGlmIChleHBvcnRzID09PSBudWxsIHx8IHR5cGVvZiBleHBvcnRzICE9PSBcIm9iamVjdFwiKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJpbnN0YW5jZS5leHBvcnRzIG11c3QgYmUgYW4gT2JqZWN0LiBSZWNlaXZlZCBcIi5jb25jYXQoZXhwb3J0cywgXCIuXCIpKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgbWVtb3J5ID0gZXhwb3J0cy5tZW1vcnk7XG4gICAgICAgIGlmICghKG1lbW9yeSBpbnN0YW5jZW9mIFdlYkFzc2VtYmx5Lk1lbW9yeSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImluc3RhbmNlLmV4cG9ydHMubWVtb3J5IG11c3QgYmUgYSBXZWJBc3NlbWJseS5NZW1vcnkuIFJlY2NlaXZlZCBcIi5jb25jYXQobWVtb3J5LCBcIi5cIikpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0TWVtb3J5KG1lbW9yeSk7XG4gICAgICAgIGlmIChleHBvcnRzLl9zdGFydCkge1xuICAgICAgICAgICAgZXhwb3J0cy5fc3RhcnQoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgV0FTSURlZmF1bHQucHJvdG90eXBlLmdldEltcG9ydE5hbWVzcGFjZSA9IGZ1bmN0aW9uIChtb2R1bGUpIHtcbiAgICAgICAgdmFyIG5hbWVzcGFjZSA9IG51bGw7XG4gICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSBXZWJBc3NlbWJseS5Nb2R1bGUuaW1wb3J0cyhtb2R1bGUpOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgdmFyIGltcCA9IF9hW19pXTtcbiAgICAgICAgICAgIC8vIFdlIG9ubHkgY2hlY2sgZm9yIHRoZSBmdW5jdGlvbnNcbiAgICAgICAgICAgIGlmIChpbXAua2luZCAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBXZSBhbGxvdyBmdW5jdGlvbnMgaW4gb3RoZXIgbmFtZXNwYWNlcyBvdGhlciB0aGFuIHdhc2lcbiAgICAgICAgICAgIGlmICghaW1wLm1vZHVsZS5zdGFydHNXaXRoKFwid2FzaV9cIikpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghbmFtZXNwYWNlKSB7XG4gICAgICAgICAgICAgICAgbmFtZXNwYWNlID0gaW1wLm1vZHVsZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChuYW1lc3BhY2UgIT09IGltcC5tb2R1bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTXVsdGlwbGUgbmFtZXNwYWNlcyBkZXRlY3RlZC5cIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuYW1lc3BhY2U7XG4gICAgfTtcbiAgICBXQVNJRGVmYXVsdC5wcm90b3R5cGUuZ2V0SW1wb3J0cyA9IGZ1bmN0aW9uIChtb2R1bGUpIHtcbiAgICAgICAgdmFyIG5hbWVzcGFjZSA9IHRoaXMuZ2V0SW1wb3J0TmFtZXNwYWNlKG1vZHVsZSk7XG4gICAgICAgIHN3aXRjaCAobmFtZXNwYWNlKSB7XG4gICAgICAgICAgICBjYXNlIFwid2FzaV91bnN0YWJsZVwiOlxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHdhc2lfdW5zdGFibGU6IHRoaXMud2FzaUltcG9ydFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjYXNlIFwid2FzaV9zbmFwc2hvdF9wcmV2aWV3MVwiOlxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHdhc2lfc25hcHNob3RfcHJldmlldzE6IHRoaXMud2FzaUltcG9ydFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbid0IGRldGVjdCBhIFdBU0kgbmFtZXNwYWNlIGZvciB0aGUgV2ViQXNzZW1ibHkgTW9kdWxlXCIpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gV0FTSURlZmF1bHQ7XG59KCkpO1xuZXhwb3J0cy5kZWZhdWx0ID0gV0FTSURlZmF1bHQ7XG5XQVNJRGVmYXVsdC5kZWZhdWx0QmluZGluZ3MgPSBkZWZhdWx0QmluZGluZ3M7XG4vLyBBbHNvIGV4cG9ydCBpdCBhcyBhIGZpZWxkIGluIHRoZSBleHBvcnQgb2JqZWN0XG5leHBvcnRzLldBU0kgPSBXQVNJRGVmYXVsdDtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL0B3YXNtZXIrd2FzaUAwLjEyLjAvbm9kZV9tb2R1bGVzL0B3YXNtZXIvd2FzaS9saWIvaW5kZXguanM/Iik7CgovKioqLyB9KSwKCi8qKiovICIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vQHdhc21lcit3YXNpQDAuMTIuMC9ub2RlX21vZHVsZXMvQHdhc21lci93YXNpL2xpYi9wb2x5ZmlsbHMvYmlnaW50LmpzIjoKLyohKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqISpcCiAgISoqKiAvaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vQHdhc21lcit3YXNpQDAuMTIuMC9ub2RlX21vZHVsZXMvQHdhc21lci93YXNpL2xpYi9wb2x5ZmlsbHMvYmlnaW50LmpzICoqKiEKICBcKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKiEgbm8gc3RhdGljIGV4cG9ydHMgZm91bmQgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwpldmFsKCIvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi8oZnVuY3Rpb24oZ2xvYmFsKSB7XG4vLyBBIHZlcnkgc2ltcGxlIHdvcmthcm91bmQgZm9yIEJpZyBpbnQuIFdvcmtzIGluIGNvbmp1bmN0aW9uIHdpdGggb3VyIGN1c3RvbVxuLy8gRGF0YXZpZXcgd29ya2Fyb3VuZCBhdCAuL2RhdGF2aWV3LnRzXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgZ2xvYmFsT2JqID0gdHlwZW9mIGdsb2JhbFRoaXMgIT09IFwidW5kZWZpbmVkXCJcbiAgICA/IGdsb2JhbFRoaXNcbiAgICA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCJcbiAgICAgICAgPyBnbG9iYWxcbiAgICAgICAgOiB7fTtcbmV4cG9ydHMuQmlnSW50UG9seWZpbGwgPSB0eXBlb2YgQmlnSW50ICE9PSBcInVuZGVmaW5lZFwiID8gQmlnSW50IDogZ2xvYmFsT2JqLkJpZ0ludCB8fCBOdW1iZXI7XG5cbi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqL30uY2FsbCh0aGlzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuLy4uLy4uLy4uLy4uLy4uLy4uL3dlYnBhY2tANC40Ni4wX3dlYnBhY2stY2xpQDQuMTAuMC9ub2RlX21vZHVsZXMvd2VicGFjay9idWlsZGluL2dsb2JhbC5qcyAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS93ZWJwYWNrQDQuNDYuMF93ZWJwYWNrLWNsaUA0LjEwLjAvbm9kZV9tb2R1bGVzL3dlYnBhY2svYnVpbGRpbi9nbG9iYWwuanNcIikpKVxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL0B3YXNtZXIrd2FzaUAwLjEyLjAvbm9kZV9tb2R1bGVzL0B3YXNtZXIvd2FzaS9saWIvcG9seWZpbGxzL2JpZ2ludC5qcz8iKTsKCi8qKiovIH0pLAoKLyoqKi8gIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9Ad2FzbWVyK3dhc2lAMC4xMi4wL25vZGVfbW9kdWxlcy9Ad2FzbWVyL3dhc2kvbGliL3BvbHlmaWxscy9icm93c2VyLWhydGltZS5qcyI6Ci8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqISpcCiAgISoqKiAvaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vQHdhc21lcit3YXNpQDAuMTIuMC9ub2RlX21vZHVsZXMvQHdhc21lci93YXNpL2xpYi9wb2x5ZmlsbHMvYnJvd3Nlci1ocnRpbWUuanMgKioqIQogIFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKZXZhbCgiXG4vLyBocnRpbWUgcG9seWZpbGwgZm9yIHRoZSBicm93c2VyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgYmFzZU5vdyA9IE1hdGguZmxvb3IoKERhdGUubm93KCkgLSBwZXJmb3JtYW5jZS5ub3coKSkgKiAxZS0zKTtcbmZ1bmN0aW9uIGhydGltZShwcmV2aW91c1RpbWVzdGFtcCkge1xuICAgIC8vIGluaXRpbGFpemUgb3VyIHZhcmlhYmxlc1xuICAgIHZhciBjbG9ja3RpbWUgPSBwZXJmb3JtYW5jZS5ub3coKSAqIDFlLTM7XG4gICAgdmFyIHNlY29uZHMgPSBNYXRoLmZsb29yKGNsb2NrdGltZSkgKyBiYXNlTm93O1xuICAgIHZhciBuYW5vc2Vjb25kcyA9IE1hdGguZmxvb3IoKGNsb2NrdGltZSAlIDEpICogMWU5KTtcbiAgICAvLyBDb21wYXJlIHRvIHRoZSBwcnZpb3VzIHRpbWVzdGFtcCBpZiB3ZSBoYXZlIG9uZVxuICAgIGlmIChwcmV2aW91c1RpbWVzdGFtcCkge1xuICAgICAgICBzZWNvbmRzID0gc2Vjb25kcyAtIHByZXZpb3VzVGltZXN0YW1wWzBdO1xuICAgICAgICBuYW5vc2Vjb25kcyA9IG5hbm9zZWNvbmRzIC0gcHJldmlvdXNUaW1lc3RhbXBbMV07XG4gICAgICAgIGlmIChuYW5vc2Vjb25kcyA8IDApIHtcbiAgICAgICAgICAgIHNlY29uZHMtLTtcbiAgICAgICAgICAgIG5hbm9zZWNvbmRzICs9IDFlOTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyBSZXR1cm4gb3VyIHNlY29uZHMgdHVwbGVcbiAgICByZXR1cm4gW3NlY29uZHMsIG5hbm9zZWNvbmRzXTtcbn1cbmV4cG9ydHMuZGVmYXVsdCA9IGhydGltZTtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL0B3YXNtZXIrd2FzaUAwLjEyLjAvbm9kZV9tb2R1bGVzL0B3YXNtZXIvd2FzaS9saWIvcG9seWZpbGxzL2Jyb3dzZXItaHJ0aW1lLmpzPyIpOwoKLyoqKi8gfSksCgovKioqLyAiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0B3YXNtZXIrd2FzaUAwLjEyLjAvbm9kZV9tb2R1bGVzL0B3YXNtZXIvd2FzaS9saWIvcG9seWZpbGxzL2J1ZmZlci5qcyI6Ci8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiEqXAogICEqKiogL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL0B3YXNtZXIrd2FzaUAwLjEyLjAvbm9kZV9tb2R1bGVzL0B3YXNtZXIvd2FzaS9saWIvcG9seWZpbGxzL2J1ZmZlci5qcyAqKiohCiAgXCoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKZXZhbCgiLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovKGZ1bmN0aW9uKEJ1ZmZlcikge1xuLy8gUmV0dXJuIG91ciBidWZmZXIgZGVwZW5kaW5nIG9uIGJyb3dzZXIgb3Igbm9kZVxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuLypST0xMVVBfUkVQTEFDRV9CUk9XU0VSXG4vLyBAdHMtaWdub3JlXG5pbXBvcnQgeyBCdWZmZXIgfSBmcm9tIFwiYnVmZmVyLWVzNlwiO1xuUk9MTFVQX1JFUExBQ0VfQlJPV1NFUiovXG52YXIgaXNvbW9ycGhpY0J1ZmZlciA9IEJ1ZmZlcjtcbmV4cG9ydHMuZGVmYXVsdCA9IGlzb21vcnBoaWNCdWZmZXI7XG5cbi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqL30uY2FsbCh0aGlzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuLy4uLy4uLy4uLy4uLy4uLy4uL2J1ZmZlckA0LjkuMi9ub2RlX21vZHVsZXMvYnVmZmVyL2luZGV4LmpzICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2J1ZmZlckA0LjkuMi9ub2RlX21vZHVsZXMvYnVmZmVyL2luZGV4LmpzXCIpLkJ1ZmZlcikpXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8vaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vQHdhc21lcit3YXNpQDAuMTIuMC9ub2RlX21vZHVsZXMvQHdhc21lci93YXNpL2xpYi9wb2x5ZmlsbHMvYnVmZmVyLmpzPyIpOwoKLyoqKi8gfSksCgovKioqLyAiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0B3YXNtZXIrd2FzaUAwLjEyLjAvbm9kZV9tb2R1bGVzL0B3YXNtZXIvd2FzaS9saWIvcG9seWZpbGxzL2RhdGF2aWV3LmpzIjoKLyohKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlwKICAhKioqIC9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9Ad2FzbWVyK3dhc2lAMC4xMi4wL25vZGVfbW9kdWxlcy9Ad2FzbWVyL3dhc2kvbGliL3BvbHlmaWxscy9kYXRhdmlldy5qcyAqKiohCiAgXCoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKiEgbm8gc3RhdGljIGV4cG9ydHMgZm91bmQgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwpldmFsKCJcbi8vIEEgdmVyeSBzaW1wbGUgd29ya2Fyb3VuZCBmb3IgQmlnIGludC4gV29ya3MgaW4gY29uanVuY3Rpb24gd2l0aCBvdXIgY3VzdG9tXG4vLyBCaWdJbnQgd29ya2Fyb3VuZCBhdCAuL2JpZ2ludC50c1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIGJpZ2ludF8xID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9iaWdpbnQgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vQHdhc21lcit3YXNpQDAuMTIuMC9ub2RlX21vZHVsZXMvQHdhc21lci93YXNpL2xpYi9wb2x5ZmlsbHMvYmlnaW50LmpzXCIpO1xudmFyIGV4cG9ydGVkRGF0YVZpZXcgPSBEYXRhVmlldztcbmlmICghZXhwb3J0ZWREYXRhVmlldy5wcm90b3R5cGUuc2V0QmlnVWludDY0KSB7XG4gICAgLy8gVGFrZW4gZnJvbSBodHRwczovL2dpc3QuZ2l0aHViLmNvbS9ncmF1cC84MTVjOWFjNjVjMmJhYzhhNTYzOTFmMGNhMjM2MzZmY1xuICAgIGV4cG9ydGVkRGF0YVZpZXcucHJvdG90eXBlLnNldEJpZ1VpbnQ2NCA9IGZ1bmN0aW9uIChieXRlT2Zmc2V0LCB2YWx1ZSwgbGl0dGxlRW5kaWFuKSB7XG4gICAgICAgIHZhciBsb3dXb3JkO1xuICAgICAgICB2YXIgaGlnaFdvcmQ7XG4gICAgICAgIGlmICh2YWx1ZSA8IE1hdGgucG93KDIsIDMyKSkge1xuICAgICAgICAgICAgbG93V29yZCA9IE51bWJlcih2YWx1ZSk7XG4gICAgICAgICAgICBoaWdoV29yZCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB2YXIgYmlnTnVtYmVyQXNCaW5hcnlTdHIgPSB2YWx1ZS50b1N0cmluZygyKTtcbiAgICAgICAgICAgIC8vIENvbnZlcnQgdGhlIGFib3ZlIGJpbmFyeSBzdHIgdG8gNjQgYml0IChhY3R1YWxseSA1MiBiaXQgd2lsbCB3b3JrKSBieSBwYWRkaW5nIHplcm9zIGluIHRoZSBsZWZ0XG4gICAgICAgICAgICB2YXIgYmlnTnVtYmVyQXNCaW5hcnlTdHIyID0gXCJcIjtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNjQgLSBiaWdOdW1iZXJBc0JpbmFyeVN0ci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGJpZ051bWJlckFzQmluYXJ5U3RyMiArPSBcIjBcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJpZ051bWJlckFzQmluYXJ5U3RyMiArPSBiaWdOdW1iZXJBc0JpbmFyeVN0cjtcbiAgICAgICAgICAgIGhpZ2hXb3JkID0gcGFyc2VJbnQoYmlnTnVtYmVyQXNCaW5hcnlTdHIyLnN1YnN0cmluZygwLCAzMiksIDIpO1xuICAgICAgICAgICAgbG93V29yZCA9IHBhcnNlSW50KGJpZ051bWJlckFzQmluYXJ5U3RyMi5zdWJzdHJpbmcoMzIpLCAyKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNldFVpbnQzMihieXRlT2Zmc2V0ICsgKGxpdHRsZUVuZGlhbiA/IDAgOiA0KSwgbG93V29yZCwgbGl0dGxlRW5kaWFuKTtcbiAgICAgICAgdGhpcy5zZXRVaW50MzIoYnl0ZU9mZnNldCArIChsaXR0bGVFbmRpYW4gPyA0IDogMCksIGhpZ2hXb3JkLCBsaXR0bGVFbmRpYW4pO1xuICAgIH07XG4gICAgZXhwb3J0ZWREYXRhVmlldy5wcm90b3R5cGUuZ2V0QmlnVWludDY0ID0gZnVuY3Rpb24gKGJ5dGVPZmZzZXQsIGxpdHRsZUVuZGlhbikge1xuICAgICAgICB2YXIgbG93V29yZCA9IHRoaXMuZ2V0VWludDMyKGJ5dGVPZmZzZXQgKyAobGl0dGxlRW5kaWFuID8gMCA6IDQpLCBsaXR0bGVFbmRpYW4pO1xuICAgICAgICB2YXIgaGlnaFdvcmQgPSB0aGlzLmdldFVpbnQzMihieXRlT2Zmc2V0ICsgKGxpdHRsZUVuZGlhbiA/IDQgOiAwKSwgbGl0dGxlRW5kaWFuKTtcbiAgICAgICAgdmFyIGxvd1dvcmRBc0JpbmFyeVN0ciA9IGxvd1dvcmQudG9TdHJpbmcoMik7XG4gICAgICAgIHZhciBoaWdoV29yZEFzQmluYXJ5U3RyID0gaGlnaFdvcmQudG9TdHJpbmcoMik7XG4gICAgICAgIC8vIENvbnZlcnQgdGhlIGFib3ZlIGJpbmFyeSBzdHIgdG8gNjQgYml0IChhY3R1YWxseSA1MiBiaXQgd2lsbCB3b3JrKSBieSBwYWRkaW5nIHplcm9zIGluIHRoZSBsZWZ0XG4gICAgICAgIHZhciBsb3dXb3JkQXNCaW5hcnlTdHJQYWRkZWQgPSBcIlwiO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDMyIC0gbG93V29yZEFzQmluYXJ5U3RyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBsb3dXb3JkQXNCaW5hcnlTdHJQYWRkZWQgKz0gXCIwXCI7XG4gICAgICAgIH1cbiAgICAgICAgbG93V29yZEFzQmluYXJ5U3RyUGFkZGVkICs9IGxvd1dvcmRBc0JpbmFyeVN0cjtcbiAgICAgICAgcmV0dXJuIGJpZ2ludF8xLkJpZ0ludFBvbHlmaWxsKFwiMGJcIiArIGhpZ2hXb3JkQXNCaW5hcnlTdHIgKyBsb3dXb3JkQXNCaW5hcnlTdHJQYWRkZWQpO1xuICAgIH07XG59XG5leHBvcnRzLkRhdGFWaWV3UG9seWZpbGwgPSBleHBvcnRlZERhdGFWaWV3O1xuXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8vaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vQHdhc21lcit3YXNpQDAuMTIuMC9ub2RlX21vZHVsZXMvQHdhc21lci93YXNpL2xpYi9wb2x5ZmlsbHMvZGF0YXZpZXcuanM/Iik7CgovKioqLyB9KSwKCi8qKiovICIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vQHdhc21lcit3YXNpQDAuMTIuMC9ub2RlX21vZHVsZXMvQHdhc21lci93YXNpL2xpYi9wb2x5ZmlsbHMvaHJ0aW1lLmJpZ2ludC5qcyI6Ci8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlwKICAhKioqIC9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9Ad2FzbWVyK3dhc2lAMC4xMi4wL25vZGVfbW9kdWxlcy9Ad2FzbWVyL3dhc2kvbGliL3BvbHlmaWxscy9ocnRpbWUuYmlnaW50LmpzICoqKiEKICBcKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKZXZhbCgiXG4vLyBTaW1wbHkgcG9seWZpbGwgZm9yIGhydGltZVxuLy8gaHR0cHM6Ly9ub2RlanMub3JnL2FwaS9wcm9jZXNzLmh0bWwjcHJvY2Vzc19wcm9jZXNzX2hydGltZV90aW1lXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgTlNfUEVSX1NFQyA9IDFlOTtcbnZhciBnZXRCaWdJbnRIcnRpbWUgPSBmdW5jdGlvbiAobmF0aXZlSHJ0aW1lKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0aW1lKSB7XG4gICAgICAgIHZhciBkaWZmID0gbmF0aXZlSHJ0aW1lKHRpbWUpO1xuICAgICAgICAvLyBSZXR1cm4gdGhlIHRpbWVcbiAgICAgICAgcmV0dXJuIChkaWZmWzBdICogTlNfUEVSX1NFQyArIGRpZmZbMV0pO1xuICAgIH07XG59O1xuZXhwb3J0cy5kZWZhdWx0ID0gZ2V0QmlnSW50SHJ0aW1lO1xuXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8vaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vQHdhc21lcit3YXNpQDAuMTIuMC9ub2RlX21vZHVsZXMvQHdhc21lci93YXNpL2xpYi9wb2x5ZmlsbHMvaHJ0aW1lLmJpZ2ludC5qcz8iKTsKCi8qKiovIH0pLAoKLyoqKi8gIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9Ad2FzbWVyK3dhc21mc0AwLjEyLjAvbm9kZV9tb2R1bGVzL0B3YXNtZXIvd2FzbWZzL2xpYi9pbmRleC5lc20uanMiOgovKiEqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlwKICAhKioqIC9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9Ad2FzbWVyK3dhc21mc0AwLjEyLjAvbm9kZV9tb2R1bGVzL0B3YXNtZXIvd2FzbWZzL2xpYi9pbmRleC5lc20uanMgKioqIQogIFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CmV2YWwoIi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLyhmdW5jdGlvbihnbG9iYWwsIHNldEltbWVkaWF0ZSkge1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5XYXNtRnMgPSB2b2lkIDA7XG4vKlxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG5Db3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZVxudGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGVcbkxpY2Vuc2UgYXQgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblRISVMgQ09ERSBJUyBQUk9WSURFRCBPTiBBTiAqQVMgSVMqIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbktJTkQsIEVJVEhFUiBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBXSVRIT1VUIExJTUlUQVRJT04gQU5ZIElNUExJRURcbldBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBUSVRMRSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UsXG5NRVJDSEFOVEFCTElUWSBPUiBOT04tSU5GUklOR0VNRU5ULlxuXG5TZWUgdGhlIEFwYWNoZSBWZXJzaW9uIDIuMCBMaWNlbnNlIGZvciBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnNcbmFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogaHR0cHM6Ly9tdGhzLmJlL3B1bnljb2RlIHYxLjQuMSBieSBAbWF0aGlhcyAqL1xuZnVuY3Rpb24gYmEoYSwgYiwgYywgZCkgeyByZXR1cm4gbmV3IChjIHx8IChjID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChlLCBmKSB7IGZ1bmN0aW9uIGcoYSkgeyB0cnkge1xuICAgIGsoZC5uZXh0KGEpKTtcbn1cbmNhdGNoIChuKSB7XG4gICAgZihuKTtcbn0gfSBmdW5jdGlvbiBoKGEpIHsgdHJ5IHtcbiAgICBrKGRbXCJ0aHJvd1wiXShhKSk7XG59XG5jYXRjaCAobikge1xuICAgIGYobik7XG59IH0gZnVuY3Rpb24gayhhKSB7IGEuZG9uZSA/IGUoYS52YWx1ZSkgOiAobmV3IGMoZnVuY3Rpb24gKGIpIHsgYihhLnZhbHVlKTsgfSkpLnRoZW4oZywgaCk7IH0gaygoZCA9IGQuYXBwbHkoYSwgYiB8fCBbXSkpLm5leHQoKSk7IH0pOyB9XG5mdW5jdGlvbiBjYShhLCBiKSB7XG4gICAgZnVuY3Rpb24gYyhhKSB7IHJldHVybiBmdW5jdGlvbiAoYikgeyByZXR1cm4gZChbYSwgYl0pOyB9OyB9XG4gICAgZnVuY3Rpb24gZChjKSB7XG4gICAgICAgIGlmIChmKVxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XG4gICAgICAgIGZvciAoOyBlOylcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgaWYgKGYgPSAxLCBnICYmIChoID0gY1swXSAmIDIgPyBnW1wicmV0dXJuXCJdIDogY1swXSA/IGdbXCJ0aHJvd1wiXSB8fCAoKGggPSBnW1wicmV0dXJuXCJdKSAmJiBoLmNhbGwoZyksIDApIDogZy5uZXh0KSAmJiAhKGggPSBoLmNhbGwoZywgY1sxXSkpLmRvbmUpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBoO1xuICAgICAgICAgICAgICAgIGlmIChnID0gMCwgaClcbiAgICAgICAgICAgICAgICAgICAgYyA9IFtjWzBdICYgMiwgaC52YWx1ZV07XG4gICAgICAgICAgICAgICAgc3dpdGNoIChjWzBdKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGM7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OiByZXR1cm4gZS5sYWJlbCsrLCB7IHZhbHVlOiBjWzFdLCBkb25lOiAhMSB9O1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICAgICAgICAgICAgICBlLmxhYmVsKys7XG4gICAgICAgICAgICAgICAgICAgICAgICBnID0gY1sxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA3OlxuICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGUub3BzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZS50cnlzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShoID0gZS50cnlzLCBoID0gMCA8IGgubGVuZ3RoICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaFtoLmxlbmd0aCAtIDFdKSAmJiAoNiA9PT0gY1swXSB8fCAyID09PSBjWzBdKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDMgPT09IGNbMF0gJiYgKCFoIHx8IGNbMV0gPiBoWzBdICYmIGNbMV0gPCBoWzNdKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLmxhYmVsID0gY1sxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKDYgPT09IGNbMF0gJiYgZS5sYWJlbCA8IGhbMV0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5sYWJlbCA9IGhbMV0sIGggPSBjO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoaCAmJiBlLmxhYmVsIDwgaFsyXSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLmxhYmVsID0gaFsyXSwgZS5vcHMucHVzaChjKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhbMl0gJiYgZS5vcHMucG9wKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZS50cnlzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjID0gYi5jYWxsKGEsIGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKG4pIHtcbiAgICAgICAgICAgICAgICBjID0gWzYsIG5dLCBnID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgICAgIGYgPSBoID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgaWYgKGNbMF0gJiA1KVxuICAgICAgICAgICAgdGhyb3cgY1sxXTtcbiAgICAgICAgcmV0dXJuIHsgdmFsdWU6IGNbMF0gPyBjWzFdIDogdm9pZCAwLCBkb25lOiAhMCB9O1xuICAgIH1cbiAgICB2YXIgZSA9IHsgbGFiZWw6IDAsIHNlbnQ6IGZ1bmN0aW9uICgpIHsgaWYgKGhbMF0gJiAxKVxuICAgICAgICAgICAgdGhyb3cgaFsxXTsgcmV0dXJuIGhbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIGcsIGgsIGs7XG4gICAgcmV0dXJuIGsgPSB7IG5leHQ6IGMoMCksIFwidGhyb3dcIjogYygxKSwgXCJyZXR1cm5cIjogYygyKSB9LCBcImZ1bmN0aW9uXCIgPT09XG4gICAgICAgIHR5cGVvZiBTeW1ib2wgJiYgKGtbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0pLCBrO1xufVxuZnVuY3Rpb24gZGEoYSkgeyB2YXIgYiA9IFwiZnVuY3Rpb25cIiA9PT0gdHlwZW9mIFN5bWJvbCAmJiBhW1N5bWJvbC5pdGVyYXRvcl0sIGMgPSAwOyByZXR1cm4gYiA/IGIuY2FsbChhKSA6IHsgbmV4dDogZnVuY3Rpb24gKCkgeyBhICYmIGMgPj0gYS5sZW5ndGggJiYgKGEgPSB2b2lkIDApOyByZXR1cm4geyB2YWx1ZTogYSAmJiBhW2MrK10sIGRvbmU6ICFhIH07IH0gfTsgfVxuZnVuY3Rpb24gZWEoYSwgYikgeyB2YXIgYyA9IFwiZnVuY3Rpb25cIiA9PT0gdHlwZW9mIFN5bWJvbCAmJiBhW1N5bWJvbC5pdGVyYXRvcl07IGlmICghYylcbiAgICByZXR1cm4gYTsgYSA9IGMuY2FsbChhKTsgdmFyIGQsIGUgPSBbXTsgdHJ5IHtcbiAgICBmb3IgKDsgKHZvaWQgMCA9PT0gYiB8fCAwIDwgYi0tKSAmJiAhKGQgPSBhLm5leHQoKSkuZG9uZTspXG4gICAgICAgIGUucHVzaChkLnZhbHVlKTtcbn1cbmNhdGNoIChnKSB7XG4gICAgdmFyIGYgPSB7IGVycm9yOiBnIH07XG59XG5maW5hbGx5IHtcbiAgICB0cnkge1xuICAgICAgICBkICYmICFkLmRvbmUgJiYgKGMgPSBhW1wicmV0dXJuXCJdKSAmJiBjLmNhbGwoYSk7XG4gICAgfVxuICAgIGZpbmFsbHkge1xuICAgICAgICBpZiAoZilcbiAgICAgICAgICAgIHRocm93IGYuZXJyb3I7XG4gICAgfVxufSByZXR1cm4gZTsgfVxuZnVuY3Rpb24gaWEoKSB7IGZvciAodmFyIGEgPSBbXSwgYiA9IDA7IGIgPCBhcmd1bWVudHMubGVuZ3RoOyBiKyspXG4gICAgYSA9IGEuY29uY2F0KGVhKGFyZ3VtZW50c1tiXSkpOyByZXR1cm4gYTsgfVxudmFyIGwgPSBcInVuZGVmaW5lZFwiICE9PSB0eXBlb2YgZ2xvYmFsVGhpcyA/IGdsb2JhbFRoaXMgOiBcInVuZGVmaW5lZFwiICE9PSB0eXBlb2Ygd2luZG93ID8gd2luZG93IDogXCJ1bmRlZmluZWRcIiAhPT0gdHlwZW9mIGdsb2JhbCA/IGdsb2JhbCA6IFwidW5kZWZpbmVkXCIgIT09IHR5cGVvZiBzZWxmID8gc2VsZiA6IHt9O1xuZnVuY3Rpb24gdChhKSB7IHJldHVybiBhICYmIGEuX19lc01vZHVsZSAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYSwgXCJkZWZhdWx0XCIpID8gYVtcImRlZmF1bHRcIl0gOiBhOyB9XG5mdW5jdGlvbiB1KGEsIGIpIHsgcmV0dXJuIGIgPSB7IGV4cG9ydHM6IHt9IH0sIGEoYiwgYi5leHBvcnRzKSwgYi5leHBvcnRzOyB9XG52YXIgdyA9IHUoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoYiwgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6ICEwIH0pO1xuICAgIGIuY29uc3RhbnRzID0geyBPX1JET05MWTogMCwgT19XUk9OTFk6IDEsIE9fUkRXUjogMiwgU19JRk1UOiA2MTQ0MCwgU19JRlJFRzogMzI3NjgsIFNfSUZESVI6IDE2Mzg0LCBTX0lGQ0hSOiA4MTkyLCBTX0lGQkxLOiAyNDU3NiwgU19JRklGTzogNDA5NiwgU19JRkxOSzogNDA5NjAsIFNfSUZTT0NLOiA0OTE1MiwgT19DUkVBVDogNjQsIE9fRVhDTDogMTI4LCBPX05PQ1RUWTogMjU2LCBPX1RSVU5DOiA1MTIsIE9fQVBQRU5EOiAxMDI0LCBPX0RJUkVDVE9SWTogNjU1MzYsIE9fTk9BVElNRTogMjYyMTQ0LCBPX05PRk9MTE9XOiAxMzEwNzIsIE9fU1lOQzogMTA1MjY3MiwgT19ESVJFQ1Q6IDE2Mzg0LCBPX05PTkJMT0NLOiAyMDQ4LCBTX0lSV1hVOiA0NDgsIFNfSVJVU1I6IDI1NiwgU19JV1VTUjogMTI4LCBTX0lYVVNSOiA2NCwgU19JUldYRzogNTYsIFNfSVJHUlA6IDMyLCBTX0lXR1JQOiAxNiwgU19JWEdSUDogOCwgU19JUldYTzogNywgU19JUk9USDogNCwgU19JV09USDogMixcbiAgICAgICAgU19JWE9USDogMSwgRl9PSzogMCwgUl9PSzogNCwgV19PSzogMiwgWF9PSzogMSwgVVZfRlNfU1lNTElOS19ESVI6IDEsIFVWX0ZTX1NZTUxJTktfSlVOQ1RJT046IDIsIFVWX0ZTX0NPUFlGSUxFX0VYQ0w6IDEsIFVWX0ZTX0NPUFlGSUxFX0ZJQ0xPTkU6IDIsIFVWX0ZTX0NPUFlGSUxFX0ZJQ0xPTkVfRk9SQ0U6IDQsIENPUFlGSUxFX0VYQ0w6IDEsIENPUFlGSUxFX0ZJQ0xPTkU6IDIsIENPUFlGSUxFX0ZJQ0xPTkVfRk9SQ0U6IDQgfTtcbn0pO1xudCh3KTtcbnZhciBqYSA9IHUoZnVuY3Rpb24gKGEsIGIpIHsgYi5kZWZhdWx0ID0gXCJmdW5jdGlvblwiID09PSB0eXBlb2YgQmlnSW50ID8gQmlnSW50IDogZnVuY3Rpb24gKCkgeyB0aHJvdyBFcnJvcihcIkJpZ0ludCBpcyBub3Qgc3VwcG9ydGVkIGluIHRoaXMgZW52aXJvbm1lbnQuXCIpOyB9OyB9KSwga2EgPSB1KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGIsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiAhMCB9KTtcbiAgICB2YXIgYyA9IHcuY29uc3RhbnRzLlNfSUZNVCwgZCA9IHcuY29uc3RhbnRzLlNfSUZESVIsIGUgPSB3LmNvbnN0YW50cy5TX0lGUkVHLCBmID0gdy5jb25zdGFudHMuU19JRkJMSywgZyA9IHcuY29uc3RhbnRzLlNfSUZDSFIsIGggPSB3LmNvbnN0YW50cy5TX0lGTE5LLCBrID0gdy5jb25zdGFudHMuU19JRklGTywgcCA9IHcuY29uc3RhbnRzLlNfSUZTT0NLO1xuICAgIGEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZ1bmN0aW9uIGEoKSB7IH1cbiAgICAgICAgYS5idWlsZCA9IGZ1bmN0aW9uIChiLCBjKSB7XG4gICAgICAgICAgICB2b2lkIDAgPT09IGMgJiYgKGMgPSAhMSk7XG4gICAgICAgICAgICB2YXIgZCA9IG5ldyBhLCBlID0gYi5naWQsIGYgPSBiLmF0aW1lLCBnID0gYi5tdGltZSwgaCA9IGIuY3RpbWU7XG4gICAgICAgICAgICBjID0gYyA/IGphLmRlZmF1bHQgOiBmdW5jdGlvbiAoYSkgeyByZXR1cm4gYTsgfTtcbiAgICAgICAgICAgIGQudWlkID0gYyhiLnVpZCk7XG4gICAgICAgICAgICBkLmdpZCA9IGMoZSk7XG4gICAgICAgICAgICBkLnJkZXYgPSBjKDApO1xuICAgICAgICAgICAgZC5ibGtzaXplID0gYyg0MDk2KTtcbiAgICAgICAgICAgIGQuaW5vID0gYyhiLmlubyk7XG4gICAgICAgICAgICBkLnNpemUgPSBjKGIuZ2V0U2l6ZSgpKTtcbiAgICAgICAgICAgIGQuYmxvY2tzID0gYygxKTtcbiAgICAgICAgICAgIGQuYXRpbWUgPSBmO1xuICAgICAgICAgICAgZC5tdGltZSA9IGc7XG4gICAgICAgICAgICBkLmN0aW1lID0gaDtcbiAgICAgICAgICAgIGQuYmlydGh0aW1lID0gaDtcbiAgICAgICAgICAgIGQuYXRpbWVNcyA9IGMoZi5nZXRUaW1lKCkpO1xuICAgICAgICAgICAgZC5tdGltZU1zID0gYyhnLmdldFRpbWUoKSk7XG4gICAgICAgICAgICBlID0gYyhoLmdldFRpbWUoKSk7XG4gICAgICAgICAgICBkLmN0aW1lTXMgPSBlO1xuICAgICAgICAgICAgZC5iaXJ0aHRpbWVNcyA9IGU7XG4gICAgICAgICAgICBkLmRldiA9IGMoMCk7XG4gICAgICAgICAgICBkLm1vZGUgPSBjKGIubW9kZSk7XG4gICAgICAgICAgICBkLm5saW5rID0gYyhiLm5saW5rKTtcbiAgICAgICAgICAgIHJldHVybiBkO1xuICAgICAgICB9O1xuICAgICAgICBhLnByb3RvdHlwZS5fY2hlY2tNb2RlUHJvcGVydHkgPSBmdW5jdGlvbiAoYSkgeyByZXR1cm4gKE51bWJlcih0aGlzLm1vZGUpICYgYykgPT09IGE7IH07XG4gICAgICAgIGEucHJvdG90eXBlLmlzRGlyZWN0b3J5ID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fY2hlY2tNb2RlUHJvcGVydHkoZCk7IH07XG4gICAgICAgIGEucHJvdG90eXBlLmlzRmlsZSA9XG4gICAgICAgICAgICBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9jaGVja01vZGVQcm9wZXJ0eShlKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUuaXNCbG9ja0RldmljZSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX2NoZWNrTW9kZVByb3BlcnR5KGYpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5pc0NoYXJhY3RlckRldmljZSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX2NoZWNrTW9kZVByb3BlcnR5KGcpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5pc1N5bWJvbGljTGluayA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX2NoZWNrTW9kZVByb3BlcnR5KGgpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5pc0ZJRk8gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9jaGVja01vZGVQcm9wZXJ0eShrKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUuaXNTb2NrZXQgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9jaGVja01vZGVQcm9wZXJ0eShwKTsgfTtcbiAgICAgICAgcmV0dXJuIGE7XG4gICAgfSgpO1xuICAgIGIuU3RhdHMgPSBhO1xuICAgIGIuZGVmYXVsdCA9IGE7XG59KTtcbnQoa2EpO1xudmFyIGxhID0gXCJ1bmRlZmluZWRcIiAhPT0gdHlwZW9mIGdsb2JhbCA/IGdsb2JhbCA6IFwidW5kZWZpbmVkXCIgIT09IHR5cGVvZiBzZWxmID8gc2VsZiA6IFwidW5kZWZpbmVkXCIgIT09IHR5cGVvZiB3aW5kb3cgPyB3aW5kb3cgOiB7fSwgeCA9IFtdLCB5ID0gW10sIG1hID0gXCJ1bmRlZmluZWRcIiAhPT0gdHlwZW9mIFVpbnQ4QXJyYXkgPyBVaW50OEFycmF5IDogQXJyYXksIG9hID0gITE7XG5mdW5jdGlvbiBwYSgpIHsgb2EgPSAhMDsgZm9yICh2YXIgYSA9IDA7IDY0ID4gYTsgKythKVxuICAgIHhbYV0gPSBcIkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky9cIlthXSwgeVtcIkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky9cIi5jaGFyQ29kZUF0KGEpXSA9IGE7IHlbNDVdID0gNjI7IHlbOTVdID0gNjM7IH1cbmZ1bmN0aW9uIHFhKGEsIGIsIGMpIHsgZm9yICh2YXIgZCA9IFtdLCBlID0gYjsgZSA8IGM7IGUgKz0gMylcbiAgICBiID0gKGFbZV0gPDwgMTYpICsgKGFbZSArIDFdIDw8IDgpICsgYVtlICsgMl0sIGQucHVzaCh4W2IgPj4gMTggJiA2M10gKyB4W2IgPj4gMTIgJiA2M10gKyB4W2IgPj4gNiAmIDYzXSArIHhbYiAmIDYzXSk7IHJldHVybiBkLmpvaW4oXCJcIik7IH1cbmZ1bmN0aW9uIHJhKGEpIHsgb2EgfHwgcGEoKTsgZm9yICh2YXIgYiA9IGEubGVuZ3RoLCBjID0gYiAlIDMsIGQgPSBcIlwiLCBlID0gW10sIGYgPSAwLCBnID0gYiAtIGM7IGYgPCBnOyBmICs9IDE2MzgzKVxuICAgIGUucHVzaChxYShhLCBmLCBmICsgMTYzODMgPiBnID8gZyA6IGYgKyAxNjM4MykpOyAxID09PSBjID8gKGEgPSBhW2IgLSAxXSwgZCArPSB4W2EgPj4gMl0sIGQgKz0geFthIDw8IDQgJiA2M10sIGQgKz0gXCI9PVwiKSA6IDIgPT09IGMgJiYgKGEgPSAoYVtiIC0gMl0gPDwgOCkgKyBhW2IgLSAxXSwgZCArPSB4W2EgPj4gMTBdLCBkICs9IHhbYSA+PiA0ICYgNjNdLCBkICs9IHhbYSA8PCAyICYgNjNdLCBkICs9IFwiPVwiKTsgZS5wdXNoKGQpOyByZXR1cm4gZS5qb2luKFwiXCIpOyB9XG5mdW5jdGlvbiBzYShhLCBiLCBjLCBkLCBlKSB7IHZhciBmID0gOCAqIGUgLSBkIC0gMTsgdmFyIGcgPSAoMSA8PCBmKSAtIDEsIGggPSBnID4+IDEsIGsgPSAtNzsgZSA9IGMgPyBlIC0gMSA6IDA7IHZhciBwID0gYyA/IC0xIDogMSwgbiA9IGFbYiArIGVdOyBlICs9IHA7IGMgPSBuICYgKDEgPDwgLWspIC0gMTsgbiA+Pj0gLWs7IGZvciAoayArPSBmOyAwIDwgazsgYyA9IDI1NiAqIGMgKyBhW2IgKyBlXSwgZSArPSBwLCBrIC09IDgpXG4gICAgOyBmID0gYyAmICgxIDw8IC1rKSAtIDE7IGMgPj49IC1rOyBmb3IgKGsgKz0gZDsgMCA8IGs7IGYgPSAyNTYgKiBmICsgYVtiICsgZV0sIGUgKz0gcCwgayAtPSA4KVxuICAgIDsgaWYgKDAgPT09IGMpXG4gICAgYyA9IDEgLSBoO1xuZWxzZSB7XG4gICAgaWYgKGMgPT09IGcpXG4gICAgICAgIHJldHVybiBmID8gTmFOIDogSW5maW5pdHkgKiAobiA/IC0xIDogMSk7XG4gICAgZiArPSBNYXRoLnBvdygyLCBkKTtcbiAgICBjIC09IGg7XG59IHJldHVybiAobiA/IC0xIDogMSkgKiBmICogTWF0aC5wb3coMiwgYyAtIGQpOyB9XG5mdW5jdGlvbiB0YShhLCBiLCBjLCBkLCBlLCBmKSB7XG4gICAgdmFyIGcsIGggPSA4ICogZiAtIGUgLSAxLCBrID0gKDEgPDwgaCkgLSAxLCBwID0gayA+PiAxLCBuID0gMjMgPT09IGUgPyBNYXRoLnBvdygyLCAtMjQpIC0gTWF0aC5wb3coMiwgLTc3KSA6IDA7XG4gICAgZiA9IGQgPyAwIDogZiAtIDE7XG4gICAgdmFyIHEgPSBkID8gMSA6IC0xLCBCID0gMCA+IGIgfHwgMCA9PT0gYiAmJiAwID4gMSAvIGIgPyAxIDogMDtcbiAgICBiID0gTWF0aC5hYnMoYik7XG4gICAgaXNOYU4oYikgfHwgSW5maW5pdHkgPT09IGIgPyAoYiA9IGlzTmFOKGIpID8gMSA6IDAsIGQgPSBrKSA6IChkID0gTWF0aC5mbG9vcihNYXRoLmxvZyhiKSAvIE1hdGguTE4yKSwgMSA+IGIgKiAoZyA9IE1hdGgucG93KDIsIC1kKSkgJiYgKGQtLSwgZyAqPSAyKSwgYiA9IDEgPD0gZCArIHAgPyBiICsgbiAvIGcgOiBiICsgbiAqIE1hdGgucG93KDIsIDEgLSBwKSwgMiA8PSBiICogZyAmJiAoZCsrLCBnIC89IDIpLCBkICsgcCA+PSBrID8gKGIgPSAwLCBkID0gaykgOiAxIDw9IGQgKyBwID8gKGIgPSAoYiAqIGcgLSAxKSAqIE1hdGgucG93KDIsIGUpLCBkICs9IHApIDogKGIgPSBiICogTWF0aC5wb3coMiwgcCAtIDEpICogTWF0aC5wb3coMiwgZSksIGQgPSAwKSk7XG4gICAgZm9yICg7IDggPD0gZTsgYVtjICsgZl0gPSBiICYgMjU1LCBmICs9IHEsIGIgLz0gMjU2LCBlIC09IDgpXG4gICAgICAgIDtcbiAgICBkID0gZCA8PCBlIHwgYjtcbiAgICBmb3IgKGggKz0gZTsgMCA8IGg7IGFbYyArIGZdID0gZCAmIDI1NSxcbiAgICAgICAgZiArPSBxLCBkIC89IDI1NiwgaCAtPSA4KVxuICAgICAgICA7XG4gICAgYVtjICsgZiAtIHFdIHw9IDEyOCAqIEI7XG59XG52YXIgd2EgPSB7fS50b1N0cmluZywgeWEgPSBBcnJheS5pc0FycmF5IHx8IGZ1bmN0aW9uIChhKSB7IHJldHVybiBcIltvYmplY3QgQXJyYXldXCIgPT0gd2EuY2FsbChhKTsgfTtcbnouVFlQRURfQVJSQVlfU1VQUE9SVCA9IHZvaWQgMCAhPT0gbGEuVFlQRURfQVJSQVlfU1VQUE9SVCA/IGxhLlRZUEVEX0FSUkFZX1NVUFBPUlQgOiAhMDtcbnZhciB6YSA9IHouVFlQRURfQVJSQVlfU1VQUE9SVCA/IDIxNDc0ODM2NDcgOiAxMDczNzQxODIzO1xuZnVuY3Rpb24gQWEoYSwgYikgeyBpZiAoKHouVFlQRURfQVJSQVlfU1VQUE9SVCA/IDIxNDc0ODM2NDcgOiAxMDczNzQxODIzKSA8IGIpXG4gICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJJbnZhbGlkIHR5cGVkIGFycmF5IGxlbmd0aFwiKTsgei5UWVBFRF9BUlJBWV9TVVBQT1JUID8gKGEgPSBuZXcgVWludDhBcnJheShiKSwgYS5fX3Byb3RvX18gPSB6LnByb3RvdHlwZSkgOiAobnVsbCA9PT0gYSAmJiAoYSA9IG5ldyB6KGIpKSwgYS5sZW5ndGggPSBiKTsgcmV0dXJuIGE7IH1cbmZ1bmN0aW9uIHooYSwgYiwgYykgeyBpZiAoISh6LlRZUEVEX0FSUkFZX1NVUFBPUlQgfHwgdGhpcyBpbnN0YW5jZW9mIHopKVxuICAgIHJldHVybiBuZXcgeihhLCBiLCBjKTsgaWYgKFwibnVtYmVyXCIgPT09IHR5cGVvZiBhKSB7XG4gICAgaWYgKFwic3RyaW5nXCIgPT09IHR5cGVvZiBiKVxuICAgICAgICB0aHJvdyBFcnJvcihcIklmIGVuY29kaW5nIGlzIHNwZWNpZmllZCB0aGVuIHRoZSBmaXJzdCBhcmd1bWVudCBtdXN0IGJlIGEgc3RyaW5nXCIpO1xuICAgIHJldHVybiBCYSh0aGlzLCBhKTtcbn0gcmV0dXJuIENhKHRoaXMsIGEsIGIsIGMpOyB9XG56LnBvb2xTaXplID0gODE5MjtcbnouX2F1Z21lbnQgPSBmdW5jdGlvbiAoYSkgeyBhLl9fcHJvdG9fXyA9IHoucHJvdG90eXBlOyByZXR1cm4gYTsgfTtcbmZ1bmN0aW9uIENhKGEsIGIsIGMsIGQpIHtcbiAgICBpZiAoXCJudW1iZXJcIiA9PT0gdHlwZW9mIGIpXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1widmFsdWVcIiBhcmd1bWVudCBtdXN0IG5vdCBiZSBhIG51bWJlcicpO1xuICAgIGlmIChcInVuZGVmaW5lZFwiICE9PSB0eXBlb2YgQXJyYXlCdWZmZXIgJiYgYiBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSB7XG4gICAgICAgIGIuYnl0ZUxlbmd0aDtcbiAgICAgICAgaWYgKDAgPiBjIHx8IGIuYnl0ZUxlbmd0aCA8IGMpXG4gICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIidvZmZzZXQnIGlzIG91dCBvZiBib3VuZHNcIik7XG4gICAgICAgIGlmIChiLmJ5dGVMZW5ndGggPCBjICsgKGQgfHwgMCkpXG4gICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIidsZW5ndGgnIGlzIG91dCBvZiBib3VuZHNcIik7XG4gICAgICAgIGIgPSB2b2lkIDAgPT09IGMgJiYgdm9pZCAwID09PSBkID8gbmV3IFVpbnQ4QXJyYXkoYikgOiB2b2lkIDAgPT09IGQgPyBuZXcgVWludDhBcnJheShiLCBjKSA6IG5ldyBVaW50OEFycmF5KGIsIGMsIGQpO1xuICAgICAgICB6LlRZUEVEX0FSUkFZX1NVUFBPUlQgPyAoYSA9IGIsIGEuX19wcm90b19fID0gei5wcm90b3R5cGUpIDogYSA9IERhKGEsIGIpO1xuICAgICAgICByZXR1cm4gYTtcbiAgICB9XG4gICAgaWYgKFwic3RyaW5nXCIgPT09XG4gICAgICAgIHR5cGVvZiBiKSB7XG4gICAgICAgIGQgPSBhO1xuICAgICAgICBhID0gYztcbiAgICAgICAgaWYgKFwic3RyaW5nXCIgIT09IHR5cGVvZiBhIHx8IFwiXCIgPT09IGEpXG4gICAgICAgICAgICBhID0gXCJ1dGY4XCI7XG4gICAgICAgIGlmICghei5pc0VuY29kaW5nKGEpKVxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignXCJlbmNvZGluZ1wiIG11c3QgYmUgYSB2YWxpZCBzdHJpbmcgZW5jb2RpbmcnKTtcbiAgICAgICAgYyA9IEVhKGIsIGEpIHwgMDtcbiAgICAgICAgZCA9IEFhKGQsIGMpO1xuICAgICAgICBiID0gZC53cml0ZShiLCBhKTtcbiAgICAgICAgYiAhPT0gYyAmJiAoZCA9IGQuc2xpY2UoMCwgYikpO1xuICAgICAgICByZXR1cm4gZDtcbiAgICB9XG4gICAgcmV0dXJuIEZhKGEsIGIpO1xufVxuei5mcm9tID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsgcmV0dXJuIENhKG51bGwsIGEsIGIsIGMpOyB9O1xuei5UWVBFRF9BUlJBWV9TVVBQT1JUICYmICh6LnByb3RvdHlwZS5fX3Byb3RvX18gPSBVaW50OEFycmF5LnByb3RvdHlwZSwgei5fX3Byb3RvX18gPSBVaW50OEFycmF5KTtcbmZ1bmN0aW9uIEdhKGEpIHsgaWYgKFwibnVtYmVyXCIgIT09IHR5cGVvZiBhKVxuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1wic2l6ZVwiIGFyZ3VtZW50IG11c3QgYmUgYSBudW1iZXInKTsgaWYgKDAgPiBhKVxuICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdcInNpemVcIiBhcmd1bWVudCBtdXN0IG5vdCBiZSBuZWdhdGl2ZScpOyB9XG56LmFsbG9jID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsgR2EoYSk7IGEgPSAwID49IGEgPyBBYShudWxsLCBhKSA6IHZvaWQgMCAhPT0gYiA/IFwic3RyaW5nXCIgPT09IHR5cGVvZiBjID8gQWEobnVsbCwgYSkuZmlsbChiLCBjKSA6IEFhKG51bGwsIGEpLmZpbGwoYikgOiBBYShudWxsLCBhKTsgcmV0dXJuIGE7IH07XG5mdW5jdGlvbiBCYShhLCBiKSB7IEdhKGIpOyBhID0gQWEoYSwgMCA+IGIgPyAwIDogTWEoYikgfCAwKTsgaWYgKCF6LlRZUEVEX0FSUkFZX1NVUFBPUlQpXG4gICAgZm9yICh2YXIgYyA9IDA7IGMgPCBiOyArK2MpXG4gICAgICAgIGFbY10gPSAwOyByZXR1cm4gYTsgfVxuei5hbGxvY1Vuc2FmZSA9IGZ1bmN0aW9uIChhKSB7IHJldHVybiBCYShudWxsLCBhKTsgfTtcbnouYWxsb2NVbnNhZmVTbG93ID0gZnVuY3Rpb24gKGEpIHsgcmV0dXJuIEJhKG51bGwsIGEpOyB9O1xuZnVuY3Rpb24gRGEoYSwgYikgeyB2YXIgYyA9IDAgPiBiLmxlbmd0aCA/IDAgOiBNYShiLmxlbmd0aCkgfCAwOyBhID0gQWEoYSwgYyk7IGZvciAodmFyIGQgPSAwOyBkIDwgYzsgZCArPSAxKVxuICAgIGFbZF0gPSBiW2RdICYgMjU1OyByZXR1cm4gYTsgfVxuZnVuY3Rpb24gRmEoYSwgYikgeyBpZiAoQShiKSkge1xuICAgIHZhciBjID0gTWEoYi5sZW5ndGgpIHwgMDtcbiAgICBhID0gQWEoYSwgYyk7XG4gICAgaWYgKDAgPT09IGEubGVuZ3RoKVxuICAgICAgICByZXR1cm4gYTtcbiAgICBiLmNvcHkoYSwgMCwgMCwgYyk7XG4gICAgcmV0dXJuIGE7XG59IGlmIChiKSB7XG4gICAgaWYgKFwidW5kZWZpbmVkXCIgIT09IHR5cGVvZiBBcnJheUJ1ZmZlciAmJiBiLmJ1ZmZlciBpbnN0YW5jZW9mIEFycmF5QnVmZmVyIHx8IFwibGVuZ3RoXCIgaW4gYilcbiAgICAgICAgcmV0dXJuIChjID0gXCJudW1iZXJcIiAhPT0gdHlwZW9mIGIubGVuZ3RoKSB8fCAoYyA9IGIubGVuZ3RoLCBjID0gYyAhPT0gYyksIGMgPyBBYShhLCAwKSA6IERhKGEsIGIpO1xuICAgIGlmIChcIkJ1ZmZlclwiID09PSBiLnR5cGUgJiYgeWEoYi5kYXRhKSlcbiAgICAgICAgcmV0dXJuIERhKGEsIGIuZGF0YSk7XG59IHRocm93IG5ldyBUeXBlRXJyb3IoXCJGaXJzdCBhcmd1bWVudCBtdXN0IGJlIGEgc3RyaW5nLCBCdWZmZXIsIEFycmF5QnVmZmVyLCBBcnJheSwgb3IgYXJyYXktbGlrZSBvYmplY3QuXCIpOyB9XG5mdW5jdGlvbiBNYShhKSB7IGlmIChhID49ICh6LlRZUEVEX0FSUkFZX1NVUFBPUlQgPyAyMTQ3NDgzNjQ3IDogMTA3Mzc0MTgyMykpXG4gICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJBdHRlbXB0IHRvIGFsbG9jYXRlIEJ1ZmZlciBsYXJnZXIgdGhhbiBtYXhpbXVtIHNpemU6IDB4XCIgKyAoei5UWVBFRF9BUlJBWV9TVVBQT1JUID8gMjE0NzQ4MzY0NyA6IDEwNzM3NDE4MjMpLnRvU3RyaW5nKDE2KSArIFwiIGJ5dGVzXCIpOyByZXR1cm4gYSB8IDA7IH1cbnouaXNCdWZmZXIgPSBOYTtcbmZ1bmN0aW9uIEEoYSkgeyByZXR1cm4gIShudWxsID09IGEgfHwgIWEuX2lzQnVmZmVyKTsgfVxuei5jb21wYXJlID0gZnVuY3Rpb24gKGEsIGIpIHsgaWYgKCFBKGEpIHx8ICFBKGIpKVxuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJBcmd1bWVudHMgbXVzdCBiZSBCdWZmZXJzXCIpOyBpZiAoYSA9PT0gYilcbiAgICByZXR1cm4gMDsgZm9yICh2YXIgYyA9IGEubGVuZ3RoLCBkID0gYi5sZW5ndGgsIGUgPSAwLCBmID0gTWF0aC5taW4oYywgZCk7IGUgPCBmOyArK2UpXG4gICAgaWYgKGFbZV0gIT09IGJbZV0pIHtcbiAgICAgICAgYyA9IGFbZV07XG4gICAgICAgIGQgPSBiW2VdO1xuICAgICAgICBicmVhaztcbiAgICB9IHJldHVybiBjIDwgZCA/IC0xIDogZCA8IGMgPyAxIDogMDsgfTtcbnouaXNFbmNvZGluZyA9IGZ1bmN0aW9uIChhKSB7IHN3aXRjaCAoU3RyaW5nKGEpLnRvTG93ZXJDYXNlKCkpIHtcbiAgICBjYXNlIFwiaGV4XCI6XG4gICAgY2FzZSBcInV0ZjhcIjpcbiAgICBjYXNlIFwidXRmLThcIjpcbiAgICBjYXNlIFwiYXNjaWlcIjpcbiAgICBjYXNlIFwibGF0aW4xXCI6XG4gICAgY2FzZSBcImJpbmFyeVwiOlxuICAgIGNhc2UgXCJiYXNlNjRcIjpcbiAgICBjYXNlIFwidWNzMlwiOlxuICAgIGNhc2UgXCJ1Y3MtMlwiOlxuICAgIGNhc2UgXCJ1dGYxNmxlXCI6XG4gICAgY2FzZSBcInV0Zi0xNmxlXCI6IHJldHVybiAhMDtcbiAgICBkZWZhdWx0OiByZXR1cm4gITE7XG59IH07XG56LmNvbmNhdCA9IGZ1bmN0aW9uIChhLCBiKSB7IGlmICgheWEoYSkpXG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcignXCJsaXN0XCIgYXJndW1lbnQgbXVzdCBiZSBhbiBBcnJheSBvZiBCdWZmZXJzJyk7IGlmICgwID09PSBhLmxlbmd0aClcbiAgICByZXR1cm4gei5hbGxvYygwKTsgdmFyIGM7IGlmICh2b2lkIDAgPT09IGIpXG4gICAgZm9yIChjID0gYiA9IDA7IGMgPCBhLmxlbmd0aDsgKytjKVxuICAgICAgICBiICs9IGFbY10ubGVuZ3RoOyBiID0gei5hbGxvY1Vuc2FmZShiKTsgdmFyIGQgPSAwOyBmb3IgKGMgPSAwOyBjIDwgYS5sZW5ndGg7ICsrYykge1xuICAgIHZhciBlID0gYVtjXTtcbiAgICBpZiAoIUEoZSkpXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1wibGlzdFwiIGFyZ3VtZW50IG11c3QgYmUgYW4gQXJyYXkgb2YgQnVmZmVycycpO1xuICAgIGUuY29weShiLCBkKTtcbiAgICBkICs9IGUubGVuZ3RoO1xufSByZXR1cm4gYjsgfTtcbmZ1bmN0aW9uIEVhKGEsIGIpIHtcbiAgICBpZiAoQShhKSlcbiAgICAgICAgcmV0dXJuIGEubGVuZ3RoO1xuICAgIGlmIChcInVuZGVmaW5lZFwiICE9PSB0eXBlb2YgQXJyYXlCdWZmZXIgJiYgXCJmdW5jdGlvblwiID09PSB0eXBlb2YgQXJyYXlCdWZmZXIuaXNWaWV3ICYmIChBcnJheUJ1ZmZlci5pc1ZpZXcoYSkgfHwgYSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSlcbiAgICAgICAgcmV0dXJuIGEuYnl0ZUxlbmd0aDtcbiAgICBcInN0cmluZ1wiICE9PSB0eXBlb2YgYSAmJiAoYSA9IFwiXCIgKyBhKTtcbiAgICB2YXIgYyA9IGEubGVuZ3RoO1xuICAgIGlmICgwID09PSBjKVxuICAgICAgICByZXR1cm4gMDtcbiAgICBmb3IgKHZhciBkID0gITE7OylcbiAgICAgICAgc3dpdGNoIChiKSB7XG4gICAgICAgICAgICBjYXNlIFwiYXNjaWlcIjpcbiAgICAgICAgICAgIGNhc2UgXCJsYXRpbjFcIjpcbiAgICAgICAgICAgIGNhc2UgXCJiaW5hcnlcIjogcmV0dXJuIGM7XG4gICAgICAgICAgICBjYXNlIFwidXRmOFwiOlxuICAgICAgICAgICAgY2FzZSBcInV0Zi04XCI6XG4gICAgICAgICAgICBjYXNlIHZvaWQgMDogcmV0dXJuIE9hKGEpLmxlbmd0aDtcbiAgICAgICAgICAgIGNhc2UgXCJ1Y3MyXCI6XG4gICAgICAgICAgICBjYXNlIFwidWNzLTJcIjpcbiAgICAgICAgICAgIGNhc2UgXCJ1dGYxNmxlXCI6XG4gICAgICAgICAgICBjYXNlIFwidXRmLTE2bGVcIjogcmV0dXJuIDIgKiBjO1xuICAgICAgICAgICAgY2FzZSBcImhleFwiOiByZXR1cm4gYyA+Pj4gMTtcbiAgICAgICAgICAgIGNhc2UgXCJiYXNlNjRcIjogcmV0dXJuIFBhKGEpLmxlbmd0aDtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgaWYgKGQpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBPYShhKS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgYiA9IChcIlwiICsgYikudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICBkID0gITA7XG4gICAgICAgIH1cbn1cbnouYnl0ZUxlbmd0aCA9IEVhO1xuZnVuY3Rpb24gUWEoYSwgYiwgYykge1xuICAgIHZhciBkID0gITE7XG4gICAgaWYgKHZvaWQgMCA9PT0gYiB8fCAwID4gYilcbiAgICAgICAgYiA9IDA7XG4gICAgaWYgKGIgPiB0aGlzLmxlbmd0aClcbiAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgaWYgKHZvaWQgMCA9PT0gYyB8fCBjID4gdGhpcy5sZW5ndGgpXG4gICAgICAgIGMgPSB0aGlzLmxlbmd0aDtcbiAgICBpZiAoMCA+PSBjKVxuICAgICAgICByZXR1cm4gXCJcIjtcbiAgICBjID4+Pj0gMDtcbiAgICBiID4+Pj0gMDtcbiAgICBpZiAoYyA8PSBiKVxuICAgICAgICByZXR1cm4gXCJcIjtcbiAgICBmb3IgKGEgfHwgKGEgPSBcInV0ZjhcIik7OylcbiAgICAgICAgc3dpdGNoIChhKSB7XG4gICAgICAgICAgICBjYXNlIFwiaGV4XCI6XG4gICAgICAgICAgICAgICAgYSA9IGI7XG4gICAgICAgICAgICAgICAgYiA9IGM7XG4gICAgICAgICAgICAgICAgYyA9IHRoaXMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIGlmICghYSB8fCAwID4gYSlcbiAgICAgICAgICAgICAgICAgICAgYSA9IDA7XG4gICAgICAgICAgICAgICAgaWYgKCFiIHx8IDAgPiBiIHx8IGIgPiBjKVxuICAgICAgICAgICAgICAgICAgICBiID0gYztcbiAgICAgICAgICAgICAgICBkID0gXCJcIjtcbiAgICAgICAgICAgICAgICBmb3IgKGMgPSBhOyBjIDwgYjsgKytjKVxuICAgICAgICAgICAgICAgICAgICBhID0gZCwgZCA9IHRoaXNbY10sIGQgPSAxNiA+IGQgPyBcIjBcIiArIGQudG9TdHJpbmcoMTYpIDogZC50b1N0cmluZygxNiksIGQgPSBhICsgZDtcbiAgICAgICAgICAgICAgICByZXR1cm4gZDtcbiAgICAgICAgICAgIGNhc2UgXCJ1dGY4XCI6XG4gICAgICAgICAgICBjYXNlIFwidXRmLThcIjogcmV0dXJuIFJhKHRoaXMsIGIsIGMpO1xuICAgICAgICAgICAgY2FzZSBcImFzY2lpXCI6XG4gICAgICAgICAgICAgICAgYSA9IFwiXCI7XG4gICAgICAgICAgICAgICAgZm9yIChjID0gTWF0aC5taW4odGhpcy5sZW5ndGgsIGMpOyBiIDwgYzsgKytiKVxuICAgICAgICAgICAgICAgICAgICBhICs9IFN0cmluZy5mcm9tQ2hhckNvZGUodGhpc1tiXSAmIDEyNyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGE7XG4gICAgICAgICAgICBjYXNlIFwibGF0aW4xXCI6XG4gICAgICAgICAgICBjYXNlIFwiYmluYXJ5XCI6XG4gICAgICAgICAgICAgICAgYSA9IFwiXCI7XG4gICAgICAgICAgICAgICAgZm9yIChjID0gTWF0aC5taW4odGhpcy5sZW5ndGgsIGMpOyBiIDwgYzsgKytiKVxuICAgICAgICAgICAgICAgICAgICBhICs9IFN0cmluZy5mcm9tQ2hhckNvZGUodGhpc1tiXSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGE7XG4gICAgICAgICAgICBjYXNlIFwiYmFzZTY0XCI6IHJldHVybiBiID0gMCA9PT0gYiAmJiBjID09PSB0aGlzLmxlbmd0aCA/IHJhKHRoaXMpIDogcmEodGhpcy5zbGljZShiLCBjKSksIGI7XG4gICAgICAgICAgICBjYXNlIFwidWNzMlwiOlxuICAgICAgICAgICAgY2FzZSBcInVjcy0yXCI6XG4gICAgICAgICAgICBjYXNlIFwidXRmMTZsZVwiOlxuICAgICAgICAgICAgY2FzZSBcInV0Zi0xNmxlXCI6XG4gICAgICAgICAgICAgICAgYiA9IHRoaXMuc2xpY2UoYiwgYyk7XG4gICAgICAgICAgICAgICAgYyA9IFwiXCI7XG4gICAgICAgICAgICAgICAgZm9yIChhID0gMDsgYSA8IGIubGVuZ3RoOyBhICs9IDIpXG4gICAgICAgICAgICAgICAgICAgIGMgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShiW2FdICsgMjU2ICogYlthICsgMV0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBjO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBpZiAoZClcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlVua25vd24gZW5jb2Rpbmc6IFwiICsgYSk7XG4gICAgICAgICAgICAgICAgYSA9IChhICsgXCJcIikudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICBkID0gITA7XG4gICAgICAgIH1cbn1cbnoucHJvdG90eXBlLl9pc0J1ZmZlciA9ICEwO1xuZnVuY3Rpb24gU2EoYSwgYiwgYykgeyB2YXIgZCA9IGFbYl07IGFbYl0gPSBhW2NdOyBhW2NdID0gZDsgfVxuei5wcm90b3R5cGUuc3dhcDE2ID0gZnVuY3Rpb24gKCkgeyB2YXIgYSA9IHRoaXMubGVuZ3RoOyBpZiAoMCAhPT0gYSAlIDIpXG4gICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJCdWZmZXIgc2l6ZSBtdXN0IGJlIGEgbXVsdGlwbGUgb2YgMTYtYml0c1wiKTsgZm9yICh2YXIgYiA9IDA7IGIgPCBhOyBiICs9IDIpXG4gICAgU2EodGhpcywgYiwgYiArIDEpOyByZXR1cm4gdGhpczsgfTtcbnoucHJvdG90eXBlLnN3YXAzMiA9IGZ1bmN0aW9uICgpIHsgdmFyIGEgPSB0aGlzLmxlbmd0aDsgaWYgKDAgIT09IGEgJSA0KVxuICAgIHRocm93IG5ldyBSYW5nZUVycm9yKFwiQnVmZmVyIHNpemUgbXVzdCBiZSBhIG11bHRpcGxlIG9mIDMyLWJpdHNcIik7IGZvciAodmFyIGIgPSAwOyBiIDwgYTsgYiArPSA0KVxuICAgIFNhKHRoaXMsIGIsIGIgKyAzKSwgU2EodGhpcywgYiArIDEsIGIgKyAyKTsgcmV0dXJuIHRoaXM7IH07XG56LnByb3RvdHlwZS5zd2FwNjQgPSBmdW5jdGlvbiAoKSB7IHZhciBhID0gdGhpcy5sZW5ndGg7IGlmICgwICE9PSBhICUgOClcbiAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIkJ1ZmZlciBzaXplIG11c3QgYmUgYSBtdWx0aXBsZSBvZiA2NC1iaXRzXCIpOyBmb3IgKHZhciBiID0gMDsgYiA8IGE7IGIgKz0gOClcbiAgICBTYSh0aGlzLCBiLCBiICsgNyksIFNhKHRoaXMsIGIgKyAxLCBiICsgNiksIFNhKHRoaXMsIGIgKyAyLCBiICsgNSksIFNhKHRoaXMsIGIgKyAzLCBiICsgNCk7IHJldHVybiB0aGlzOyB9O1xuei5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7IHZhciBhID0gdGhpcy5sZW5ndGggfCAwOyByZXR1cm4gMCA9PT0gYSA/IFwiXCIgOiAwID09PSBhcmd1bWVudHMubGVuZ3RoID8gUmEodGhpcywgMCwgYSkgOiBRYS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9O1xuei5wcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24gKGEpIHsgaWYgKCFBKGEpKVxuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJBcmd1bWVudCBtdXN0IGJlIGEgQnVmZmVyXCIpOyByZXR1cm4gdGhpcyA9PT0gYSA/ICEwIDogMCA9PT0gei5jb21wYXJlKHRoaXMsIGEpOyB9O1xuei5wcm90b3R5cGUuaW5zcGVjdCA9IGZ1bmN0aW9uICgpIHsgdmFyIGEgPSBcIlwiOyAwIDwgdGhpcy5sZW5ndGggJiYgKGEgPSB0aGlzLnRvU3RyaW5nKFwiaGV4XCIsIDAsIDUwKS5tYXRjaCgvLnsyfS9nKS5qb2luKFwiIFwiKSwgNTAgPCB0aGlzLmxlbmd0aCAmJiAoYSArPSBcIiAuLi4gXCIpKTsgcmV0dXJuIFwiPEJ1ZmZlciBcIiArIGEgKyBcIj5cIjsgfTtcbnoucHJvdG90eXBlLmNvbXBhcmUgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCwgZSkge1xuICAgIGlmICghQShhKSlcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkFyZ3VtZW50IG11c3QgYmUgYSBCdWZmZXJcIik7XG4gICAgdm9pZCAwID09PSBiICYmIChiID0gMCk7XG4gICAgdm9pZCAwID09PSBjICYmIChjID0gYSA/IGEubGVuZ3RoIDogMCk7XG4gICAgdm9pZCAwID09PSBkICYmIChkID0gMCk7XG4gICAgdm9pZCAwID09PSBlICYmIChlID0gdGhpcy5sZW5ndGgpO1xuICAgIGlmICgwID4gYiB8fCBjID4gYS5sZW5ndGggfHwgMCA+IGQgfHwgZSA+IHRoaXMubGVuZ3RoKVxuICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIm91dCBvZiByYW5nZSBpbmRleFwiKTtcbiAgICBpZiAoZCA+PSBlICYmIGIgPj0gYylcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgaWYgKGQgPj0gZSlcbiAgICAgICAgcmV0dXJuIC0xO1xuICAgIGlmIChiID49IGMpXG4gICAgICAgIHJldHVybiAxO1xuICAgIGIgPj4+PSAwO1xuICAgIGMgPj4+PSAwO1xuICAgIGQgPj4+PSAwO1xuICAgIGUgPj4+PSAwO1xuICAgIGlmICh0aGlzID09PSBhKVxuICAgICAgICByZXR1cm4gMDtcbiAgICB2YXIgZiA9IGUgLSBkLCBnID0gYyAtIGIsIGggPSBNYXRoLm1pbihmLCBnKTtcbiAgICBkID0gdGhpcy5zbGljZShkLCBlKTtcbiAgICBhID0gYS5zbGljZShiLCBjKTtcbiAgICBmb3IgKGIgPSAwOyBiIDwgaDsgKytiKVxuICAgICAgICBpZiAoZFtiXSAhPT0gYVtiXSkge1xuICAgICAgICAgICAgZiA9IGRbYl07XG4gICAgICAgICAgICBnID0gYVtiXTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgcmV0dXJuIGYgPFxuICAgICAgICBnID8gLTEgOiBnIDwgZiA/IDEgOiAwO1xufTtcbmZ1bmN0aW9uIFRhKGEsIGIsIGMsIGQsIGUpIHtcbiAgICBpZiAoMCA9PT0gYS5sZW5ndGgpXG4gICAgICAgIHJldHVybiAtMTtcbiAgICBcInN0cmluZ1wiID09PSB0eXBlb2YgYyA/IChkID0gYywgYyA9IDApIDogMjE0NzQ4MzY0NyA8IGMgPyBjID0gMjE0NzQ4MzY0NyA6IC0yMTQ3NDgzNjQ4ID4gYyAmJiAoYyA9IC0yMTQ3NDgzNjQ4KTtcbiAgICBjID0gK2M7XG4gICAgaXNOYU4oYykgJiYgKGMgPSBlID8gMCA6IGEubGVuZ3RoIC0gMSk7XG4gICAgMCA+IGMgJiYgKGMgPSBhLmxlbmd0aCArIGMpO1xuICAgIGlmIChjID49IGEubGVuZ3RoKSB7XG4gICAgICAgIGlmIChlKVxuICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICBjID0gYS5sZW5ndGggLSAxO1xuICAgIH1cbiAgICBlbHNlIGlmICgwID4gYylcbiAgICAgICAgaWYgKGUpXG4gICAgICAgICAgICBjID0gMDtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgIFwic3RyaW5nXCIgPT09IHR5cGVvZiBiICYmIChiID0gei5mcm9tKGIsIGQpKTtcbiAgICBpZiAoQShiKSlcbiAgICAgICAgcmV0dXJuIDAgPT09IGIubGVuZ3RoID8gLTEgOiBVYShhLCBiLCBjLCBkLCBlKTtcbiAgICBpZiAoXCJudW1iZXJcIiA9PT0gdHlwZW9mIGIpXG4gICAgICAgIHJldHVybiBiICY9IDI1NSwgei5UWVBFRF9BUlJBWV9TVVBQT1JUICYmIFwiZnVuY3Rpb25cIiA9PT0gdHlwZW9mIFVpbnQ4QXJyYXkucHJvdG90eXBlLmluZGV4T2YgPyBlID8gVWludDhBcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKGEsIGIsIGMpIDpcbiAgICAgICAgICAgIFVpbnQ4QXJyYXkucHJvdG90eXBlLmxhc3RJbmRleE9mLmNhbGwoYSwgYiwgYykgOiBVYShhLCBbYl0sIGMsIGQsIGUpO1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJ2YWwgbXVzdCBiZSBzdHJpbmcsIG51bWJlciBvciBCdWZmZXJcIik7XG59XG5mdW5jdGlvbiBVYShhLCBiLCBjLCBkLCBlKSB7IGZ1bmN0aW9uIGYoYSwgYikgeyByZXR1cm4gMSA9PT0gZyA/IGFbYl0gOiBhLnJlYWRVSW50MTZCRShiICogZyk7IH0gdmFyIGcgPSAxLCBoID0gYS5sZW5ndGgsIGsgPSBiLmxlbmd0aDsgaWYgKHZvaWQgMCAhPT0gZCAmJiAoZCA9IFN0cmluZyhkKS50b0xvd2VyQ2FzZSgpLCBcInVjczJcIiA9PT0gZCB8fCBcInVjcy0yXCIgPT09IGQgfHwgXCJ1dGYxNmxlXCIgPT09IGQgfHwgXCJ1dGYtMTZsZVwiID09PSBkKSkge1xuICAgIGlmICgyID4gYS5sZW5ndGggfHwgMiA+IGIubGVuZ3RoKVxuICAgICAgICByZXR1cm4gLTE7XG4gICAgZyA9IDI7XG4gICAgaCAvPSAyO1xuICAgIGsgLz0gMjtcbiAgICBjIC89IDI7XG59IGlmIChlKVxuICAgIGZvciAoZCA9IC0xOyBjIDwgaDsgYysrKVxuICAgICAgICBpZiAoZihhLCBjKSA9PT0gZihiLCAtMSA9PT0gZCA/IDAgOiBjIC0gZCkpIHtcbiAgICAgICAgICAgIGlmICgtMSA9PT0gZCAmJiAoZCA9IGMpLCBjIC0gZCArIDEgPT09IGspXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQgKiBnO1xuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIC0xICE9PSBkICYmIChjIC09IGMgLSBkKSwgZCA9IC0xO1xuZWxzZVxuICAgIGZvciAoYyArIGsgPiBoICYmIChjID0gaCAtIGspOyAwIDw9IGM7IGMtLSkge1xuICAgICAgICBoID0gITA7XG4gICAgICAgIGZvciAoZCA9IDA7IGQgPCBrOyBkKyspXG4gICAgICAgICAgICBpZiAoZihhLCBjICsgZCkgIT09IGYoYiwgZCkpIHtcbiAgICAgICAgICAgICAgICBoID0gITE7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIGlmIChoKVxuICAgICAgICAgICAgcmV0dXJuIGM7XG4gICAgfSByZXR1cm4gLTE7IH1cbnoucHJvdG90eXBlLmluY2x1ZGVzID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsgcmV0dXJuIC0xICE9PSB0aGlzLmluZGV4T2YoYSwgYiwgYyk7IH07XG56LnByb3RvdHlwZS5pbmRleE9mID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsgcmV0dXJuIFRhKHRoaXMsIGEsIGIsIGMsICEwKTsgfTtcbnoucHJvdG90eXBlLmxhc3RJbmRleE9mID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsgcmV0dXJuIFRhKHRoaXMsIGEsIGIsIGMsICExKTsgfTtcbnoucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHtcbiAgICBpZiAodm9pZCAwID09PSBiKVxuICAgICAgICBkID0gXCJ1dGY4XCIsIGMgPSB0aGlzLmxlbmd0aCwgYiA9IDA7XG4gICAgZWxzZSBpZiAodm9pZCAwID09PSBjICYmIFwic3RyaW5nXCIgPT09IHR5cGVvZiBiKVxuICAgICAgICBkID0gYiwgYyA9IHRoaXMubGVuZ3RoLCBiID0gMDtcbiAgICBlbHNlIGlmIChpc0Zpbml0ZShiKSlcbiAgICAgICAgYiB8PSAwLCBpc0Zpbml0ZShjKSA/IChjIHw9IDAsIHZvaWQgMCA9PT0gZCAmJiAoZCA9IFwidXRmOFwiKSkgOiAoZCA9IGMsIGMgPSB2b2lkIDApO1xuICAgIGVsc2VcbiAgICAgICAgdGhyb3cgRXJyb3IoXCJCdWZmZXIud3JpdGUoc3RyaW5nLCBlbmNvZGluZywgb2Zmc2V0WywgbGVuZ3RoXSkgaXMgbm8gbG9uZ2VyIHN1cHBvcnRlZFwiKTtcbiAgICB2YXIgZSA9IHRoaXMubGVuZ3RoIC0gYjtcbiAgICBpZiAodm9pZCAwID09PSBjIHx8IGMgPiBlKVxuICAgICAgICBjID0gZTtcbiAgICBpZiAoMCA8IGEubGVuZ3RoICYmICgwID4gYyB8fCAwID4gYikgfHwgYiA+IHRoaXMubGVuZ3RoKVxuICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIkF0dGVtcHQgdG8gd3JpdGUgb3V0c2lkZSBidWZmZXIgYm91bmRzXCIpO1xuICAgIGQgfHwgKGQgPSBcInV0ZjhcIik7XG4gICAgZm9yIChlID0gITE7OylcbiAgICAgICAgc3dpdGNoIChkKSB7XG4gICAgICAgICAgICBjYXNlIFwiaGV4XCI6XG4gICAgICAgICAgICAgICAgYToge1xuICAgICAgICAgICAgICAgICAgICBiID1cbiAgICAgICAgICAgICAgICAgICAgICAgIE51bWJlcihiKSB8fCAwO1xuICAgICAgICAgICAgICAgICAgICBkID0gdGhpcy5sZW5ndGggLSBiO1xuICAgICAgICAgICAgICAgICAgICBjID8gKGMgPSBOdW1iZXIoYyksIGMgPiBkICYmIChjID0gZCkpIDogYyA9IGQ7XG4gICAgICAgICAgICAgICAgICAgIGQgPSBhLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKDAgIT09IGQgJSAyKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkludmFsaWQgaGV4IHN0cmluZ1wiKTtcbiAgICAgICAgICAgICAgICAgICAgYyA+IGQgLyAyICYmIChjID0gZCAvIDIpO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGQgPSAwOyBkIDwgYzsgKytkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlID0gcGFyc2VJbnQoYS5zdWJzdHIoMiAqIGQsIDIpLCAxNik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNOYU4oZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhID0gZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhayBhO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1tiICsgZF0gPSBlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGEgPSBkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gYTtcbiAgICAgICAgICAgIGNhc2UgXCJ1dGY4XCI6XG4gICAgICAgICAgICBjYXNlIFwidXRmLThcIjogcmV0dXJuIFZhKE9hKGEsIHRoaXMubGVuZ3RoIC0gYiksIHRoaXMsIGIsIGMpO1xuICAgICAgICAgICAgY2FzZSBcImFzY2lpXCI6IHJldHVybiBWYShXYShhKSwgdGhpcywgYiwgYyk7XG4gICAgICAgICAgICBjYXNlIFwibGF0aW4xXCI6XG4gICAgICAgICAgICBjYXNlIFwiYmluYXJ5XCI6IHJldHVybiBWYShXYShhKSwgdGhpcywgYiwgYyk7XG4gICAgICAgICAgICBjYXNlIFwiYmFzZTY0XCI6IHJldHVybiBWYShQYShhKSwgdGhpcywgYiwgYyk7XG4gICAgICAgICAgICBjYXNlIFwidWNzMlwiOlxuICAgICAgICAgICAgY2FzZSBcInVjcy0yXCI6XG4gICAgICAgICAgICBjYXNlIFwidXRmMTZsZVwiOlxuICAgICAgICAgICAgY2FzZSBcInV0Zi0xNmxlXCI6XG4gICAgICAgICAgICAgICAgZCA9IGE7XG4gICAgICAgICAgICAgICAgZSA9IHRoaXMubGVuZ3RoIC1cbiAgICAgICAgICAgICAgICAgICAgYjtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBmID0gW10sIGcgPSAwOyBnIDwgZC5sZW5ndGggJiYgISgwID4gKGUgLT0gMikpOyArK2cpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGggPSBkLmNoYXJDb2RlQXQoZyk7XG4gICAgICAgICAgICAgICAgICAgIGEgPSBoID4+IDg7XG4gICAgICAgICAgICAgICAgICAgIGggJT0gMjU2O1xuICAgICAgICAgICAgICAgICAgICBmLnB1c2goaCk7XG4gICAgICAgICAgICAgICAgICAgIGYucHVzaChhKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIFZhKGYsIHRoaXMsIGIsIGMpO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBpZiAoZSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlVua25vd24gZW5jb2Rpbmc6IFwiICsgZCk7XG4gICAgICAgICAgICAgICAgZCA9IChcIlwiICsgZCkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICBlID0gITA7XG4gICAgICAgIH1cbn07XG56LnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB7IHR5cGU6IFwiQnVmZmVyXCIsIGRhdGE6IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKHRoaXMuX2FyciB8fCB0aGlzLCAwKSB9OyB9O1xuZnVuY3Rpb24gUmEoYSwgYiwgYykge1xuICAgIGMgPSBNYXRoLm1pbihhLmxlbmd0aCwgYyk7XG4gICAgZm9yICh2YXIgZCA9IFtdOyBiIDwgYzspIHtcbiAgICAgICAgdmFyIGUgPSBhW2JdLCBmID0gbnVsbCwgZyA9IDIzOSA8IGUgPyA0IDogMjIzIDwgZSA/IDMgOiAxOTEgPCBlID8gMiA6IDE7XG4gICAgICAgIGlmIChiICsgZyA8PSBjKVxuICAgICAgICAgICAgc3dpdGNoIChnKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAxMjggPiBlICYmIChmID0gZSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgdmFyIGggPSBhW2IgKyAxXTtcbiAgICAgICAgICAgICAgICAgICAgMTI4ID09PSAoaCAmIDE5MikgJiYgKGUgPSAoZSAmIDMxKSA8PCA2IHwgaCAmIDYzLCAxMjcgPCBlICYmIChmID0gZSkpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgIGggPSBhW2IgKyAxXTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGsgPSBhW2IgKyAyXTtcbiAgICAgICAgICAgICAgICAgICAgMTI4ID09PSAoaCAmIDE5MikgJiYgMTI4ID09PSAoayAmIDE5MikgJiYgKGUgPSAoZSAmIDE1KSA8PCAxMiB8IChoICYgNjMpIDw8IDYgfCBrICYgNjMsIDIwNDcgPCBlICYmICg1NTI5NiA+IGUgfHwgNTczNDMgPCBlKSAmJiAoZiA9IGUpKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICBoID0gYVtiICsgMV07XG4gICAgICAgICAgICAgICAgICAgIGsgPSBhW2IgKyAyXTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHAgPSBhW2IgKyAzXTtcbiAgICAgICAgICAgICAgICAgICAgMTI4ID09PSAoaCAmIDE5MikgJiYgMTI4ID09PSAoayAmIDE5MikgJiYgMTI4ID09PSAocCAmIDE5MikgJiYgKGUgPSAoZSAmIDE1KSA8PCAxOCB8IChoICYgNjMpIDw8IDEyIHwgKGsgJiA2MykgPDwgNiB8IHAgJiA2MywgNjU1MzUgPCBlICYmIDExMTQxMTIgPiBlICYmIChmID1cbiAgICAgICAgICAgICAgICAgICAgICAgIGUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgbnVsbCA9PT0gZiA/IChmID0gNjU1MzMsIGcgPSAxKSA6IDY1NTM1IDwgZiAmJiAoZiAtPSA2NTUzNiwgZC5wdXNoKGYgPj4+IDEwICYgMTAyMyB8IDU1Mjk2KSwgZiA9IDU2MzIwIHwgZiAmIDEwMjMpO1xuICAgICAgICBkLnB1c2goZik7XG4gICAgICAgIGIgKz0gZztcbiAgICB9XG4gICAgYSA9IGQubGVuZ3RoO1xuICAgIGlmIChhIDw9IGFiKVxuICAgICAgICBkID0gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShTdHJpbmcsIGQpO1xuICAgIGVsc2Uge1xuICAgICAgICBjID0gXCJcIjtcbiAgICAgICAgZm9yIChiID0gMDsgYiA8IGE7KVxuICAgICAgICAgICAgYyArPSBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KFN0cmluZywgZC5zbGljZShiLCBiICs9IGFiKSk7XG4gICAgICAgIGQgPSBjO1xuICAgIH1cbiAgICByZXR1cm4gZDtcbn1cbnZhciBhYiA9IDQwOTY7XG56LnByb3RvdHlwZS5zbGljZSA9IGZ1bmN0aW9uIChhLCBiKSB7IHZhciBjID0gdGhpcy5sZW5ndGg7IGEgPSB+fmE7IGIgPSB2b2lkIDAgPT09IGIgPyBjIDogfn5iOyAwID4gYSA/IChhICs9IGMsIDAgPiBhICYmIChhID0gMCkpIDogYSA+IGMgJiYgKGEgPSBjKTsgMCA+IGIgPyAoYiArPSBjLCAwID4gYiAmJiAoYiA9IDApKSA6IGIgPiBjICYmIChiID0gYyk7IGIgPCBhICYmIChiID0gYSk7IGlmICh6LlRZUEVEX0FSUkFZX1NVUFBPUlQpXG4gICAgYiA9IHRoaXMuc3ViYXJyYXkoYSwgYiksIGIuX19wcm90b19fID0gei5wcm90b3R5cGU7XG5lbHNlIHtcbiAgICBjID0gYiAtIGE7XG4gICAgYiA9IG5ldyB6KGMsIHZvaWQgMCk7XG4gICAgZm9yICh2YXIgZCA9IDA7IGQgPCBjOyArK2QpXG4gICAgICAgIGJbZF0gPSB0aGlzW2QgKyBhXTtcbn0gcmV0dXJuIGI7IH07XG5mdW5jdGlvbiBDKGEsIGIsIGMpIHsgaWYgKDAgIT09IGEgJSAxIHx8IDAgPiBhKVxuICAgIHRocm93IG5ldyBSYW5nZUVycm9yKFwib2Zmc2V0IGlzIG5vdCB1aW50XCIpOyBpZiAoYSArIGIgPiBjKVxuICAgIHRocm93IG5ldyBSYW5nZUVycm9yKFwiVHJ5aW5nIHRvIGFjY2VzcyBiZXlvbmQgYnVmZmVyIGxlbmd0aFwiKTsgfVxuei5wcm90b3R5cGUucmVhZFVJbnRMRSA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IGEgfD0gMDsgYiB8PSAwOyBjIHx8IEMoYSwgYiwgdGhpcy5sZW5ndGgpOyBjID0gdGhpc1thXTsgZm9yICh2YXIgZCA9IDEsIGUgPSAwOyArK2UgPCBiICYmIChkICo9IDI1Nik7KVxuICAgIGMgKz0gdGhpc1thICsgZV0gKiBkOyByZXR1cm4gYzsgfTtcbnoucHJvdG90eXBlLnJlYWRVSW50QkUgPSBmdW5jdGlvbiAoYSwgYiwgYykgeyBhIHw9IDA7IGIgfD0gMDsgYyB8fCBDKGEsIGIsIHRoaXMubGVuZ3RoKTsgYyA9IHRoaXNbYSArIC0tYl07IGZvciAodmFyIGQgPSAxOyAwIDwgYiAmJiAoZCAqPSAyNTYpOylcbiAgICBjICs9IHRoaXNbYSArIC0tYl0gKiBkOyByZXR1cm4gYzsgfTtcbnoucHJvdG90eXBlLnJlYWRVSW50OCA9IGZ1bmN0aW9uIChhLCBiKSB7IGIgfHwgQyhhLCAxLCB0aGlzLmxlbmd0aCk7IHJldHVybiB0aGlzW2FdOyB9O1xuei5wcm90b3R5cGUucmVhZFVJbnQxNkxFID0gZnVuY3Rpb24gKGEsIGIpIHsgYiB8fCBDKGEsIDIsIHRoaXMubGVuZ3RoKTsgcmV0dXJuIHRoaXNbYV0gfCB0aGlzW2EgKyAxXSA8PCA4OyB9O1xuei5wcm90b3R5cGUucmVhZFVJbnQxNkJFID0gZnVuY3Rpb24gKGEsIGIpIHsgYiB8fCBDKGEsIDIsIHRoaXMubGVuZ3RoKTsgcmV0dXJuIHRoaXNbYV0gPDwgOCB8IHRoaXNbYSArIDFdOyB9O1xuei5wcm90b3R5cGUucmVhZFVJbnQzMkxFID0gZnVuY3Rpb24gKGEsIGIpIHsgYiB8fCBDKGEsIDQsIHRoaXMubGVuZ3RoKTsgcmV0dXJuICh0aGlzW2FdIHwgdGhpc1thICsgMV0gPDwgOCB8IHRoaXNbYSArIDJdIDw8IDE2KSArIDE2Nzc3MjE2ICogdGhpc1thICsgM107IH07XG56LnByb3RvdHlwZS5yZWFkVUludDMyQkUgPSBmdW5jdGlvbiAoYSwgYikgeyBiIHx8IEMoYSwgNCwgdGhpcy5sZW5ndGgpOyByZXR1cm4gMTY3NzcyMTYgKiB0aGlzW2FdICsgKHRoaXNbYSArIDFdIDw8IDE2IHwgdGhpc1thICsgMl0gPDwgOCB8IHRoaXNbYSArIDNdKTsgfTtcbnoucHJvdG90eXBlLnJlYWRJbnRMRSA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IGEgfD0gMDsgYiB8PSAwOyBjIHx8IEMoYSwgYiwgdGhpcy5sZW5ndGgpOyBjID0gdGhpc1thXTsgZm9yICh2YXIgZCA9IDEsIGUgPSAwOyArK2UgPCBiICYmIChkICo9IDI1Nik7KVxuICAgIGMgKz0gdGhpc1thICsgZV0gKiBkOyBjID49IDEyOCAqIGQgJiYgKGMgLT0gTWF0aC5wb3coMiwgOCAqIGIpKTsgcmV0dXJuIGM7IH07XG56LnByb3RvdHlwZS5yZWFkSW50QkUgPSBmdW5jdGlvbiAoYSwgYiwgYykgeyBhIHw9IDA7IGIgfD0gMDsgYyB8fCBDKGEsIGIsIHRoaXMubGVuZ3RoKTsgYyA9IGI7IGZvciAodmFyIGQgPSAxLCBlID0gdGhpc1thICsgLS1jXTsgMCA8IGMgJiYgKGQgKj0gMjU2KTspXG4gICAgZSArPSB0aGlzW2EgKyAtLWNdICogZDsgZSA+PSAxMjggKiBkICYmIChlIC09IE1hdGgucG93KDIsIDggKiBiKSk7IHJldHVybiBlOyB9O1xuei5wcm90b3R5cGUucmVhZEludDggPSBmdW5jdGlvbiAoYSwgYikgeyBiIHx8IEMoYSwgMSwgdGhpcy5sZW5ndGgpOyByZXR1cm4gdGhpc1thXSAmIDEyOCA/IC0xICogKDI1NSAtIHRoaXNbYV0gKyAxKSA6IHRoaXNbYV07IH07XG56LnByb3RvdHlwZS5yZWFkSW50MTZMRSA9IGZ1bmN0aW9uIChhLCBiKSB7IGIgfHwgQyhhLCAyLCB0aGlzLmxlbmd0aCk7IGEgPSB0aGlzW2FdIHwgdGhpc1thICsgMV0gPDwgODsgcmV0dXJuIGEgJiAzMjc2OCA/IGEgfCA0Mjk0OTAxNzYwIDogYTsgfTtcbnoucHJvdG90eXBlLnJlYWRJbnQxNkJFID0gZnVuY3Rpb24gKGEsIGIpIHsgYiB8fCBDKGEsIDIsIHRoaXMubGVuZ3RoKTsgYSA9IHRoaXNbYSArIDFdIHwgdGhpc1thXSA8PCA4OyByZXR1cm4gYSAmIDMyNzY4ID8gYSB8IDQyOTQ5MDE3NjAgOiBhOyB9O1xuei5wcm90b3R5cGUucmVhZEludDMyTEUgPSBmdW5jdGlvbiAoYSwgYikgeyBiIHx8IEMoYSwgNCwgdGhpcy5sZW5ndGgpOyByZXR1cm4gdGhpc1thXSB8IHRoaXNbYSArIDFdIDw8IDggfCB0aGlzW2EgKyAyXSA8PCAxNiB8IHRoaXNbYSArIDNdIDw8IDI0OyB9O1xuei5wcm90b3R5cGUucmVhZEludDMyQkUgPSBmdW5jdGlvbiAoYSwgYikgeyBiIHx8IEMoYSwgNCwgdGhpcy5sZW5ndGgpOyByZXR1cm4gdGhpc1thXSA8PCAyNCB8IHRoaXNbYSArIDFdIDw8IDE2IHwgdGhpc1thICsgMl0gPDwgOCB8IHRoaXNbYSArIDNdOyB9O1xuei5wcm90b3R5cGUucmVhZEZsb2F0TEUgPSBmdW5jdGlvbiAoYSwgYikgeyBiIHx8IEMoYSwgNCwgdGhpcy5sZW5ndGgpOyByZXR1cm4gc2EodGhpcywgYSwgITAsIDIzLCA0KTsgfTtcbnoucHJvdG90eXBlLnJlYWRGbG9hdEJFID0gZnVuY3Rpb24gKGEsIGIpIHsgYiB8fCBDKGEsIDQsIHRoaXMubGVuZ3RoKTsgcmV0dXJuIHNhKHRoaXMsIGEsICExLCAyMywgNCk7IH07XG56LnByb3RvdHlwZS5yZWFkRG91YmxlTEUgPSBmdW5jdGlvbiAoYSwgYikgeyBiIHx8IEMoYSwgOCwgdGhpcy5sZW5ndGgpOyByZXR1cm4gc2EodGhpcywgYSwgITAsIDUyLCA4KTsgfTtcbnoucHJvdG90eXBlLnJlYWREb3VibGVCRSA9IGZ1bmN0aW9uIChhLCBiKSB7IGIgfHwgQyhhLCA4LCB0aGlzLmxlbmd0aCk7IHJldHVybiBzYSh0aGlzLCBhLCAhMSwgNTIsIDgpOyB9O1xuZnVuY3Rpb24gRShhLCBiLCBjLCBkLCBlLCBmKSB7IGlmICghQShhKSlcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdcImJ1ZmZlclwiIGFyZ3VtZW50IG11c3QgYmUgYSBCdWZmZXIgaW5zdGFuY2UnKTsgaWYgKGIgPiBlIHx8IGIgPCBmKVxuICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdcInZhbHVlXCIgYXJndW1lbnQgaXMgb3V0IG9mIGJvdW5kcycpOyBpZiAoYyArIGQgPiBhLmxlbmd0aClcbiAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIkluZGV4IG91dCBvZiByYW5nZVwiKTsgfVxuei5wcm90b3R5cGUud3JpdGVVSW50TEUgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCkgeyBhID0gK2E7IGIgfD0gMDsgYyB8PSAwOyBkIHx8IEUodGhpcywgYSwgYiwgYywgTWF0aC5wb3coMiwgOCAqIGMpIC0gMSwgMCk7IGQgPSAxOyB2YXIgZSA9IDA7IGZvciAodGhpc1tiXSA9IGEgJiAyNTU7ICsrZSA8IGMgJiYgKGQgKj0gMjU2KTspXG4gICAgdGhpc1tiICsgZV0gPSBhIC8gZCAmIDI1NTsgcmV0dXJuIGIgKyBjOyB9O1xuei5wcm90b3R5cGUud3JpdGVVSW50QkUgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCkgeyBhID0gK2E7IGIgfD0gMDsgYyB8PSAwOyBkIHx8IEUodGhpcywgYSwgYiwgYywgTWF0aC5wb3coMiwgOCAqIGMpIC0gMSwgMCk7IGQgPSBjIC0gMTsgdmFyIGUgPSAxOyBmb3IgKHRoaXNbYiArIGRdID0gYSAmIDI1NTsgMCA8PSAtLWQgJiYgKGUgKj0gMjU2KTspXG4gICAgdGhpc1tiICsgZF0gPSBhIC8gZSAmIDI1NTsgcmV0dXJuIGIgKyBjOyB9O1xuei5wcm90b3R5cGUud3JpdGVVSW50OCA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IGEgPSArYTsgYiB8PSAwOyBjIHx8IEUodGhpcywgYSwgYiwgMSwgMjU1LCAwKTsgei5UWVBFRF9BUlJBWV9TVVBQT1JUIHx8IChhID0gTWF0aC5mbG9vcihhKSk7IHRoaXNbYl0gPSBhICYgMjU1OyByZXR1cm4gYiArIDE7IH07XG5mdW5jdGlvbiBiYihhLCBiLCBjLCBkKSB7IDAgPiBiICYmIChiID0gNjU1MzUgKyBiICsgMSk7IGZvciAodmFyIGUgPSAwLCBmID0gTWF0aC5taW4oYS5sZW5ndGggLSBjLCAyKTsgZSA8IGY7ICsrZSlcbiAgICBhW2MgKyBlXSA9IChiICYgMjU1IDw8IDggKiAoZCA/IGUgOiAxIC0gZSkpID4+PiA4ICogKGQgPyBlIDogMSAtIGUpOyB9XG56LnByb3RvdHlwZS53cml0ZVVJbnQxNkxFID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsgYSA9ICthOyBiIHw9IDA7IGMgfHwgRSh0aGlzLCBhLCBiLCAyLCA2NTUzNSwgMCk7IHouVFlQRURfQVJSQVlfU1VQUE9SVCA/ICh0aGlzW2JdID0gYSAmIDI1NSwgdGhpc1tiICsgMV0gPSBhID4+PiA4KSA6IGJiKHRoaXMsIGEsIGIsICEwKTsgcmV0dXJuIGIgKyAyOyB9O1xuei5wcm90b3R5cGUud3JpdGVVSW50MTZCRSA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IGEgPSArYTsgYiB8PSAwOyBjIHx8IEUodGhpcywgYSwgYiwgMiwgNjU1MzUsIDApOyB6LlRZUEVEX0FSUkFZX1NVUFBPUlQgPyAodGhpc1tiXSA9IGEgPj4+IDgsIHRoaXNbYiArIDFdID0gYSAmIDI1NSkgOiBiYih0aGlzLCBhLCBiLCAhMSk7IHJldHVybiBiICsgMjsgfTtcbmZ1bmN0aW9uIGNiKGEsIGIsIGMsIGQpIHsgMCA+IGIgJiYgKGIgPSA0Mjk0OTY3Mjk1ICsgYiArIDEpOyBmb3IgKHZhciBlID0gMCwgZiA9IE1hdGgubWluKGEubGVuZ3RoIC0gYywgNCk7IGUgPCBmOyArK2UpXG4gICAgYVtjICsgZV0gPSBiID4+PiA4ICogKGQgPyBlIDogMyAtIGUpICYgMjU1OyB9XG56LnByb3RvdHlwZS53cml0ZVVJbnQzMkxFID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsgYSA9ICthOyBiIHw9IDA7IGMgfHwgRSh0aGlzLCBhLCBiLCA0LCA0Mjk0OTY3Mjk1LCAwKTsgei5UWVBFRF9BUlJBWV9TVVBQT1JUID8gKHRoaXNbYiArIDNdID0gYSA+Pj4gMjQsIHRoaXNbYiArIDJdID0gYSA+Pj4gMTYsIHRoaXNbYiArIDFdID0gYSA+Pj4gOCwgdGhpc1tiXSA9IGEgJiAyNTUpIDogY2IodGhpcywgYSwgYiwgITApOyByZXR1cm4gYiArIDQ7IH07XG56LnByb3RvdHlwZS53cml0ZVVJbnQzMkJFID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsgYSA9ICthOyBiIHw9IDA7IGMgfHwgRSh0aGlzLCBhLCBiLCA0LCA0Mjk0OTY3Mjk1LCAwKTsgei5UWVBFRF9BUlJBWV9TVVBQT1JUID8gKHRoaXNbYl0gPSBhID4+PiAyNCwgdGhpc1tiICsgMV0gPSBhID4+PiAxNiwgdGhpc1tiICsgMl0gPSBhID4+PiA4LCB0aGlzW2IgKyAzXSA9IGEgJiAyNTUpIDogY2IodGhpcywgYSwgYiwgITEpOyByZXR1cm4gYiArIDQ7IH07XG56LnByb3RvdHlwZS53cml0ZUludExFID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsgYSA9ICthOyBiIHw9IDA7IGQgfHwgKGQgPSBNYXRoLnBvdygyLCA4ICogYyAtIDEpLCBFKHRoaXMsIGEsIGIsIGMsIGQgLSAxLCAtZCkpOyBkID0gMDsgdmFyIGUgPSAxLCBmID0gMDsgZm9yICh0aGlzW2JdID0gYSAmIDI1NTsgKytkIDwgYyAmJiAoZSAqPSAyNTYpOylcbiAgICAwID4gYSAmJiAwID09PSBmICYmIDAgIT09IHRoaXNbYiArIGQgLSAxXSAmJiAoZiA9IDEpLCB0aGlzW2IgKyBkXSA9IChhIC8gZSA+PiAwKSAtIGYgJiAyNTU7IHJldHVybiBiICsgYzsgfTtcbnoucHJvdG90eXBlLndyaXRlSW50QkUgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCkgeyBhID0gK2E7IGIgfD0gMDsgZCB8fCAoZCA9IE1hdGgucG93KDIsIDggKiBjIC0gMSksIEUodGhpcywgYSwgYiwgYywgZCAtIDEsIC1kKSk7IGQgPSBjIC0gMTsgdmFyIGUgPSAxLCBmID0gMDsgZm9yICh0aGlzW2IgKyBkXSA9IGEgJiAyNTU7IDAgPD0gLS1kICYmIChlICo9IDI1Nik7KVxuICAgIDAgPiBhICYmIDAgPT09IGYgJiYgMCAhPT0gdGhpc1tiICsgZCArIDFdICYmIChmID0gMSksIHRoaXNbYiArIGRdID0gKGEgLyBlID4+IDApIC0gZiAmIDI1NTsgcmV0dXJuIGIgKyBjOyB9O1xuei5wcm90b3R5cGUud3JpdGVJbnQ4ID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsgYSA9ICthOyBiIHw9IDA7IGMgfHwgRSh0aGlzLCBhLCBiLCAxLCAxMjcsIC0xMjgpOyB6LlRZUEVEX0FSUkFZX1NVUFBPUlQgfHwgKGEgPSBNYXRoLmZsb29yKGEpKTsgMCA+IGEgJiYgKGEgPSAyNTUgKyBhICsgMSk7IHRoaXNbYl0gPSBhICYgMjU1OyByZXR1cm4gYiArIDE7IH07XG56LnByb3RvdHlwZS53cml0ZUludDE2TEUgPSBmdW5jdGlvbiAoYSwgYiwgYykgeyBhID0gK2E7IGIgfD0gMDsgYyB8fCBFKHRoaXMsIGEsIGIsIDIsIDMyNzY3LCAtMzI3NjgpOyB6LlRZUEVEX0FSUkFZX1NVUFBPUlQgPyAodGhpc1tiXSA9IGEgJiAyNTUsIHRoaXNbYiArIDFdID0gYSA+Pj4gOCkgOiBiYih0aGlzLCBhLCBiLCAhMCk7IHJldHVybiBiICsgMjsgfTtcbnoucHJvdG90eXBlLndyaXRlSW50MTZCRSA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IGEgPSArYTsgYiB8PSAwOyBjIHx8IEUodGhpcywgYSwgYiwgMiwgMzI3NjcsIC0zMjc2OCk7IHouVFlQRURfQVJSQVlfU1VQUE9SVCA/ICh0aGlzW2JdID0gYSA+Pj4gOCwgdGhpc1tiICsgMV0gPSBhICYgMjU1KSA6IGJiKHRoaXMsIGEsIGIsICExKTsgcmV0dXJuIGIgKyAyOyB9O1xuei5wcm90b3R5cGUud3JpdGVJbnQzMkxFID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsgYSA9ICthOyBiIHw9IDA7IGMgfHwgRSh0aGlzLCBhLCBiLCA0LCAyMTQ3NDgzNjQ3LCAtMjE0NzQ4MzY0OCk7IHouVFlQRURfQVJSQVlfU1VQUE9SVCA/ICh0aGlzW2JdID0gYSAmIDI1NSwgdGhpc1tiICsgMV0gPSBhID4+PiA4LCB0aGlzW2IgKyAyXSA9IGEgPj4+IDE2LCB0aGlzW2IgKyAzXSA9IGEgPj4+IDI0KSA6IGNiKHRoaXMsIGEsIGIsICEwKTsgcmV0dXJuIGIgKyA0OyB9O1xuei5wcm90b3R5cGUud3JpdGVJbnQzMkJFID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsgYSA9ICthOyBiIHw9IDA7IGMgfHwgRSh0aGlzLCBhLCBiLCA0LCAyMTQ3NDgzNjQ3LCAtMjE0NzQ4MzY0OCk7IDAgPiBhICYmIChhID0gNDI5NDk2NzI5NSArIGEgKyAxKTsgei5UWVBFRF9BUlJBWV9TVVBQT1JUID8gKHRoaXNbYl0gPSBhID4+PiAyNCwgdGhpc1tiICsgMV0gPSBhID4+PiAxNiwgdGhpc1tiICsgMl0gPSBhID4+PiA4LCB0aGlzW2IgKyAzXSA9IGEgJiAyNTUpIDogY2IodGhpcywgYSwgYiwgITEpOyByZXR1cm4gYiArIDQ7IH07XG5mdW5jdGlvbiBkYihhLCBiLCBjLCBkKSB7IGlmIChjICsgZCA+IGEubGVuZ3RoKVxuICAgIHRocm93IG5ldyBSYW5nZUVycm9yKFwiSW5kZXggb3V0IG9mIHJhbmdlXCIpOyBpZiAoMCA+IGMpXG4gICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJJbmRleCBvdXQgb2YgcmFuZ2VcIik7IH1cbnoucHJvdG90eXBlLndyaXRlRmxvYXRMRSA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IGMgfHwgZGIodGhpcywgYSwgYiwgNCk7IHRhKHRoaXMsIGEsIGIsICEwLCAyMywgNCk7IHJldHVybiBiICsgNDsgfTtcbnoucHJvdG90eXBlLndyaXRlRmxvYXRCRSA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IGMgfHwgZGIodGhpcywgYSwgYiwgNCk7IHRhKHRoaXMsIGEsIGIsICExLCAyMywgNCk7IHJldHVybiBiICsgNDsgfTtcbnoucHJvdG90eXBlLndyaXRlRG91YmxlTEUgPSBmdW5jdGlvbiAoYSwgYiwgYykgeyBjIHx8IGRiKHRoaXMsIGEsIGIsIDgpOyB0YSh0aGlzLCBhLCBiLCAhMCwgNTIsIDgpOyByZXR1cm4gYiArIDg7IH07XG56LnByb3RvdHlwZS53cml0ZURvdWJsZUJFID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsgYyB8fCBkYih0aGlzLCBhLCBiLCA4KTsgdGEodGhpcywgYSwgYiwgITEsIDUyLCA4KTsgcmV0dXJuIGIgKyA4OyB9O1xuei5wcm90b3R5cGUuY29weSA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkKSB7XG4gICAgYyB8fCAoYyA9IDApO1xuICAgIGQgfHwgMCA9PT0gZCB8fCAoZCA9IHRoaXMubGVuZ3RoKTtcbiAgICBiID49IGEubGVuZ3RoICYmIChiID0gYS5sZW5ndGgpO1xuICAgIGIgfHwgKGIgPSAwKTtcbiAgICAwIDwgZCAmJiBkIDwgYyAmJiAoZCA9IGMpO1xuICAgIGlmIChkID09PSBjIHx8IDAgPT09IGEubGVuZ3RoIHx8IDAgPT09IHRoaXMubGVuZ3RoKVxuICAgICAgICByZXR1cm4gMDtcbiAgICBpZiAoMCA+IGIpXG4gICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKFwidGFyZ2V0U3RhcnQgb3V0IG9mIGJvdW5kc1wiKTtcbiAgICBpZiAoMCA+IGMgfHwgYyA+PSB0aGlzLmxlbmd0aClcbiAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJzb3VyY2VTdGFydCBvdXQgb2YgYm91bmRzXCIpO1xuICAgIGlmICgwID4gZClcbiAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJzb3VyY2VFbmQgb3V0IG9mIGJvdW5kc1wiKTtcbiAgICBkID4gdGhpcy5sZW5ndGggJiYgKGQgPSB0aGlzLmxlbmd0aCk7XG4gICAgYS5sZW5ndGggLSBiIDwgZCAtIGMgJiYgKGQgPSBhLmxlbmd0aCAtIGIgKyBjKTtcbiAgICB2YXIgZSA9IGQgLSBjO1xuICAgIGlmICh0aGlzID09PSBhICYmIGMgPCBiICYmIGIgPCBkKVxuICAgICAgICBmb3IgKGQgPSBlIC0gMTsgMCA8PSBkOyAtLWQpXG4gICAgICAgICAgICBhW2QgKyBiXSA9IHRoaXNbZCArIGNdO1xuICAgIGVsc2UgaWYgKDFFMyA+IGUgfHxcbiAgICAgICAgIXouVFlQRURfQVJSQVlfU1VQUE9SVClcbiAgICAgICAgZm9yIChkID0gMDsgZCA8IGU7ICsrZClcbiAgICAgICAgICAgIGFbZCArIGJdID0gdGhpc1tkICsgY107XG4gICAgZWxzZVxuICAgICAgICBVaW50OEFycmF5LnByb3RvdHlwZS5zZXQuY2FsbChhLCB0aGlzLnN1YmFycmF5KGMsIGMgKyBlKSwgYik7XG4gICAgcmV0dXJuIGU7XG59O1xuei5wcm90b3R5cGUuZmlsbCA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkKSB7XG4gICAgaWYgKFwic3RyaW5nXCIgPT09IHR5cGVvZiBhKSB7XG4gICAgICAgIFwic3RyaW5nXCIgPT09IHR5cGVvZiBiID8gKGQgPSBiLCBiID0gMCwgYyA9IHRoaXMubGVuZ3RoKSA6IFwic3RyaW5nXCIgPT09IHR5cGVvZiBjICYmIChkID0gYywgYyA9IHRoaXMubGVuZ3RoKTtcbiAgICAgICAgaWYgKDEgPT09IGEubGVuZ3RoKSB7XG4gICAgICAgICAgICB2YXIgZSA9IGEuY2hhckNvZGVBdCgwKTtcbiAgICAgICAgICAgIDI1NiA+IGUgJiYgKGEgPSBlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodm9pZCAwICE9PSBkICYmIFwic3RyaW5nXCIgIT09IHR5cGVvZiBkKVxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcImVuY29kaW5nIG11c3QgYmUgYSBzdHJpbmdcIik7XG4gICAgICAgIGlmIChcInN0cmluZ1wiID09PSB0eXBlb2YgZCAmJiAhei5pc0VuY29kaW5nKGQpKVxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlVua25vd24gZW5jb2Rpbmc6IFwiICsgZCk7XG4gICAgfVxuICAgIGVsc2VcbiAgICAgICAgXCJudW1iZXJcIiA9PT0gdHlwZW9mIGEgJiYgKGEgJj0gMjU1KTtcbiAgICBpZiAoMCA+IGIgfHwgdGhpcy5sZW5ndGggPCBiIHx8IHRoaXMubGVuZ3RoIDwgYylcbiAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJPdXQgb2YgcmFuZ2UgaW5kZXhcIik7XG4gICAgaWYgKGMgPD0gYilcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgYiA+Pj49XG4gICAgICAgIDA7XG4gICAgYyA9IHZvaWQgMCA9PT0gYyA/IHRoaXMubGVuZ3RoIDogYyA+Pj4gMDtcbiAgICBhIHx8IChhID0gMCk7XG4gICAgaWYgKFwibnVtYmVyXCIgPT09IHR5cGVvZiBhKVxuICAgICAgICBmb3IgKGQgPSBiOyBkIDwgYzsgKytkKVxuICAgICAgICAgICAgdGhpc1tkXSA9IGE7XG4gICAgZWxzZVxuICAgICAgICBmb3IgKGEgPSBBKGEpID8gYSA6IE9hKChuZXcgeihhLCBkKSkudG9TdHJpbmcoKSksIGUgPSBhLmxlbmd0aCwgZCA9IDA7IGQgPCBjIC0gYjsgKytkKVxuICAgICAgICAgICAgdGhpc1tkICsgYl0gPSBhW2QgJSBlXTtcbiAgICByZXR1cm4gdGhpcztcbn07XG52YXIgZWIgPSAvW14rXFwvMC05QS1aYS16LV9dL2c7XG5mdW5jdGlvbiBPYShhLCBiKSB7XG4gICAgYiA9IGIgfHwgSW5maW5pdHk7XG4gICAgZm9yICh2YXIgYywgZCA9IGEubGVuZ3RoLCBlID0gbnVsbCwgZiA9IFtdLCBnID0gMDsgZyA8IGQ7ICsrZykge1xuICAgICAgICBjID0gYS5jaGFyQ29kZUF0KGcpO1xuICAgICAgICBpZiAoNTUyOTUgPCBjICYmIDU3MzQ0ID4gYykge1xuICAgICAgICAgICAgaWYgKCFlKSB7XG4gICAgICAgICAgICAgICAgaWYgKDU2MzE5IDwgYykge1xuICAgICAgICAgICAgICAgICAgICAtMSA8IChiIC09IDMpICYmIGYucHVzaCgyMzksIDE5MSwgMTg5KTtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGcgKyAxID09PSBkKSB7XG4gICAgICAgICAgICAgICAgICAgIC0xIDwgKGIgLT0gMykgJiYgZi5wdXNoKDIzOSwgMTkxLCAxODkpO1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZSA9IGM7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoNTYzMjAgPiBjKSB7XG4gICAgICAgICAgICAgICAgLTEgPCAoYiAtPSAzKSAmJiBmLnB1c2goMjM5LCAxOTEsIDE4OSk7XG4gICAgICAgICAgICAgICAgZSA9IGM7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjID0gKGUgLSA1NTI5NiA8PCAxMCB8IGMgLSA1NjMyMCkgKyA2NTUzNjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBlICYmIC0xIDwgKGIgLT0gMykgJiYgZi5wdXNoKDIzOSwgMTkxLCAxODkpO1xuICAgICAgICBlID0gbnVsbDtcbiAgICAgICAgaWYgKDEyOCA+IGMpIHtcbiAgICAgICAgICAgIGlmICgwID4gLS1iKVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZi5wdXNoKGMpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKDIwNDggPiBjKSB7XG4gICAgICAgICAgICBpZiAoMCA+IChiIC09IDIpKVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZi5wdXNoKGMgPj4gNiB8IDE5MiwgYyAmIDYzIHwgMTI4KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICg2NTUzNiA+IGMpIHtcbiAgICAgICAgICAgIGlmICgwID4gKGIgLT0gMykpXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBmLnB1c2goYyA+PiAxMiB8IDIyNCwgYyA+PiA2ICYgNjMgfCAxMjgsIGMgJiA2MyB8IDEyOCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoMTExNDExMiA+IGMpIHtcbiAgICAgICAgICAgIGlmICgwID4gKGIgLT0gNCkpXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBmLnB1c2goYyA+PiAxOCB8IDI0MCwgYyA+PiAxMiAmIDYzIHwgMTI4LCBjID4+IDYgJiA2MyB8IDEyOCwgYyAmIDYzIHwgMTI4KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aHJvdyBFcnJvcihcIkludmFsaWQgY29kZSBwb2ludFwiKTtcbiAgICB9XG4gICAgcmV0dXJuIGY7XG59XG5mdW5jdGlvbiBXYShhKSB7IGZvciAodmFyIGIgPSBbXSwgYyA9IDA7IGMgPCBhLmxlbmd0aDsgKytjKVxuICAgIGIucHVzaChhLmNoYXJDb2RlQXQoYykgJiAyNTUpOyByZXR1cm4gYjsgfVxuZnVuY3Rpb24gUGEoYSkge1xuICAgIGEgPSAoYS50cmltID8gYS50cmltKCkgOiBhLnJlcGxhY2UoL15cXHMrfFxccyskL2csIFwiXCIpKS5yZXBsYWNlKGViLCBcIlwiKTtcbiAgICBpZiAoMiA+IGEubGVuZ3RoKVxuICAgICAgICBhID0gXCJcIjtcbiAgICBlbHNlXG4gICAgICAgIGZvciAoOyAwICE9PSBhLmxlbmd0aCAlIDQ7KVxuICAgICAgICAgICAgYSArPSBcIj1cIjtcbiAgICBvYSB8fCBwYSgpO1xuICAgIHZhciBiID0gYS5sZW5ndGg7XG4gICAgaWYgKDAgPCBiICUgNClcbiAgICAgICAgdGhyb3cgRXJyb3IoXCJJbnZhbGlkIHN0cmluZy4gTGVuZ3RoIG11c3QgYmUgYSBtdWx0aXBsZSBvZiA0XCIpO1xuICAgIHZhciBjID0gXCI9XCIgPT09IGFbYiAtIDJdID8gMiA6IFwiPVwiID09PSBhW2IgLSAxXSA/IDEgOiAwO1xuICAgIHZhciBkID0gbmV3IG1hKDMgKiBiIC8gNCAtIGMpO1xuICAgIHZhciBlID0gMCA8IGMgPyBiIC0gNCA6IGI7XG4gICAgdmFyIGYgPSAwO1xuICAgIGZvciAoYiA9IDA7IGIgPCBlOyBiICs9IDQpIHtcbiAgICAgICAgdmFyIGcgPSB5W2EuY2hhckNvZGVBdChiKV0gPDwgMTggfCB5W2EuY2hhckNvZGVBdChiICsgMSldIDw8IDEyIHwgeVthLmNoYXJDb2RlQXQoYiArIDIpXSA8PCA2IHwgeVthLmNoYXJDb2RlQXQoYiArIDMpXTtcbiAgICAgICAgZFtmKytdID0gZyA+PiAxNiAmIDI1NTtcbiAgICAgICAgZFtmKytdID0gZyA+PiA4ICYgMjU1O1xuICAgICAgICBkW2YrK10gPSBnICYgMjU1O1xuICAgIH1cbiAgICAyID09PSBjID8gKGcgPSB5W2EuY2hhckNvZGVBdChiKV0gPDwgMiB8XG4gICAgICAgIHlbYS5jaGFyQ29kZUF0KGIgKyAxKV0gPj4gNCwgZFtmKytdID0gZyAmIDI1NSkgOiAxID09PSBjICYmIChnID0geVthLmNoYXJDb2RlQXQoYildIDw8IDEwIHwgeVthLmNoYXJDb2RlQXQoYiArIDEpXSA8PCA0IHwgeVthLmNoYXJDb2RlQXQoYiArIDIpXSA+PiAyLCBkW2YrK10gPSBnID4+IDggJiAyNTUsIGRbZisrXSA9IGcgJiAyNTUpO1xuICAgIHJldHVybiBkO1xufVxuZnVuY3Rpb24gVmEoYSwgYiwgYywgZCkgeyBmb3IgKHZhciBlID0gMDsgZSA8IGQgJiYgIShlICsgYyA+PSBiLmxlbmd0aCB8fCBlID49IGEubGVuZ3RoKTsgKytlKVxuICAgIGJbZSArIGNdID0gYVtlXTsgcmV0dXJuIGU7IH1cbmZ1bmN0aW9uIE5hKGEpIHsgcmV0dXJuIG51bGwgIT0gYSAmJiAoISFhLl9pc0J1ZmZlciB8fCBmYihhKSB8fCBcImZ1bmN0aW9uXCIgPT09IHR5cGVvZiBhLnJlYWRGbG9hdExFICYmIFwiZnVuY3Rpb25cIiA9PT0gdHlwZW9mIGEuc2xpY2UgJiYgZmIoYS5zbGljZSgwLCAwKSkpOyB9XG5mdW5jdGlvbiBmYihhKSB7IHJldHVybiAhIWEuY29uc3RydWN0b3IgJiYgXCJmdW5jdGlvblwiID09PSB0eXBlb2YgYS5jb25zdHJ1Y3Rvci5pc0J1ZmZlciAmJiBhLmNvbnN0cnVjdG9yLmlzQnVmZmVyKGEpOyB9XG52YXIgZ2IgPSBPYmplY3QuZnJlZXplKHsgX19wcm90b19fOiBudWxsLCBJTlNQRUNUX01BWF9CWVRFUzogNTAsIGtNYXhMZW5ndGg6IHphLCBCdWZmZXI6IHosIFNsb3dCdWZmZXI6IGZ1bmN0aW9uIChhKSB7ICthICE9IGEgJiYgKGEgPSAwKTsgcmV0dXJuIHouYWxsb2MoK2EpOyB9LCBpc0J1ZmZlcjogTmEgfSksIEYgPSB1KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgZnVuY3Rpb24gYyhhKSB7IGZvciAodmFyIGIgPSBbXSwgYyA9IDE7IGMgPCBhcmd1bWVudHMubGVuZ3RoOyBjKyspXG4gICAgICAgIGJbYyAtIDFdID0gYXJndW1lbnRzW2NdOyByZXR1cm4gbmV3IChnYi5CdWZmZXIuYmluZC5hcHBseShnYi5CdWZmZXIsIGQoW3ZvaWQgMCwgYV0sIGIpKSk7IH1cbiAgICB2YXIgZCA9IGwgJiYgbC5fX3NwcmVhZEFycmF5cyB8fCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZvciAodmFyIGEgPSAwLCBiID0gMCwgYyA9IGFyZ3VtZW50cy5sZW5ndGg7IGIgPCBjOyBiKyspXG4gICAgICAgICAgICBhICs9IGFyZ3VtZW50c1tiXS5sZW5ndGg7XG4gICAgICAgIGEgPSBBcnJheShhKTtcbiAgICAgICAgdmFyIGQgPSAwO1xuICAgICAgICBmb3IgKGIgPSAwOyBiIDwgYzsgYisrKVxuICAgICAgICAgICAgZm9yICh2YXIgayA9IGFyZ3VtZW50c1tiXSwgcCA9IDAsIG4gPSBrLmxlbmd0aDsgcCA8IG47IHArKywgZCsrKVxuICAgICAgICAgICAgICAgIGFbZF0gPSBrW3BdO1xuICAgICAgICByZXR1cm4gYTtcbiAgICB9O1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShiLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogITAgfSk7XG4gICAgYi5CdWZmZXIgPSBnYi5CdWZmZXI7XG4gICAgYi5idWZmZXJBbGxvY1Vuc2FmZSA9IGdiLkJ1ZmZlci5hbGxvY1Vuc2FmZSB8fCBjO1xuICAgIGIuYnVmZmVyRnJvbSA9IGdiLkJ1ZmZlci5mcm9tIHx8IGM7XG59KTtcbnQoRik7XG5mdW5jdGlvbiBoYigpIHsgdGhyb3cgRXJyb3IoXCJzZXRUaW1lb3V0IGhhcyBub3QgYmVlbiBkZWZpbmVkXCIpOyB9XG5mdW5jdGlvbiBpYigpIHsgdGhyb3cgRXJyb3IoXCJjbGVhclRpbWVvdXQgaGFzIG5vdCBiZWVuIGRlZmluZWRcIik7IH1cbnZhciBqYiA9IGhiLCBrYiA9IGliO1xuXCJmdW5jdGlvblwiID09PSB0eXBlb2YgbGEuc2V0VGltZW91dCAmJiAoamIgPSBzZXRUaW1lb3V0KTtcblwiZnVuY3Rpb25cIiA9PT0gdHlwZW9mIGxhLmNsZWFyVGltZW91dCAmJiAoa2IgPSBjbGVhclRpbWVvdXQpO1xuZnVuY3Rpb24gcGIoYSkgeyBpZiAoamIgPT09IHNldFRpbWVvdXQpXG4gICAgcmV0dXJuIHNldFRpbWVvdXQoYSwgMCk7IGlmICgoamIgPT09IGhiIHx8ICFqYikgJiYgc2V0VGltZW91dClcbiAgICByZXR1cm4gamIgPSBzZXRUaW1lb3V0LCBzZXRUaW1lb3V0KGEsIDApOyB0cnkge1xuICAgIHJldHVybiBqYihhLCAwKTtcbn1cbmNhdGNoIChiKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIGpiLmNhbGwobnVsbCwgYSwgMCk7XG4gICAgfVxuICAgIGNhdGNoIChjKSB7XG4gICAgICAgIHJldHVybiBqYi5jYWxsKHRoaXMsIGEsIDApO1xuICAgIH1cbn0gfVxuZnVuY3Rpb24gcmIoYSkgeyBpZiAoa2IgPT09IGNsZWFyVGltZW91dClcbiAgICByZXR1cm4gY2xlYXJUaW1lb3V0KGEpOyBpZiAoKGtiID09PSBpYiB8fCAha2IpICYmIGNsZWFyVGltZW91dClcbiAgICByZXR1cm4ga2IgPSBjbGVhclRpbWVvdXQsIGNsZWFyVGltZW91dChhKTsgdHJ5IHtcbiAgICByZXR1cm4ga2IoYSk7XG59XG5jYXRjaCAoYikge1xuICAgIHRyeSB7XG4gICAgICAgIHJldHVybiBrYi5jYWxsKG51bGwsIGEpO1xuICAgIH1cbiAgICBjYXRjaCAoYykge1xuICAgICAgICByZXR1cm4ga2IuY2FsbCh0aGlzLCBhKTtcbiAgICB9XG59IH1cbnZhciBzYiA9IFtdLCB0YiA9ICExLCB1YiwgdmIgPSAtMTtcbmZ1bmN0aW9uIHdiKCkgeyB0YiAmJiB1YiAmJiAodGIgPSAhMSwgdWIubGVuZ3RoID8gc2IgPSB1Yi5jb25jYXQoc2IpIDogdmIgPSAtMSwgc2IubGVuZ3RoICYmIHhiKCkpOyB9XG5mdW5jdGlvbiB4YigpIHsgaWYgKCF0Yikge1xuICAgIHZhciBhID0gcGIod2IpO1xuICAgIHRiID0gITA7XG4gICAgZm9yICh2YXIgYiA9IHNiLmxlbmd0aDsgYjspIHtcbiAgICAgICAgdWIgPSBzYjtcbiAgICAgICAgZm9yIChzYiA9IFtdOyArK3ZiIDwgYjspXG4gICAgICAgICAgICB1YiAmJiB1Ylt2Yl0ucnVuKCk7XG4gICAgICAgIHZiID0gLTE7XG4gICAgICAgIGIgPSBzYi5sZW5ndGg7XG4gICAgfVxuICAgIHViID0gbnVsbDtcbiAgICB0YiA9ICExO1xuICAgIHJiKGEpO1xufSB9XG5mdW5jdGlvbiBHKGEpIHsgdmFyIGIgPSBBcnJheShhcmd1bWVudHMubGVuZ3RoIC0gMSk7IGlmICgxIDwgYXJndW1lbnRzLmxlbmd0aClcbiAgICBmb3IgKHZhciBjID0gMTsgYyA8IGFyZ3VtZW50cy5sZW5ndGg7IGMrKylcbiAgICAgICAgYltjIC0gMV0gPSBhcmd1bWVudHNbY107IHNiLnB1c2gobmV3IHliKGEsIGIpKTsgMSAhPT0gc2IubGVuZ3RoIHx8IHRiIHx8IHBiKHhiKTsgfVxuZnVuY3Rpb24geWIoYSwgYikgeyB0aGlzLmZ1biA9IGE7IHRoaXMuYXJyYXkgPSBiOyB9XG55Yi5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24gKCkgeyB0aGlzLmZ1bi5hcHBseShudWxsLCB0aGlzLmFycmF5KTsgfTtcbmZ1bmN0aW9uIHpiKCkgeyB9XG52YXIgcGVyZm9ybWFuY2UgPSBsYS5wZXJmb3JtYW5jZSB8fCB7fSwgQWIgPSBwZXJmb3JtYW5jZS5ub3cgfHwgcGVyZm9ybWFuY2UubW96Tm93IHx8IHBlcmZvcm1hbmNlLm1zTm93IHx8IHBlcmZvcm1hbmNlLm9Ob3cgfHwgcGVyZm9ybWFuY2Uud2Via2l0Tm93IHx8IGZ1bmN0aW9uICgpIHsgcmV0dXJuIChuZXcgRGF0ZSkuZ2V0VGltZSgpOyB9LCBCYiA9IG5ldyBEYXRlLCBDYiA9IHsgbmV4dFRpY2s6IEcsIHRpdGxlOiBcImJyb3dzZXJcIiwgYnJvd3NlcjogITAsIGVudjoge30sIGFyZ3Y6IFtdLCB2ZXJzaW9uOiBcIlwiLCB2ZXJzaW9uczoge30sIG9uOiB6YiwgYWRkTGlzdGVuZXI6IHpiLCBvbmNlOiB6Yiwgb2ZmOiB6YiwgcmVtb3ZlTGlzdGVuZXI6IHpiLCByZW1vdmVBbGxMaXN0ZW5lcnM6IHpiLCBlbWl0OiB6YiwgYmluZGluZzogZnVuY3Rpb24gKCkgeyB0aHJvdyBFcnJvcihcInByb2Nlc3MuYmluZGluZyBpcyBub3Qgc3VwcG9ydGVkXCIpOyB9LCBjd2Q6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFwiL1wiOyB9LCBjaGRpcjogZnVuY3Rpb24gKCkgeyB0aHJvdyBFcnJvcihcInByb2Nlc3MuY2hkaXIgaXMgbm90IHN1cHBvcnRlZFwiKTsgfSxcbiAgICB1bWFzazogZnVuY3Rpb24gKCkgeyByZXR1cm4gMDsgfSwgaHJ0aW1lOiBmdW5jdGlvbiAoYSkgeyB2YXIgYiA9IC4wMDEgKiBBYi5jYWxsKHBlcmZvcm1hbmNlKSwgYyA9IE1hdGguZmxvb3IoYik7IGIgPSBNYXRoLmZsb29yKGIgJSAxICogMUU5KTsgYSAmJiAoYyAtPSBhWzBdLCBiIC09IGFbMV0sIDAgPiBiICYmIChjLS0sIGIgKz0gMUU5KSk7IHJldHVybiBbYywgYl07IH0sIHBsYXRmb3JtOiBcImJyb3dzZXJcIiwgcmVsZWFzZToge30sIGNvbmZpZzoge30sIHVwdGltZTogZnVuY3Rpb24gKCkgeyByZXR1cm4gKG5ldyBEYXRlIC0gQmIpIC8gMUUzOyB9IH0sIERiID0gXCJmdW5jdGlvblwiID09PSB0eXBlb2YgT2JqZWN0LmNyZWF0ZSA/IGZ1bmN0aW9uIChhLCBiKSB7IGEuc3VwZXJfID0gYjsgYS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKGIucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBhLCBlbnVtZXJhYmxlOiAhMSwgd3JpdGFibGU6ICEwLCBjb25maWd1cmFibGU6ICEwIH0gfSk7IH0gOiBmdW5jdGlvbiAoYSwgYikge1xuICAgIGZ1bmN0aW9uIGMoKSB7IH1cbiAgICBhLnN1cGVyXyA9IGI7XG4gICAgYy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZTtcbiAgICBhLnByb3RvdHlwZSA9IG5ldyBjO1xuICAgIGEucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gYTtcbn0sIEViID0gLyVbc2RqJV0vZztcbmZ1bmN0aW9uIEZiKGEpIHsgaWYgKCFHYihhKSkge1xuICAgIGZvciAodmFyIGIgPSBbXSwgYyA9IDA7IGMgPCBhcmd1bWVudHMubGVuZ3RoOyBjKyspXG4gICAgICAgIGIucHVzaChIKGFyZ3VtZW50c1tjXSkpO1xuICAgIHJldHVybiBiLmpvaW4oXCIgXCIpO1xufSBjID0gMTsgdmFyIGQgPSBhcmd1bWVudHMsIGUgPSBkLmxlbmd0aDsgYiA9IFN0cmluZyhhKS5yZXBsYWNlKEViLCBmdW5jdGlvbiAoYSkgeyBpZiAoXCIlJVwiID09PSBhKVxuICAgIHJldHVybiBcIiVcIjsgaWYgKGMgPj0gZSlcbiAgICByZXR1cm4gYTsgc3dpdGNoIChhKSB7XG4gICAgY2FzZSBcIiVzXCI6IHJldHVybiBTdHJpbmcoZFtjKytdKTtcbiAgICBjYXNlIFwiJWRcIjogcmV0dXJuIE51bWJlcihkW2MrK10pO1xuICAgIGNhc2UgXCIlalwiOiB0cnkge1xuICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoZFtjKytdKTtcbiAgICB9XG4gICAgY2F0Y2ggKGgpIHtcbiAgICAgICAgcmV0dXJuIFwiW0NpcmN1bGFyXVwiO1xuICAgIH1cbiAgICBkZWZhdWx0OiByZXR1cm4gYTtcbn0gfSk7IGZvciAodmFyIGYgPSBkW2NdOyBjIDwgZTsgZiA9IGRbKytjXSlcbiAgICBiID0gbnVsbCAhPT0gZiAmJiBIYihmKSA/IGIgKyAoXCIgXCIgKyBIKGYpKSA6IGIgKyAoXCIgXCIgKyBmKTsgcmV0dXJuIGI7IH1cbmZ1bmN0aW9uIEliKGEsIGIpIHsgaWYgKEpiKGxhLnByb2Nlc3MpKVxuICAgIHJldHVybiBmdW5jdGlvbiAoKSB7IHJldHVybiBJYihhLCBiKS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9OyBpZiAoITAgPT09IENiLm5vRGVwcmVjYXRpb24pXG4gICAgcmV0dXJuIGE7IHZhciBjID0gITE7IHJldHVybiBmdW5jdGlvbiAoKSB7IGlmICghYykge1xuICAgIGlmIChDYi50aHJvd0RlcHJlY2F0aW9uKVxuICAgICAgICB0aHJvdyBFcnJvcihiKTtcbiAgICBDYi50cmFjZURlcHJlY2F0aW9uID8gY29uc29sZS50cmFjZShiKSA6IGNvbnNvbGUuZXJyb3IoYik7XG4gICAgYyA9ICEwO1xufSByZXR1cm4gYS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9OyB9XG52YXIgS2IgPSB7fSwgTGI7XG5mdW5jdGlvbiBNYihhKSB7IEpiKExiKSAmJiAoTGIgPSBDYi5lbnYuTk9ERV9ERUJVRyB8fCBcIlwiKTsgYSA9IGEudG9VcHBlckNhc2UoKTsgS2JbYV0gfHwgKChuZXcgUmVnRXhwKFwiXFxcXGJcIiArIGEgKyBcIlxcXFxiXCIsIFwiaVwiKSkudGVzdChMYikgPyBLYlthXSA9IGZ1bmN0aW9uICgpIHsgdmFyIGIgPSBGYi5hcHBseShudWxsLCBhcmd1bWVudHMpOyBjb25zb2xlLmVycm9yKFwiJXMgJWQ6ICVzXCIsIGEsIDAsIGIpOyB9IDogS2JbYV0gPSBmdW5jdGlvbiAoKSB7IH0pOyByZXR1cm4gS2JbYV07IH1cbmZ1bmN0aW9uIEgoYSwgYikgeyB2YXIgYyA9IHsgc2VlbjogW10sIHN0eWxpemU6IE5iIH07IDMgPD0gYXJndW1lbnRzLmxlbmd0aCAmJiAoYy5kZXB0aCA9IGFyZ3VtZW50c1syXSk7IDQgPD0gYXJndW1lbnRzLmxlbmd0aCAmJiAoYy5jb2xvcnMgPSBhcmd1bWVudHNbM10pOyBPYihiKSA/IGMuc2hvd0hpZGRlbiA9IGIgOiBiICYmIFBiKGMsIGIpOyBKYihjLnNob3dIaWRkZW4pICYmIChjLnNob3dIaWRkZW4gPSAhMSk7IEpiKGMuZGVwdGgpICYmIChjLmRlcHRoID0gMik7IEpiKGMuY29sb3JzKSAmJiAoYy5jb2xvcnMgPSAhMSk7IEpiKGMuY3VzdG9tSW5zcGVjdCkgJiYgKGMuY3VzdG9tSW5zcGVjdCA9ICEwKTsgYy5jb2xvcnMgJiYgKGMuc3R5bGl6ZSA9IFFiKTsgcmV0dXJuIFJiKGMsIGEsIGMuZGVwdGgpOyB9XG5ILmNvbG9ycyA9IHsgYm9sZDogWzEsIDIyXSwgaXRhbGljOiBbMywgMjNdLCB1bmRlcmxpbmU6IFs0LCAyNF0sIGludmVyc2U6IFs3LCAyN10sIHdoaXRlOiBbMzcsIDM5XSwgZ3JleTogWzkwLCAzOV0sIGJsYWNrOiBbMzAsIDM5XSwgYmx1ZTogWzM0LCAzOV0sIGN5YW46IFszNiwgMzldLCBncmVlbjogWzMyLCAzOV0sIG1hZ2VudGE6IFszNSwgMzldLCByZWQ6IFszMSwgMzldLCB5ZWxsb3c6IFszMywgMzldIH07XG5ILnN0eWxlcyA9IHsgc3BlY2lhbDogXCJjeWFuXCIsIG51bWJlcjogXCJ5ZWxsb3dcIiwgXCJib29sZWFuXCI6IFwieWVsbG93XCIsIHVuZGVmaW5lZDogXCJncmV5XCIsIFwibnVsbFwiOiBcImJvbGRcIiwgc3RyaW5nOiBcImdyZWVuXCIsIGRhdGU6IFwibWFnZW50YVwiLCByZWdleHA6IFwicmVkXCIgfTtcbmZ1bmN0aW9uIFFiKGEsIGIpIHsgcmV0dXJuIChiID0gSC5zdHlsZXNbYl0pID8gXCJcXHUwMDFiW1wiICsgSC5jb2xvcnNbYl1bMF0gKyBcIm1cIiArIGEgKyBcIlxcdTAwMWJbXCIgKyBILmNvbG9yc1tiXVsxXSArIFwibVwiIDogYTsgfVxuZnVuY3Rpb24gTmIoYSkgeyByZXR1cm4gYTsgfVxuZnVuY3Rpb24gU2IoYSkgeyB2YXIgYiA9IHt9OyBhLmZvckVhY2goZnVuY3Rpb24gKGEpIHsgYlthXSA9ICEwOyB9KTsgcmV0dXJuIGI7IH1cbmZ1bmN0aW9uIFJiKGEsIGIsIGMpIHtcbiAgICBpZiAoYS5jdXN0b21JbnNwZWN0ICYmIGIgJiYgVGIoYi5pbnNwZWN0KSAmJiBiLmluc3BlY3QgIT09IEggJiYgKCFiLmNvbnN0cnVjdG9yIHx8IGIuY29uc3RydWN0b3IucHJvdG90eXBlICE9PSBiKSkge1xuICAgICAgICB2YXIgZCA9IGIuaW5zcGVjdChjLCBhKTtcbiAgICAgICAgR2IoZCkgfHwgKGQgPSBSYihhLCBkLCBjKSk7XG4gICAgICAgIHJldHVybiBkO1xuICAgIH1cbiAgICBpZiAoZCA9IFViKGEsIGIpKVxuICAgICAgICByZXR1cm4gZDtcbiAgICB2YXIgZSA9IE9iamVjdC5rZXlzKGIpLCBmID0gU2IoZSk7XG4gICAgYS5zaG93SGlkZGVuICYmIChlID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoYikpO1xuICAgIGlmIChWYihiKSAmJiAoMCA8PSBlLmluZGV4T2YoXCJtZXNzYWdlXCIpIHx8IDAgPD0gZS5pbmRleE9mKFwiZGVzY3JpcHRpb25cIikpKVxuICAgICAgICByZXR1cm4gWmIoYik7XG4gICAgaWYgKDAgPT09IGUubGVuZ3RoKSB7XG4gICAgICAgIGlmIChUYihiKSlcbiAgICAgICAgICAgIHJldHVybiBhLnN0eWxpemUoXCJbRnVuY3Rpb25cIiArIChiLm5hbWUgPyBcIjogXCIgKyBiLm5hbWUgOiBcIlwiKSArIFwiXVwiLCBcInNwZWNpYWxcIik7XG4gICAgICAgIGlmIChhYyhiKSlcbiAgICAgICAgICAgIHJldHVybiBhLnN0eWxpemUoUmVnRXhwLnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGIpLCBcInJlZ2V4cFwiKTtcbiAgICAgICAgaWYgKGJjKGIpKVxuICAgICAgICAgICAgcmV0dXJuIGEuc3R5bGl6ZShEYXRlLnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGIpLCBcImRhdGVcIik7XG4gICAgICAgIGlmIChWYihiKSlcbiAgICAgICAgICAgIHJldHVybiBaYihiKTtcbiAgICB9XG4gICAgZCA9IFwiXCI7XG4gICAgdmFyIGcgPSAhMSwgaCA9IFtcIntcIiwgXCJ9XCJdO1xuICAgIGNjKGIpICYmIChnID0gITAsIGggPSBbXCJbXCIsIFwiXVwiXSk7XG4gICAgVGIoYikgJiYgKGQgPSBcIiBbRnVuY3Rpb25cIiArIChiLm5hbWUgPyBcIjogXCIgKyBiLm5hbWUgOiBcIlwiKSArIFwiXVwiKTtcbiAgICBhYyhiKSAmJiAoZCA9IFwiIFwiICsgUmVnRXhwLnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGIpKTtcbiAgICBiYyhiKSAmJiAoZCA9IFwiIFwiICsgRGF0ZS5wcm90b3R5cGUudG9VVENTdHJpbmcuY2FsbChiKSk7XG4gICAgVmIoYikgJiYgKGQgPSBcIiBcIiArIFpiKGIpKTtcbiAgICBpZiAoMCA9PT0gZS5sZW5ndGggJiYgKCFnIHx8IDAgPT0gYi5sZW5ndGgpKVxuICAgICAgICByZXR1cm4gaFswXSArIGQgKyBoWzFdO1xuICAgIGlmICgwID4gYylcbiAgICAgICAgcmV0dXJuIGFjKGIpID8gYS5zdHlsaXplKFJlZ0V4cC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChiKSwgXCJyZWdleHBcIikgOiBhLnN0eWxpemUoXCJbT2JqZWN0XVwiLCBcInNwZWNpYWxcIik7XG4gICAgYS5zZWVuLnB1c2goYik7XG4gICAgZSA9IGcgP1xuICAgICAgICBkYyhhLCBiLCBjLCBmLCBlKSA6IGUubWFwKGZ1bmN0aW9uIChkKSB7IHJldHVybiBlYyhhLCBiLCBjLCBmLCBkLCBnKTsgfSk7XG4gICAgYS5zZWVuLnBvcCgpO1xuICAgIHJldHVybiBmYyhlLCBkLCBoKTtcbn1cbmZ1bmN0aW9uIFViKGEsIGIpIHsgaWYgKEpiKGIpKVxuICAgIHJldHVybiBhLnN0eWxpemUoXCJ1bmRlZmluZWRcIiwgXCJ1bmRlZmluZWRcIik7IGlmIChHYihiKSlcbiAgICByZXR1cm4gYiA9IFwiJ1wiICsgSlNPTi5zdHJpbmdpZnkoYikucmVwbGFjZSgvXlwifFwiJC9nLCBcIlwiKS5yZXBsYWNlKC8nL2csIFwiXFxcXCdcIikucmVwbGFjZSgvXFxcXFwiL2csICdcIicpICsgXCInXCIsIGEuc3R5bGl6ZShiLCBcInN0cmluZ1wiKTsgaWYgKGdjKGIpKVxuICAgIHJldHVybiBhLnN0eWxpemUoXCJcIiArIGIsIFwibnVtYmVyXCIpOyBpZiAoT2IoYikpXG4gICAgcmV0dXJuIGEuc3R5bGl6ZShcIlwiICsgYiwgXCJib29sZWFuXCIpOyBpZiAobnVsbCA9PT0gYilcbiAgICByZXR1cm4gYS5zdHlsaXplKFwibnVsbFwiLCBcIm51bGxcIik7IH1cbmZ1bmN0aW9uIFpiKGEpIHsgcmV0dXJuIFwiW1wiICsgRXJyb3IucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYSkgKyBcIl1cIjsgfVxuZnVuY3Rpb24gZGMoYSwgYiwgYywgZCwgZSkgeyBmb3IgKHZhciBmID0gW10sIGcgPSAwLCBoID0gYi5sZW5ndGg7IGcgPCBoOyArK2cpXG4gICAgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGIsIFN0cmluZyhnKSkgPyBmLnB1c2goZWMoYSwgYiwgYywgZCwgU3RyaW5nKGcpLCAhMCkpIDogZi5wdXNoKFwiXCIpOyBlLmZvckVhY2goZnVuY3Rpb24gKGUpIHsgZS5tYXRjaCgvXlxcZCskLykgfHwgZi5wdXNoKGVjKGEsIGIsIGMsIGQsIGUsICEwKSk7IH0pOyByZXR1cm4gZjsgfVxuZnVuY3Rpb24gZWMoYSwgYiwgYywgZCwgZSwgZikge1xuICAgIHZhciBnLCBoO1xuICAgIGIgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGIsIGUpIHx8IHsgdmFsdWU6IGJbZV0gfTtcbiAgICBiLmdldCA/IGggPSBiLnNldCA/IGEuc3R5bGl6ZShcIltHZXR0ZXIvU2V0dGVyXVwiLCBcInNwZWNpYWxcIikgOiBhLnN0eWxpemUoXCJbR2V0dGVyXVwiLCBcInNwZWNpYWxcIikgOiBiLnNldCAmJiAoaCA9IGEuc3R5bGl6ZShcIltTZXR0ZXJdXCIsIFwic3BlY2lhbFwiKSk7XG4gICAgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGQsIGUpIHx8IChnID0gXCJbXCIgKyBlICsgXCJdXCIpO1xuICAgIGggfHwgKDAgPiBhLnNlZW4uaW5kZXhPZihiLnZhbHVlKSA/IChoID0gbnVsbCA9PT0gYyA/IFJiKGEsIGIudmFsdWUsIG51bGwpIDogUmIoYSwgYi52YWx1ZSwgYyAtIDEpLCAtMSA8IGguaW5kZXhPZihcIlxcblwiKSAmJiAoaCA9IGYgPyBoLnNwbGl0KFwiXFxuXCIpLm1hcChmdW5jdGlvbiAoYSkgeyByZXR1cm4gXCIgIFwiICsgYTsgfSkuam9pbihcIlxcblwiKS5zdWJzdHIoMikgOiBcIlxcblwiICsgaC5zcGxpdChcIlxcblwiKS5tYXAoZnVuY3Rpb24gKGEpIHsgcmV0dXJuIFwiICAgXCIgKyBhOyB9KS5qb2luKFwiXFxuXCIpKSkgOlxuICAgICAgICBoID0gYS5zdHlsaXplKFwiW0NpcmN1bGFyXVwiLCBcInNwZWNpYWxcIikpO1xuICAgIGlmIChKYihnKSkge1xuICAgICAgICBpZiAoZiAmJiBlLm1hdGNoKC9eXFxkKyQvKSlcbiAgICAgICAgICAgIHJldHVybiBoO1xuICAgICAgICBnID0gSlNPTi5zdHJpbmdpZnkoXCJcIiArIGUpO1xuICAgICAgICBnLm1hdGNoKC9eXCIoW2EtekEtWl9dW2EtekEtWl8wLTldKilcIiQvKSA/IChnID0gZy5zdWJzdHIoMSwgZy5sZW5ndGggLSAyKSwgZyA9IGEuc3R5bGl6ZShnLCBcIm5hbWVcIikpIDogKGcgPSBnLnJlcGxhY2UoLycvZywgXCJcXFxcJ1wiKS5yZXBsYWNlKC9cXFxcXCIvZywgJ1wiJykucmVwbGFjZSgvKF5cInxcIiQpL2csIFwiJ1wiKSwgZyA9IGEuc3R5bGl6ZShnLCBcInN0cmluZ1wiKSk7XG4gICAgfVxuICAgIHJldHVybiBnICsgXCI6IFwiICsgaDtcbn1cbmZ1bmN0aW9uIGZjKGEsIGIsIGMpIHsgcmV0dXJuIDYwIDwgYS5yZWR1Y2UoZnVuY3Rpb24gKGEsIGIpIHsgYi5pbmRleE9mKFwiXFxuXCIpOyByZXR1cm4gYSArIGIucmVwbGFjZSgvXFx1MDAxYlxcW1xcZFxcZD9tL2csIFwiXCIpLmxlbmd0aCArIDE7IH0sIDApID8gY1swXSArIChcIlwiID09PSBiID8gXCJcIiA6IGIgKyBcIlxcbiBcIikgKyBcIiBcIiArIGEuam9pbihcIixcXG4gIFwiKSArIFwiIFwiICsgY1sxXSA6IGNbMF0gKyBiICsgXCIgXCIgKyBhLmpvaW4oXCIsIFwiKSArIFwiIFwiICsgY1sxXTsgfVxuZnVuY3Rpb24gY2MoYSkgeyByZXR1cm4gQXJyYXkuaXNBcnJheShhKTsgfVxuZnVuY3Rpb24gT2IoYSkgeyByZXR1cm4gXCJib29sZWFuXCIgPT09IHR5cGVvZiBhOyB9XG5mdW5jdGlvbiBnYyhhKSB7IHJldHVybiBcIm51bWJlclwiID09PSB0eXBlb2YgYTsgfVxuZnVuY3Rpb24gR2IoYSkgeyByZXR1cm4gXCJzdHJpbmdcIiA9PT0gdHlwZW9mIGE7IH1cbmZ1bmN0aW9uIEpiKGEpIHsgcmV0dXJuIHZvaWQgMCA9PT0gYTsgfVxuZnVuY3Rpb24gYWMoYSkgeyByZXR1cm4gSGIoYSkgJiYgXCJbb2JqZWN0IFJlZ0V4cF1cIiA9PT0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGEpOyB9XG5mdW5jdGlvbiBIYihhKSB7IHJldHVybiBcIm9iamVjdFwiID09PSB0eXBlb2YgYSAmJiBudWxsICE9PSBhOyB9XG5mdW5jdGlvbiBiYyhhKSB7IHJldHVybiBIYihhKSAmJiBcIltvYmplY3QgRGF0ZV1cIiA9PT0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGEpOyB9XG5mdW5jdGlvbiBWYihhKSB7IHJldHVybiBIYihhKSAmJiAoXCJbb2JqZWN0IEVycm9yXVwiID09PSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYSkgfHwgYSBpbnN0YW5jZW9mIEVycm9yKTsgfVxuZnVuY3Rpb24gVGIoYSkgeyByZXR1cm4gXCJmdW5jdGlvblwiID09PSB0eXBlb2YgYTsgfVxuZnVuY3Rpb24gaGMoYSkgeyByZXR1cm4gbnVsbCA9PT0gYSB8fCBcImJvb2xlYW5cIiA9PT0gdHlwZW9mIGEgfHwgXCJudW1iZXJcIiA9PT0gdHlwZW9mIGEgfHwgXCJzdHJpbmdcIiA9PT0gdHlwZW9mIGEgfHwgXCJzeW1ib2xcIiA9PT0gdHlwZW9mIGEgfHwgXCJ1bmRlZmluZWRcIiA9PT0gdHlwZW9mIGE7IH1cbmZ1bmN0aW9uIGljKGEpIHsgcmV0dXJuIDEwID4gYSA/IFwiMFwiICsgYS50b1N0cmluZygxMCkgOiBhLnRvU3RyaW5nKDEwKTsgfVxudmFyIGpjID0gXCJKYW4gRmViIE1hciBBcHIgTWF5IEp1biBKdWwgQXVnIFNlcCBPY3QgTm92IERlY1wiLnNwbGl0KFwiIFwiKTtcbmZ1bmN0aW9uIGtjKCkgeyB2YXIgYSA9IG5ldyBEYXRlLCBiID0gW2ljKGEuZ2V0SG91cnMoKSksIGljKGEuZ2V0TWludXRlcygpKSwgaWMoYS5nZXRTZWNvbmRzKCkpXS5qb2luKFwiOlwiKTsgcmV0dXJuIFthLmdldERhdGUoKSwgamNbYS5nZXRNb250aCgpXSwgYl0uam9pbihcIiBcIik7IH1cbmZ1bmN0aW9uIFBiKGEsIGIpIHsgaWYgKCFiIHx8ICFIYihiKSlcbiAgICByZXR1cm4gYTsgZm9yICh2YXIgYyA9IE9iamVjdC5rZXlzKGIpLCBkID0gYy5sZW5ndGg7IGQtLTspXG4gICAgYVtjW2RdXSA9IGJbY1tkXV07IHJldHVybiBhOyB9XG52YXIgbGMgPSB7IGluaGVyaXRzOiBEYiwgX2V4dGVuZDogUGIsIGxvZzogZnVuY3Rpb24gKCkgeyBjb25zb2xlLmxvZyhcIiVzIC0gJXNcIiwga2MoKSwgRmIuYXBwbHkobnVsbCwgYXJndW1lbnRzKSk7IH0sIGlzQnVmZmVyOiBmdW5jdGlvbiAoYSkgeyByZXR1cm4gTmEoYSk7IH0sIGlzUHJpbWl0aXZlOiBoYywgaXNGdW5jdGlvbjogVGIsIGlzRXJyb3I6IFZiLCBpc0RhdGU6IGJjLCBpc09iamVjdDogSGIsIGlzUmVnRXhwOiBhYywgaXNVbmRlZmluZWQ6IEpiLCBpc1N5bWJvbDogZnVuY3Rpb24gKGEpIHsgcmV0dXJuIFwic3ltYm9sXCIgPT09IHR5cGVvZiBhOyB9LCBpc1N0cmluZzogR2IsIGlzTnVtYmVyOiBnYywgaXNOdWxsT3JVbmRlZmluZWQ6IGZ1bmN0aW9uIChhKSB7IHJldHVybiBudWxsID09IGE7IH0sIGlzTnVsbDogZnVuY3Rpb24gKGEpIHsgcmV0dXJuIG51bGwgPT09IGE7IH0sIGlzQm9vbGVhbjogT2IsIGlzQXJyYXk6IGNjLCBpbnNwZWN0OiBILCBkZXByZWNhdGU6IEliLCBmb3JtYXQ6IEZiLCBkZWJ1Z2xvZzogTWIgfTtcbmZ1bmN0aW9uIG1jKGEsIGIpIHsgaWYgKGEgPT09IGIpXG4gICAgcmV0dXJuIDA7IGZvciAodmFyIGMgPSBhLmxlbmd0aCwgZCA9IGIubGVuZ3RoLCBlID0gMCwgZiA9IE1hdGgubWluKGMsIGQpOyBlIDwgZjsgKytlKVxuICAgIGlmIChhW2VdICE9PSBiW2VdKSB7XG4gICAgICAgIGMgPSBhW2VdO1xuICAgICAgICBkID0gYltlXTtcbiAgICAgICAgYnJlYWs7XG4gICAgfSByZXR1cm4gYyA8IGQgPyAtMSA6IGQgPCBjID8gMSA6IDA7IH1cbnZhciBuYyA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHksIG9jID0gT2JqZWN0LmtleXMgfHwgZnVuY3Rpb24gKGEpIHsgdmFyIGIgPSBbXSwgYzsgZm9yIChjIGluIGEpXG4gICAgbmMuY2FsbChhLCBjKSAmJiBiLnB1c2goYyk7IHJldHVybiBiOyB9LCBwYyA9IEFycmF5LnByb3RvdHlwZS5zbGljZSwgcWM7XG5mdW5jdGlvbiByYygpIHsgcmV0dXJuIFwidW5kZWZpbmVkXCIgIT09IHR5cGVvZiBxYyA/IHFjIDogcWMgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBcImZvb1wiID09PSBmdW5jdGlvbiAoKSB7IH0ubmFtZTsgfSgpOyB9XG5mdW5jdGlvbiBzYyhhKSB7IHJldHVybiBOYShhKSB8fCBcImZ1bmN0aW9uXCIgIT09IHR5cGVvZiBsYS5BcnJheUJ1ZmZlciA/ICExIDogXCJmdW5jdGlvblwiID09PSB0eXBlb2YgQXJyYXlCdWZmZXIuaXNWaWV3ID8gQXJyYXlCdWZmZXIuaXNWaWV3KGEpIDogYSA/IGEgaW5zdGFuY2VvZiBEYXRhVmlldyB8fCBhLmJ1ZmZlciAmJiBhLmJ1ZmZlciBpbnN0YW5jZW9mIEFycmF5QnVmZmVyID8gITAgOiAhMSA6ICExOyB9XG5mdW5jdGlvbiBJKGEsIGIpIHsgYSB8fCBKKGEsICEwLCBiLCBcIj09XCIsIHRjKTsgfVxudmFyIHVjID0gL1xccypmdW5jdGlvblxccysoW15cXChcXHNdKilcXHMqLztcbmZ1bmN0aW9uIHZjKGEpIHsgaWYgKFRiKGEpKVxuICAgIHJldHVybiByYygpID8gYS5uYW1lIDogKGEgPSBhLnRvU3RyaW5nKCkubWF0Y2godWMpKSAmJiBhWzFdOyB9XG5JLkFzc2VydGlvbkVycm9yID0gd2M7XG5mdW5jdGlvbiB3YyhhKSB7IHRoaXMubmFtZSA9IFwiQXNzZXJ0aW9uRXJyb3JcIjsgdGhpcy5hY3R1YWwgPSBhLmFjdHVhbDsgdGhpcy5leHBlY3RlZCA9IGEuZXhwZWN0ZWQ7IHRoaXMub3BlcmF0b3IgPSBhLm9wZXJhdG9yOyBhLm1lc3NhZ2UgPyAodGhpcy5tZXNzYWdlID0gYS5tZXNzYWdlLCB0aGlzLmdlbmVyYXRlZE1lc3NhZ2UgPSAhMSkgOiAodGhpcy5tZXNzYWdlID0geGMoeWModGhpcy5hY3R1YWwpLCAxMjgpICsgXCIgXCIgKyB0aGlzLm9wZXJhdG9yICsgXCIgXCIgKyB4Yyh5Yyh0aGlzLmV4cGVjdGVkKSwgMTI4KSwgdGhpcy5nZW5lcmF0ZWRNZXNzYWdlID0gITApOyB2YXIgYiA9IGEuc3RhY2tTdGFydEZ1bmN0aW9uIHx8IEo7IEVycm9yLmNhcHR1cmVTdGFja1RyYWNlID8gRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UodGhpcywgYikgOiAoYSA9IEVycm9yKCksIGEuc3RhY2sgJiYgKGEgPSBhLnN0YWNrLCBiID0gdmMoYiksIGIgPSBhLmluZGV4T2YoXCJcXG5cIiArIGIpLCAwIDw9IGIgJiYgKGIgPSBhLmluZGV4T2YoXCJcXG5cIiwgYiArIDEpLCBhID0gYS5zdWJzdHJpbmcoYiArIDEpKSwgdGhpcy5zdGFjayA9IGEpKTsgfVxuRGIod2MsIEVycm9yKTtcbmZ1bmN0aW9uIHhjKGEsIGIpIHsgcmV0dXJuIFwic3RyaW5nXCIgPT09IHR5cGVvZiBhID8gYS5sZW5ndGggPCBiID8gYSA6IGEuc2xpY2UoMCwgYikgOiBhOyB9XG5mdW5jdGlvbiB5YyhhKSB7IGlmIChyYygpIHx8ICFUYihhKSlcbiAgICByZXR1cm4gSChhKTsgYSA9IHZjKGEpOyByZXR1cm4gXCJbRnVuY3Rpb25cIiArIChhID8gXCI6IFwiICsgYSA6IFwiXCIpICsgXCJdXCI7IH1cbmZ1bmN0aW9uIEooYSwgYiwgYywgZCwgZSkgeyB0aHJvdyBuZXcgd2MoeyBtZXNzYWdlOiBjLCBhY3R1YWw6IGEsIGV4cGVjdGVkOiBiLCBvcGVyYXRvcjogZCwgc3RhY2tTdGFydEZ1bmN0aW9uOiBlIH0pOyB9XG5JLmZhaWwgPSBKO1xuZnVuY3Rpb24gdGMoYSwgYikgeyBhIHx8IEooYSwgITAsIGIsIFwiPT1cIiwgdGMpOyB9XG5JLm9rID0gdGM7XG5JLmVxdWFsID0gemM7XG5mdW5jdGlvbiB6YyhhLCBiLCBjKSB7IGEgIT0gYiAmJiBKKGEsIGIsIGMsIFwiPT1cIiwgemMpOyB9XG5JLm5vdEVxdWFsID0gQWM7XG5mdW5jdGlvbiBBYyhhLCBiLCBjKSB7IGEgPT0gYiAmJiBKKGEsIGIsIGMsIFwiIT1cIiwgQWMpOyB9XG5JLmRlZXBFcXVhbCA9IEJjO1xuZnVuY3Rpb24gQmMoYSwgYiwgYykgeyBDYyhhLCBiLCAhMSkgfHwgSihhLCBiLCBjLCBcImRlZXBFcXVhbFwiLCBCYyk7IH1cbkkuZGVlcFN0cmljdEVxdWFsID0gRGM7XG5mdW5jdGlvbiBEYyhhLCBiLCBjKSB7IENjKGEsIGIsICEwKSB8fCBKKGEsIGIsIGMsIFwiZGVlcFN0cmljdEVxdWFsXCIsIERjKTsgfVxuZnVuY3Rpb24gQ2MoYSwgYiwgYywgZCkge1xuICAgIGlmIChhID09PSBiKVxuICAgICAgICByZXR1cm4gITA7XG4gICAgaWYgKE5hKGEpICYmIE5hKGIpKVxuICAgICAgICByZXR1cm4gMCA9PT0gbWMoYSwgYik7XG4gICAgaWYgKGJjKGEpICYmIGJjKGIpKVxuICAgICAgICByZXR1cm4gYS5nZXRUaW1lKCkgPT09IGIuZ2V0VGltZSgpO1xuICAgIGlmIChhYyhhKSAmJiBhYyhiKSlcbiAgICAgICAgcmV0dXJuIGEuc291cmNlID09PSBiLnNvdXJjZSAmJiBhLmdsb2JhbCA9PT0gYi5nbG9iYWwgJiYgYS5tdWx0aWxpbmUgPT09IGIubXVsdGlsaW5lICYmIGEubGFzdEluZGV4ID09PSBiLmxhc3RJbmRleCAmJiBhLmlnbm9yZUNhc2UgPT09IGIuaWdub3JlQ2FzZTtcbiAgICBpZiAobnVsbCAhPT0gYSAmJiBcIm9iamVjdFwiID09PSB0eXBlb2YgYSB8fCBudWxsICE9PSBiICYmIFwib2JqZWN0XCIgPT09IHR5cGVvZiBiKSB7XG4gICAgICAgIGlmICghc2MoYSkgfHwgIXNjKGIpIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChhKSAhPT0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGIpIHx8IGEgaW5zdGFuY2VvZiBGbG9hdDMyQXJyYXkgfHwgYSBpbnN0YW5jZW9mIEZsb2F0NjRBcnJheSkge1xuICAgICAgICAgICAgaWYgKE5hKGEpICE9PSBOYShiKSlcbiAgICAgICAgICAgICAgICByZXR1cm4gITE7XG4gICAgICAgICAgICBkID0gZCB8fCB7IGFjdHVhbDogW10sIGV4cGVjdGVkOiBbXSB9O1xuICAgICAgICAgICAgdmFyIGUgPSBkLmFjdHVhbC5pbmRleE9mKGEpO1xuICAgICAgICAgICAgaWYgKC0xICE9PSBlICYmIGUgPT09IGQuZXhwZWN0ZWQuaW5kZXhPZihiKSlcbiAgICAgICAgICAgICAgICByZXR1cm4gITA7XG4gICAgICAgICAgICBkLmFjdHVhbC5wdXNoKGEpO1xuICAgICAgICAgICAgZC5leHBlY3RlZC5wdXNoKGIpO1xuICAgICAgICAgICAgcmV0dXJuIEVjKGEsIGIsIGMsIGQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAwID09PSBtYyhuZXcgVWludDhBcnJheShhLmJ1ZmZlciksIG5ldyBVaW50OEFycmF5KGIuYnVmZmVyKSk7XG4gICAgfVxuICAgIHJldHVybiBjID8gYSA9PT0gYiA6IGEgPT0gYjtcbn1cbmZ1bmN0aW9uIEZjKGEpIHsgcmV0dXJuIFwiW29iamVjdCBBcmd1bWVudHNdXCIgPT0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGEpOyB9XG5mdW5jdGlvbiBFYyhhLCBiLCBjLCBkKSB7IGlmIChudWxsID09PSBhIHx8IHZvaWQgMCA9PT0gYSB8fCBudWxsID09PSBiIHx8IHZvaWQgMCA9PT0gYilcbiAgICByZXR1cm4gITE7IGlmIChoYyhhKSB8fCBoYyhiKSlcbiAgICByZXR1cm4gYSA9PT0gYjsgaWYgKGMgJiYgT2JqZWN0LmdldFByb3RvdHlwZU9mKGEpICE9PSBPYmplY3QuZ2V0UHJvdG90eXBlT2YoYikpXG4gICAgcmV0dXJuICExOyB2YXIgZSA9IEZjKGEpLCBmID0gRmMoYik7IGlmIChlICYmICFmIHx8ICFlICYmIGYpXG4gICAgcmV0dXJuICExOyBpZiAoZSlcbiAgICByZXR1cm4gYSA9IHBjLmNhbGwoYSksIGIgPSBwYy5jYWxsKGIpLCBDYyhhLCBiLCBjKTsgZSA9IG9jKGEpOyB2YXIgZyA9IG9jKGIpOyBpZiAoZS5sZW5ndGggIT09IGcubGVuZ3RoKVxuICAgIHJldHVybiAhMTsgZS5zb3J0KCk7IGcuc29ydCgpOyBmb3IgKGYgPSBlLmxlbmd0aCAtIDE7IDAgPD0gZjsgZi0tKVxuICAgIGlmIChlW2ZdICE9PSBnW2ZdKVxuICAgICAgICByZXR1cm4gITE7IGZvciAoZiA9IGUubGVuZ3RoIC0gMTsgMCA8PSBmOyBmLS0pXG4gICAgaWYgKGcgPSBlW2ZdLCAhQ2MoYVtnXSwgYltnXSwgYywgZCkpXG4gICAgICAgIHJldHVybiAhMTsgcmV0dXJuICEwOyB9XG5JLm5vdERlZXBFcXVhbCA9IEdjO1xuZnVuY3Rpb24gR2MoYSwgYiwgYykgeyBDYyhhLCBiLCAhMSkgJiYgSihhLCBiLCBjLCBcIm5vdERlZXBFcXVhbFwiLCBHYyk7IH1cbkkubm90RGVlcFN0cmljdEVxdWFsID0gSGM7XG5mdW5jdGlvbiBIYyhhLCBiLCBjKSB7IENjKGEsIGIsICEwKSAmJiBKKGEsIGIsIGMsIFwibm90RGVlcFN0cmljdEVxdWFsXCIsIEhjKTsgfVxuSS5zdHJpY3RFcXVhbCA9IEljO1xuZnVuY3Rpb24gSWMoYSwgYiwgYykgeyBhICE9PSBiICYmIEooYSwgYiwgYywgXCI9PT1cIiwgSWMpOyB9XG5JLm5vdFN0cmljdEVxdWFsID0gSmM7XG5mdW5jdGlvbiBKYyhhLCBiLCBjKSB7IGEgPT09IGIgJiYgSihhLCBiLCBjLCBcIiE9PVwiLCBKYyk7IH1cbmZ1bmN0aW9uIEtjKGEsIGIpIHsgaWYgKCFhIHx8ICFiKVxuICAgIHJldHVybiAhMTsgaWYgKFwiW29iamVjdCBSZWdFeHBdXCIgPT0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGIpKVxuICAgIHJldHVybiBiLnRlc3QoYSk7IHRyeSB7XG4gICAgaWYgKGEgaW5zdGFuY2VvZiBiKVxuICAgICAgICByZXR1cm4gITA7XG59XG5jYXRjaCAoYykgeyB9IHJldHVybiBFcnJvci5pc1Byb3RvdHlwZU9mKGIpID8gITEgOiAhMCA9PT0gYi5jYWxsKHt9LCBhKTsgfVxuZnVuY3Rpb24gTGMoYSwgYiwgYywgZCkgeyBpZiAoXCJmdW5jdGlvblwiICE9PSB0eXBlb2YgYilcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdcImJsb2NrXCIgYXJndW1lbnQgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7IFwic3RyaW5nXCIgPT09IHR5cGVvZiBjICYmIChkID0gYywgYyA9IG51bGwpOyB0cnkge1xuICAgIGIoKTtcbn1cbmNhdGNoIChoKSB7XG4gICAgdmFyIGUgPSBoO1xufSBiID0gZTsgZCA9IChjICYmIGMubmFtZSA/IFwiIChcIiArIGMubmFtZSArIFwiKS5cIiA6IFwiLlwiKSArIChkID8gXCIgXCIgKyBkIDogXCIuXCIpOyBhICYmICFiICYmIEooYiwgYywgXCJNaXNzaW5nIGV4cGVjdGVkIGV4Y2VwdGlvblwiICsgZCk7IGUgPSBcInN0cmluZ1wiID09PSB0eXBlb2YgZDsgdmFyIGYgPSAhYSAmJiBWYihiKSwgZyA9ICFhICYmIGIgJiYgIWM7IChmICYmIGUgJiYgS2MoYiwgYykgfHwgZykgJiYgSihiLCBjLCBcIkdvdCB1bndhbnRlZCBleGNlcHRpb25cIiArIGQpOyBpZiAoYSAmJiBiICYmIGMgJiYgIUtjKGIsIGMpIHx8ICFhICYmIGIpXG4gICAgdGhyb3cgYjsgfVxuSS50aHJvd3MgPSBNYztcbmZ1bmN0aW9uIE1jKGEsIGIsIGMpIHsgTGMoITAsIGEsIGIsIGMpOyB9XG5JLmRvZXNOb3RUaHJvdyA9IE5jO1xuZnVuY3Rpb24gTmMoYSwgYiwgYykgeyBMYyghMSwgYSwgYiwgYyk7IH1cbkkuaWZFcnJvciA9IE9jO1xuZnVuY3Rpb24gT2MoYSkgeyBpZiAoYSlcbiAgICB0aHJvdyBhOyB9XG52YXIgUGMgPSB1KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgZnVuY3Rpb24gYyhhKSB7IHJldHVybiBmdW5jdGlvbiAoYSkgeyBmdW5jdGlvbiBiKGIpIHsgZm9yICh2YXIgYyA9IFtdLCBlID0gMTsgZSA8IGFyZ3VtZW50cy5sZW5ndGg7IGUrKylcbiAgICAgICAgY1tlIC0gMV0gPSBhcmd1bWVudHNbZV07IGMgPSBhLmNhbGwodGhpcywgZChiLCBjKSkgfHwgdGhpczsgYy5jb2RlID0gYjsgY1toXSA9IGI7IGMubmFtZSA9IGEucHJvdG90eXBlLm5hbWUgKyBcIiBbXCIgKyBjW2hdICsgXCJdXCI7IHJldHVybiBjOyB9IGcoYiwgYSk7IHJldHVybiBiOyB9KGEpOyB9XG4gICAgZnVuY3Rpb24gZChhLCBiKSB7IEkuc3RyaWN0RXF1YWwodHlwZW9mIGEsIFwic3RyaW5nXCIpOyB2YXIgYyA9IGtbYV07IEkoYywgXCJBbiBpbnZhbGlkIGVycm9yIG1lc3NhZ2Uga2V5IHdhcyB1c2VkOiBcIiArIGEgKyBcIi5cIik7IGlmIChcImZ1bmN0aW9uXCIgPT09IHR5cGVvZiBjKVxuICAgICAgICBhID0gYztcbiAgICBlbHNlIHtcbiAgICAgICAgYSA9IGxjLmZvcm1hdDtcbiAgICAgICAgaWYgKHZvaWQgMCA9PT0gYiB8fCAwID09PSBiLmxlbmd0aClcbiAgICAgICAgICAgIHJldHVybiBjO1xuICAgICAgICBiLnVuc2hpZnQoYyk7XG4gICAgfSByZXR1cm4gU3RyaW5nKGEuYXBwbHkobnVsbCwgYikpOyB9XG4gICAgZnVuY3Rpb24gZShhLCBiKSB7XG4gICAgICAgIGtbYV0gPVxuICAgICAgICAgICAgXCJmdW5jdGlvblwiID09PSB0eXBlb2YgYiA/IGIgOiBTdHJpbmcoYik7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGYoYSwgYikgeyBJKGEsIFwiZXhwZWN0ZWQgaXMgcmVxdWlyZWRcIik7IEkoXCJzdHJpbmdcIiA9PT0gdHlwZW9mIGIsIFwidGhpbmcgaXMgcmVxdWlyZWRcIik7IGlmIChBcnJheS5pc0FycmF5KGEpKSB7XG4gICAgICAgIHZhciBjID0gYS5sZW5ndGg7XG4gICAgICAgIEkoMCA8IGMsIFwiQXQgbGVhc3Qgb25lIGV4cGVjdGVkIHZhbHVlIG5lZWRzIHRvIGJlIHNwZWNpZmllZFwiKTtcbiAgICAgICAgYSA9IGEubWFwKGZ1bmN0aW9uIChhKSB7IHJldHVybiBTdHJpbmcoYSk7IH0pO1xuICAgICAgICByZXR1cm4gMiA8IGMgPyBcIm9uZSBvZiBcIiArIGIgKyBcIiBcIiArIGEuc2xpY2UoMCwgYyAtIDEpLmpvaW4oXCIsIFwiKSArIFwiLCBvciBcIiArIGFbYyAtIDFdIDogMiA9PT0gYyA/IFwib25lIG9mIFwiICsgYiArIFwiIFwiICsgYVswXSArIFwiIG9yIFwiICsgYVsxXSA6IFwib2YgXCIgKyBiICsgXCIgXCIgKyBhWzBdO1xuICAgIH0gcmV0dXJuIFwib2YgXCIgKyBiICsgXCIgXCIgKyBTdHJpbmcoYSk7IH1cbiAgICB2YXIgZyA9IGwgJiYgbC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKCkge1xuICAgICAgICBmdW5jdGlvbiBhKGIsIGMpIHtcbiAgICAgICAgICAgIGEgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZlxuICAgICAgICAgICAgICAgIEFycmF5ICYmIGZ1bmN0aW9uIChhLCBiKSB7IGEuX19wcm90b19fID0gYjsgfSB8fCBmdW5jdGlvbiAoYSwgYikgeyBmb3IgKHZhciBjIGluIGIpXG4gICAgICAgICAgICAgICAgYi5oYXNPd25Qcm9wZXJ0eShjKSAmJiAoYVtjXSA9IGJbY10pOyB9O1xuICAgICAgICAgICAgcmV0dXJuIGEoYiwgYyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChiLCBjKSB7IGZ1bmN0aW9uIGQoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBiOyB9IGEoYiwgYyk7IGIucHJvdG90eXBlID0gbnVsbCA9PT0gYyA/IE9iamVjdC5jcmVhdGUoYykgOiAoZC5wcm90b3R5cGUgPSBjLnByb3RvdHlwZSwgbmV3IGQpOyB9O1xuICAgIH0oKTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoYiwgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6ICEwIH0pO1xuICAgIHZhciBoID0gXCJ1bmRlZmluZWRcIiA9PT0gdHlwZW9mIFN5bWJvbCA/IFwiX2tDb2RlXCIgOiBTeW1ib2woXCJjb2RlXCIpLCBrID0ge307XG4gICAgYSA9IGZ1bmN0aW9uIChhKSB7XG4gICAgICAgIGZ1bmN0aW9uIGMoYykge1xuICAgICAgICAgICAgaWYgKFwib2JqZWN0XCIgIT09IHR5cGVvZiBjIHx8IG51bGwgPT09IGMpXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IGIuVHlwZUVycm9yKFwiRVJSX0lOVkFMSURfQVJHX1RZUEVcIiwgXCJvcHRpb25zXCIsIFwib2JqZWN0XCIpO1xuICAgICAgICAgICAgdmFyIGQgPSBjLm1lc3NhZ2UgP1xuICAgICAgICAgICAgICAgIGEuY2FsbCh0aGlzLCBjLm1lc3NhZ2UpIHx8IHRoaXMgOiBhLmNhbGwodGhpcywgbGMuaW5zcGVjdChjLmFjdHVhbCkuc2xpY2UoMCwgMTI4KSArIFwiIFwiICsgKGMub3BlcmF0b3IgKyBcIiBcIiArIGxjLmluc3BlY3QoYy5leHBlY3RlZCkuc2xpY2UoMCwgMTI4KSkpIHx8IHRoaXM7XG4gICAgICAgICAgICBkLmdlbmVyYXRlZE1lc3NhZ2UgPSAhYy5tZXNzYWdlO1xuICAgICAgICAgICAgZC5uYW1lID0gXCJBc3NlcnRpb25FcnJvciBbRVJSX0FTU0VSVElPTl1cIjtcbiAgICAgICAgICAgIGQuY29kZSA9IFwiRVJSX0FTU0VSVElPTlwiO1xuICAgICAgICAgICAgZC5hY3R1YWwgPSBjLmFjdHVhbDtcbiAgICAgICAgICAgIGQuZXhwZWN0ZWQgPSBjLmV4cGVjdGVkO1xuICAgICAgICAgICAgZC5vcGVyYXRvciA9IGMub3BlcmF0b3I7XG4gICAgICAgICAgICBiLkVycm9yLmNhcHR1cmVTdGFja1RyYWNlKGQsIGMuc3RhY2tTdGFydEZ1bmN0aW9uKTtcbiAgICAgICAgICAgIHJldHVybiBkO1xuICAgICAgICB9XG4gICAgICAgIGcoYywgYSk7XG4gICAgICAgIHJldHVybiBjO1xuICAgIH0obC5FcnJvcik7XG4gICAgYi5Bc3NlcnRpb25FcnJvciA9IGE7XG4gICAgYi5tZXNzYWdlID0gZDtcbiAgICBiLkUgPSBlO1xuICAgIGIuRXJyb3IgPSBjKGwuRXJyb3IpO1xuICAgIGIuVHlwZUVycm9yID0gYyhsLlR5cGVFcnJvcik7XG4gICAgYi5SYW5nZUVycm9yID0gYyhsLlJhbmdlRXJyb3IpO1xuICAgIGUoXCJFUlJfQVJHX05PVF9JVEVSQUJMRVwiLCBcIiVzIG11c3QgYmUgaXRlcmFibGVcIik7XG4gICAgZShcIkVSUl9BU1NFUlRJT05cIiwgXCIlc1wiKTtcbiAgICBlKFwiRVJSX0JVRkZFUl9PVVRfT0ZfQk9VTkRTXCIsIGZ1bmN0aW9uIChhLCBiKSB7IHJldHVybiBiID8gXCJBdHRlbXB0IHRvIHdyaXRlIG91dHNpZGUgYnVmZmVyIGJvdW5kc1wiIDogJ1wiJyArIGEgKyAnXCIgaXMgb3V0c2lkZSBvZiBidWZmZXIgYm91bmRzJzsgfSk7XG4gICAgZShcIkVSUl9DSElMRF9DTE9TRURfQkVGT1JFX1JFUExZXCIsIFwiQ2hpbGQgY2xvc2VkIGJlZm9yZSByZXBseSByZWNlaXZlZFwiKTtcbiAgICBlKFwiRVJSX0NPTlNPTEVfV1JJVEFCTEVfU1RSRUFNXCIsIFwiQ29uc29sZSBleHBlY3RzIGEgd3JpdGFibGUgc3RyZWFtIGluc3RhbmNlIGZvciAlc1wiKTtcbiAgICBlKFwiRVJSX0NQVV9VU0FHRVwiLCBcIlVuYWJsZSB0byBvYnRhaW4gY3B1IHVzYWdlICVzXCIpO1xuICAgIGUoXCJFUlJfRE5TX1NFVF9TRVJWRVJTX0ZBSUxFRFwiLCBmdW5jdGlvbiAoYSwgYikgeyByZXR1cm4gJ2MtYXJlcyBmYWlsZWQgdG8gc2V0IHNlcnZlcnM6IFwiJyArIGEgKyAnXCIgWycgKyBiICsgXCJdXCI7IH0pO1xuICAgIGUoXCJFUlJfRkFMU1lfVkFMVUVfUkVKRUNUSU9OXCIsIFwiUHJvbWlzZSB3YXMgcmVqZWN0ZWQgd2l0aCBmYWxzeSB2YWx1ZVwiKTtcbiAgICBlKFwiRVJSX0VOQ09ESU5HX05PVF9TVVBQT1JURURcIiwgZnVuY3Rpb24gKGEpIHsgcmV0dXJuICdUaGUgXCInICsgYSArICdcIiBlbmNvZGluZyBpcyBub3Qgc3VwcG9ydGVkJzsgfSk7XG4gICAgZShcIkVSUl9FTkNPRElOR19JTlZBTElEX0VOQ09ERURfREFUQVwiLCBmdW5jdGlvbiAoYSkgeyByZXR1cm4gXCJUaGUgZW5jb2RlZCBkYXRhIHdhcyBub3QgdmFsaWQgZm9yIGVuY29kaW5nIFwiICsgYTsgfSk7XG4gICAgZShcIkVSUl9IVFRQX0hFQURFUlNfU0VOVFwiLCBcIkNhbm5vdCByZW5kZXIgaGVhZGVycyBhZnRlciB0aGV5IGFyZSBzZW50IHRvIHRoZSBjbGllbnRcIik7XG4gICAgZShcIkVSUl9IVFRQX0lOVkFMSURfU1RBVFVTX0NPREVcIiwgXCJJbnZhbGlkIHN0YXR1cyBjb2RlOiAlc1wiKTtcbiAgICBlKFwiRVJSX0hUVFBfVFJBSUxFUl9JTlZBTElEXCIsIFwiVHJhaWxlcnMgYXJlIGludmFsaWQgd2l0aCB0aGlzIHRyYW5zZmVyIGVuY29kaW5nXCIpO1xuICAgIGUoXCJFUlJfSU5ERVhfT1VUX09GX1JBTkdFXCIsIFwiSW5kZXggb3V0IG9mIHJhbmdlXCIpO1xuICAgIGUoXCJFUlJfSU5WQUxJRF9BUkdfVFlQRVwiLCBmdW5jdGlvbiAoYSwgYiwgYykgeyBJKGEsIFwibmFtZSBpcyByZXF1aXJlZFwiKTsgaWYgKGIuaW5jbHVkZXMoXCJub3QgXCIpKSB7XG4gICAgICAgIHZhciBkID0gXCJtdXN0IG5vdCBiZVwiO1xuICAgICAgICBiID0gYi5zcGxpdChcIm5vdCBcIilbMV07XG4gICAgfVxuICAgIGVsc2VcbiAgICAgICAgZCA9IFwibXVzdCBiZVwiOyBpZiAoQXJyYXkuaXNBcnJheShhKSlcbiAgICAgICAgZCA9IFwiVGhlIFwiICsgYS5tYXAoZnVuY3Rpb24gKGEpIHsgcmV0dXJuICdcIicgKyBhICsgJ1wiJzsgfSkuam9pbihcIiwgXCIpICsgXCIgYXJndW1lbnRzIFwiICsgZCArIFwiIFwiICsgZihiLCBcInR5cGVcIik7XG4gICAgZWxzZSBpZiAoYS5pbmNsdWRlcyhcIiBhcmd1bWVudFwiKSlcbiAgICAgICAgZCA9IFwiVGhlIFwiICsgYSArIFwiIFwiICsgZCArIFwiIFwiICsgZihiLCBcInR5cGVcIik7XG4gICAgZWxzZSB7XG4gICAgICAgIHZhciBlID0gYS5pbmNsdWRlcyhcIi5cIikgPyBcInByb3BlcnR5XCIgOiBcImFyZ3VtZW50XCI7XG4gICAgICAgIGQgPSAnVGhlIFwiJyArIGEgKyAnXCIgJyArIGUgKyBcIiBcIiArIGQgKyBcIiBcIiArIGYoYiwgXCJ0eXBlXCIpO1xuICAgIH0gMyA8PSBhcmd1bWVudHMubGVuZ3RoICYmIChkICs9IFwiLiBSZWNlaXZlZCB0eXBlIFwiICsgKG51bGwgIT09IGMgPyB0eXBlb2YgYyA6IFwibnVsbFwiKSk7IHJldHVybiBkOyB9KTtcbiAgICBlKFwiRVJSX0lOVkFMSURfQVJSQVlfTEVOR1RIXCIsIGZ1bmN0aW9uIChhLCBiLCBjKSB7IEkuc3RyaWN0RXF1YWwodHlwZW9mIGMsIFwibnVtYmVyXCIpOyByZXR1cm4gJ1RoZSBhcnJheSBcIicgKyBhICsgJ1wiIChsZW5ndGggJyArIGMgKyBcIikgbXVzdCBiZSBvZiBsZW5ndGggXCIgKyBiICsgXCIuXCI7IH0pO1xuICAgIGUoXCJFUlJfSU5WQUxJRF9CVUZGRVJfU0laRVwiLCBcIkJ1ZmZlciBzaXplIG11c3QgYmUgYSBtdWx0aXBsZSBvZiAlc1wiKTtcbiAgICBlKFwiRVJSX0lOVkFMSURfQ0FMTEJBQ0tcIiwgXCJDYWxsYmFjayBtdXN0IGJlIGEgZnVuY3Rpb25cIik7XG4gICAgZShcIkVSUl9JTlZBTElEX0NIQVJcIiwgXCJJbnZhbGlkIGNoYXJhY3RlciBpbiAlc1wiKTtcbiAgICBlKFwiRVJSX0lOVkFMSURfQ1VSU09SX1BPU1wiLCBcIkNhbm5vdCBzZXQgY3Vyc29yIHJvdyB3aXRob3V0IHNldHRpbmcgaXRzIGNvbHVtblwiKTtcbiAgICBlKFwiRVJSX0lOVkFMSURfRkRcIiwgJ1wiZmRcIiBtdXN0IGJlIGEgcG9zaXRpdmUgaW50ZWdlcjogJXMnKTtcbiAgICBlKFwiRVJSX0lOVkFMSURfRklMRV9VUkxfSE9TVFwiLCAnRmlsZSBVUkwgaG9zdCBtdXN0IGJlIFwibG9jYWxob3N0XCIgb3IgZW1wdHkgb24gJXMnKTtcbiAgICBlKFwiRVJSX0lOVkFMSURfRklMRV9VUkxfUEFUSFwiLCBcIkZpbGUgVVJMIHBhdGggJXNcIik7XG4gICAgZShcIkVSUl9JTlZBTElEX0hBTkRMRV9UWVBFXCIsIFwiVGhpcyBoYW5kbGUgdHlwZSBjYW5ub3QgYmUgc2VudFwiKTtcbiAgICBlKFwiRVJSX0lOVkFMSURfSVBfQUREUkVTU1wiLCBcIkludmFsaWQgSVAgYWRkcmVzczogJXNcIik7XG4gICAgZShcIkVSUl9JTlZBTElEX09QVF9WQUxVRVwiLCBmdW5jdGlvbiAoYSwgYikgeyByZXR1cm4gJ1RoZSB2YWx1ZSBcIicgKyBTdHJpbmcoYikgKyAnXCIgaXMgaW52YWxpZCBmb3Igb3B0aW9uIFwiJyArIGEgKyAnXCInOyB9KTtcbiAgICBlKFwiRVJSX0lOVkFMSURfT1BUX1ZBTFVFX0VOQ09ESU5HXCIsIGZ1bmN0aW9uIChhKSB7IHJldHVybiAnVGhlIHZhbHVlIFwiJyArIFN0cmluZyhhKSArICdcIiBpcyBpbnZhbGlkIGZvciBvcHRpb24gXCJlbmNvZGluZ1wiJzsgfSk7XG4gICAgZShcIkVSUl9JTlZBTElEX1JFUExfRVZBTF9DT05GSUdcIiwgJ0Nhbm5vdCBzcGVjaWZ5IGJvdGggXCJicmVha0V2YWxPblNpZ2ludFwiIGFuZCBcImV2YWxcIiBmb3IgUkVQTCcpO1xuICAgIGUoXCJFUlJfSU5WQUxJRF9TWU5DX0ZPUktfSU5QVVRcIiwgXCJBc3luY2hyb25vdXMgZm9ya3MgZG8gbm90IHN1cHBvcnQgQnVmZmVyLCBVaW50OEFycmF5IG9yIHN0cmluZyBpbnB1dDogJXNcIik7XG4gICAgZShcIkVSUl9JTlZBTElEX1RISVNcIiwgJ1ZhbHVlIG9mIFwidGhpc1wiIG11c3QgYmUgb2YgdHlwZSAlcycpO1xuICAgIGUoXCJFUlJfSU5WQUxJRF9UVVBMRVwiLCBcIiVzIG11c3QgYmUgYW4gaXRlcmFibGUgJXMgdHVwbGVcIik7XG4gICAgZShcIkVSUl9JTlZBTElEX1VSTFwiLCBcIkludmFsaWQgVVJMOiAlc1wiKTtcbiAgICBlKFwiRVJSX0lOVkFMSURfVVJMX1NDSEVNRVwiLCBmdW5jdGlvbiAoYSkgeyByZXR1cm4gXCJUaGUgVVJMIG11c3QgYmUgXCIgKyBmKGEsIFwic2NoZW1lXCIpOyB9KTtcbiAgICBlKFwiRVJSX0lQQ19DSEFOTkVMX0NMT1NFRFwiLCBcIkNoYW5uZWwgY2xvc2VkXCIpO1xuICAgIGUoXCJFUlJfSVBDX0RJU0NPTk5FQ1RFRFwiLCBcIklQQyBjaGFubmVsIGlzIGFscmVhZHkgZGlzY29ubmVjdGVkXCIpO1xuICAgIGUoXCJFUlJfSVBDX09ORV9QSVBFXCIsIFwiQ2hpbGQgcHJvY2VzcyBjYW4gaGF2ZSBvbmx5IG9uZSBJUEMgcGlwZVwiKTtcbiAgICBlKFwiRVJSX0lQQ19TWU5DX0ZPUktcIiwgXCJJUEMgY2Fubm90IGJlIHVzZWQgd2l0aCBzeW5jaHJvbm91cyBmb3Jrc1wiKTtcbiAgICBlKFwiRVJSX01JU1NJTkdfQVJHU1wiLCBmdW5jdGlvbiAoKSB7IGZvciAodmFyIGEgPSBbXSwgYiA9IDA7IGIgPCBhcmd1bWVudHMubGVuZ3RoOyBiKyspXG4gICAgICAgIGFbYl0gPSBhcmd1bWVudHNbYl07IEkoMCA8IGEubGVuZ3RoLCBcIkF0IGxlYXN0IG9uZSBhcmcgbmVlZHMgdG8gYmUgc3BlY2lmaWVkXCIpOyBiID0gXCJUaGUgXCI7IHZhciBjID0gYS5sZW5ndGg7IGEgPSBhLm1hcChmdW5jdGlvbiAoYSkgeyByZXR1cm4gJ1wiJyArIGEgKyAnXCInOyB9KTsgc3dpdGNoIChjKSB7XG4gICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgIGIgKz0gYVswXSArIFwiIGFyZ3VtZW50XCI7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgYiArPSBhWzBdICsgXCIgYW5kIFwiICsgYVsxXSArIFwiIGFyZ3VtZW50c1wiO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6IGIgKz0gYS5zbGljZSgwLCBjIC0gMSkuam9pbihcIiwgXCIpLCBiICs9IFwiLCBhbmQgXCIgKyBhW2MgLSAxXSArIFwiIGFyZ3VtZW50c1wiO1xuICAgIH0gcmV0dXJuIGIgKyBcIiBtdXN0IGJlIHNwZWNpZmllZFwiOyB9KTtcbiAgICBlKFwiRVJSX01VTFRJUExFX0NBTExCQUNLXCIsIFwiQ2FsbGJhY2sgY2FsbGVkIG11bHRpcGxlIHRpbWVzXCIpO1xuICAgIGUoXCJFUlJfTkFQSV9DT05TX0ZVTkNUSU9OXCIsIFwiQ29uc3RydWN0b3IgbXVzdCBiZSBhIGZ1bmN0aW9uXCIpO1xuICAgIGUoXCJFUlJfTkFQSV9DT05TX1BST1RPVFlQRV9PQkpFQ1RcIiwgXCJDb25zdHJ1Y3Rvci5wcm90b3R5cGUgbXVzdCBiZSBhbiBvYmplY3RcIik7XG4gICAgZShcIkVSUl9OT19DUllQVE9cIiwgXCJOb2RlLmpzIGlzIG5vdCBjb21waWxlZCB3aXRoIE9wZW5TU0wgY3J5cHRvIHN1cHBvcnRcIik7XG4gICAgZShcIkVSUl9OT19MT05HRVJfU1VQUE9SVEVEXCIsIFwiJXMgaXMgbm8gbG9uZ2VyIHN1cHBvcnRlZFwiKTtcbiAgICBlKFwiRVJSX1BBUlNFX0hJU1RPUllfREFUQVwiLCBcIkNvdWxkIG5vdCBwYXJzZSBoaXN0b3J5IGRhdGEgaW4gJXNcIik7XG4gICAgZShcIkVSUl9TT0NLRVRfQUxSRUFEWV9CT1VORFwiLCBcIlNvY2tldCBpcyBhbHJlYWR5IGJvdW5kXCIpO1xuICAgIGUoXCJFUlJfU09DS0VUX0JBRF9QT1JUXCIsIFwiUG9ydCBzaG91bGQgYmUgPiAwIGFuZCA8IDY1NTM2XCIpO1xuICAgIGUoXCJFUlJfU09DS0VUX0JBRF9UWVBFXCIsIFwiQmFkIHNvY2tldCB0eXBlIHNwZWNpZmllZC4gVmFsaWQgdHlwZXMgYXJlOiB1ZHA0LCB1ZHA2XCIpO1xuICAgIGUoXCJFUlJfU09DS0VUX0NBTk5PVF9TRU5EXCIsIFwiVW5hYmxlIHRvIHNlbmQgZGF0YVwiKTtcbiAgICBlKFwiRVJSX1NPQ0tFVF9DTE9TRURcIiwgXCJTb2NrZXQgaXMgY2xvc2VkXCIpO1xuICAgIGUoXCJFUlJfU09DS0VUX0RHUkFNX05PVF9SVU5OSU5HXCIsIFwiTm90IHJ1bm5pbmdcIik7XG4gICAgZShcIkVSUl9TVERFUlJfQ0xPU0VcIiwgXCJwcm9jZXNzLnN0ZGVyciBjYW5ub3QgYmUgY2xvc2VkXCIpO1xuICAgIGUoXCJFUlJfU1RET1VUX0NMT1NFXCIsIFwicHJvY2Vzcy5zdGRvdXQgY2Fubm90IGJlIGNsb3NlZFwiKTtcbiAgICBlKFwiRVJSX1NUUkVBTV9XUkFQXCIsIFwiU3RyZWFtIGhhcyBTdHJpbmdEZWNvZGVyIHNldCBvciBpcyBpbiBvYmplY3RNb2RlXCIpO1xuICAgIGUoXCJFUlJfVExTX0NFUlRfQUxUTkFNRV9JTlZBTElEXCIsIFwiSG9zdG5hbWUvSVAgZG9lcyBub3QgbWF0Y2ggY2VydGlmaWNhdGUncyBhbHRuYW1lczogJXNcIik7XG4gICAgZShcIkVSUl9UTFNfREhfUEFSQU1fU0laRVwiLCBmdW5jdGlvbiAoYSkgeyByZXR1cm4gXCJESCBwYXJhbWV0ZXIgc2l6ZSBcIiArIGEgKyBcIiBpcyBsZXNzIHRoYW4gMjA0OFwiOyB9KTtcbiAgICBlKFwiRVJSX1RMU19IQU5EU0hBS0VfVElNRU9VVFwiLCBcIlRMUyBoYW5kc2hha2UgdGltZW91dFwiKTtcbiAgICBlKFwiRVJSX1RMU19SRU5FR09USUFUSU9OX0ZBSUxFRFwiLCBcIkZhaWxlZCB0byByZW5lZ290aWF0ZVwiKTtcbiAgICBlKFwiRVJSX1RMU19SRVFVSVJFRF9TRVJWRVJfTkFNRVwiLCAnXCJzZXJ2ZXJuYW1lXCIgaXMgcmVxdWlyZWQgcGFyYW1ldGVyIGZvciBTZXJ2ZXIuYWRkQ29udGV4dCcpO1xuICAgIGUoXCJFUlJfVExTX1NFU1NJT05fQVRUQUNLXCIsIFwiVFNMIHNlc3Npb24gcmVuZWdvdGlhdGlvbiBhdHRhY2sgZGV0ZWN0ZWRcIik7XG4gICAgZShcIkVSUl9UUkFOU0ZPUk1fQUxSRUFEWV9UUkFOU0ZPUk1JTkdcIiwgXCJDYWxsaW5nIHRyYW5zZm9ybSBkb25lIHdoZW4gc3RpbGwgdHJhbnNmb3JtaW5nXCIpO1xuICAgIGUoXCJFUlJfVFJBTlNGT1JNX1dJVEhfTEVOR1RIXzBcIiwgXCJDYWxsaW5nIHRyYW5zZm9ybSBkb25lIHdoZW4gd3JpdGFibGVTdGF0ZS5sZW5ndGggIT0gMFwiKTtcbiAgICBlKFwiRVJSX1VOS05PV05fRU5DT0RJTkdcIiwgXCJVbmtub3duIGVuY29kaW5nOiAlc1wiKTtcbiAgICBlKFwiRVJSX1VOS05PV05fU0lHTkFMXCIsIFwiVW5rbm93biBzaWduYWw6ICVzXCIpO1xuICAgIGUoXCJFUlJfVU5LTk9XTl9TVERJTl9UWVBFXCIsIFwiVW5rbm93biBzdGRpbiBmaWxlIHR5cGVcIik7XG4gICAgZShcIkVSUl9VTktOT1dOX1NUUkVBTV9UWVBFXCIsIFwiVW5rbm93biBzdHJlYW0gZmlsZSB0eXBlXCIpO1xuICAgIGUoXCJFUlJfVjhCUkVBS0lURVJBVE9SXCIsIFwiRnVsbCBJQ1UgZGF0YSBub3QgaW5zdGFsbGVkLiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL25vZGVqcy9ub2RlL3dpa2kvSW50bFwiKTtcbn0pO1xudChQYyk7XG52YXIgSyA9IHUoZnVuY3Rpb24gKGEsIGIpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KGIsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiAhMCB9KTsgYi5FTkNPRElOR19VVEY4ID0gXCJ1dGY4XCI7IGIuYXNzZXJ0RW5jb2RpbmcgPSBmdW5jdGlvbiAoYSkgeyBpZiAoYSAmJiAhRi5CdWZmZXIuaXNFbmNvZGluZyhhKSlcbiAgICB0aHJvdyBuZXcgUGMuVHlwZUVycm9yKFwiRVJSX0lOVkFMSURfT1BUX1ZBTFVFX0VOQ09ESU5HXCIsIGEpOyB9OyBiLnN0clRvRW5jb2RpbmcgPSBmdW5jdGlvbiAoYSwgZCkgeyByZXR1cm4gZCAmJiBkICE9PSBiLkVOQ09ESU5HX1VURjggPyBcImJ1ZmZlclwiID09PSBkID8gbmV3IEYuQnVmZmVyKGEpIDogKG5ldyBGLkJ1ZmZlcihhKSkudG9TdHJpbmcoZCkgOiBhOyB9OyB9KTtcbnQoSyk7XG52YXIgUWMgPSB1KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGIsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiAhMCB9KTtcbiAgICB2YXIgYyA9IHcuY29uc3RhbnRzLlNfSUZNVCwgZCA9IHcuY29uc3RhbnRzLlNfSUZESVIsIGUgPSB3LmNvbnN0YW50cy5TX0lGUkVHLCBmID0gdy5jb25zdGFudHMuU19JRkJMSywgZyA9IHcuY29uc3RhbnRzLlNfSUZDSFIsIGggPSB3LmNvbnN0YW50cy5TX0lGTE5LLCBrID0gdy5jb25zdGFudHMuU19JRklGTywgcCA9IHcuY29uc3RhbnRzLlNfSUZTT0NLO1xuICAgIGEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZ1bmN0aW9uIGEoKSB7IHRoaXMubmFtZSA9IFwiXCI7IHRoaXMubW9kZSA9IDA7IH1cbiAgICAgICAgYS5idWlsZCA9IGZ1bmN0aW9uIChiLCBjKSB7IHZhciBkID0gbmV3IGEsIGUgPSBiLmdldE5vZGUoKS5tb2RlOyBkLm5hbWUgPSBLLnN0clRvRW5jb2RpbmcoYi5nZXROYW1lKCksIGMpOyBkLm1vZGUgPSBlOyByZXR1cm4gZDsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUuX2NoZWNrTW9kZVByb3BlcnR5ID0gZnVuY3Rpb24gKGEpIHsgcmV0dXJuICh0aGlzLm1vZGUgJiBjKSA9PT0gYTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUuaXNEaXJlY3RvcnkgPVxuICAgICAgICAgICAgZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fY2hlY2tNb2RlUHJvcGVydHkoZCk7IH07XG4gICAgICAgIGEucHJvdG90eXBlLmlzRmlsZSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX2NoZWNrTW9kZVByb3BlcnR5KGUpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5pc0Jsb2NrRGV2aWNlID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fY2hlY2tNb2RlUHJvcGVydHkoZik7IH07XG4gICAgICAgIGEucHJvdG90eXBlLmlzQ2hhcmFjdGVyRGV2aWNlID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fY2hlY2tNb2RlUHJvcGVydHkoZyk7IH07XG4gICAgICAgIGEucHJvdG90eXBlLmlzU3ltYm9saWNMaW5rID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fY2hlY2tNb2RlUHJvcGVydHkoaCk7IH07XG4gICAgICAgIGEucHJvdG90eXBlLmlzRklGTyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX2NoZWNrTW9kZVByb3BlcnR5KGspOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5pc1NvY2tldCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX2NoZWNrTW9kZVByb3BlcnR5KHApOyB9O1xuICAgICAgICByZXR1cm4gYTtcbiAgICB9KCk7XG4gICAgYi5EaXJlbnQgPSBhO1xuICAgIGIuZGVmYXVsdCA9IGE7XG59KTtcbnQoUWMpO1xuZnVuY3Rpb24gUmMoYSwgYikgeyBmb3IgKHZhciBjID0gMCwgZCA9IGEubGVuZ3RoIC0gMTsgMCA8PSBkOyBkLS0pIHtcbiAgICB2YXIgZSA9IGFbZF07XG4gICAgXCIuXCIgPT09IGUgPyBhLnNwbGljZShkLCAxKSA6IFwiLi5cIiA9PT0gZSA/IChhLnNwbGljZShkLCAxKSwgYysrKSA6IGMgJiYgKGEuc3BsaWNlKGQsIDEpLCBjLS0pO1xufSBpZiAoYilcbiAgICBmb3IgKDsgYy0tOyBjKVxuICAgICAgICBhLnVuc2hpZnQoXCIuLlwiKTsgcmV0dXJuIGE7IH1cbnZhciBTYyA9IC9eKFxcLz98KShbXFxzXFxTXSo/KSgoPzpcXC57MSwyfXxbXlxcL10rP3wpKFxcLlteLlxcL10qfCkpKD86W1xcL10qKSQvO1xuZnVuY3Rpb24gVGMoKSB7IGZvciAodmFyIGEgPSBcIlwiLCBiID0gITEsIGMgPSBhcmd1bWVudHMubGVuZ3RoIC0gMTsgLTEgPD0gYyAmJiAhYjsgYy0tKSB7XG4gICAgdmFyIGQgPSAwIDw9IGMgPyBhcmd1bWVudHNbY10gOiBcIi9cIjtcbiAgICBpZiAoXCJzdHJpbmdcIiAhPT0gdHlwZW9mIGQpXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJBcmd1bWVudHMgdG8gcGF0aC5yZXNvbHZlIG11c3QgYmUgc3RyaW5nc1wiKTtcbiAgICBkICYmIChhID0gZCArIFwiL1wiICsgYSwgYiA9IFwiL1wiID09PSBkLmNoYXJBdCgwKSk7XG59IGEgPSBSYyhVYyhhLnNwbGl0KFwiL1wiKSwgZnVuY3Rpb24gKGEpIHsgcmV0dXJuICEhYTsgfSksICFiKS5qb2luKFwiL1wiKTsgcmV0dXJuIChiID8gXCIvXCIgOiBcIlwiKSArIGEgfHwgXCIuXCI7IH1cbmZ1bmN0aW9uIFZjKGEpIHsgdmFyIGIgPSBXYyhhKSwgYyA9IFwiL1wiID09PSBYYyhhLCAtMSk7IChhID0gUmMoVWMoYS5zcGxpdChcIi9cIiksIGZ1bmN0aW9uIChhKSB7IHJldHVybiAhIWE7IH0pLCAhYikuam9pbihcIi9cIikpIHx8IGIgfHwgKGEgPSBcIi5cIik7IGEgJiYgYyAmJiAoYSArPSBcIi9cIik7IHJldHVybiAoYiA/IFwiL1wiIDogXCJcIikgKyBhOyB9XG5mdW5jdGlvbiBXYyhhKSB7IHJldHVybiBcIi9cIiA9PT0gYS5jaGFyQXQoMCk7IH1cbmZ1bmN0aW9uIFljKGEsIGIpIHsgZnVuY3Rpb24gYyhhKSB7IGZvciAodmFyIGIgPSAwOyBiIDwgYS5sZW5ndGggJiYgXCJcIiA9PT0gYVtiXTsgYisrKVxuICAgIDsgZm9yICh2YXIgYyA9IGEubGVuZ3RoIC0gMTsgMCA8PSBjICYmIFwiXCIgPT09IGFbY107IGMtLSlcbiAgICA7IHJldHVybiBiID4gYyA/IFtdIDogYS5zbGljZShiLCBjIC0gYiArIDEpOyB9IGEgPSBUYyhhKS5zdWJzdHIoMSk7IGIgPSBUYyhiKS5zdWJzdHIoMSk7IGEgPSBjKGEuc3BsaXQoXCIvXCIpKTsgYiA9IGMoYi5zcGxpdChcIi9cIikpOyBmb3IgKHZhciBkID0gTWF0aC5taW4oYS5sZW5ndGgsIGIubGVuZ3RoKSwgZSA9IGQsIGYgPSAwOyBmIDwgZDsgZisrKVxuICAgIGlmIChhW2ZdICE9PSBiW2ZdKSB7XG4gICAgICAgIGUgPSBmO1xuICAgICAgICBicmVhaztcbiAgICB9IGQgPSBbXTsgZm9yIChmID0gZTsgZiA8IGEubGVuZ3RoOyBmKyspXG4gICAgZC5wdXNoKFwiLi5cIik7IGQgPSBkLmNvbmNhdChiLnNsaWNlKGUpKTsgcmV0dXJuIGQuam9pbihcIi9cIik7IH1cbnZhciBaYyA9IHsgZXh0bmFtZTogZnVuY3Rpb24gKGEpIHsgcmV0dXJuIFNjLmV4ZWMoYSkuc2xpY2UoMSlbM107IH0sIGJhc2VuYW1lOiBmdW5jdGlvbiAoYSwgYikgeyBhID0gU2MuZXhlYyhhKS5zbGljZSgxKVsyXTsgYiAmJiBhLnN1YnN0cigtMSAqIGIubGVuZ3RoKSA9PT0gYiAmJiAoYSA9IGEuc3Vic3RyKDAsIGEubGVuZ3RoIC0gYi5sZW5ndGgpKTsgcmV0dXJuIGE7IH0sIGRpcm5hbWU6IGZ1bmN0aW9uIChhKSB7IHZhciBiID0gU2MuZXhlYyhhKS5zbGljZSgxKTsgYSA9IGJbMF07IGIgPSBiWzFdOyBpZiAoIWEgJiYgIWIpXG4gICAgICAgIHJldHVybiBcIi5cIjsgYiAmJiAoYiA9IGIuc3Vic3RyKDAsIGIubGVuZ3RoIC0gMSkpOyByZXR1cm4gYSArIGI7IH0sIHNlcDogXCIvXCIsIGRlbGltaXRlcjogXCI6XCIsIHJlbGF0aXZlOiBZYywgam9pbjogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYSA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMCk7XG4gICAgICAgIHJldHVybiBWYyhVYyhhLCBmdW5jdGlvbiAoYSkge1xuICAgICAgICAgICAgaWYgKFwic3RyaW5nXCIgIT09IHR5cGVvZiBhKVxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJBcmd1bWVudHMgdG8gcGF0aC5qb2luIG11c3QgYmUgc3RyaW5nc1wiKTtcbiAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICB9KS5qb2luKFwiL1wiKSk7XG4gICAgfSwgaXNBYnNvbHV0ZTogV2MsIG5vcm1hbGl6ZTogVmMsIHJlc29sdmU6IFRjIH07XG5mdW5jdGlvbiBVYyhhLCBiKSB7IGlmIChhLmZpbHRlcilcbiAgICByZXR1cm4gYS5maWx0ZXIoYik7IGZvciAodmFyIGMgPSBbXSwgZCA9IDA7IGQgPCBhLmxlbmd0aDsgZCsrKVxuICAgIGIoYVtkXSwgZCwgYSkgJiYgYy5wdXNoKGFbZF0pOyByZXR1cm4gYzsgfVxudmFyIFhjID0gXCJiXCIgPT09IFwiYWJcIi5zdWJzdHIoLTEpID8gZnVuY3Rpb24gKGEsIGIsIGMpIHsgcmV0dXJuIGEuc3Vic3RyKGIsIGMpOyB9IDogZnVuY3Rpb24gKGEsIGIsIGMpIHsgMCA+IGIgJiYgKGIgPSBhLmxlbmd0aCArIGIpOyByZXR1cm4gYS5zdWJzdHIoYiwgYyk7IH0sICRjID0gdShmdW5jdGlvbiAoYSwgYikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkoYiwgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6ICEwIH0pOyBhID0gXCJmdW5jdGlvblwiID09PSB0eXBlb2Ygc2V0SW1tZWRpYXRlID8gc2V0SW1tZWRpYXRlLmJpbmQobCkgOiBzZXRUaW1lb3V0LmJpbmQobCk7IGIuZGVmYXVsdCA9IGE7IH0pO1xudCgkYyk7XG52YXIgTCA9IHUoZnVuY3Rpb24gKGEsIGIpIHsgZnVuY3Rpb24gYygpIHsgdmFyIGEgPSBDYiB8fCB7fTsgYS5nZXR1aWQgfHwgKGEuZ2V0dWlkID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gMDsgfSk7IGEuZ2V0Z2lkIHx8IChhLmdldGdpZCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIDA7IH0pOyBhLmN3ZCB8fCAoYS5jd2QgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBcIi9cIjsgfSk7IGEubmV4dFRpY2sgfHwgKGEubmV4dFRpY2sgPSAkYy5kZWZhdWx0KTsgYS5lbWl0V2FybmluZyB8fCAoYS5lbWl0V2FybmluZyA9IGZ1bmN0aW9uIChhLCBiKSB7IGNvbnNvbGUud2FybihcIlwiICsgYiArIChiID8gXCI6IFwiIDogXCJcIikgKyBhKTsgfSk7IGEuZW52IHx8IChhLmVudiA9IHt9KTsgcmV0dXJuIGE7IH0gT2JqZWN0LmRlZmluZVByb3BlcnR5KGIsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiAhMCB9KTsgYi5jcmVhdGVQcm9jZXNzID0gYzsgYi5kZWZhdWx0ID0gYygpOyB9KTtcbnQoTCk7XG5mdW5jdGlvbiBhZCgpIHsgfVxuYWQucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbmZ1bmN0aW9uIE8oKSB7IE8uaW5pdC5jYWxsKHRoaXMpOyB9XG5PLkV2ZW50RW1pdHRlciA9IE87XG5PLnVzaW5nRG9tYWlucyA9ICExO1xuTy5wcm90b3R5cGUuZG9tYWluID0gdm9pZCAwO1xuTy5wcm90b3R5cGUuX2V2ZW50cyA9IHZvaWQgMDtcbk8ucHJvdG90eXBlLl9tYXhMaXN0ZW5lcnMgPSB2b2lkIDA7XG5PLmRlZmF1bHRNYXhMaXN0ZW5lcnMgPSAxMDtcbk8uaW5pdCA9IGZ1bmN0aW9uICgpIHsgdGhpcy5kb21haW4gPSBudWxsOyB0aGlzLl9ldmVudHMgJiYgdGhpcy5fZXZlbnRzICE9PSBPYmplY3QuZ2V0UHJvdG90eXBlT2YodGhpcykuX2V2ZW50cyB8fCAodGhpcy5fZXZlbnRzID0gbmV3IGFkLCB0aGlzLl9ldmVudHNDb3VudCA9IDApOyB0aGlzLl9tYXhMaXN0ZW5lcnMgPSB0aGlzLl9tYXhMaXN0ZW5lcnMgfHwgdm9pZCAwOyB9O1xuTy5wcm90b3R5cGUuc2V0TWF4TGlzdGVuZXJzID0gZnVuY3Rpb24gKGEpIHsgaWYgKFwibnVtYmVyXCIgIT09IHR5cGVvZiBhIHx8IDAgPiBhIHx8IGlzTmFOKGEpKVxuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1wiblwiIGFyZ3VtZW50IG11c3QgYmUgYSBwb3NpdGl2ZSBudW1iZXInKTsgdGhpcy5fbWF4TGlzdGVuZXJzID0gYTsgcmV0dXJuIHRoaXM7IH07XG5PLnByb3RvdHlwZS5nZXRNYXhMaXN0ZW5lcnMgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB2b2lkIDAgPT09IHRoaXMuX21heExpc3RlbmVycyA/IE8uZGVmYXVsdE1heExpc3RlbmVycyA6IHRoaXMuX21heExpc3RlbmVyczsgfTtcbk8ucHJvdG90eXBlLmVtaXQgPSBmdW5jdGlvbiAoYSkge1xuICAgIHZhciBiLCBjO1xuICAgIHZhciBkID0gXCJlcnJvclwiID09PSBhO1xuICAgIGlmIChiID0gdGhpcy5fZXZlbnRzKVxuICAgICAgICBkID0gZCAmJiBudWxsID09IGIuZXJyb3I7XG4gICAgZWxzZSBpZiAoIWQpXG4gICAgICAgIHJldHVybiAhMTtcbiAgICB2YXIgZSA9IHRoaXMuZG9tYWluO1xuICAgIGlmIChkKSB7XG4gICAgICAgIGIgPSBhcmd1bWVudHNbMV07XG4gICAgICAgIGlmIChlKVxuICAgICAgICAgICAgYiB8fCAoYiA9IEVycm9yKCdVbmNhdWdodCwgdW5zcGVjaWZpZWQgXCJlcnJvclwiIGV2ZW50JykpLCBiLmRvbWFpbkVtaXR0ZXIgPSB0aGlzLCBiLmRvbWFpbiA9IGUsIGIuZG9tYWluVGhyb3duID0gITEsIGUuZW1pdChcImVycm9yXCIsIGIpO1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmIChiIGluc3RhbmNlb2YgRXJyb3IpXG4gICAgICAgICAgICAgICAgdGhyb3cgYjtcbiAgICAgICAgICAgIGUgPSBFcnJvcignVW5jYXVnaHQsIHVuc3BlY2lmaWVkIFwiZXJyb3JcIiBldmVudC4gKCcgKyBiICsgXCIpXCIpO1xuICAgICAgICAgICAgZS5jb250ZXh0ID0gYjtcbiAgICAgICAgICAgIHRocm93IGU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICExO1xuICAgIH1cbiAgICBlID0gYlthXTtcbiAgICBpZiAoIWUpXG4gICAgICAgIHJldHVybiAhMTtcbiAgICBiID0gXCJmdW5jdGlvblwiID09PSB0eXBlb2YgZTtcbiAgICB2YXIgZiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gICAgc3dpdGNoIChmKSB7XG4gICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgIGlmIChiKVxuICAgICAgICAgICAgICAgIGUuY2FsbCh0aGlzKTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBmb3IgKGIgPSBlLmxlbmd0aCwgZSA9IGJkKGUsIGIpLCBkID0gMDsgZCA8IGI7ICsrZClcbiAgICAgICAgICAgICAgICAgICAgZVtkXS5jYWxsKHRoaXMpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgIGQgPSBhcmd1bWVudHNbMV07XG4gICAgICAgICAgICBpZiAoYilcbiAgICAgICAgICAgICAgICBlLmNhbGwodGhpcywgZCk7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgZm9yIChiID0gZS5sZW5ndGgsIGUgPSBiZChlLCBiKSwgZiA9IDA7IGYgPCBiOyArK2YpXG4gICAgICAgICAgICAgICAgICAgIGVbZl0uY2FsbCh0aGlzLCBkKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICBkID0gYXJndW1lbnRzWzFdO1xuICAgICAgICAgICAgZiA9IGFyZ3VtZW50c1syXTtcbiAgICAgICAgICAgIGlmIChiKVxuICAgICAgICAgICAgICAgIGUuY2FsbCh0aGlzLCBkLCBmKTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBmb3IgKGIgPSBlLmxlbmd0aCwgZSA9IGJkKGUsIGIpLCBjID0gMDsgYyA8IGI7ICsrYylcbiAgICAgICAgICAgICAgICAgICAgZVtjXS5jYWxsKHRoaXMsIGQsIGYpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgIGQgPSBhcmd1bWVudHNbMV07XG4gICAgICAgICAgICBmID0gYXJndW1lbnRzWzJdO1xuICAgICAgICAgICAgYyA9IGFyZ3VtZW50c1szXTtcbiAgICAgICAgICAgIGlmIChiKVxuICAgICAgICAgICAgICAgIGUuY2FsbCh0aGlzLCBkLCBmLCBjKTtcbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGIgPSBlLmxlbmd0aDtcbiAgICAgICAgICAgICAgICBlID0gYmQoZSwgYik7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgZyA9IDA7IGcgPCBiOyArK2cpXG4gICAgICAgICAgICAgICAgICAgIGVbZ10uY2FsbCh0aGlzLCBkLCBmLCBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgZCA9IEFycmF5KGYgLSAxKTtcbiAgICAgICAgICAgIGZvciAoYyA9IDE7IGMgPCBmOyBjKyspXG4gICAgICAgICAgICAgICAgZFtjIC0gMV0gPSBhcmd1bWVudHNbY107XG4gICAgICAgICAgICBpZiAoYilcbiAgICAgICAgICAgICAgICBlLmFwcGx5KHRoaXMsIGQpO1xuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIGZvciAoYiA9IGUubGVuZ3RoLCBlID0gYmQoZSwgYiksIGYgPSAwOyBmIDwgYjsgKytmKVxuICAgICAgICAgICAgICAgICAgICBlW2ZdLmFwcGx5KHRoaXMsIGQpO1xuICAgIH1cbiAgICByZXR1cm4gITA7XG59O1xuZnVuY3Rpb24gY2QoYSwgYiwgYywgZCkge1xuICAgIHZhciBlO1xuICAgIGlmIChcImZ1bmN0aW9uXCIgIT09IHR5cGVvZiBjKVxuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdcImxpc3RlbmVyXCIgYXJndW1lbnQgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7XG4gICAgaWYgKGUgPSBhLl9ldmVudHMpIHtcbiAgICAgICAgZS5uZXdMaXN0ZW5lciAmJiAoYS5lbWl0KFwibmV3TGlzdGVuZXJcIiwgYiwgYy5saXN0ZW5lciA/IGMubGlzdGVuZXIgOiBjKSwgZSA9IGEuX2V2ZW50cyk7XG4gICAgICAgIHZhciBmID0gZVtiXTtcbiAgICB9XG4gICAgZWxzZVxuICAgICAgICBlID0gYS5fZXZlbnRzID0gbmV3IGFkLCBhLl9ldmVudHNDb3VudCA9IDA7XG4gICAgZiA/IChcImZ1bmN0aW9uXCIgPT09IHR5cGVvZiBmID8gZiA9IGVbYl0gPSBkID8gW2MsIGZdIDogW2YsIGNdIDogZCA/IGYudW5zaGlmdChjKSA6IGYucHVzaChjKSwgZi53YXJuZWQgfHwgKGMgPSB2b2lkIDAgPT09IGEuX21heExpc3RlbmVycyA/IE8uZGVmYXVsdE1heExpc3RlbmVycyA6IGEuX21heExpc3RlbmVycykgJiYgMCA8IGMgJiYgZi5sZW5ndGggPiBjICYmIChmLndhcm5lZCA9ICEwLCBjID0gRXJyb3IoXCJQb3NzaWJsZSBFdmVudEVtaXR0ZXIgbWVtb3J5IGxlYWsgZGV0ZWN0ZWQuIFwiICsgZi5sZW5ndGggK1xuICAgICAgICBcIiBcIiArIGIgKyBcIiBsaXN0ZW5lcnMgYWRkZWQuIFVzZSBlbWl0dGVyLnNldE1heExpc3RlbmVycygpIHRvIGluY3JlYXNlIGxpbWl0XCIpLCBjLm5hbWUgPSBcIk1heExpc3RlbmVyc0V4Y2VlZGVkV2FybmluZ1wiLCBjLmVtaXR0ZXIgPSBhLCBjLnR5cGUgPSBiLCBjLmNvdW50ID0gZi5sZW5ndGgsIFwiZnVuY3Rpb25cIiA9PT0gdHlwZW9mIGNvbnNvbGUud2FybiA/IGNvbnNvbGUud2FybihjKSA6IGNvbnNvbGUubG9nKGMpKSkgOiAoZVtiXSA9IGMsICsrYS5fZXZlbnRzQ291bnQpO1xuICAgIHJldHVybiBhO1xufVxuTy5wcm90b3R5cGUuYWRkTGlzdGVuZXIgPSBmdW5jdGlvbiAoYSwgYikgeyByZXR1cm4gY2QodGhpcywgYSwgYiwgITEpOyB9O1xuTy5wcm90b3R5cGUub24gPSBPLnByb3RvdHlwZS5hZGRMaXN0ZW5lcjtcbk8ucHJvdG90eXBlLnByZXBlbmRMaXN0ZW5lciA9IGZ1bmN0aW9uIChhLCBiKSB7IHJldHVybiBjZCh0aGlzLCBhLCBiLCAhMCk7IH07XG5mdW5jdGlvbiBkZChhLCBiLCBjKSB7IGZ1bmN0aW9uIGQoKSB7IGEucmVtb3ZlTGlzdGVuZXIoYiwgZCk7IGUgfHwgKGUgPSAhMCwgYy5hcHBseShhLCBhcmd1bWVudHMpKTsgfSB2YXIgZSA9ICExOyBkLmxpc3RlbmVyID0gYzsgcmV0dXJuIGQ7IH1cbk8ucHJvdG90eXBlLm9uY2UgPSBmdW5jdGlvbiAoYSwgYikgeyBpZiAoXCJmdW5jdGlvblwiICE9PSB0eXBlb2YgYilcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdcImxpc3RlbmVyXCIgYXJndW1lbnQgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7IHRoaXMub24oYSwgZGQodGhpcywgYSwgYikpOyByZXR1cm4gdGhpczsgfTtcbk8ucHJvdG90eXBlLnByZXBlbmRPbmNlTGlzdGVuZXIgPSBmdW5jdGlvbiAoYSwgYikgeyBpZiAoXCJmdW5jdGlvblwiICE9PSB0eXBlb2YgYilcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdcImxpc3RlbmVyXCIgYXJndW1lbnQgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7IHRoaXMucHJlcGVuZExpc3RlbmVyKGEsIGRkKHRoaXMsIGEsIGIpKTsgcmV0dXJuIHRoaXM7IH07XG5PLnByb3RvdHlwZS5yZW1vdmVMaXN0ZW5lciA9IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgdmFyIGM7XG4gICAgaWYgKFwiZnVuY3Rpb25cIiAhPT0gdHlwZW9mIGIpXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1wibGlzdGVuZXJcIiBhcmd1bWVudCBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcbiAgICB2YXIgZCA9IHRoaXMuX2V2ZW50cztcbiAgICBpZiAoIWQpXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIHZhciBlID0gZFthXTtcbiAgICBpZiAoIWUpXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIGlmIChlID09PSBiIHx8IGUubGlzdGVuZXIgJiYgZS5saXN0ZW5lciA9PT0gYilcbiAgICAgICAgMCA9PT0gLS10aGlzLl9ldmVudHNDb3VudCA/IHRoaXMuX2V2ZW50cyA9IG5ldyBhZCA6IChkZWxldGUgZFthXSwgZC5yZW1vdmVMaXN0ZW5lciAmJiB0aGlzLmVtaXQoXCJyZW1vdmVMaXN0ZW5lclwiLCBhLCBlLmxpc3RlbmVyIHx8IGIpKTtcbiAgICBlbHNlIGlmIChcImZ1bmN0aW9uXCIgIT09IHR5cGVvZiBlKSB7XG4gICAgICAgIHZhciBmID0gLTE7XG4gICAgICAgIGZvciAoYyA9IGUubGVuZ3RoOyAwIDwgYy0tOylcbiAgICAgICAgICAgIGlmIChlW2NdID09PSBiIHx8IGVbY10ubGlzdGVuZXIgJiYgZVtjXS5saXN0ZW5lciA9PT0gYikge1xuICAgICAgICAgICAgICAgIHZhciBnID0gZVtjXS5saXN0ZW5lcjtcbiAgICAgICAgICAgICAgICBmID0gYztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgaWYgKDAgPlxuICAgICAgICAgICAgZilcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICBpZiAoMSA9PT0gZS5sZW5ndGgpIHtcbiAgICAgICAgICAgIGVbMF0gPSB2b2lkIDA7XG4gICAgICAgICAgICBpZiAoMCA9PT0gLS10aGlzLl9ldmVudHNDb3VudClcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZXZlbnRzID0gbmV3IGFkLCB0aGlzO1xuICAgICAgICAgICAgZGVsZXRlIGRbYV07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjID0gZiArIDE7XG4gICAgICAgICAgICBmb3IgKHZhciBoID0gZS5sZW5ndGg7IGMgPCBoOyBmICs9IDEsIGMgKz0gMSlcbiAgICAgICAgICAgICAgICBlW2ZdID0gZVtjXTtcbiAgICAgICAgICAgIGUucG9wKCk7XG4gICAgICAgIH1cbiAgICAgICAgZC5yZW1vdmVMaXN0ZW5lciAmJiB0aGlzLmVtaXQoXCJyZW1vdmVMaXN0ZW5lclwiLCBhLCBnIHx8IGIpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbn07XG5PLnByb3RvdHlwZS5yZW1vdmVBbGxMaXN0ZW5lcnMgPSBmdW5jdGlvbiAoYSkge1xuICAgIHZhciBiID0gdGhpcy5fZXZlbnRzO1xuICAgIGlmICghYilcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgaWYgKCFiLnJlbW92ZUxpc3RlbmVyKVxuICAgICAgICByZXR1cm4gMCA9PT0gYXJndW1lbnRzLmxlbmd0aCA/ICh0aGlzLl9ldmVudHMgPSBuZXcgYWQsIHRoaXMuX2V2ZW50c0NvdW50ID0gMCkgOiBiW2FdICYmICgwID09PSAtLXRoaXMuX2V2ZW50c0NvdW50ID8gdGhpcy5fZXZlbnRzID0gbmV3IGFkIDogZGVsZXRlIGJbYV0pLCB0aGlzO1xuICAgIGlmICgwID09PSBhcmd1bWVudHMubGVuZ3RoKSB7XG4gICAgICAgIGIgPSBPYmplY3Qua2V5cyhiKTtcbiAgICAgICAgZm9yICh2YXIgYyA9IDAsIGQ7IGMgPCBiLmxlbmd0aDsgKytjKVxuICAgICAgICAgICAgZCA9IGJbY10sIFwicmVtb3ZlTGlzdGVuZXJcIiAhPT0gZCAmJiB0aGlzLnJlbW92ZUFsbExpc3RlbmVycyhkKTtcbiAgICAgICAgdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoXCJyZW1vdmVMaXN0ZW5lclwiKTtcbiAgICAgICAgdGhpcy5fZXZlbnRzID0gbmV3IGFkO1xuICAgICAgICB0aGlzLl9ldmVudHNDb3VudCA9IDA7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBiID0gYlthXTtcbiAgICBpZiAoXCJmdW5jdGlvblwiID09PSB0eXBlb2YgYilcbiAgICAgICAgdGhpcy5yZW1vdmVMaXN0ZW5lcihhLCBiKTtcbiAgICBlbHNlIGlmIChiKSB7XG4gICAgICAgIGRvXG4gICAgICAgICAgICB0aGlzLnJlbW92ZUxpc3RlbmVyKGEsIGJbYi5sZW5ndGggLSAxXSk7XG4gICAgICAgIHdoaWxlIChiWzBdKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG59O1xuTy5wcm90b3R5cGUubGlzdGVuZXJzID0gZnVuY3Rpb24gKGEpIHsgdmFyIGIgPSB0aGlzLl9ldmVudHM7IGlmIChiKVxuICAgIGlmIChhID0gYlthXSlcbiAgICAgICAgaWYgKFwiZnVuY3Rpb25cIiA9PT0gdHlwZW9mIGEpXG4gICAgICAgICAgICBhID0gW2EubGlzdGVuZXIgfHwgYV07XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYiA9IEFycmF5KGEubGVuZ3RoKTtcbiAgICAgICAgICAgIGZvciAodmFyIGMgPSAwOyBjIDwgYi5sZW5ndGg7ICsrYylcbiAgICAgICAgICAgICAgICBiW2NdID0gYVtjXS5saXN0ZW5lciB8fCBhW2NdO1xuICAgICAgICAgICAgYSA9IGI7XG4gICAgICAgIH1cbiAgICBlbHNlXG4gICAgICAgIGEgPSBbXTtcbmVsc2VcbiAgICBhID0gW107IHJldHVybiBhOyB9O1xuTy5saXN0ZW5lckNvdW50ID0gZnVuY3Rpb24gKGEsIGIpIHsgcmV0dXJuIFwiZnVuY3Rpb25cIiA9PT0gdHlwZW9mIGEubGlzdGVuZXJDb3VudCA/IGEubGlzdGVuZXJDb3VudChiKSA6IGVkLmNhbGwoYSwgYik7IH07XG5PLnByb3RvdHlwZS5saXN0ZW5lckNvdW50ID0gZWQ7XG5mdW5jdGlvbiBlZChhKSB7IHZhciBiID0gdGhpcy5fZXZlbnRzOyBpZiAoYikge1xuICAgIGEgPSBiW2FdO1xuICAgIGlmIChcImZ1bmN0aW9uXCIgPT09IHR5cGVvZiBhKVxuICAgICAgICByZXR1cm4gMTtcbiAgICBpZiAoYSlcbiAgICAgICAgcmV0dXJuIGEubGVuZ3RoO1xufSByZXR1cm4gMDsgfVxuTy5wcm90b3R5cGUuZXZlbnROYW1lcyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIDAgPCB0aGlzLl9ldmVudHNDb3VudCA/IFJlZmxlY3Qub3duS2V5cyh0aGlzLl9ldmVudHMpIDogW107IH07XG5mdW5jdGlvbiBiZChhLCBiKSB7IGZvciAodmFyIGMgPSBBcnJheShiKTsgYi0tOylcbiAgICBjW2JdID0gYVtiXTsgcmV0dXJuIGM7IH1cbnZhciBmZCA9IHUoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICB2YXIgYyA9IGwgJiYgbC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBhKGIsIGMpIHsgYSA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCB7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChhLCBiKSB7IGEuX19wcm90b19fID0gYjsgfSB8fCBmdW5jdGlvbiAoYSwgYikgeyBmb3IgKHZhciBjIGluIGIpXG4gICAgICAgIGIuaGFzT3duUHJvcGVydHkoYykgJiYgKGFbY10gPSBiW2NdKTsgfTsgcmV0dXJuIGEoYiwgYyk7IH0gcmV0dXJuIGZ1bmN0aW9uIChiLCBjKSB7IGZ1bmN0aW9uIGQoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBiOyB9IGEoYiwgYyk7IGIucHJvdG90eXBlID0gbnVsbCA9PT0gYyA/IE9iamVjdC5jcmVhdGUoYykgOiAoZC5wcm90b3R5cGUgPSBjLnByb3RvdHlwZSwgbmV3IGQpOyB9OyB9KCk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGIsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiAhMCB9KTtcbiAgICB2YXIgZCA9IHcuY29uc3RhbnRzLlNfSUZNVCwgZSA9IHcuY29uc3RhbnRzLlNfSUZESVIsIGYgPSB3LmNvbnN0YW50cy5TX0lGUkVHLCBnID0gdy5jb25zdGFudHMuU19JRkxOSywgaCA9IHcuY29uc3RhbnRzLk9fQVBQRU5EO1xuICAgIGIuU0VQID0gXCIvXCI7XG4gICAgYSA9IGZ1bmN0aW9uIChhKSB7XG4gICAgICAgIGZ1bmN0aW9uIGIoYiwgYykgeyB2b2lkIDAgPT09IGMgJiYgKGMgPSA0MzgpOyB2YXIgZCA9IGEuY2FsbCh0aGlzKSB8fCB0aGlzOyBkLnVpZCA9IEwuZGVmYXVsdC5nZXR1aWQoKTsgZC5naWQgPSBMLmRlZmF1bHQuZ2V0Z2lkKCk7IGQuYXRpbWUgPSBuZXcgRGF0ZTsgZC5tdGltZSA9IG5ldyBEYXRlOyBkLmN0aW1lID0gbmV3IERhdGU7IGQucGVybSA9IDQzODsgZC5tb2RlID0gZjsgZC5ubGluayA9IDE7IGQucGVybSA9IGM7IGQubW9kZSB8PSBjOyBkLmlubyA9IGI7IHJldHVybiBkOyB9XG4gICAgICAgIGMoYiwgYSk7XG4gICAgICAgIGIucHJvdG90eXBlLmdldFN0cmluZyA9IGZ1bmN0aW9uIChhKSB7IHZvaWQgMCA9PT0gYSAmJiAoYSA9IFwidXRmOFwiKTsgcmV0dXJuIHRoaXMuZ2V0QnVmZmVyKCkudG9TdHJpbmcoYSk7IH07XG4gICAgICAgIGIucHJvdG90eXBlLnNldFN0cmluZyA9IGZ1bmN0aW9uIChhKSB7IHRoaXMuYnVmID0gRi5idWZmZXJGcm9tKGEsIFwidXRmOFwiKTsgdGhpcy50b3VjaCgpOyB9O1xuICAgICAgICBiLnByb3RvdHlwZS5nZXRCdWZmZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLmJ1ZiB8fCB0aGlzLnNldEJ1ZmZlcihGLmJ1ZmZlckFsbG9jVW5zYWZlKDApKTtcbiAgICAgICAgICAgIHJldHVybiBGLmJ1ZmZlckZyb20odGhpcy5idWYpO1xuICAgICAgICB9O1xuICAgICAgICBiLnByb3RvdHlwZS5zZXRCdWZmZXIgPSBmdW5jdGlvbiAoYSkgeyB0aGlzLmJ1ZiA9IEYuYnVmZmVyRnJvbShhKTsgdGhpcy50b3VjaCgpOyB9O1xuICAgICAgICBiLnByb3RvdHlwZS5nZXRTaXplID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5idWYgPyB0aGlzLmJ1Zi5sZW5ndGggOiAwOyB9O1xuICAgICAgICBiLnByb3RvdHlwZS5zZXRNb2RlUHJvcGVydHkgPSBmdW5jdGlvbiAoYSkgeyB0aGlzLm1vZGUgPSB0aGlzLm1vZGUgJiB+ZCB8IGE7IH07XG4gICAgICAgIGIucHJvdG90eXBlLnNldElzRmlsZSA9IGZ1bmN0aW9uICgpIHsgdGhpcy5zZXRNb2RlUHJvcGVydHkoZik7IH07XG4gICAgICAgIGIucHJvdG90eXBlLnNldElzRGlyZWN0b3J5ID0gZnVuY3Rpb24gKCkgeyB0aGlzLnNldE1vZGVQcm9wZXJ0eShlKTsgfTtcbiAgICAgICAgYi5wcm90b3R5cGUuc2V0SXNTeW1saW5rID0gZnVuY3Rpb24gKCkgeyB0aGlzLnNldE1vZGVQcm9wZXJ0eShnKTsgfTtcbiAgICAgICAgYi5wcm90b3R5cGUuaXNGaWxlID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gKHRoaXMubW9kZSAmIGQpID09PSBmOyB9O1xuICAgICAgICBiLnByb3RvdHlwZS5pc0RpcmVjdG9yeSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiAodGhpcy5tb2RlICZcbiAgICAgICAgICAgICAgICBkKSA9PT0gZTtcbiAgICAgICAgfTtcbiAgICAgICAgYi5wcm90b3R5cGUuaXNTeW1saW5rID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gKHRoaXMubW9kZSAmIGQpID09PSBnOyB9O1xuICAgICAgICBiLnByb3RvdHlwZS5tYWtlU3ltbGluayA9IGZ1bmN0aW9uIChhKSB7IHRoaXMuc3ltbGluayA9IGE7IHRoaXMuc2V0SXNTeW1saW5rKCk7IH07XG4gICAgICAgIGIucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsgdm9pZCAwID09PSBiICYmIChiID0gMCk7IHZvaWQgMCA9PT0gYyAmJiAoYyA9IGEubGVuZ3RoKTsgdm9pZCAwID09PSBkICYmIChkID0gMCk7IHRoaXMuYnVmIHx8ICh0aGlzLmJ1ZiA9IEYuYnVmZmVyQWxsb2NVbnNhZmUoMCkpOyBpZiAoZCArIGMgPiB0aGlzLmJ1Zi5sZW5ndGgpIHtcbiAgICAgICAgICAgIHZhciBlID0gRi5idWZmZXJBbGxvY1Vuc2FmZShkICsgYyk7XG4gICAgICAgICAgICB0aGlzLmJ1Zi5jb3B5KGUsIDAsIDAsIHRoaXMuYnVmLmxlbmd0aCk7XG4gICAgICAgICAgICB0aGlzLmJ1ZiA9IGU7XG4gICAgICAgIH0gYS5jb3B5KHRoaXMuYnVmLCBkLCBiLCBiICsgYyk7IHRoaXMudG91Y2goKTsgcmV0dXJuIGM7IH07XG4gICAgICAgIGIucHJvdG90eXBlLnJlYWQgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCkge1xuICAgICAgICAgICAgdm9pZCAwID09PSBiICYmIChiID0gMCk7XG4gICAgICAgICAgICB2b2lkIDAgPT09IGMgJiYgKGMgPSBhLmJ5dGVMZW5ndGgpO1xuICAgICAgICAgICAgdm9pZCAwID09PSBkICYmIChkID0gMCk7XG4gICAgICAgICAgICB0aGlzLmJ1ZiB8fCAodGhpcy5idWYgPSBGLmJ1ZmZlckFsbG9jVW5zYWZlKDApKTtcbiAgICAgICAgICAgIGMgPiBhLmJ5dGVMZW5ndGggJiYgKGMgPSBhLmJ5dGVMZW5ndGgpO1xuICAgICAgICAgICAgYyArIGQgPiB0aGlzLmJ1Zi5sZW5ndGggJiYgKGMgPSB0aGlzLmJ1Zi5sZW5ndGggLSBkKTtcbiAgICAgICAgICAgIHRoaXMuYnVmLmNvcHkoYSwgYiwgZCwgZCArIGMpO1xuICAgICAgICAgICAgcmV0dXJuIGM7XG4gICAgICAgIH07XG4gICAgICAgIGIucHJvdG90eXBlLnRydW5jYXRlID0gZnVuY3Rpb24gKGEpIHsgdm9pZCAwID09PSBhICYmIChhID0gMCk7IGlmIChhKVxuICAgICAgICAgICAgaWYgKHRoaXMuYnVmIHx8ICh0aGlzLmJ1ZiA9IEYuYnVmZmVyQWxsb2NVbnNhZmUoMCkpLCBhIDw9IHRoaXMuYnVmLmxlbmd0aClcbiAgICAgICAgICAgICAgICB0aGlzLmJ1ZiA9IHRoaXMuYnVmLnNsaWNlKDAsIGEpO1xuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIGIgPSBGLmJ1ZmZlckFsbG9jVW5zYWZlKDApO1xuICAgICAgICAgICAgICAgIHRoaXMuYnVmLmNvcHkoYik7XG4gICAgICAgICAgICAgICAgYi5maWxsKDAsIGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aGlzLmJ1ZiA9IEYuYnVmZmVyQWxsb2NVbnNhZmUoMCk7IHRoaXMudG91Y2goKTsgfTtcbiAgICAgICAgYi5wcm90b3R5cGUuY2htb2QgPSBmdW5jdGlvbiAoYSkge1xuICAgICAgICAgICAgdGhpcy5wZXJtID0gYTtcbiAgICAgICAgICAgIHRoaXMubW9kZSA9IHRoaXMubW9kZSAmIC01MTIgfFxuICAgICAgICAgICAgICAgIGE7XG4gICAgICAgICAgICB0aGlzLnRvdWNoKCk7XG4gICAgICAgIH07XG4gICAgICAgIGIucHJvdG90eXBlLmNob3duID0gZnVuY3Rpb24gKGEsIGIpIHsgdGhpcy51aWQgPSBhOyB0aGlzLmdpZCA9IGI7IHRoaXMudG91Y2goKTsgfTtcbiAgICAgICAgYi5wcm90b3R5cGUudG91Y2ggPSBmdW5jdGlvbiAoKSB7IHRoaXMubXRpbWUgPSBuZXcgRGF0ZTsgdGhpcy5lbWl0KFwiY2hhbmdlXCIsIHRoaXMpOyB9O1xuICAgICAgICBiLnByb3RvdHlwZS5jYW5SZWFkID0gZnVuY3Rpb24gKGEsIGIpIHsgdm9pZCAwID09PSBhICYmIChhID0gTC5kZWZhdWx0LmdldHVpZCgpKTsgdm9pZCAwID09PSBiICYmIChiID0gTC5kZWZhdWx0LmdldGdpZCgpKTsgcmV0dXJuIHRoaXMucGVybSAmIDQgfHwgYiA9PT0gdGhpcy5naWQgJiYgdGhpcy5wZXJtICYgMzIgfHwgYSA9PT0gdGhpcy51aWQgJiYgdGhpcy5wZXJtICYgMjU2ID8gITAgOiAhMTsgfTtcbiAgICAgICAgYi5wcm90b3R5cGUuY2FuV3JpdGUgPSBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAgICAgdm9pZCAwID09PSBhICYmIChhID0gTC5kZWZhdWx0LmdldHVpZCgpKTtcbiAgICAgICAgICAgIHZvaWQgMCA9PT0gYiAmJiAoYiA9IEwuZGVmYXVsdC5nZXRnaWQoKSk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wZXJtICYgMiB8fCBiID09PSB0aGlzLmdpZCAmJiB0aGlzLnBlcm0gJiAxNiB8fCBhID09PVxuICAgICAgICAgICAgICAgIHRoaXMudWlkICYmIHRoaXMucGVybSAmIDEyOCA/ICEwIDogITE7XG4gICAgICAgIH07XG4gICAgICAgIGIucHJvdG90eXBlLmRlbCA9IGZ1bmN0aW9uICgpIHsgdGhpcy5lbWl0KFwiZGVsZXRlXCIsIHRoaXMpOyB9O1xuICAgICAgICBiLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB7IGlubzogdGhpcy5pbm8sIHVpZDogdGhpcy51aWQsIGdpZDogdGhpcy5naWQsIGF0aW1lOiB0aGlzLmF0aW1lLmdldFRpbWUoKSwgbXRpbWU6IHRoaXMubXRpbWUuZ2V0VGltZSgpLCBjdGltZTogdGhpcy5jdGltZS5nZXRUaW1lKCksIHBlcm06IHRoaXMucGVybSwgbW9kZTogdGhpcy5tb2RlLCBubGluazogdGhpcy5ubGluaywgc3ltbGluazogdGhpcy5zeW1saW5rLCBkYXRhOiB0aGlzLmdldFN0cmluZygpIH07IH07XG4gICAgICAgIHJldHVybiBiO1xuICAgIH0oTy5FdmVudEVtaXR0ZXIpO1xuICAgIGIuTm9kZSA9IGE7XG4gICAgYSA9IGZ1bmN0aW9uIChhKSB7XG4gICAgICAgIGZ1bmN0aW9uIGQoYiwgYywgZCkge1xuICAgICAgICAgICAgdmFyIGUgPSBhLmNhbGwodGhpcykgfHwgdGhpcztcbiAgICAgICAgICAgIGUuY2hpbGRyZW4gPSB7fTtcbiAgICAgICAgICAgIGUuc3RlcHMgPSBbXTtcbiAgICAgICAgICAgIGUuaW5vID0gMDtcbiAgICAgICAgICAgIGUubGVuZ3RoID0gMDtcbiAgICAgICAgICAgIGUudm9sID0gYjtcbiAgICAgICAgICAgIGUucGFyZW50ID0gYztcbiAgICAgICAgICAgIGUuc3RlcHMgPSBjID8gYy5zdGVwcy5jb25jYXQoW2RdKSA6XG4gICAgICAgICAgICAgICAgW2RdO1xuICAgICAgICAgICAgcmV0dXJuIGU7XG4gICAgICAgIH1cbiAgICAgICAgYyhkLCBhKTtcbiAgICAgICAgZC5wcm90b3R5cGUuc2V0Tm9kZSA9IGZ1bmN0aW9uIChhKSB7IHRoaXMubm9kZSA9IGE7IHRoaXMuaW5vID0gYS5pbm87IH07XG4gICAgICAgIGQucHJvdG90eXBlLmdldE5vZGUgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLm5vZGU7IH07XG4gICAgICAgIGQucHJvdG90eXBlLmNyZWF0ZUNoaWxkID0gZnVuY3Rpb24gKGEsIGIpIHsgdm9pZCAwID09PSBiICYmIChiID0gdGhpcy52b2wuY3JlYXRlTm9kZSgpKTsgdmFyIGMgPSBuZXcgZCh0aGlzLnZvbCwgdGhpcywgYSk7IGMuc2V0Tm9kZShiKTsgYi5pc0RpcmVjdG9yeSgpOyB0aGlzLnNldENoaWxkKGEsIGMpOyByZXR1cm4gYzsgfTtcbiAgICAgICAgZC5wcm90b3R5cGUuc2V0Q2hpbGQgPSBmdW5jdGlvbiAoYSwgYikgeyB2b2lkIDAgPT09IGIgJiYgKGIgPSBuZXcgZCh0aGlzLnZvbCwgdGhpcywgYSkpOyB0aGlzLmNoaWxkcmVuW2FdID0gYjsgYi5wYXJlbnQgPSB0aGlzOyB0aGlzLmxlbmd0aCsrOyB0aGlzLmVtaXQoXCJjaGlsZDphZGRcIiwgYiwgdGhpcyk7IHJldHVybiBiOyB9O1xuICAgICAgICBkLnByb3RvdHlwZS5kZWxldGVDaGlsZCA9IGZ1bmN0aW9uIChhKSB7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5jaGlsZHJlblthLmdldE5hbWUoKV07XG4gICAgICAgICAgICB0aGlzLmxlbmd0aC0tO1xuICAgICAgICAgICAgdGhpcy5lbWl0KFwiY2hpbGQ6ZGVsZXRlXCIsIGEsIHRoaXMpO1xuICAgICAgICB9O1xuICAgICAgICBkLnByb3RvdHlwZS5nZXRDaGlsZCA9IGZ1bmN0aW9uIChhKSB7IGlmIChPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbCh0aGlzLmNoaWxkcmVuLCBhKSlcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuW2FdOyB9O1xuICAgICAgICBkLnByb3RvdHlwZS5nZXRQYXRoID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5zdGVwcy5qb2luKGIuU0VQKTsgfTtcbiAgICAgICAgZC5wcm90b3R5cGUuZ2V0TmFtZSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuc3RlcHNbdGhpcy5zdGVwcy5sZW5ndGggLSAxXTsgfTtcbiAgICAgICAgZC5wcm90b3R5cGUud2FsayA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IHZvaWQgMCA9PT0gYiAmJiAoYiA9IGEubGVuZ3RoKTsgdm9pZCAwID09PSBjICYmIChjID0gMCk7IGlmIChjID49IGEubGVuZ3RoIHx8IGMgPj0gYilcbiAgICAgICAgICAgIHJldHVybiB0aGlzOyB2YXIgZCA9IHRoaXMuZ2V0Q2hpbGQoYVtjXSk7IHJldHVybiBkID8gZC53YWxrKGEsIGIsIGMgKyAxKSA6IG51bGw7IH07XG4gICAgICAgIGQucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN0ZXBzOiB0aGlzLnN0ZXBzLFxuICAgICAgICAgICAgICAgIGlubzogdGhpcy5pbm8sIGNoaWxkcmVuOiBPYmplY3Qua2V5cyh0aGlzLmNoaWxkcmVuKSB9O1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZDtcbiAgICB9KE8uRXZlbnRFbWl0dGVyKTtcbiAgICBiLkxpbmsgPSBhO1xuICAgIGEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZ1bmN0aW9uIGEoYSwgYiwgYywgZCkgeyB0aGlzLnBvc2l0aW9uID0gMDsgdGhpcy5saW5rID0gYTsgdGhpcy5ub2RlID0gYjsgdGhpcy5mbGFncyA9IGM7IHRoaXMuZmQgPSBkOyB9XG4gICAgICAgIGEucHJvdG90eXBlLmdldFN0cmluZyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMubm9kZS5nZXRTdHJpbmcoKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUuc2V0U3RyaW5nID0gZnVuY3Rpb24gKGEpIHsgdGhpcy5ub2RlLnNldFN0cmluZyhhKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUuZ2V0QnVmZmVyID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5ub2RlLmdldEJ1ZmZlcigpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5zZXRCdWZmZXIgPSBmdW5jdGlvbiAoYSkgeyB0aGlzLm5vZGUuc2V0QnVmZmVyKGEpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5nZXRTaXplID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5ub2RlLmdldFNpemUoKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUudHJ1bmNhdGUgPVxuICAgICAgICAgICAgZnVuY3Rpb24gKGEpIHsgdGhpcy5ub2RlLnRydW5jYXRlKGEpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5zZWVrVG8gPSBmdW5jdGlvbiAoYSkgeyB0aGlzLnBvc2l0aW9uID0gYTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUuc3RhdHMgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBrYS5kZWZhdWx0LmJ1aWxkKHRoaXMubm9kZSk7IH07XG4gICAgICAgIGEucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsgdm9pZCAwID09PSBiICYmIChiID0gMCk7IHZvaWQgMCA9PT0gYyAmJiAoYyA9IGEubGVuZ3RoKTsgXCJudW1iZXJcIiAhPT0gdHlwZW9mIGQgJiYgKGQgPSB0aGlzLnBvc2l0aW9uKTsgdGhpcy5mbGFncyAmIGggJiYgKGQgPSB0aGlzLmdldFNpemUoKSk7IGEgPSB0aGlzLm5vZGUud3JpdGUoYSwgYiwgYywgZCk7IHRoaXMucG9zaXRpb24gPSBkICsgYTsgcmV0dXJuIGE7IH07XG4gICAgICAgIGEucHJvdG90eXBlLnJlYWQgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCkge1xuICAgICAgICAgICAgdm9pZCAwID09PSBiICYmIChiID0gMCk7XG4gICAgICAgICAgICB2b2lkIDAgPT09IGMgJiYgKGMgPSBhLmJ5dGVMZW5ndGgpO1xuICAgICAgICAgICAgXCJudW1iZXJcIiAhPT0gdHlwZW9mIGQgJiYgKGQgPSB0aGlzLnBvc2l0aW9uKTtcbiAgICAgICAgICAgIGEgPSB0aGlzLm5vZGUucmVhZChhLCBiLCBjLCBkKTtcbiAgICAgICAgICAgIHRoaXMucG9zaXRpb24gPSBkICsgYTtcbiAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICB9O1xuICAgICAgICBhLnByb3RvdHlwZS5jaG1vZCA9IGZ1bmN0aW9uIChhKSB7IHRoaXMubm9kZS5jaG1vZChhKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUuY2hvd24gPSBmdW5jdGlvbiAoYSwgYikgeyB0aGlzLm5vZGUuY2hvd24oYSwgYik7IH07XG4gICAgICAgIHJldHVybiBhO1xuICAgIH0oKTtcbiAgICBiLkZpbGUgPSBhO1xufSk7XG50KGZkKTtcbnZhciBnZCA9IGZkLk5vZGUsIGhkID0gdShmdW5jdGlvbiAoYSwgYikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkoYiwgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6ICEwIH0pOyBiLmRlZmF1bHQgPSBmdW5jdGlvbiAoYSwgYiwgZSkgeyB2YXIgYyA9IHNldFRpbWVvdXQuYXBwbHkobnVsbCwgYXJndW1lbnRzKTsgYyAmJiBcIm9iamVjdFwiID09PSB0eXBlb2YgYyAmJiBcImZ1bmN0aW9uXCIgPT09IHR5cGVvZiBjLnVucmVmICYmIGMudW5yZWYoKTsgcmV0dXJuIGM7IH07IH0pO1xudChoZCk7XG5mdW5jdGlvbiBpZCgpIHsgdGhpcy50YWlsID0gdGhpcy5oZWFkID0gbnVsbDsgdGhpcy5sZW5ndGggPSAwOyB9XG5pZC5wcm90b3R5cGUucHVzaCA9IGZ1bmN0aW9uIChhKSB7IGEgPSB7IGRhdGE6IGEsIG5leHQ6IG51bGwgfTsgMCA8IHRoaXMubGVuZ3RoID8gdGhpcy50YWlsLm5leHQgPSBhIDogdGhpcy5oZWFkID0gYTsgdGhpcy50YWlsID0gYTsgKyt0aGlzLmxlbmd0aDsgfTtcbmlkLnByb3RvdHlwZS51bnNoaWZ0ID0gZnVuY3Rpb24gKGEpIHsgYSA9IHsgZGF0YTogYSwgbmV4dDogdGhpcy5oZWFkIH07IDAgPT09IHRoaXMubGVuZ3RoICYmICh0aGlzLnRhaWwgPSBhKTsgdGhpcy5oZWFkID0gYTsgKyt0aGlzLmxlbmd0aDsgfTtcbmlkLnByb3RvdHlwZS5zaGlmdCA9IGZ1bmN0aW9uICgpIHsgaWYgKDAgIT09IHRoaXMubGVuZ3RoKSB7XG4gICAgdmFyIGEgPSB0aGlzLmhlYWQuZGF0YTtcbiAgICB0aGlzLmhlYWQgPSAxID09PSB0aGlzLmxlbmd0aCA/IHRoaXMudGFpbCA9IG51bGwgOiB0aGlzLmhlYWQubmV4dDtcbiAgICAtLXRoaXMubGVuZ3RoO1xuICAgIHJldHVybiBhO1xufSB9O1xuaWQucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkgeyB0aGlzLmhlYWQgPSB0aGlzLnRhaWwgPSBudWxsOyB0aGlzLmxlbmd0aCA9IDA7IH07XG5pZC5wcm90b3R5cGUuam9pbiA9IGZ1bmN0aW9uIChhKSB7IGlmICgwID09PSB0aGlzLmxlbmd0aClcbiAgICByZXR1cm4gXCJcIjsgZm9yICh2YXIgYiA9IHRoaXMuaGVhZCwgYyA9IFwiXCIgKyBiLmRhdGE7IGIgPSBiLm5leHQ7KVxuICAgIGMgKz0gYSArIGIuZGF0YTsgcmV0dXJuIGM7IH07XG5pZC5wcm90b3R5cGUuY29uY2F0ID0gZnVuY3Rpb24gKGEpIHsgaWYgKDAgPT09IHRoaXMubGVuZ3RoKVxuICAgIHJldHVybiB6LmFsbG9jKDApOyBpZiAoMSA9PT0gdGhpcy5sZW5ndGgpXG4gICAgcmV0dXJuIHRoaXMuaGVhZC5kYXRhOyBhID0gei5hbGxvY1Vuc2FmZShhID4+PiAwKTsgZm9yICh2YXIgYiA9IHRoaXMuaGVhZCwgYyA9IDA7IGI7KVxuICAgIGIuZGF0YS5jb3B5KGEsIGMpLCBjICs9IGIuZGF0YS5sZW5ndGgsIGIgPSBiLm5leHQ7IHJldHVybiBhOyB9O1xudmFyIGpkID0gei5pc0VuY29kaW5nIHx8IGZ1bmN0aW9uIChhKSB7IHN3aXRjaCAoYSAmJiBhLnRvTG93ZXJDYXNlKCkpIHtcbiAgICBjYXNlIFwiaGV4XCI6XG4gICAgY2FzZSBcInV0ZjhcIjpcbiAgICBjYXNlIFwidXRmLThcIjpcbiAgICBjYXNlIFwiYXNjaWlcIjpcbiAgICBjYXNlIFwiYmluYXJ5XCI6XG4gICAgY2FzZSBcImJhc2U2NFwiOlxuICAgIGNhc2UgXCJ1Y3MyXCI6XG4gICAgY2FzZSBcInVjcy0yXCI6XG4gICAgY2FzZSBcInV0ZjE2bGVcIjpcbiAgICBjYXNlIFwidXRmLTE2bGVcIjpcbiAgICBjYXNlIFwicmF3XCI6IHJldHVybiAhMDtcbiAgICBkZWZhdWx0OiByZXR1cm4gITE7XG59IH07XG5mdW5jdGlvbiBrZChhKSB7IHRoaXMuZW5jb2RpbmcgPSAoYSB8fCBcInV0ZjhcIikudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9bLV9dLywgXCJcIik7IGlmIChhICYmICFqZChhKSlcbiAgICB0aHJvdyBFcnJvcihcIlVua25vd24gZW5jb2Rpbmc6IFwiICsgYSk7IHN3aXRjaCAodGhpcy5lbmNvZGluZykge1xuICAgIGNhc2UgXCJ1dGY4XCI6XG4gICAgICAgIHRoaXMuc3Vycm9nYXRlU2l6ZSA9IDM7XG4gICAgICAgIGJyZWFrO1xuICAgIGNhc2UgXCJ1Y3MyXCI6XG4gICAgY2FzZSBcInV0ZjE2bGVcIjpcbiAgICAgICAgdGhpcy5zdXJyb2dhdGVTaXplID0gMjtcbiAgICAgICAgdGhpcy5kZXRlY3RJbmNvbXBsZXRlQ2hhciA9IGxkO1xuICAgICAgICBicmVhaztcbiAgICBjYXNlIFwiYmFzZTY0XCI6XG4gICAgICAgIHRoaXMuc3Vycm9nYXRlU2l6ZSA9IDM7XG4gICAgICAgIHRoaXMuZGV0ZWN0SW5jb21wbGV0ZUNoYXIgPSBtZDtcbiAgICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgICAgdGhpcy53cml0ZSA9IG5kO1xuICAgICAgICByZXR1cm47XG59IHRoaXMuY2hhckJ1ZmZlciA9IG5ldyB6KDYpOyB0aGlzLmNoYXJMZW5ndGggPSB0aGlzLmNoYXJSZWNlaXZlZCA9IDA7IH1cbmtkLnByb3RvdHlwZS53cml0ZSA9IGZ1bmN0aW9uIChhKSB7XG4gICAgZm9yICh2YXIgYiA9IFwiXCI7IHRoaXMuY2hhckxlbmd0aDspIHtcbiAgICAgICAgYiA9IGEubGVuZ3RoID49IHRoaXMuY2hhckxlbmd0aCAtIHRoaXMuY2hhclJlY2VpdmVkID8gdGhpcy5jaGFyTGVuZ3RoIC0gdGhpcy5jaGFyUmVjZWl2ZWQgOiBhLmxlbmd0aDtcbiAgICAgICAgYS5jb3B5KHRoaXMuY2hhckJ1ZmZlciwgdGhpcy5jaGFyUmVjZWl2ZWQsIDAsIGIpO1xuICAgICAgICB0aGlzLmNoYXJSZWNlaXZlZCArPSBiO1xuICAgICAgICBpZiAodGhpcy5jaGFyUmVjZWl2ZWQgPCB0aGlzLmNoYXJMZW5ndGgpXG4gICAgICAgICAgICByZXR1cm4gXCJcIjtcbiAgICAgICAgYSA9IGEuc2xpY2UoYiwgYS5sZW5ndGgpO1xuICAgICAgICBiID0gdGhpcy5jaGFyQnVmZmVyLnNsaWNlKDAsIHRoaXMuY2hhckxlbmd0aCkudG9TdHJpbmcodGhpcy5lbmNvZGluZyk7XG4gICAgICAgIHZhciBjID0gYi5jaGFyQ29kZUF0KGIubGVuZ3RoIC0gMSk7XG4gICAgICAgIGlmICg1NTI5NiA8PSBjICYmIDU2MzE5ID49IGMpXG4gICAgICAgICAgICB0aGlzLmNoYXJMZW5ndGggKz0gdGhpcy5zdXJyb2dhdGVTaXplLCBiID0gXCJcIjtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmNoYXJSZWNlaXZlZCA9IHRoaXMuY2hhckxlbmd0aCA9IDA7XG4gICAgICAgICAgICBpZiAoMCA9PT0gYS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGI7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cbiAgICB0aGlzLmRldGVjdEluY29tcGxldGVDaGFyKGEpO1xuICAgIHZhciBkID0gYS5sZW5ndGg7XG4gICAgdGhpcy5jaGFyTGVuZ3RoICYmIChhLmNvcHkodGhpcy5jaGFyQnVmZmVyLCAwLCBhLmxlbmd0aCAtIHRoaXMuY2hhclJlY2VpdmVkLCBkKSwgZCAtPSB0aGlzLmNoYXJSZWNlaXZlZCk7XG4gICAgYiArPSBhLnRvU3RyaW5nKHRoaXMuZW5jb2RpbmcsIDAsIGQpO1xuICAgIGQgPSBiLmxlbmd0aCAtIDE7XG4gICAgYyA9IGIuY2hhckNvZGVBdChkKTtcbiAgICByZXR1cm4gNTUyOTYgPD0gYyAmJiA1NjMxOSA+PSBjID8gKGMgPSB0aGlzLnN1cnJvZ2F0ZVNpemUsIHRoaXMuY2hhckxlbmd0aCArPSBjLCB0aGlzLmNoYXJSZWNlaXZlZCArPSBjLCB0aGlzLmNoYXJCdWZmZXIuY29weSh0aGlzLmNoYXJCdWZmZXIsIGMsIDAsIGMpLCBhLmNvcHkodGhpcy5jaGFyQnVmZmVyLCAwLCAwLCBjKSwgYi5zdWJzdHJpbmcoMCwgZCkpIDogYjtcbn07XG5rZC5wcm90b3R5cGUuZGV0ZWN0SW5jb21wbGV0ZUNoYXIgPSBmdW5jdGlvbiAoYSkgeyBmb3IgKHZhciBiID0gMyA8PSBhLmxlbmd0aCA/IDMgOiBhLmxlbmd0aDsgMCA8IGI7IGItLSkge1xuICAgIHZhciBjID0gYVthLmxlbmd0aCAtIGJdO1xuICAgIGlmICgxID09IGIgJiYgNiA9PSBjID4+IDUpIHtcbiAgICAgICAgdGhpcy5jaGFyTGVuZ3RoID0gMjtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGlmICgyID49IGIgJiYgMTQgPT0gYyA+PiA0KSB7XG4gICAgICAgIHRoaXMuY2hhckxlbmd0aCA9IDM7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBpZiAoMyA+PSBiICYmIDMwID09IGMgPj4gMykge1xuICAgICAgICB0aGlzLmNoYXJMZW5ndGggPSA0O1xuICAgICAgICBicmVhaztcbiAgICB9XG59IHRoaXMuY2hhclJlY2VpdmVkID0gYjsgfTtcbmtkLnByb3RvdHlwZS5lbmQgPSBmdW5jdGlvbiAoYSkgeyB2YXIgYiA9IFwiXCI7IGEgJiYgYS5sZW5ndGggJiYgKGIgPSB0aGlzLndyaXRlKGEpKTsgdGhpcy5jaGFyUmVjZWl2ZWQgJiYgKGEgPSB0aGlzLmVuY29kaW5nLCBiICs9IHRoaXMuY2hhckJ1ZmZlci5zbGljZSgwLCB0aGlzLmNoYXJSZWNlaXZlZCkudG9TdHJpbmcoYSkpOyByZXR1cm4gYjsgfTtcbmZ1bmN0aW9uIG5kKGEpIHsgcmV0dXJuIGEudG9TdHJpbmcodGhpcy5lbmNvZGluZyk7IH1cbmZ1bmN0aW9uIGxkKGEpIHsgdGhpcy5jaGFyTGVuZ3RoID0gKHRoaXMuY2hhclJlY2VpdmVkID0gYS5sZW5ndGggJSAyKSA/IDIgOiAwOyB9XG5mdW5jdGlvbiBtZChhKSB7IHRoaXMuY2hhckxlbmd0aCA9ICh0aGlzLmNoYXJSZWNlaXZlZCA9IGEubGVuZ3RoICUgMykgPyAzIDogMDsgfVxuUC5SZWFkYWJsZVN0YXRlID0gb2Q7XG52YXIgUSA9IE1iKFwic3RyZWFtXCIpO1xuRGIoUCwgTyk7XG5mdW5jdGlvbiBwZChhLCBiLCBjKSB7IGlmIChcImZ1bmN0aW9uXCIgPT09IHR5cGVvZiBhLnByZXBlbmRMaXN0ZW5lcilcbiAgICByZXR1cm4gYS5wcmVwZW5kTGlzdGVuZXIoYiwgYyk7IGlmIChhLl9ldmVudHMgJiYgYS5fZXZlbnRzW2JdKVxuICAgIEFycmF5LmlzQXJyYXkoYS5fZXZlbnRzW2JdKSA/IGEuX2V2ZW50c1tiXS51bnNoaWZ0KGMpIDogYS5fZXZlbnRzW2JdID0gW2MsIGEuX2V2ZW50c1tiXV07XG5lbHNlXG4gICAgYS5vbihiLCBjKTsgfVxuZnVuY3Rpb24gb2QoYSwgYikge1xuICAgIGEgPSBhIHx8IHt9O1xuICAgIHRoaXMub2JqZWN0TW9kZSA9ICEhYS5vYmplY3RNb2RlO1xuICAgIGIgaW5zdGFuY2VvZiBWICYmICh0aGlzLm9iamVjdE1vZGUgPSB0aGlzLm9iamVjdE1vZGUgfHwgISFhLnJlYWRhYmxlT2JqZWN0TW9kZSk7XG4gICAgYiA9IGEuaGlnaFdhdGVyTWFyaztcbiAgICB2YXIgYyA9IHRoaXMub2JqZWN0TW9kZSA/IDE2IDogMTYzODQ7XG4gICAgdGhpcy5oaWdoV2F0ZXJNYXJrID0gYiB8fCAwID09PSBiID8gYiA6IGM7XG4gICAgdGhpcy5oaWdoV2F0ZXJNYXJrID0gfn50aGlzLmhpZ2hXYXRlck1hcms7XG4gICAgdGhpcy5idWZmZXIgPSBuZXcgaWQ7XG4gICAgdGhpcy5sZW5ndGggPSAwO1xuICAgIHRoaXMucGlwZXMgPSBudWxsO1xuICAgIHRoaXMucGlwZXNDb3VudCA9IDA7XG4gICAgdGhpcy5mbG93aW5nID0gbnVsbDtcbiAgICB0aGlzLnJlYWRpbmcgPSB0aGlzLmVuZEVtaXR0ZWQgPSB0aGlzLmVuZGVkID0gITE7XG4gICAgdGhpcy5zeW5jID0gITA7XG4gICAgdGhpcy5yZXN1bWVTY2hlZHVsZWQgPSB0aGlzLnJlYWRhYmxlTGlzdGVuaW5nID0gdGhpcy5lbWl0dGVkUmVhZGFibGUgPSB0aGlzLm5lZWRSZWFkYWJsZSA9ICExO1xuICAgIHRoaXMuZGVmYXVsdEVuY29kaW5nID0gYS5kZWZhdWx0RW5jb2RpbmcgfHxcbiAgICAgICAgXCJ1dGY4XCI7XG4gICAgdGhpcy5yYW5PdXQgPSAhMTtcbiAgICB0aGlzLmF3YWl0RHJhaW4gPSAwO1xuICAgIHRoaXMucmVhZGluZ01vcmUgPSAhMTtcbiAgICB0aGlzLmVuY29kaW5nID0gdGhpcy5kZWNvZGVyID0gbnVsbDtcbiAgICBhLmVuY29kaW5nICYmICh0aGlzLmRlY29kZXIgPSBuZXcga2QoYS5lbmNvZGluZyksIHRoaXMuZW5jb2RpbmcgPSBhLmVuY29kaW5nKTtcbn1cbmZ1bmN0aW9uIFAoYSkgeyBpZiAoISh0aGlzIGluc3RhbmNlb2YgUCkpXG4gICAgcmV0dXJuIG5ldyBQKGEpOyB0aGlzLl9yZWFkYWJsZVN0YXRlID0gbmV3IG9kKGEsIHRoaXMpOyB0aGlzLnJlYWRhYmxlID0gITA7IGEgJiYgXCJmdW5jdGlvblwiID09PSB0eXBlb2YgYS5yZWFkICYmICh0aGlzLl9yZWFkID0gYS5yZWFkKTsgTy5jYWxsKHRoaXMpOyB9XG5QLnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24gKGEsIGIpIHsgdmFyIGMgPSB0aGlzLl9yZWFkYWJsZVN0YXRlOyBjLm9iamVjdE1vZGUgfHwgXCJzdHJpbmdcIiAhPT0gdHlwZW9mIGEgfHwgKGIgPSBiIHx8IGMuZGVmYXVsdEVuY29kaW5nLCBiICE9PSBjLmVuY29kaW5nICYmIChhID0gei5mcm9tKGEsIGIpLCBiID0gXCJcIikpOyByZXR1cm4gcWQodGhpcywgYywgYSwgYiwgITEpOyB9O1xuUC5wcm90b3R5cGUudW5zaGlmdCA9IGZ1bmN0aW9uIChhKSB7IHJldHVybiBxZCh0aGlzLCB0aGlzLl9yZWFkYWJsZVN0YXRlLCBhLCBcIlwiLCAhMCk7IH07XG5QLnByb3RvdHlwZS5pc1BhdXNlZCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuICExID09PSB0aGlzLl9yZWFkYWJsZVN0YXRlLmZsb3dpbmc7IH07XG5mdW5jdGlvbiBxZChhLCBiLCBjLCBkLCBlKSB7XG4gICAgdmFyIGYgPSBjO1xuICAgIHZhciBnID0gbnVsbDtcbiAgICBOYShmKSB8fCBcInN0cmluZ1wiID09PSB0eXBlb2YgZiB8fCBudWxsID09PSBmIHx8IHZvaWQgMCA9PT0gZiB8fCBiLm9iamVjdE1vZGUgfHwgKGcgPSBuZXcgVHlwZUVycm9yKFwiSW52YWxpZCBub24tc3RyaW5nL2J1ZmZlciBjaHVua1wiKSk7XG4gICAgaWYgKGYgPSBnKVxuICAgICAgICBhLmVtaXQoXCJlcnJvclwiLCBmKTtcbiAgICBlbHNlIGlmIChudWxsID09PSBjKVxuICAgICAgICBiLnJlYWRpbmcgPSAhMSwgYi5lbmRlZCB8fCAoYi5kZWNvZGVyICYmIChjID0gYi5kZWNvZGVyLmVuZCgpKSAmJiBjLmxlbmd0aCAmJiAoYi5idWZmZXIucHVzaChjKSwgYi5sZW5ndGggKz0gYi5vYmplY3RNb2RlID8gMSA6IGMubGVuZ3RoKSwgYi5lbmRlZCA9ICEwLCByZChhKSk7XG4gICAgZWxzZSBpZiAoYi5vYmplY3RNb2RlIHx8IGMgJiYgMCA8IGMubGVuZ3RoKVxuICAgICAgICBpZiAoYi5lbmRlZCAmJiAhZSlcbiAgICAgICAgICAgIGEuZW1pdChcImVycm9yXCIsIEVycm9yKFwic3RyZWFtLnB1c2goKSBhZnRlciBFT0ZcIikpO1xuICAgICAgICBlbHNlIGlmIChiLmVuZEVtaXR0ZWQgJiYgZSlcbiAgICAgICAgICAgIGEuZW1pdChcImVycm9yXCIsIEVycm9yKFwic3RyZWFtLnVuc2hpZnQoKSBhZnRlciBlbmQgZXZlbnRcIikpO1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmIChiLmRlY29kZXIgJiYgIWUgJiYgIWQpIHtcbiAgICAgICAgICAgICAgICBjID0gYi5kZWNvZGVyLndyaXRlKGMpO1xuICAgICAgICAgICAgICAgIHZhciBoID0gIWIub2JqZWN0TW9kZSAmJiAwID09PSBjLmxlbmd0aDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGUgfHwgKGIucmVhZGluZyA9ICExKTtcbiAgICAgICAgICAgIGggfHwgKGIuZmxvd2luZyAmJiAwID09PSBiLmxlbmd0aCAmJiAhYi5zeW5jID8gKGEuZW1pdChcImRhdGFcIiwgYyksIGEucmVhZCgwKSkgOiAoYi5sZW5ndGggKz0gYi5vYmplY3RNb2RlID8gMSA6IGMubGVuZ3RoLCBlID8gYi5idWZmZXIudW5zaGlmdChjKSA6IGIuYnVmZmVyLnB1c2goYyksIGIubmVlZFJlYWRhYmxlICYmIHJkKGEpKSk7XG4gICAgICAgICAgICBiLnJlYWRpbmdNb3JlIHx8IChiLnJlYWRpbmdNb3JlID0gITAsIEcoc2QsIGEsIGIpKTtcbiAgICAgICAgfVxuICAgIGVsc2VcbiAgICAgICAgZSB8fCAoYi5yZWFkaW5nID0gITEpO1xuICAgIHJldHVybiAhYi5lbmRlZCAmJiAoYi5uZWVkUmVhZGFibGUgfHwgYi5sZW5ndGggPCBiLmhpZ2hXYXRlck1hcmsgfHwgMCA9PT0gYi5sZW5ndGgpO1xufVxuUC5wcm90b3R5cGUuc2V0RW5jb2RpbmcgPSBmdW5jdGlvbiAoYSkgeyB0aGlzLl9yZWFkYWJsZVN0YXRlLmRlY29kZXIgPSBuZXcga2QoYSk7IHRoaXMuX3JlYWRhYmxlU3RhdGUuZW5jb2RpbmcgPSBhOyByZXR1cm4gdGhpczsgfTtcbmZ1bmN0aW9uIHRkKGEsIGIpIHsgaWYgKDAgPj0gYSB8fCAwID09PSBiLmxlbmd0aCAmJiBiLmVuZGVkKVxuICAgIHJldHVybiAwOyBpZiAoYi5vYmplY3RNb2RlKVxuICAgIHJldHVybiAxOyBpZiAoYSAhPT0gYSlcbiAgICByZXR1cm4gYi5mbG93aW5nICYmIGIubGVuZ3RoID8gYi5idWZmZXIuaGVhZC5kYXRhLmxlbmd0aCA6IGIubGVuZ3RoOyBpZiAoYSA+IGIuaGlnaFdhdGVyTWFyaykge1xuICAgIHZhciBjID0gYTtcbiAgICA4Mzg4NjA4IDw9IGMgPyBjID0gODM4ODYwOCA6IChjLS0sIGMgfD0gYyA+Pj4gMSwgYyB8PSBjID4+PiAyLCBjIHw9IGMgPj4+IDQsIGMgfD0gYyA+Pj4gOCwgYyB8PSBjID4+PiAxNiwgYysrKTtcbiAgICBiLmhpZ2hXYXRlck1hcmsgPSBjO1xufSByZXR1cm4gYSA8PSBiLmxlbmd0aCA/IGEgOiBiLmVuZGVkID8gYi5sZW5ndGggOiAoYi5uZWVkUmVhZGFibGUgPSAhMCwgMCk7IH1cblAucHJvdG90eXBlLnJlYWQgPSBmdW5jdGlvbiAoYSkge1xuICAgIFEoXCJyZWFkXCIsIGEpO1xuICAgIGEgPSBwYXJzZUludChhLCAxMCk7XG4gICAgdmFyIGIgPSB0aGlzLl9yZWFkYWJsZVN0YXRlLCBjID0gYTtcbiAgICAwICE9PSBhICYmIChiLmVtaXR0ZWRSZWFkYWJsZSA9ICExKTtcbiAgICBpZiAoMCA9PT0gYSAmJiBiLm5lZWRSZWFkYWJsZSAmJiAoYi5sZW5ndGggPj0gYi5oaWdoV2F0ZXJNYXJrIHx8IGIuZW5kZWQpKVxuICAgICAgICByZXR1cm4gUShcInJlYWQ6IGVtaXRSZWFkYWJsZVwiLCBiLmxlbmd0aCwgYi5lbmRlZCksIDAgPT09IGIubGVuZ3RoICYmIGIuZW5kZWQgPyBKZCh0aGlzKSA6IHJkKHRoaXMpLCBudWxsO1xuICAgIGEgPSB0ZChhLCBiKTtcbiAgICBpZiAoMCA9PT0gYSAmJiBiLmVuZGVkKVxuICAgICAgICByZXR1cm4gMCA9PT0gYi5sZW5ndGggJiYgSmQodGhpcyksIG51bGw7XG4gICAgdmFyIGQgPSBiLm5lZWRSZWFkYWJsZTtcbiAgICBRKFwibmVlZCByZWFkYWJsZVwiLCBkKTtcbiAgICBpZiAoMCA9PT0gYi5sZW5ndGggfHwgYi5sZW5ndGggLSBhIDwgYi5oaWdoV2F0ZXJNYXJrKVxuICAgICAgICBkID0gITAsIFEoXCJsZW5ndGggbGVzcyB0aGFuIHdhdGVybWFya1wiLCBkKTtcbiAgICBiLmVuZGVkIHx8IGIucmVhZGluZyA/IFEoXCJyZWFkaW5nIG9yIGVuZGVkXCIsICExKSA6IGQgJiYgKFEoXCJkbyByZWFkXCIpLCBiLnJlYWRpbmcgPSAhMCwgYi5zeW5jID0gITAsIDAgPT09IGIubGVuZ3RoICYmIChiLm5lZWRSZWFkYWJsZSA9ICEwKSwgdGhpcy5fcmVhZChiLmhpZ2hXYXRlck1hcmspLCBiLnN5bmMgPSAhMSwgYi5yZWFkaW5nIHx8IChhID0gdGQoYywgYikpKTtcbiAgICBkID0gMCA8IGEgPyBLZChhLCBiKSA6IG51bGw7XG4gICAgbnVsbCA9PT0gZCA/IChiLm5lZWRSZWFkYWJsZSA9ICEwLCBhID0gMCkgOiBiLmxlbmd0aCAtPSBhO1xuICAgIDAgPT09IGIubGVuZ3RoICYmIChiLmVuZGVkIHx8IChiLm5lZWRSZWFkYWJsZSA9ICEwKSwgYyAhPT0gYSAmJiBiLmVuZGVkICYmIEpkKHRoaXMpKTtcbiAgICBudWxsICE9PSBkICYmIHRoaXMuZW1pdChcImRhdGFcIiwgZCk7XG4gICAgcmV0dXJuIGQ7XG59O1xuZnVuY3Rpb24gcmQoYSkgeyB2YXIgYiA9IGEuX3JlYWRhYmxlU3RhdGU7IGIubmVlZFJlYWRhYmxlID0gITE7IGIuZW1pdHRlZFJlYWRhYmxlIHx8IChRKFwiZW1pdFJlYWRhYmxlXCIsIGIuZmxvd2luZyksIGIuZW1pdHRlZFJlYWRhYmxlID0gITAsIGIuc3luYyA/IEcoTGQsIGEpIDogTGQoYSkpOyB9XG5mdW5jdGlvbiBMZChhKSB7IFEoXCJlbWl0IHJlYWRhYmxlXCIpOyBhLmVtaXQoXCJyZWFkYWJsZVwiKTsgTWQoYSk7IH1cbmZ1bmN0aW9uIHNkKGEsIGIpIHsgZm9yICh2YXIgYyA9IGIubGVuZ3RoOyAhYi5yZWFkaW5nICYmICFiLmZsb3dpbmcgJiYgIWIuZW5kZWQgJiYgYi5sZW5ndGggPCBiLmhpZ2hXYXRlck1hcmsgJiYgKFEoXCJtYXliZVJlYWRNb3JlIHJlYWQgMFwiKSwgYS5yZWFkKDApLCBjICE9PSBiLmxlbmd0aCk7KVxuICAgIGMgPSBiLmxlbmd0aDsgYi5yZWFkaW5nTW9yZSA9ICExOyB9XG5QLnByb3RvdHlwZS5fcmVhZCA9IGZ1bmN0aW9uICgpIHsgdGhpcy5lbWl0KFwiZXJyb3JcIiwgRXJyb3IoXCJub3QgaW1wbGVtZW50ZWRcIikpOyB9O1xuUC5wcm90b3R5cGUucGlwZSA9IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgZnVuY3Rpb24gYyhhKSB7IFEoXCJvbnVucGlwZVwiKTsgYSA9PT0gbiAmJiBlKCk7IH1cbiAgICBmdW5jdGlvbiBkKCkgeyBRKFwib25lbmRcIik7IGEuZW5kKCk7IH1cbiAgICBmdW5jdGlvbiBlKCkgeyBRKFwiY2xlYW51cFwiKTsgYS5yZW1vdmVMaXN0ZW5lcihcImNsb3NlXCIsIGgpOyBhLnJlbW92ZUxpc3RlbmVyKFwiZmluaXNoXCIsIGspOyBhLnJlbW92ZUxpc3RlbmVyKFwiZHJhaW5cIiwgQik7IGEucmVtb3ZlTGlzdGVuZXIoXCJlcnJvclwiLCBnKTsgYS5yZW1vdmVMaXN0ZW5lcihcInVucGlwZVwiLCBjKTsgbi5yZW1vdmVMaXN0ZW5lcihcImVuZFwiLCBkKTsgbi5yZW1vdmVMaXN0ZW5lcihcImVuZFwiLCBlKTsgbi5yZW1vdmVMaXN0ZW5lcihcImRhdGFcIiwgZik7IG0gPSAhMDsgIXEuYXdhaXREcmFpbiB8fCBhLl93cml0YWJsZVN0YXRlICYmICFhLl93cml0YWJsZVN0YXRlLm5lZWREcmFpbiB8fCBCKCk7IH1cbiAgICBmdW5jdGlvbiBmKGIpIHtcbiAgICAgICAgUShcIm9uZGF0YVwiKTtcbiAgICAgICAgdiA9ICExO1xuICAgICAgICAhMSAhPT0gYS53cml0ZShiKSB8fCB2IHx8ICgoMSA9PT0gcS5waXBlc0NvdW50ICYmIHEucGlwZXMgPT09XG4gICAgICAgICAgICBhIHx8IDEgPCBxLnBpcGVzQ291bnQgJiYgLTEgIT09IE5kKHEucGlwZXMsIGEpKSAmJiAhbSAmJiAoUShcImZhbHNlIHdyaXRlIHJlc3BvbnNlLCBwYXVzZVwiLCBuLl9yZWFkYWJsZVN0YXRlLmF3YWl0RHJhaW4pLCBuLl9yZWFkYWJsZVN0YXRlLmF3YWl0RHJhaW4rKywgdiA9ICEwKSwgbi5wYXVzZSgpKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZyhiKSB7IFEoXCJvbmVycm9yXCIsIGIpOyBwKCk7IGEucmVtb3ZlTGlzdGVuZXIoXCJlcnJvclwiLCBnKTsgMCA9PT0gYS5saXN0ZW5lcnMoXCJlcnJvclwiKS5sZW5ndGggJiYgYS5lbWl0KFwiZXJyb3JcIiwgYik7IH1cbiAgICBmdW5jdGlvbiBoKCkgeyBhLnJlbW92ZUxpc3RlbmVyKFwiZmluaXNoXCIsIGspOyBwKCk7IH1cbiAgICBmdW5jdGlvbiBrKCkgeyBRKFwib25maW5pc2hcIik7IGEucmVtb3ZlTGlzdGVuZXIoXCJjbG9zZVwiLCBoKTsgcCgpOyB9XG4gICAgZnVuY3Rpb24gcCgpIHsgUShcInVucGlwZVwiKTsgbi51bnBpcGUoYSk7IH1cbiAgICB2YXIgbiA9IHRoaXMsIHEgPSB0aGlzLl9yZWFkYWJsZVN0YXRlO1xuICAgIHN3aXRjaCAocS5waXBlc0NvdW50KSB7XG4gICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgIHEucGlwZXMgPSBhO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgIHEucGlwZXMgPSBbcS5waXBlcyxcbiAgICAgICAgICAgICAgICBhXTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OiBxLnBpcGVzLnB1c2goYSk7XG4gICAgfVxuICAgIHEucGlwZXNDb3VudCArPSAxO1xuICAgIFEoXCJwaXBlIGNvdW50PSVkIG9wdHM9JWpcIiwgcS5waXBlc0NvdW50LCBiKTtcbiAgICBiID0gYiAmJiAhMSA9PT0gYi5lbmQgPyBlIDogZDtcbiAgICBpZiAocS5lbmRFbWl0dGVkKVxuICAgICAgICBHKGIpO1xuICAgIGVsc2VcbiAgICAgICAgbi5vbmNlKFwiZW5kXCIsIGIpO1xuICAgIGEub24oXCJ1bnBpcGVcIiwgYyk7XG4gICAgdmFyIEIgPSBPZChuKTtcbiAgICBhLm9uKFwiZHJhaW5cIiwgQik7XG4gICAgdmFyIG0gPSAhMSwgdiA9ICExO1xuICAgIG4ub24oXCJkYXRhXCIsIGYpO1xuICAgIHBkKGEsIFwiZXJyb3JcIiwgZyk7XG4gICAgYS5vbmNlKFwiY2xvc2VcIiwgaCk7XG4gICAgYS5vbmNlKFwiZmluaXNoXCIsIGspO1xuICAgIGEuZW1pdChcInBpcGVcIiwgbik7XG4gICAgcS5mbG93aW5nIHx8IChRKFwicGlwZSByZXN1bWVcIiksIG4ucmVzdW1lKCkpO1xuICAgIHJldHVybiBhO1xufTtcbmZ1bmN0aW9uIE9kKGEpIHsgcmV0dXJuIGZ1bmN0aW9uICgpIHsgdmFyIGIgPSBhLl9yZWFkYWJsZVN0YXRlOyBRKFwicGlwZU9uRHJhaW5cIiwgYi5hd2FpdERyYWluKTsgYi5hd2FpdERyYWluICYmIGIuYXdhaXREcmFpbi0tOyAwID09PSBiLmF3YWl0RHJhaW4gJiYgYS5saXN0ZW5lcnMoXCJkYXRhXCIpLmxlbmd0aCAmJiAoYi5mbG93aW5nID0gITAsIE1kKGEpKTsgfTsgfVxuUC5wcm90b3R5cGUudW5waXBlID0gZnVuY3Rpb24gKGEpIHsgdmFyIGIgPSB0aGlzLl9yZWFkYWJsZVN0YXRlOyBpZiAoMCA9PT0gYi5waXBlc0NvdW50KVxuICAgIHJldHVybiB0aGlzOyBpZiAoMSA9PT0gYi5waXBlc0NvdW50KSB7XG4gICAgaWYgKGEgJiYgYSAhPT0gYi5waXBlcylcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgYSB8fCAoYSA9IGIucGlwZXMpO1xuICAgIGIucGlwZXMgPSBudWxsO1xuICAgIGIucGlwZXNDb3VudCA9IDA7XG4gICAgYi5mbG93aW5nID0gITE7XG4gICAgYSAmJiBhLmVtaXQoXCJ1bnBpcGVcIiwgdGhpcyk7XG4gICAgcmV0dXJuIHRoaXM7XG59IGlmICghYSkge1xuICAgIGEgPSBiLnBpcGVzO1xuICAgIHZhciBjID0gYi5waXBlc0NvdW50O1xuICAgIGIucGlwZXMgPSBudWxsO1xuICAgIGIucGlwZXNDb3VudCA9IDA7XG4gICAgYi5mbG93aW5nID0gITE7XG4gICAgZm9yIChiID0gMDsgYiA8IGM7IGIrKylcbiAgICAgICAgYVtiXS5lbWl0KFwidW5waXBlXCIsIHRoaXMpO1xuICAgIHJldHVybiB0aGlzO1xufSBjID0gTmQoYi5waXBlcywgYSk7IGlmICgtMSA9PT0gYylcbiAgICByZXR1cm4gdGhpczsgYi5waXBlcy5zcGxpY2UoYywgMSk7IC0tYi5waXBlc0NvdW50OyAxID09PSBiLnBpcGVzQ291bnQgJiYgKGIucGlwZXMgPSBiLnBpcGVzWzBdKTsgYS5lbWl0KFwidW5waXBlXCIsIHRoaXMpOyByZXR1cm4gdGhpczsgfTtcblAucHJvdG90eXBlLm9uID0gZnVuY3Rpb24gKGEsIGIpIHsgYiA9IE8ucHJvdG90eXBlLm9uLmNhbGwodGhpcywgYSwgYik7IFwiZGF0YVwiID09PSBhID8gITEgIT09IHRoaXMuX3JlYWRhYmxlU3RhdGUuZmxvd2luZyAmJiB0aGlzLnJlc3VtZSgpIDogXCJyZWFkYWJsZVwiID09PSBhICYmIChhID0gdGhpcy5fcmVhZGFibGVTdGF0ZSwgYS5lbmRFbWl0dGVkIHx8IGEucmVhZGFibGVMaXN0ZW5pbmcgfHwgKGEucmVhZGFibGVMaXN0ZW5pbmcgPSBhLm5lZWRSZWFkYWJsZSA9ICEwLCBhLmVtaXR0ZWRSZWFkYWJsZSA9ICExLCBhLnJlYWRpbmcgPyBhLmxlbmd0aCAmJiByZCh0aGlzKSA6IEcoUGQsIHRoaXMpKSk7IHJldHVybiBiOyB9O1xuUC5wcm90b3R5cGUuYWRkTGlzdGVuZXIgPSBQLnByb3RvdHlwZS5vbjtcbmZ1bmN0aW9uIFBkKGEpIHsgUShcInJlYWRhYmxlIG5leHR0aWNrIHJlYWQgMFwiKTsgYS5yZWFkKDApOyB9XG5QLnByb3RvdHlwZS5yZXN1bWUgPSBmdW5jdGlvbiAoKSB7IHZhciBhID0gdGhpcy5fcmVhZGFibGVTdGF0ZTsgYS5mbG93aW5nIHx8IChRKFwicmVzdW1lXCIpLCBhLmZsb3dpbmcgPSAhMCwgYS5yZXN1bWVTY2hlZHVsZWQgfHwgKGEucmVzdW1lU2NoZWR1bGVkID0gITAsIEcoUWQsIHRoaXMsIGEpKSk7IHJldHVybiB0aGlzOyB9O1xuZnVuY3Rpb24gUWQoYSwgYikgeyBiLnJlYWRpbmcgfHwgKFEoXCJyZXN1bWUgcmVhZCAwXCIpLCBhLnJlYWQoMCkpOyBiLnJlc3VtZVNjaGVkdWxlZCA9ICExOyBiLmF3YWl0RHJhaW4gPSAwOyBhLmVtaXQoXCJyZXN1bWVcIik7IE1kKGEpOyBiLmZsb3dpbmcgJiYgIWIucmVhZGluZyAmJiBhLnJlYWQoMCk7IH1cblAucHJvdG90eXBlLnBhdXNlID0gZnVuY3Rpb24gKCkgeyBRKFwiY2FsbCBwYXVzZSBmbG93aW5nPSVqXCIsIHRoaXMuX3JlYWRhYmxlU3RhdGUuZmxvd2luZyk7ICExICE9PSB0aGlzLl9yZWFkYWJsZVN0YXRlLmZsb3dpbmcgJiYgKFEoXCJwYXVzZVwiKSwgdGhpcy5fcmVhZGFibGVTdGF0ZS5mbG93aW5nID0gITEsIHRoaXMuZW1pdChcInBhdXNlXCIpKTsgcmV0dXJuIHRoaXM7IH07XG5mdW5jdGlvbiBNZChhKSB7IHZhciBiID0gYS5fcmVhZGFibGVTdGF0ZTsgZm9yIChRKFwiZmxvd1wiLCBiLmZsb3dpbmcpOyBiLmZsb3dpbmcgJiYgbnVsbCAhPT0gYS5yZWFkKCk7KVxuICAgIDsgfVxuUC5wcm90b3R5cGUud3JhcCA9IGZ1bmN0aW9uIChhKSB7XG4gICAgdmFyIGIgPSB0aGlzLl9yZWFkYWJsZVN0YXRlLCBjID0gITEsIGQgPSB0aGlzO1xuICAgIGEub24oXCJlbmRcIiwgZnVuY3Rpb24gKCkgeyBRKFwid3JhcHBlZCBlbmRcIik7IGlmIChiLmRlY29kZXIgJiYgIWIuZW5kZWQpIHtcbiAgICAgICAgdmFyIGEgPSBiLmRlY29kZXIuZW5kKCk7XG4gICAgICAgIGEgJiYgYS5sZW5ndGggJiYgZC5wdXNoKGEpO1xuICAgIH0gZC5wdXNoKG51bGwpOyB9KTtcbiAgICBhLm9uKFwiZGF0YVwiLCBmdW5jdGlvbiAoZSkgeyBRKFwid3JhcHBlZCBkYXRhXCIpOyBiLmRlY29kZXIgJiYgKGUgPSBiLmRlY29kZXIud3JpdGUoZSkpOyBiLm9iamVjdE1vZGUgJiYgKG51bGwgPT09IGUgfHwgdm9pZCAwID09PSBlKSB8fCAhKGIub2JqZWN0TW9kZSB8fCBlICYmIGUubGVuZ3RoKSB8fCBkLnB1c2goZSkgfHwgKGMgPSAhMCwgYS5wYXVzZSgpKTsgfSk7XG4gICAgZm9yICh2YXIgZSBpbiBhKVxuICAgICAgICB2b2lkIDAgPT09IHRoaXNbZV0gJiYgXCJmdW5jdGlvblwiID09PSB0eXBlb2YgYVtlXSAmJiAodGhpc1tlXSA9IGZ1bmN0aW9uIChiKSB7IHJldHVybiBmdW5jdGlvbiAoKSB7IHJldHVybiBhW2JdLmFwcGx5KGEsIGFyZ3VtZW50cyk7IH07IH0oZSkpO1xuICAgIFJkKFtcImVycm9yXCIsXG4gICAgICAgIFwiY2xvc2VcIiwgXCJkZXN0cm95XCIsIFwicGF1c2VcIiwgXCJyZXN1bWVcIl0sIGZ1bmN0aW9uIChiKSB7IGEub24oYiwgZC5lbWl0LmJpbmQoZCwgYikpOyB9KTtcbiAgICBkLl9yZWFkID0gZnVuY3Rpb24gKGIpIHsgUShcIndyYXBwZWQgX3JlYWRcIiwgYik7IGMgJiYgKGMgPSAhMSwgYS5yZXN1bWUoKSk7IH07XG4gICAgcmV0dXJuIGQ7XG59O1xuUC5fZnJvbUxpc3QgPSBLZDtcbmZ1bmN0aW9uIEtkKGEsIGIpIHtcbiAgICBpZiAoMCA9PT0gYi5sZW5ndGgpXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIGlmIChiLm9iamVjdE1vZGUpXG4gICAgICAgIHZhciBjID0gYi5idWZmZXIuc2hpZnQoKTtcbiAgICBlbHNlIGlmICghYSB8fCBhID49IGIubGVuZ3RoKVxuICAgICAgICBjID0gYi5kZWNvZGVyID8gYi5idWZmZXIuam9pbihcIlwiKSA6IDEgPT09IGIuYnVmZmVyLmxlbmd0aCA/IGIuYnVmZmVyLmhlYWQuZGF0YSA6IGIuYnVmZmVyLmNvbmNhdChiLmxlbmd0aCksIGIuYnVmZmVyLmNsZWFyKCk7XG4gICAgZWxzZSB7XG4gICAgICAgIGMgPSBiLmJ1ZmZlcjtcbiAgICAgICAgYiA9IGIuZGVjb2RlcjtcbiAgICAgICAgaWYgKGEgPCBjLmhlYWQuZGF0YS5sZW5ndGgpXG4gICAgICAgICAgICBiID0gYy5oZWFkLmRhdGEuc2xpY2UoMCwgYSksIGMuaGVhZC5kYXRhID0gYy5oZWFkLmRhdGEuc2xpY2UoYSk7XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKGEgPT09IGMuaGVhZC5kYXRhLmxlbmd0aClcbiAgICAgICAgICAgICAgICBjID0gYy5zaGlmdCgpO1xuICAgICAgICAgICAgZWxzZSBpZiAoYikge1xuICAgICAgICAgICAgICAgIGIgPSBjLmhlYWQ7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAxLCBlID0gYi5kYXRhO1xuICAgICAgICAgICAgICAgIGZvciAoYSAtPSBlLmxlbmd0aDsgYiA9IGIubmV4dDspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBiLmRhdGEsIGcgPSBhID4gZi5sZW5ndGggPyBmLmxlbmd0aCA6IGE7XG4gICAgICAgICAgICAgICAgICAgIGUgPSBnID09PSBmLmxlbmd0aCA/IGUgKyBmIDogZSArIGYuc2xpY2UoMCwgYSk7XG4gICAgICAgICAgICAgICAgICAgIGEgLT0gZztcbiAgICAgICAgICAgICAgICAgICAgaWYgKDAgPT09IGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGcgPT09IGYubGVuZ3RoID8gKCsrZCwgYy5oZWFkID0gYi5uZXh0ID8gYi5uZXh0IDogYy50YWlsID0gbnVsbCkgOiAoYy5oZWFkID0gYiwgYi5kYXRhID0gZi5zbGljZShnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICArK2Q7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGMubGVuZ3RoIC09IGQ7XG4gICAgICAgICAgICAgICAgYyA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBiID0gei5hbGxvY1Vuc2FmZShhKTtcbiAgICAgICAgICAgICAgICBkID0gYy5oZWFkO1xuICAgICAgICAgICAgICAgIGUgPSAxO1xuICAgICAgICAgICAgICAgIGQuZGF0YS5jb3B5KGIpO1xuICAgICAgICAgICAgICAgIGZvciAoYSAtPSBkLmRhdGEubGVuZ3RoOyBkID0gZC5uZXh0Oykge1xuICAgICAgICAgICAgICAgICAgICBmID0gZC5kYXRhO1xuICAgICAgICAgICAgICAgICAgICBnID0gYSA+IGYubGVuZ3RoID8gZi5sZW5ndGggOiBhO1xuICAgICAgICAgICAgICAgICAgICBmLmNvcHkoYiwgYi5sZW5ndGggLSBhLCAwLCBnKTtcbiAgICAgICAgICAgICAgICAgICAgYSAtPSBnO1xuICAgICAgICAgICAgICAgICAgICBpZiAoMCA9PT0gYSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZyA9PT0gZi5sZW5ndGggPyAoKytlLCBjLmhlYWQgPSBkLm5leHQgPyBkLm5leHQgOiBjLnRhaWwgPSBudWxsKSA6IChjLmhlYWQgPSBkLCBkLmRhdGEgPSBmLnNsaWNlKGcpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICsrZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYy5sZW5ndGggLT0gZTtcbiAgICAgICAgICAgICAgICBjID0gYjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGIgPSBjO1xuICAgICAgICB9XG4gICAgICAgIGMgPSBiO1xuICAgIH1cbiAgICByZXR1cm4gYztcbn1cbmZ1bmN0aW9uIEpkKGEpIHsgdmFyIGIgPSBhLl9yZWFkYWJsZVN0YXRlOyBpZiAoMCA8IGIubGVuZ3RoKVxuICAgIHRocm93IEVycm9yKCdcImVuZFJlYWRhYmxlKClcIiBjYWxsZWQgb24gbm9uLWVtcHR5IHN0cmVhbScpOyBiLmVuZEVtaXR0ZWQgfHwgKGIuZW5kZWQgPSAhMCwgRyhTZCwgYiwgYSkpOyB9XG5mdW5jdGlvbiBTZChhLCBiKSB7IGEuZW5kRW1pdHRlZCB8fCAwICE9PSBhLmxlbmd0aCB8fCAoYS5lbmRFbWl0dGVkID0gITAsIGIucmVhZGFibGUgPSAhMSwgYi5lbWl0KFwiZW5kXCIpKTsgfVxuZnVuY3Rpb24gUmQoYSwgYikgeyBmb3IgKHZhciBjID0gMCwgZCA9IGEubGVuZ3RoOyBjIDwgZDsgYysrKVxuICAgIGIoYVtjXSwgYyk7IH1cbmZ1bmN0aW9uIE5kKGEsIGIpIHsgZm9yICh2YXIgYyA9IDAsIGQgPSBhLmxlbmd0aDsgYyA8IGQ7IGMrKylcbiAgICBpZiAoYVtjXSA9PT0gYilcbiAgICAgICAgcmV0dXJuIGM7IHJldHVybiAtMTsgfVxuVy5Xcml0YWJsZVN0YXRlID0gVGQ7XG5EYihXLCBPKTtcbmZ1bmN0aW9uIFVkKCkgeyB9XG5mdW5jdGlvbiBWZChhLCBiLCBjKSB7IHRoaXMuY2h1bmsgPSBhOyB0aGlzLmVuY29kaW5nID0gYjsgdGhpcy5jYWxsYmFjayA9IGM7IHRoaXMubmV4dCA9IG51bGw7IH1cbmZ1bmN0aW9uIFRkKGEsIGIpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJidWZmZXJcIiwgeyBnZXQ6IEliKGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuZ2V0QnVmZmVyKCk7IH0sIFwiX3dyaXRhYmxlU3RhdGUuYnVmZmVyIGlzIGRlcHJlY2F0ZWQuIFVzZSBfd3JpdGFibGVTdGF0ZS5nZXRCdWZmZXIgaW5zdGVhZC5cIikgfSk7XG4gICAgYSA9IGEgfHwge307XG4gICAgdGhpcy5vYmplY3RNb2RlID0gISFhLm9iamVjdE1vZGU7XG4gICAgYiBpbnN0YW5jZW9mIFYgJiYgKHRoaXMub2JqZWN0TW9kZSA9IHRoaXMub2JqZWN0TW9kZSB8fCAhIWEud3JpdGFibGVPYmplY3RNb2RlKTtcbiAgICB2YXIgYyA9IGEuaGlnaFdhdGVyTWFyaywgZCA9IHRoaXMub2JqZWN0TW9kZSA/IDE2IDogMTYzODQ7XG4gICAgdGhpcy5oaWdoV2F0ZXJNYXJrID0gYyB8fCAwID09PSBjID8gYyA6IGQ7XG4gICAgdGhpcy5oaWdoV2F0ZXJNYXJrID0gfn50aGlzLmhpZ2hXYXRlck1hcms7XG4gICAgdGhpcy5maW5pc2hlZCA9IHRoaXMuZW5kZWQgPSB0aGlzLmVuZGluZyA9IHRoaXMubmVlZERyYWluID0gITE7XG4gICAgdGhpcy5kZWNvZGVTdHJpbmdzID0gITEgIT09IGEuZGVjb2RlU3RyaW5ncztcbiAgICB0aGlzLmRlZmF1bHRFbmNvZGluZyA9IGEuZGVmYXVsdEVuY29kaW5nIHx8IFwidXRmOFwiO1xuICAgIHRoaXMubGVuZ3RoID0gMDtcbiAgICB0aGlzLndyaXRpbmcgPSAhMTtcbiAgICB0aGlzLmNvcmtlZCA9IDA7XG4gICAgdGhpcy5zeW5jID0gITA7XG4gICAgdGhpcy5idWZmZXJQcm9jZXNzaW5nID0gITE7XG4gICAgdGhpcy5vbndyaXRlID0gZnVuY3Rpb24gKGEpIHsgdmFyIGMgPSBiLl93cml0YWJsZVN0YXRlLCBkID0gYy5zeW5jLCBlID0gYy53cml0ZWNiOyBjLndyaXRpbmcgPSAhMTsgYy53cml0ZWNiID0gbnVsbDsgYy5sZW5ndGggLT0gYy53cml0ZWxlbjsgYy53cml0ZWxlbiA9IDA7IGEgPyAoLS1jLnBlbmRpbmdjYiwgZCA/IEcoZSwgYSkgOiBlKGEpLCBiLl93cml0YWJsZVN0YXRlLmVycm9yRW1pdHRlZCA9ICEwLCBiLmVtaXQoXCJlcnJvclwiLCBhKSkgOiAoKGEgPSBXZChjKSkgfHwgYy5jb3JrZWQgfHwgYy5idWZmZXJQcm9jZXNzaW5nIHx8ICFjLmJ1ZmZlcmVkUmVxdWVzdCB8fCBYZChiLCBjKSwgZCA/IEcoWWQsIGIsIGMsIGEsIGUpIDogWWQoYiwgYywgYSwgZSkpOyB9O1xuICAgIHRoaXMud3JpdGVjYiA9IG51bGw7XG4gICAgdGhpcy53cml0ZWxlbiA9IDA7XG4gICAgdGhpcy5sYXN0QnVmZmVyZWRSZXF1ZXN0ID1cbiAgICAgICAgdGhpcy5idWZmZXJlZFJlcXVlc3QgPSBudWxsO1xuICAgIHRoaXMucGVuZGluZ2NiID0gMDtcbiAgICB0aGlzLmVycm9yRW1pdHRlZCA9IHRoaXMucHJlZmluaXNoZWQgPSAhMTtcbiAgICB0aGlzLmJ1ZmZlcmVkUmVxdWVzdENvdW50ID0gMDtcbiAgICB0aGlzLmNvcmtlZFJlcXVlc3RzRnJlZSA9IG5ldyBaZCh0aGlzKTtcbn1cblRkLnByb3RvdHlwZS5nZXRCdWZmZXIgPSBmdW5jdGlvbiAoKSB7IGZvciAodmFyIGEgPSB0aGlzLmJ1ZmZlcmVkUmVxdWVzdCwgYiA9IFtdOyBhOylcbiAgICBiLnB1c2goYSksIGEgPSBhLm5leHQ7IHJldHVybiBiOyB9O1xuZnVuY3Rpb24gVyhhKSB7IGlmICghKHRoaXMgaW5zdGFuY2VvZiBXIHx8IHRoaXMgaW5zdGFuY2VvZiBWKSlcbiAgICByZXR1cm4gbmV3IFcoYSk7IHRoaXMuX3dyaXRhYmxlU3RhdGUgPSBuZXcgVGQoYSwgdGhpcyk7IHRoaXMud3JpdGFibGUgPSAhMDsgYSAmJiAoXCJmdW5jdGlvblwiID09PSB0eXBlb2YgYS53cml0ZSAmJiAodGhpcy5fd3JpdGUgPSBhLndyaXRlKSwgXCJmdW5jdGlvblwiID09PSB0eXBlb2YgYS53cml0ZXYgJiYgKHRoaXMuX3dyaXRldiA9IGEud3JpdGV2KSk7IE8uY2FsbCh0aGlzKTsgfVxuVy5wcm90b3R5cGUucGlwZSA9IGZ1bmN0aW9uICgpIHsgdGhpcy5lbWl0KFwiZXJyb3JcIiwgRXJyb3IoXCJDYW5ub3QgcGlwZSwgbm90IHJlYWRhYmxlXCIpKTsgfTtcblcucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24gKGEsIGIsIGMpIHtcbiAgICB2YXIgZCA9IHRoaXMuX3dyaXRhYmxlU3RhdGUsIGUgPSAhMTtcbiAgICBcImZ1bmN0aW9uXCIgPT09IHR5cGVvZiBiICYmIChjID0gYiwgYiA9IG51bGwpO1xuICAgIHouaXNCdWZmZXIoYSkgPyBiID0gXCJidWZmZXJcIiA6IGIgfHwgKGIgPSBkLmRlZmF1bHRFbmNvZGluZyk7XG4gICAgXCJmdW5jdGlvblwiICE9PSB0eXBlb2YgYyAmJiAoYyA9IFVkKTtcbiAgICBpZiAoZC5lbmRlZClcbiAgICAgICAgZCA9IGMsIGEgPSBFcnJvcihcIndyaXRlIGFmdGVyIGVuZFwiKSwgdGhpcy5lbWl0KFwiZXJyb3JcIiwgYSksIEcoZCwgYSk7XG4gICAgZWxzZSB7XG4gICAgICAgIHZhciBmID0gYywgZyA9ICEwLCBoID0gITE7XG4gICAgICAgIG51bGwgPT09IGEgPyBoID0gbmV3IFR5cGVFcnJvcihcIk1heSBub3Qgd3JpdGUgbnVsbCB2YWx1ZXMgdG8gc3RyZWFtXCIpIDogei5pc0J1ZmZlcihhKSB8fCBcInN0cmluZ1wiID09PSB0eXBlb2YgYSB8fCB2b2lkIDAgPT09IGEgfHwgZC5vYmplY3RNb2RlIHx8IChoID0gbmV3IFR5cGVFcnJvcihcIkludmFsaWQgbm9uLXN0cmluZy9idWZmZXIgY2h1bmtcIikpO1xuICAgICAgICBoICYmICh0aGlzLmVtaXQoXCJlcnJvclwiLCBoKSwgRyhmLCBoKSwgZyA9ICExKTtcbiAgICAgICAgZyAmJiAoZC5wZW5kaW5nY2IrKyxcbiAgICAgICAgICAgIGUgPSBiLCBkLm9iamVjdE1vZGUgfHwgITEgPT09IGQuZGVjb2RlU3RyaW5ncyB8fCBcInN0cmluZ1wiICE9PSB0eXBlb2YgYSB8fCAoYSA9IHouZnJvbShhLCBlKSksIHouaXNCdWZmZXIoYSkgJiYgKGUgPSBcImJ1ZmZlclwiKSwgZiA9IGQub2JqZWN0TW9kZSA/IDEgOiBhLmxlbmd0aCwgZC5sZW5ndGggKz0gZiwgYiA9IGQubGVuZ3RoIDwgZC5oaWdoV2F0ZXJNYXJrLCBiIHx8IChkLm5lZWREcmFpbiA9ICEwKSwgZC53cml0aW5nIHx8IGQuY29ya2VkID8gKGYgPSBkLmxhc3RCdWZmZXJlZFJlcXVlc3QsIGQubGFzdEJ1ZmZlcmVkUmVxdWVzdCA9IG5ldyBWZChhLCBlLCBjKSwgZiA/IGYubmV4dCA9IGQubGFzdEJ1ZmZlcmVkUmVxdWVzdCA6IGQuYnVmZmVyZWRSZXF1ZXN0ID0gZC5sYXN0QnVmZmVyZWRSZXF1ZXN0LCBkLmJ1ZmZlcmVkUmVxdWVzdENvdW50ICs9IDEpIDogJGQodGhpcywgZCwgITEsIGYsIGEsIGUsIGMpLCBlID0gYik7XG4gICAgfVxuICAgIHJldHVybiBlO1xufTtcblcucHJvdG90eXBlLmNvcmsgPSBmdW5jdGlvbiAoKSB7IHRoaXMuX3dyaXRhYmxlU3RhdGUuY29ya2VkKys7IH07XG5XLnByb3RvdHlwZS51bmNvcmsgPSBmdW5jdGlvbiAoKSB7IHZhciBhID0gdGhpcy5fd3JpdGFibGVTdGF0ZTsgYS5jb3JrZWQgJiYgKGEuY29ya2VkLS0sIGEud3JpdGluZyB8fCBhLmNvcmtlZCB8fCBhLmZpbmlzaGVkIHx8IGEuYnVmZmVyUHJvY2Vzc2luZyB8fCAhYS5idWZmZXJlZFJlcXVlc3QgfHwgWGQodGhpcywgYSkpOyB9O1xuVy5wcm90b3R5cGUuc2V0RGVmYXVsdEVuY29kaW5nID0gZnVuY3Rpb24gKGEpIHsgXCJzdHJpbmdcIiA9PT0gdHlwZW9mIGEgJiYgKGEgPSBhLnRvTG93ZXJDYXNlKCkpOyBpZiAoISgtMSA8IFwiaGV4IHV0ZjggdXRmLTggYXNjaWkgYmluYXJ5IGJhc2U2NCB1Y3MyIHVjcy0yIHV0ZjE2bGUgdXRmLTE2bGUgcmF3XCIuc3BsaXQoXCIgXCIpLmluZGV4T2YoKGEgKyBcIlwiKS50b0xvd2VyQ2FzZSgpKSkpXG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlVua25vd24gZW5jb2Rpbmc6IFwiICsgYSk7IHRoaXMuX3dyaXRhYmxlU3RhdGUuZGVmYXVsdEVuY29kaW5nID0gYTsgcmV0dXJuIHRoaXM7IH07XG5mdW5jdGlvbiAkZChhLCBiLCBjLCBkLCBlLCBmLCBnKSB7IGIud3JpdGVsZW4gPSBkOyBiLndyaXRlY2IgPSBnOyBiLndyaXRpbmcgPSAhMDsgYi5zeW5jID0gITA7IGMgPyBhLl93cml0ZXYoZSwgYi5vbndyaXRlKSA6IGEuX3dyaXRlKGUsIGYsIGIub253cml0ZSk7IGIuc3luYyA9ICExOyB9XG5mdW5jdGlvbiBZZChhLCBiLCBjLCBkKSB7ICFjICYmIDAgPT09IGIubGVuZ3RoICYmIGIubmVlZERyYWluICYmIChiLm5lZWREcmFpbiA9ICExLCBhLmVtaXQoXCJkcmFpblwiKSk7IGIucGVuZGluZ2NiLS07IGQoKTsgYWUoYSwgYik7IH1cbmZ1bmN0aW9uIFhkKGEsIGIpIHtcbiAgICBiLmJ1ZmZlclByb2Nlc3NpbmcgPSAhMDtcbiAgICB2YXIgYyA9IGIuYnVmZmVyZWRSZXF1ZXN0O1xuICAgIGlmIChhLl93cml0ZXYgJiYgYyAmJiBjLm5leHQpIHtcbiAgICAgICAgdmFyIGQgPSBBcnJheShiLmJ1ZmZlcmVkUmVxdWVzdENvdW50KSwgZSA9IGIuY29ya2VkUmVxdWVzdHNGcmVlO1xuICAgICAgICBlLmVudHJ5ID0gYztcbiAgICAgICAgZm9yICh2YXIgZiA9IDA7IGM7KVxuICAgICAgICAgICAgZFtmXSA9IGMsIGMgPSBjLm5leHQsIGYgKz0gMTtcbiAgICAgICAgJGQoYSwgYiwgITAsIGIubGVuZ3RoLCBkLCBcIlwiLCBlLmZpbmlzaCk7XG4gICAgICAgIGIucGVuZGluZ2NiKys7XG4gICAgICAgIGIubGFzdEJ1ZmZlcmVkUmVxdWVzdCA9IG51bGw7XG4gICAgICAgIGUubmV4dCA/IChiLmNvcmtlZFJlcXVlc3RzRnJlZSA9IGUubmV4dCwgZS5uZXh0ID0gbnVsbCkgOiBiLmNvcmtlZFJlcXVlc3RzRnJlZSA9IG5ldyBaZChiKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGZvciAoOyBjICYmIChkID0gYy5jaHVuaywgJGQoYSwgYiwgITEsIGIub2JqZWN0TW9kZSA/IDEgOiBkLmxlbmd0aCwgZCwgYy5lbmNvZGluZywgYy5jYWxsYmFjayksIGMgPSBjLm5leHQsICFiLndyaXRpbmcpOylcbiAgICAgICAgICAgIDtcbiAgICAgICAgbnVsbCA9PT0gYyAmJiAoYi5sYXN0QnVmZmVyZWRSZXF1ZXN0ID0gbnVsbCk7XG4gICAgfVxuICAgIGIuYnVmZmVyZWRSZXF1ZXN0Q291bnQgPVxuICAgICAgICAwO1xuICAgIGIuYnVmZmVyZWRSZXF1ZXN0ID0gYztcbiAgICBiLmJ1ZmZlclByb2Nlc3NpbmcgPSAhMTtcbn1cblcucHJvdG90eXBlLl93cml0ZSA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IGMoRXJyb3IoXCJub3QgaW1wbGVtZW50ZWRcIikpOyB9O1xuVy5wcm90b3R5cGUuX3dyaXRldiA9IG51bGw7XG5XLnByb3RvdHlwZS5lbmQgPSBmdW5jdGlvbiAoYSwgYiwgYykgeyB2YXIgZCA9IHRoaXMuX3dyaXRhYmxlU3RhdGU7IFwiZnVuY3Rpb25cIiA9PT0gdHlwZW9mIGEgPyAoYyA9IGEsIGIgPSBhID0gbnVsbCkgOiBcImZ1bmN0aW9uXCIgPT09IHR5cGVvZiBiICYmIChjID0gYiwgYiA9IG51bGwpOyBudWxsICE9PSBhICYmIHZvaWQgMCAhPT0gYSAmJiB0aGlzLndyaXRlKGEsIGIpOyBkLmNvcmtlZCAmJiAoZC5jb3JrZWQgPSAxLCB0aGlzLnVuY29yaygpKTsgaWYgKCFkLmVuZGluZyAmJiAhZC5maW5pc2hlZCkge1xuICAgIGEgPSBjO1xuICAgIGQuZW5kaW5nID0gITA7XG4gICAgYWUodGhpcywgZCk7XG4gICAgaWYgKGEpXG4gICAgICAgIGlmIChkLmZpbmlzaGVkKVxuICAgICAgICAgICAgRyhhKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy5vbmNlKFwiZmluaXNoXCIsIGEpO1xuICAgIGQuZW5kZWQgPSAhMDtcbiAgICB0aGlzLndyaXRhYmxlID0gITE7XG59IH07XG5mdW5jdGlvbiBXZChhKSB7IHJldHVybiBhLmVuZGluZyAmJiAwID09PSBhLmxlbmd0aCAmJiBudWxsID09PSBhLmJ1ZmZlcmVkUmVxdWVzdCAmJiAhYS5maW5pc2hlZCAmJiAhYS53cml0aW5nOyB9XG5mdW5jdGlvbiBhZShhLCBiKSB7IHZhciBjID0gV2QoYik7IGMgJiYgKDAgPT09IGIucGVuZGluZ2NiID8gKGIucHJlZmluaXNoZWQgfHwgKGIucHJlZmluaXNoZWQgPSAhMCwgYS5lbWl0KFwicHJlZmluaXNoXCIpKSwgYi5maW5pc2hlZCA9ICEwLCBhLmVtaXQoXCJmaW5pc2hcIikpIDogYi5wcmVmaW5pc2hlZCB8fCAoYi5wcmVmaW5pc2hlZCA9ICEwLCBhLmVtaXQoXCJwcmVmaW5pc2hcIikpKTsgcmV0dXJuIGM7IH1cbmZ1bmN0aW9uIFpkKGEpIHsgdmFyIGIgPSB0aGlzOyB0aGlzLmVudHJ5ID0gdGhpcy5uZXh0ID0gbnVsbDsgdGhpcy5maW5pc2ggPSBmdW5jdGlvbiAoYykgeyB2YXIgZCA9IGIuZW50cnk7IGZvciAoYi5lbnRyeSA9IG51bGw7IGQ7KSB7XG4gICAgdmFyIGUgPSBkLmNhbGxiYWNrO1xuICAgIGEucGVuZGluZ2NiLS07XG4gICAgZShjKTtcbiAgICBkID0gZC5uZXh0O1xufSBhLmNvcmtlZFJlcXVlc3RzRnJlZSA/IGEuY29ya2VkUmVxdWVzdHNGcmVlLm5leHQgPSBiIDogYS5jb3JrZWRSZXF1ZXN0c0ZyZWUgPSBiOyB9OyB9XG5EYihWLCBQKTtcbmZvciAodmFyIGJlID0gT2JqZWN0LmtleXMoVy5wcm90b3R5cGUpLCBjZSA9IDA7IGNlIDwgYmUubGVuZ3RoOyBjZSsrKSB7XG4gICAgdmFyIGRlID0gYmVbY2VdO1xuICAgIFYucHJvdG90eXBlW2RlXSB8fCAoVi5wcm90b3R5cGVbZGVdID0gVy5wcm90b3R5cGVbZGVdKTtcbn1cbmZ1bmN0aW9uIFYoYSkgeyBpZiAoISh0aGlzIGluc3RhbmNlb2YgVikpXG4gICAgcmV0dXJuIG5ldyBWKGEpOyBQLmNhbGwodGhpcywgYSk7IFcuY2FsbCh0aGlzLCBhKTsgYSAmJiAhMSA9PT0gYS5yZWFkYWJsZSAmJiAodGhpcy5yZWFkYWJsZSA9ICExKTsgYSAmJiAhMSA9PT0gYS53cml0YWJsZSAmJiAodGhpcy53cml0YWJsZSA9ICExKTsgdGhpcy5hbGxvd0hhbGZPcGVuID0gITA7IGEgJiYgITEgPT09IGEuYWxsb3dIYWxmT3BlbiAmJiAodGhpcy5hbGxvd0hhbGZPcGVuID0gITEpOyB0aGlzLm9uY2UoXCJlbmRcIiwgZWUpOyB9XG5mdW5jdGlvbiBlZSgpIHsgdGhpcy5hbGxvd0hhbGZPcGVuIHx8IHRoaXMuX3dyaXRhYmxlU3RhdGUuZW5kZWQgfHwgRyhmZSwgdGhpcyk7IH1cbmZ1bmN0aW9uIGZlKGEpIHsgYS5lbmQoKTsgfVxuRGIoWCwgVik7XG5mdW5jdGlvbiBnZShhKSB7IHRoaXMuYWZ0ZXJUcmFuc2Zvcm0gPSBmdW5jdGlvbiAoYiwgYykgeyB2YXIgZCA9IGEuX3RyYW5zZm9ybVN0YXRlOyBkLnRyYW5zZm9ybWluZyA9ICExOyB2YXIgZSA9IGQud3JpdGVjYjsgZSA/IChkLndyaXRlY2h1bmsgPSBudWxsLCBkLndyaXRlY2IgPSBudWxsLCBudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYyAmJiBhLnB1c2goYyksIGUoYiksIGIgPSBhLl9yZWFkYWJsZVN0YXRlLCBiLnJlYWRpbmcgPSAhMSwgKGIubmVlZFJlYWRhYmxlIHx8IGIubGVuZ3RoIDwgYi5oaWdoV2F0ZXJNYXJrKSAmJiBhLl9yZWFkKGIuaGlnaFdhdGVyTWFyayksIGIgPSB2b2lkIDApIDogYiA9IGEuZW1pdChcImVycm9yXCIsIEVycm9yKFwibm8gd3JpdGVjYiBpbiBUcmFuc2Zvcm0gY2xhc3NcIikpOyByZXR1cm4gYjsgfTsgdGhpcy50cmFuc2Zvcm1pbmcgPSB0aGlzLm5lZWRUcmFuc2Zvcm0gPSAhMTsgdGhpcy53cml0ZWVuY29kaW5nID0gdGhpcy53cml0ZWNodW5rID0gdGhpcy53cml0ZWNiID0gbnVsbDsgfVxuZnVuY3Rpb24gWChhKSB7IGlmICghKHRoaXMgaW5zdGFuY2VvZiBYKSlcbiAgICByZXR1cm4gbmV3IFgoYSk7IFYuY2FsbCh0aGlzLCBhKTsgdGhpcy5fdHJhbnNmb3JtU3RhdGUgPSBuZXcgZ2UodGhpcyk7IHZhciBiID0gdGhpczsgdGhpcy5fcmVhZGFibGVTdGF0ZS5uZWVkUmVhZGFibGUgPSAhMDsgdGhpcy5fcmVhZGFibGVTdGF0ZS5zeW5jID0gITE7IGEgJiYgKFwiZnVuY3Rpb25cIiA9PT0gdHlwZW9mIGEudHJhbnNmb3JtICYmICh0aGlzLl90cmFuc2Zvcm0gPSBhLnRyYW5zZm9ybSksIFwiZnVuY3Rpb25cIiA9PT0gdHlwZW9mIGEuZmx1c2ggJiYgKHRoaXMuX2ZsdXNoID0gYS5mbHVzaCkpOyB0aGlzLm9uY2UoXCJwcmVmaW5pc2hcIiwgZnVuY3Rpb24gKCkgeyBcImZ1bmN0aW9uXCIgPT09IHR5cGVvZiB0aGlzLl9mbHVzaCA/IHRoaXMuX2ZsdXNoKGZ1bmN0aW9uIChhKSB7IGhlKGIsIGEpOyB9KSA6IGhlKGIpOyB9KTsgfVxuWC5wcm90b3R5cGUucHVzaCA9IGZ1bmN0aW9uIChhLCBiKSB7IHRoaXMuX3RyYW5zZm9ybVN0YXRlLm5lZWRUcmFuc2Zvcm0gPSAhMTsgcmV0dXJuIFYucHJvdG90eXBlLnB1c2guY2FsbCh0aGlzLCBhLCBiKTsgfTtcblgucHJvdG90eXBlLl90cmFuc2Zvcm0gPSBmdW5jdGlvbiAoKSB7IHRocm93IEVycm9yKFwiTm90IGltcGxlbWVudGVkXCIpOyB9O1xuWC5wcm90b3R5cGUuX3dyaXRlID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsgdmFyIGQgPSB0aGlzLl90cmFuc2Zvcm1TdGF0ZTsgZC53cml0ZWNiID0gYzsgZC53cml0ZWNodW5rID0gYTsgZC53cml0ZWVuY29kaW5nID0gYjsgZC50cmFuc2Zvcm1pbmcgfHwgKGEgPSB0aGlzLl9yZWFkYWJsZVN0YXRlLCAoZC5uZWVkVHJhbnNmb3JtIHx8IGEubmVlZFJlYWRhYmxlIHx8IGEubGVuZ3RoIDwgYS5oaWdoV2F0ZXJNYXJrKSAmJiB0aGlzLl9yZWFkKGEuaGlnaFdhdGVyTWFyaykpOyB9O1xuWC5wcm90b3R5cGUuX3JlYWQgPSBmdW5jdGlvbiAoKSB7IHZhciBhID0gdGhpcy5fdHJhbnNmb3JtU3RhdGU7IG51bGwgIT09IGEud3JpdGVjaHVuayAmJiBhLndyaXRlY2IgJiYgIWEudHJhbnNmb3JtaW5nID8gKGEudHJhbnNmb3JtaW5nID0gITAsIHRoaXMuX3RyYW5zZm9ybShhLndyaXRlY2h1bmssIGEud3JpdGVlbmNvZGluZywgYS5hZnRlclRyYW5zZm9ybSkpIDogYS5uZWVkVHJhbnNmb3JtID0gITA7IH07XG5mdW5jdGlvbiBoZShhLCBiKSB7IGlmIChiKVxuICAgIHJldHVybiBhLmVtaXQoXCJlcnJvclwiLCBiKTsgYiA9IGEuX3RyYW5zZm9ybVN0YXRlOyBpZiAoYS5fd3JpdGFibGVTdGF0ZS5sZW5ndGgpXG4gICAgdGhyb3cgRXJyb3IoXCJDYWxsaW5nIHRyYW5zZm9ybSBkb25lIHdoZW4gd3MubGVuZ3RoICE9IDBcIik7IGlmIChiLnRyYW5zZm9ybWluZylcbiAgICB0aHJvdyBFcnJvcihcIkNhbGxpbmcgdHJhbnNmb3JtIGRvbmUgd2hlbiBzdGlsbCB0cmFuc2Zvcm1pbmdcIik7IHJldHVybiBhLnB1c2gobnVsbCk7IH1cbkRiKGllLCBYKTtcbmZ1bmN0aW9uIGllKGEpIHsgaWYgKCEodGhpcyBpbnN0YW5jZW9mIGllKSlcbiAgICByZXR1cm4gbmV3IGllKGEpOyBYLmNhbGwodGhpcywgYSk7IH1cbmllLnByb3RvdHlwZS5fdHJhbnNmb3JtID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsgYyhudWxsLCBhKTsgfTtcbkRiKFksIE8pO1xuWS5SZWFkYWJsZSA9IFA7XG5ZLldyaXRhYmxlID0gVztcblkuRHVwbGV4ID0gVjtcblkuVHJhbnNmb3JtID0gWDtcblkuUGFzc1Rocm91Z2ggPSBpZTtcblkuU3RyZWFtID0gWTtcbmZ1bmN0aW9uIFkoKSB7IE8uY2FsbCh0aGlzKTsgfVxuWS5wcm90b3R5cGUucGlwZSA9IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgZnVuY3Rpb24gYyhiKSB7IGEud3JpdGFibGUgJiYgITEgPT09IGEud3JpdGUoYikgJiYgay5wYXVzZSAmJiBrLnBhdXNlKCk7IH1cbiAgICBmdW5jdGlvbiBkKCkgeyBrLnJlYWRhYmxlICYmIGsucmVzdW1lICYmIGsucmVzdW1lKCk7IH1cbiAgICBmdW5jdGlvbiBlKCkgeyBwIHx8IChwID0gITAsIGEuZW5kKCkpOyB9XG4gICAgZnVuY3Rpb24gZigpIHsgcCB8fCAocCA9ICEwLCBcImZ1bmN0aW9uXCIgPT09IHR5cGVvZiBhLmRlc3Ryb3kgJiYgYS5kZXN0cm95KCkpOyB9XG4gICAgZnVuY3Rpb24gZyhhKSB7IGgoKTsgaWYgKDAgPT09IE8ubGlzdGVuZXJDb3VudCh0aGlzLCBcImVycm9yXCIpKVxuICAgICAgICB0aHJvdyBhOyB9XG4gICAgZnVuY3Rpb24gaCgpIHtcbiAgICAgICAgay5yZW1vdmVMaXN0ZW5lcihcImRhdGFcIiwgYyk7XG4gICAgICAgIGEucmVtb3ZlTGlzdGVuZXIoXCJkcmFpblwiLCBkKTtcbiAgICAgICAgay5yZW1vdmVMaXN0ZW5lcihcImVuZFwiLCBlKTtcbiAgICAgICAgay5yZW1vdmVMaXN0ZW5lcihcImNsb3NlXCIsIGYpO1xuICAgICAgICBrLnJlbW92ZUxpc3RlbmVyKFwiZXJyb3JcIiwgZyk7XG4gICAgICAgIGEucmVtb3ZlTGlzdGVuZXIoXCJlcnJvclwiLCBnKTtcbiAgICAgICAgay5yZW1vdmVMaXN0ZW5lcihcImVuZFwiLCBoKTtcbiAgICAgICAgay5yZW1vdmVMaXN0ZW5lcihcImNsb3NlXCIsIGgpO1xuICAgICAgICBhLnJlbW92ZUxpc3RlbmVyKFwiY2xvc2VcIiwgaCk7XG4gICAgfVxuICAgIHZhciBrID0gdGhpcztcbiAgICBrLm9uKFwiZGF0YVwiLCBjKTtcbiAgICBhLm9uKFwiZHJhaW5cIiwgZCk7XG4gICAgYS5faXNTdGRpbyB8fCBiICYmICExID09PSBiLmVuZCB8fCAoay5vbihcImVuZFwiLCBlKSwgay5vbihcImNsb3NlXCIsIGYpKTtcbiAgICB2YXIgcCA9ICExO1xuICAgIGsub24oXCJlcnJvclwiLCBnKTtcbiAgICBhLm9uKFwiZXJyb3JcIiwgZyk7XG4gICAgay5vbihcImVuZFwiLCBoKTtcbiAgICBrLm9uKFwiY2xvc2VcIiwgaCk7XG4gICAgYS5vbihcImNsb3NlXCIsIGgpO1xuICAgIGEuZW1pdChcInBpcGVcIiwgayk7XG4gICAgcmV0dXJuIGE7XG59O1xudmFyIGplID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLCBsZSA9IHsgZXh0ZW5kOiBmdW5jdGlvbiBrZShhLCBiKSB7IGZvciAodmFyIGQgaW4gYilcbiAgICAgICAgYVtkXSA9IGJbZF07IHJldHVybiAzID4gYXJndW1lbnRzLmxlbmd0aCA/IGEgOiBrZS5hcHBseShudWxsLCBbYV0uY29uY2F0KGplLmNhbGwoYXJndW1lbnRzLCAyKSkpOyB9IH0sIG1lID0gdShmdW5jdGlvbiAoYSwgYikge1xuICAgIGZ1bmN0aW9uIGMoYSwgYiwgYykgeyB2b2lkIDAgPT09IGMgJiYgKGMgPSBmdW5jdGlvbiAoYSkgeyByZXR1cm4gYTsgfSk7IHJldHVybiBmdW5jdGlvbiAoKSB7IGZvciAodmFyIGUgPSBbXSwgZiA9IDA7IGYgPCBhcmd1bWVudHMubGVuZ3RoOyBmKyspXG4gICAgICAgIGVbZl0gPSBhcmd1bWVudHNbZl07IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAoZiwgZykgeyBhW2JdLmJpbmQoYSkuYXBwbHkodm9pZCAwLCBkKGUsIFtmdW5jdGlvbiAoYSwgYikgeyByZXR1cm4gYSA/IGcoYSkgOiBmKGMoYikpOyB9XSkpOyB9KTsgfTsgfVxuICAgIHZhciBkID0gbCAmJiBsLl9fc3ByZWFkQXJyYXlzIHx8IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZm9yICh2YXIgYSA9IDAsIGIgPSAwLCBjID0gYXJndW1lbnRzLmxlbmd0aDsgYiA8IGM7IGIrKylcbiAgICAgICAgICAgIGEgKz1cbiAgICAgICAgICAgICAgICBhcmd1bWVudHNbYl0ubGVuZ3RoO1xuICAgICAgICBhID0gQXJyYXkoYSk7XG4gICAgICAgIHZhciBkID0gMDtcbiAgICAgICAgZm9yIChiID0gMDsgYiA8IGM7IGIrKylcbiAgICAgICAgICAgIGZvciAodmFyIGUgPSBhcmd1bWVudHNbYl0sIG4gPSAwLCBxID0gZS5sZW5ndGg7IG4gPCBxOyBuKyssIGQrKylcbiAgICAgICAgICAgICAgICBhW2RdID0gZVtuXTtcbiAgICAgICAgcmV0dXJuIGE7XG4gICAgfTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoYiwgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6ICEwIH0pO1xuICAgIHZhciBlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBmdW5jdGlvbiBhKGEsIGIpIHsgdGhpcy52b2wgPSBhOyB0aGlzLmZkID0gYjsgfVxuICAgICAgICBhLnByb3RvdHlwZS5hcHBlbmRGaWxlID0gZnVuY3Rpb24gKGEsIGIpIHsgcmV0dXJuIGModGhpcy52b2wsIFwiYXBwZW5kRmlsZVwiKSh0aGlzLmZkLCBhLCBiKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUuY2htb2QgPSBmdW5jdGlvbiAoYSkgeyByZXR1cm4gYyh0aGlzLnZvbCwgXCJmY2htb2RcIikodGhpcy5mZCwgYSk7IH07XG4gICAgICAgIGEucHJvdG90eXBlLmNob3duID0gZnVuY3Rpb24gKGEsIGIpIHsgcmV0dXJuIGModGhpcy52b2wsIFwiZmNob3duXCIpKHRoaXMuZmQsIGEsIGIpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBjKHRoaXMudm9sLCBcImNsb3NlXCIpKHRoaXMuZmQpO1xuICAgICAgICB9O1xuICAgICAgICBhLnByb3RvdHlwZS5kYXRhc3luYyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGModGhpcy52b2wsIFwiZmRhdGFzeW5jXCIpKHRoaXMuZmQpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5yZWFkID0gZnVuY3Rpb24gKGEsIGIsIGQsIGUpIHsgcmV0dXJuIGModGhpcy52b2wsIFwicmVhZFwiLCBmdW5jdGlvbiAoYikgeyByZXR1cm4geyBieXRlc1JlYWQ6IGIsIGJ1ZmZlcjogYSB9OyB9KSh0aGlzLmZkLCBhLCBiLCBkLCBlKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUucmVhZEZpbGUgPSBmdW5jdGlvbiAoYSkgeyByZXR1cm4gYyh0aGlzLnZvbCwgXCJyZWFkRmlsZVwiKSh0aGlzLmZkLCBhKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUuc3RhdCA9IGZ1bmN0aW9uIChhKSB7IHJldHVybiBjKHRoaXMudm9sLCBcImZzdGF0XCIpKHRoaXMuZmQsIGEpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5zeW5jID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gYyh0aGlzLnZvbCwgXCJmc3luY1wiKSh0aGlzLmZkKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUudHJ1bmNhdGUgPSBmdW5jdGlvbiAoYSkgeyByZXR1cm4gYyh0aGlzLnZvbCwgXCJmdHJ1bmNhdGVcIikodGhpcy5mZCwgYSk7IH07XG4gICAgICAgIGEucHJvdG90eXBlLnV0aW1lcyA9XG4gICAgICAgICAgICBmdW5jdGlvbiAoYSwgYikgeyByZXR1cm4gYyh0aGlzLnZvbCwgXCJmdXRpbWVzXCIpKHRoaXMuZmQsIGEsIGIpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS53cml0ZSA9IGZ1bmN0aW9uIChhLCBiLCBkLCBlKSB7IHJldHVybiBjKHRoaXMudm9sLCBcIndyaXRlXCIsIGZ1bmN0aW9uIChiKSB7IHJldHVybiB7IGJ5dGVzV3JpdHRlbjogYiwgYnVmZmVyOiBhIH07IH0pKHRoaXMuZmQsIGEsIGIsIGQsIGUpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS53cml0ZUZpbGUgPSBmdW5jdGlvbiAoYSwgYikgeyByZXR1cm4gYyh0aGlzLnZvbCwgXCJ3cml0ZUZpbGVcIikodGhpcy5mZCwgYSwgYik7IH07XG4gICAgICAgIHJldHVybiBhO1xuICAgIH0oKTtcbiAgICBiLkZpbGVIYW5kbGUgPSBlO1xuICAgIGIuZGVmYXVsdCA9IGZ1bmN0aW9uIChhKSB7XG4gICAgICAgIHJldHVybiBcInVuZGVmaW5lZFwiID09PSB0eXBlb2YgUHJvbWlzZSA/IG51bGwgOiB7IEZpbGVIYW5kbGU6IGUsIGFjY2VzczogZnVuY3Rpb24gKGIsIGQpIHsgcmV0dXJuIGMoYSwgXCJhY2Nlc3NcIikoYiwgZCk7IH0sIGFwcGVuZEZpbGU6IGZ1bmN0aW9uIChiLCBkLCBmKSB7IHJldHVybiBjKGEsIFwiYXBwZW5kRmlsZVwiKShiIGluc3RhbmNlb2YgZSA/IGIuZmQgOiBiLCBkLCBmKTsgfSwgY2htb2Q6IGZ1bmN0aW9uIChiLCBkKSB7IHJldHVybiBjKGEsIFwiY2htb2RcIikoYiwgZCk7IH0sIGNob3duOiBmdW5jdGlvbiAoYiwgZCwgZSkgeyByZXR1cm4gYyhhLCBcImNob3duXCIpKGIsIGQsIGUpOyB9LCBjb3B5RmlsZTogZnVuY3Rpb24gKGIsIGQsIGUpIHsgcmV0dXJuIGMoYSwgXCJjb3B5RmlsZVwiKShiLCBkLCBlKTsgfSwgbGNobW9kOiBmdW5jdGlvbiAoYiwgZCkgeyByZXR1cm4gYyhhLCBcImxjaG1vZFwiKShiLCBkKTsgfSwgbGNob3duOiBmdW5jdGlvbiAoYiwgZCwgZSkgeyByZXR1cm4gYyhhLCBcImxjaG93blwiKShiLCBkLCBlKTsgfSwgbGluazogZnVuY3Rpb24gKGIsIGQpIHsgcmV0dXJuIGMoYSwgXCJsaW5rXCIpKGIsIGQpOyB9LCBsc3RhdDogZnVuY3Rpb24gKGIsIGQpIHsgcmV0dXJuIGMoYSwgXCJsc3RhdFwiKShiLCBkKTsgfSwgbWtkaXI6IGZ1bmN0aW9uIChiLCBkKSB7IHJldHVybiBjKGEsIFwibWtkaXJcIikoYiwgZCk7IH0sIG1rZHRlbXA6IGZ1bmN0aW9uIChiLCBkKSB7IHJldHVybiBjKGEsIFwibWtkdGVtcFwiKShiLCBkKTsgfSwgb3BlbjogZnVuY3Rpb24gKGIsIGQsIGYpIHsgcmV0dXJuIGMoYSwgXCJvcGVuXCIsIGZ1bmN0aW9uIChiKSB7IHJldHVybiBuZXcgZShhLCBiKTsgfSkoYiwgZCwgZik7IH0sIHJlYWRkaXI6IGZ1bmN0aW9uIChiLCBkKSB7IHJldHVybiBjKGEsIFwicmVhZGRpclwiKShiLCBkKTsgfSwgcmVhZEZpbGU6IGZ1bmN0aW9uIChiLCBkKSB7IHJldHVybiBjKGEsIFwicmVhZEZpbGVcIikoYiBpbnN0YW5jZW9mIGUgPyBiLmZkIDogYiwgZCk7IH0sIHJlYWRsaW5rOiBmdW5jdGlvbiAoYiwgZCkgeyByZXR1cm4gYyhhLCBcInJlYWRsaW5rXCIpKGIsIGQpOyB9LCByZWFscGF0aDogZnVuY3Rpb24gKGIsIGQpIHsgcmV0dXJuIGMoYSwgXCJyZWFscGF0aFwiKShiLCBkKTsgfSwgcmVuYW1lOiBmdW5jdGlvbiAoYiwgZCkgeyByZXR1cm4gYyhhLCBcInJlbmFtZVwiKShiLCBkKTsgfSwgcm1kaXI6IGZ1bmN0aW9uIChiKSB7IHJldHVybiBjKGEsIFwicm1kaXJcIikoYik7IH0sIHN0YXQ6IGZ1bmN0aW9uIChiLCBkKSB7IHJldHVybiBjKGEsIFwic3RhdFwiKShiLCBkKTsgfSwgc3ltbGluazogZnVuY3Rpb24gKGIsIGQsIGUpIHsgcmV0dXJuIGMoYSwgXCJzeW1saW5rXCIpKGIsIGQsIGUpOyB9LCB0cnVuY2F0ZTogZnVuY3Rpb24gKGIsIGQpIHsgcmV0dXJuIGMoYSwgXCJ0cnVuY2F0ZVwiKShiLCBkKTsgfSwgdW5saW5rOiBmdW5jdGlvbiAoYikgeyByZXR1cm4gYyhhLCBcInVubGlua1wiKShiKTsgfSwgdXRpbWVzOiBmdW5jdGlvbiAoYiwgZCwgZSkgeyByZXR1cm4gYyhhLCBcInV0aW1lc1wiKShiLCBkLCBlKTsgfSwgd3JpdGVGaWxlOiBmdW5jdGlvbiAoYiwgZCwgZikgeyByZXR1cm4gYyhhLCBcIndyaXRlRmlsZVwiKShiIGluc3RhbmNlb2YgZSA/IGIuZmQgOiBiLCBkLCBmKTsgfSB9O1xuICAgIH07XG59KTtcbnQobWUpO1xudmFyIG5lID0gL1teXFx4MjAtXFx4N0VdLywgb2UgPSAvW1xceDJFXFx1MzAwMlxcdUZGMEVcXHVGRjYxXS9nLCBwZSA9IHsgb3ZlcmZsb3c6IFwiT3ZlcmZsb3c6IGlucHV0IG5lZWRzIHdpZGVyIGludGVnZXJzIHRvIHByb2Nlc3NcIiwgXCJub3QtYmFzaWNcIjogXCJJbGxlZ2FsIGlucHV0ID49IDB4ODAgKG5vdCBhIGJhc2ljIGNvZGUgcG9pbnQpXCIsIFwiaW52YWxpZC1pbnB1dFwiOiBcIkludmFsaWQgaW5wdXRcIiB9LCBxZSA9IE1hdGguZmxvb3IsIHJlID0gU3RyaW5nLmZyb21DaGFyQ29kZTtcbmZ1bmN0aW9uIHNlKGEsIGIpIHsgdmFyIGMgPSBhLnNwbGl0KFwiQFwiKSwgZCA9IFwiXCI7IDEgPCBjLmxlbmd0aCAmJiAoZCA9IGNbMF0gKyBcIkBcIiwgYSA9IGNbMV0pOyBhID0gYS5yZXBsYWNlKG9lLCBcIi5cIik7IGEgPSBhLnNwbGl0KFwiLlwiKTsgYyA9IGEubGVuZ3RoOyBmb3IgKHZhciBlID0gW107IGMtLTspXG4gICAgZVtjXSA9IGIoYVtjXSk7IGIgPSBlLmpvaW4oXCIuXCIpOyByZXR1cm4gZCArIGI7IH1cbmZ1bmN0aW9uIHRlKGEsIGIpIHsgcmV0dXJuIGEgKyAyMiArIDc1ICogKDI2ID4gYSkgLSAoKDAgIT0gYikgPDwgNSk7IH1cbmZ1bmN0aW9uIHVlKGEpIHtcbiAgICByZXR1cm4gc2UoYSwgZnVuY3Rpb24gKGEpIHtcbiAgICAgICAgaWYgKG5lLnRlc3QoYSkpIHtcbiAgICAgICAgICAgIHZhciBiO1xuICAgICAgICAgICAgdmFyIGQgPSBbXTtcbiAgICAgICAgICAgIHZhciBlID0gW107XG4gICAgICAgICAgICB2YXIgZiA9IDA7XG4gICAgICAgICAgICBmb3IgKGIgPSBhLmxlbmd0aDsgZiA8IGI7KSB7XG4gICAgICAgICAgICAgICAgdmFyIGcgPSBhLmNoYXJDb2RlQXQoZisrKTtcbiAgICAgICAgICAgICAgICBpZiAoNTUyOTYgPD0gZyAmJiA1NjMxOSA+PSBnICYmIGYgPCBiKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBoID0gYS5jaGFyQ29kZUF0KGYrKyk7XG4gICAgICAgICAgICAgICAgICAgIDU2MzIwID09IChoICYgNjQ1MTIpID8gZS5wdXNoKCgoZyAmIDEwMjMpIDw8IDEwKSArIChoICYgMTAyMykgKyA2NTUzNikgOiAoZS5wdXNoKGcpLCBmLS0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIGUucHVzaChnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGEgPSBlO1xuICAgICAgICAgICAgaCA9IGEubGVuZ3RoO1xuICAgICAgICAgICAgZSA9IDEyODtcbiAgICAgICAgICAgIHZhciBrID0gMDtcbiAgICAgICAgICAgIHZhciBwID0gNzI7XG4gICAgICAgICAgICBmb3IgKGcgPSAwOyBnIDwgaDsgKytnKSB7XG4gICAgICAgICAgICAgICAgdmFyIG4gPSBhW2ddO1xuICAgICAgICAgICAgICAgIDEyOCA+IG4gJiYgZC5wdXNoKHJlKG4pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAoKGYgPSBiID0gZC5sZW5ndGgpICYmIGQucHVzaChcIi1cIik7IGYgPCBoOykge1xuICAgICAgICAgICAgICAgIHZhciBxID0gMjE0NzQ4MzY0NztcbiAgICAgICAgICAgICAgICBmb3IgKGcgPSAwOyBnIDwgaDsgKytnKVxuICAgICAgICAgICAgICAgICAgICBuID0gYVtnXSwgbiA+PSBlICYmIG4gPCBxICYmIChxID0gbik7XG4gICAgICAgICAgICAgICAgdmFyIEIgPSBmICsgMTtcbiAgICAgICAgICAgICAgICBpZiAocSAtIGUgPiBxZSgoMjE0NzQ4MzY0NyAtIGspIC8gQikpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKHBlLm92ZXJmbG93KTtcbiAgICAgICAgICAgICAgICBrICs9IChxIC0gZSkgKiBCO1xuICAgICAgICAgICAgICAgIGUgPSBxO1xuICAgICAgICAgICAgICAgIGZvciAoZyA9IDA7IGcgPCBoOyArK2cpIHtcbiAgICAgICAgICAgICAgICAgICAgbiA9IGFbZ107XG4gICAgICAgICAgICAgICAgICAgIGlmIChuIDwgZSAmJiAyMTQ3NDgzNjQ3IDwgKytrKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IocGUub3ZlcmZsb3cpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobiA9PSBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbSA9IGs7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHEgPSAzNjs7IHEgKz0gMzYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuID0gcSA8PSBwID8gMSA6IHEgPj0gcCArIDI2ID8gMjYgOiBxIC0gcDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobSA8IG4pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2ID0gbSAtIG47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbSA9IDM2IC0gbjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnB1c2gocmUodGUobiArIHYgJSBtLCAwKSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0gPSBxZSh2IC8gbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBkLnB1c2gocmUodGUobSwgMCkpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHAgPSBCO1xuICAgICAgICAgICAgICAgICAgICAgICAgcSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBrID0gZiA9PSBiID8gcWUoayAvIDcwMCkgOiBrID4+IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGsgKz0gcWUoayAvIHApOyA0NTUgPCBrOyBxICs9IDM2KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBxZShrIC8gMzUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcCA9IHFlKHEgKyAzNiAqIGsgLyAoayArIDM4KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBrID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICsrZjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICArK2s7XG4gICAgICAgICAgICAgICAgKytlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZCA9IFwieG4tLVwiICsgZC5qb2luKFwiXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGQgPSBhO1xuICAgICAgICByZXR1cm4gZDtcbiAgICB9KTtcbn1cbnZhciB2ZSA9IEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rpb24gKGEpIHsgcmV0dXJuIFwiW29iamVjdCBBcnJheV1cIiA9PT0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGEpOyB9O1xuZnVuY3Rpb24gd2UoYSkgeyBzd2l0Y2ggKHR5cGVvZiBhKSB7XG4gICAgY2FzZSBcInN0cmluZ1wiOiByZXR1cm4gYTtcbiAgICBjYXNlIFwiYm9vbGVhblwiOiByZXR1cm4gYSA/IFwidHJ1ZVwiIDogXCJmYWxzZVwiO1xuICAgIGNhc2UgXCJudW1iZXJcIjogcmV0dXJuIGlzRmluaXRlKGEpID8gYSA6IFwiXCI7XG4gICAgZGVmYXVsdDogcmV0dXJuIFwiXCI7XG59IH1cbmZ1bmN0aW9uIHhlKGEsIGIsIGMsIGQpIHsgYiA9IGIgfHwgXCImXCI7IGMgPSBjIHx8IFwiPVwiOyBudWxsID09PSBhICYmIChhID0gdm9pZCAwKTsgcmV0dXJuIFwib2JqZWN0XCIgPT09IHR5cGVvZiBhID8geWUoemUoYSksIGZ1bmN0aW9uIChkKSB7IHZhciBlID0gZW5jb2RlVVJJQ29tcG9uZW50KHdlKGQpKSArIGM7IHJldHVybiB2ZShhW2RdKSA/IHllKGFbZF0sIGZ1bmN0aW9uIChhKSB7IHJldHVybiBlICsgZW5jb2RlVVJJQ29tcG9uZW50KHdlKGEpKTsgfSkuam9pbihiKSA6IGUgKyBlbmNvZGVVUklDb21wb25lbnQod2UoYVtkXSkpOyB9KS5qb2luKGIpIDogZCA/IGVuY29kZVVSSUNvbXBvbmVudCh3ZShkKSkgKyBjICsgZW5jb2RlVVJJQ29tcG9uZW50KHdlKGEpKSA6IFwiXCI7IH1cbmZ1bmN0aW9uIHllKGEsIGIpIHsgaWYgKGEubWFwKVxuICAgIHJldHVybiBhLm1hcChiKTsgZm9yICh2YXIgYyA9IFtdLCBkID0gMDsgZCA8IGEubGVuZ3RoOyBkKyspXG4gICAgYy5wdXNoKGIoYVtkXSwgZCkpOyByZXR1cm4gYzsgfVxudmFyIHplID0gT2JqZWN0LmtleXMgfHwgZnVuY3Rpb24gKGEpIHsgdmFyIGIgPSBbXSwgYzsgZm9yIChjIGluIGEpXG4gICAgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGEsIGMpICYmIGIucHVzaChjKTsgcmV0dXJuIGI7IH07XG5mdW5jdGlvbiBBZShhLCBiLCBjLCBkKSB7IGMgPSBjIHx8IFwiPVwiOyB2YXIgZSA9IHt9OyBpZiAoXCJzdHJpbmdcIiAhPT0gdHlwZW9mIGEgfHwgMCA9PT0gYS5sZW5ndGgpXG4gICAgcmV0dXJuIGU7IHZhciBmID0gL1xcKy9nOyBhID0gYS5zcGxpdChiIHx8IFwiJlwiKTsgYiA9IDFFMzsgZCAmJiBcIm51bWJlclwiID09PSB0eXBlb2YgZC5tYXhLZXlzICYmIChiID0gZC5tYXhLZXlzKTsgZCA9IGEubGVuZ3RoOyAwIDwgYiAmJiBkID4gYiAmJiAoZCA9IGIpOyBmb3IgKGIgPSAwOyBiIDwgZDsgKytiKSB7XG4gICAgdmFyIGcgPSBhW2JdLnJlcGxhY2UoZiwgXCIlMjBcIiksIGggPSBnLmluZGV4T2YoYyk7XG4gICAgaWYgKDAgPD0gaCkge1xuICAgICAgICB2YXIgayA9IGcuc3Vic3RyKDAsIGgpO1xuICAgICAgICBnID0gZy5zdWJzdHIoaCArIDEpO1xuICAgIH1cbiAgICBlbHNlXG4gICAgICAgIGsgPSBnLCBnID0gXCJcIjtcbiAgICBrID0gZGVjb2RlVVJJQ29tcG9uZW50KGspO1xuICAgIGcgPSBkZWNvZGVVUklDb21wb25lbnQoZyk7XG4gICAgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIGspID8gdmUoZVtrXSkgPyBlW2tdLnB1c2goZykgOiBlW2tdID0gW2Vba10sIGddIDogZVtrXSA9IGc7XG59IHJldHVybiBlOyB9XG52YXIgRmUgPSB7IHBhcnNlOiBCZSwgcmVzb2x2ZTogQ2UsIHJlc29sdmVPYmplY3Q6IERlLCBmb3JtYXQ6IEVlLCBVcmw6IFogfTtcbmZ1bmN0aW9uIFooKSB7IHRoaXMuaHJlZiA9IHRoaXMucGF0aCA9IHRoaXMucGF0aG5hbWUgPSB0aGlzLnF1ZXJ5ID0gdGhpcy5zZWFyY2ggPSB0aGlzLmhhc2ggPSB0aGlzLmhvc3RuYW1lID0gdGhpcy5wb3J0ID0gdGhpcy5ob3N0ID0gdGhpcy5hdXRoID0gdGhpcy5zbGFzaGVzID0gdGhpcy5wcm90b2NvbCA9IG51bGw7IH1cbnZhciBHZSA9IC9eKFthLXowLTkuKy1dKzopL2ksIEhlID0gLzpbMC05XSokLywgSWUgPSAvXihcXC9cXC8/KD8hXFwvKVteXFw/XFxzXSopKFxcP1teXFxzXSopPyQvLCBKZSA9IFwie318XFxcXF5gXCIuc3BsaXQoXCJcIikuY29uY2F0KCc8PlwiYCBcXHJcXG5cXHQnLnNwbGl0KFwiXCIpKSwgS2UgPSBbXCInXCJdLmNvbmNhdChKZSksIExlID0gW1wiJVwiLCBcIi9cIiwgXCI/XCIsIFwiO1wiLCBcIiNcIl0uY29uY2F0KEtlKSwgTWUgPSBbXCIvXCIsIFwiP1wiLCBcIiNcIl0sIE5lID0gMjU1LCBPZSA9IC9eWythLXowLTlBLVpfLV17MCw2M30kLywgUGUgPSAvXihbK2EtejAtOUEtWl8tXXswLDYzfSkoLiopJC8sIFFlID0geyBqYXZhc2NyaXB0OiAhMCwgXCJqYXZhc2NyaXB0OlwiOiAhMCB9LCBSZSA9IHsgamF2YXNjcmlwdDogITAsIFwiamF2YXNjcmlwdDpcIjogITAgfSwgU2UgPSB7IGh0dHA6ICEwLCBodHRwczogITAsIGZ0cDogITAsIGdvcGhlcjogITAsIGZpbGU6ICEwLCBcImh0dHA6XCI6ICEwLCBcImh0dHBzOlwiOiAhMCwgXCJmdHA6XCI6ICEwLCBcImdvcGhlcjpcIjogITAsIFwiZmlsZTpcIjogITAgfTtcbmZ1bmN0aW9uIEJlKGEsIGIsIGMpIHsgaWYgKGEgJiYgSGIoYSkgJiYgYSBpbnN0YW5jZW9mIFopXG4gICAgcmV0dXJuIGE7IHZhciBkID0gbmV3IFo7IGQucGFyc2UoYSwgYiwgYyk7IHJldHVybiBkOyB9XG5aLnByb3RvdHlwZS5wYXJzZSA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IHJldHVybiBUZSh0aGlzLCBhLCBiLCBjKTsgfTtcbmZ1bmN0aW9uIFRlKGEsIGIsIGMsIGQpIHtcbiAgICBpZiAoIUdiKGIpKVxuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiUGFyYW1ldGVyICd1cmwnIG11c3QgYmUgYSBzdHJpbmcsIG5vdCBcIiArIHR5cGVvZiBiKTtcbiAgICB2YXIgZSA9IGIuaW5kZXhPZihcIj9cIik7XG4gICAgZSA9IC0xICE9PSBlICYmIGUgPCBiLmluZGV4T2YoXCIjXCIpID8gXCI/XCIgOiBcIiNcIjtcbiAgICBiID0gYi5zcGxpdChlKTtcbiAgICBiWzBdID0gYlswXS5yZXBsYWNlKC9cXFxcL2csIFwiL1wiKTtcbiAgICBiID0gYi5qb2luKGUpO1xuICAgIGUgPSBiLnRyaW0oKTtcbiAgICBpZiAoIWQgJiYgMSA9PT0gYi5zcGxpdChcIiNcIikubGVuZ3RoICYmIChiID0gSWUuZXhlYyhlKSkpXG4gICAgICAgIHJldHVybiBhLnBhdGggPSBlLCBhLmhyZWYgPSBlLCBhLnBhdGhuYW1lID0gYlsxXSwgYlsyXSA/IChhLnNlYXJjaCA9IGJbMl0sIGEucXVlcnkgPSBjID8gQWUoYS5zZWFyY2guc3Vic3RyKDEpKSA6IGEuc2VhcmNoLnN1YnN0cigxKSkgOiBjICYmIChhLnNlYXJjaCA9IFwiXCIsIGEucXVlcnkgPSB7fSksIGE7XG4gICAgaWYgKGIgPSBHZS5leGVjKGUpKSB7XG4gICAgICAgIGIgPSBiWzBdO1xuICAgICAgICB2YXIgZiA9IGIudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgYS5wcm90b2NvbCA9IGY7XG4gICAgICAgIGUgPSBlLnN1YnN0cihiLmxlbmd0aCk7XG4gICAgfVxuICAgIGlmIChkIHx8IGIgfHxcbiAgICAgICAgZS5tYXRjaCgvXlxcL1xcL1teQFxcL10rQFteQFxcL10rLykpIHtcbiAgICAgICAgdmFyIGcgPSBcIi8vXCIgPT09IGUuc3Vic3RyKDAsIDIpO1xuICAgICAgICAhZyB8fCBiICYmIFJlW2JdIHx8IChlID0gZS5zdWJzdHIoMiksIGEuc2xhc2hlcyA9ICEwKTtcbiAgICB9XG4gICAgaWYgKCFSZVtiXSAmJiAoZyB8fCBiICYmICFTZVtiXSkpIHtcbiAgICAgICAgYiA9IC0xO1xuICAgICAgICBmb3IgKGQgPSAwOyBkIDwgTWUubGVuZ3RoOyBkKyspXG4gICAgICAgICAgICBnID0gZS5pbmRleE9mKE1lW2RdKSwgLTEgIT09IGcgJiYgKC0xID09PSBiIHx8IGcgPCBiKSAmJiAoYiA9IGcpO1xuICAgICAgICBnID0gLTEgPT09IGIgPyBlLmxhc3RJbmRleE9mKFwiQFwiKSA6IGUubGFzdEluZGV4T2YoXCJAXCIsIGIpO1xuICAgICAgICAtMSAhPT0gZyAmJiAoZCA9IGUuc2xpY2UoMCwgZyksIGUgPSBlLnNsaWNlKGcgKyAxKSwgYS5hdXRoID0gZGVjb2RlVVJJQ29tcG9uZW50KGQpKTtcbiAgICAgICAgYiA9IC0xO1xuICAgICAgICBmb3IgKGQgPSAwOyBkIDwgTGUubGVuZ3RoOyBkKyspXG4gICAgICAgICAgICBnID0gZS5pbmRleE9mKExlW2RdKSwgLTEgIT09IGcgJiYgKC0xID09PSBiIHx8IGcgPCBiKSAmJiAoYiA9IGcpO1xuICAgICAgICAtMSA9PT0gYiAmJiAoYiA9IGUubGVuZ3RoKTtcbiAgICAgICAgYS5ob3N0ID0gZS5zbGljZSgwLCBiKTtcbiAgICAgICAgZSA9IGUuc2xpY2UoYik7XG4gICAgICAgIFVlKGEpO1xuICAgICAgICBhLmhvc3RuYW1lID0gYS5ob3N0bmFtZSB8fCBcIlwiO1xuICAgICAgICBnID0gXCJbXCIgPT09IGEuaG9zdG5hbWVbMF0gJiZcbiAgICAgICAgICAgIFwiXVwiID09PSBhLmhvc3RuYW1lW2EuaG9zdG5hbWUubGVuZ3RoIC0gMV07XG4gICAgICAgIGlmICghZykge1xuICAgICAgICAgICAgdmFyIGggPSBhLmhvc3RuYW1lLnNwbGl0KC9cXC4vKTtcbiAgICAgICAgICAgIGQgPSAwO1xuICAgICAgICAgICAgZm9yIChiID0gaC5sZW5ndGg7IGQgPCBiOyBkKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgayA9IGhbZF07XG4gICAgICAgICAgICAgICAgaWYgKGsgJiYgIWsubWF0Y2goT2UpKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHAgPSBcIlwiLCBuID0gMCwgcSA9IGsubGVuZ3RoOyBuIDwgcTsgbisrKVxuICAgICAgICAgICAgICAgICAgICAgICAgcCA9IDEyNyA8IGsuY2hhckNvZGVBdChuKSA/IHAgKyBcInhcIiA6IHAgKyBrW25dO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXAubWF0Y2goT2UpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBiID0gaC5zbGljZSgwLCBkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBoLnNsaWNlKGQgKyAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrID0gay5tYXRjaChQZSkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5wdXNoKGtbMV0pLCBkLnVuc2hpZnQoa1syXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBkLmxlbmd0aCAmJiAoZSA9IFwiL1wiICsgZC5qb2luKFwiLlwiKSArIGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYS5ob3N0bmFtZSA9IGIuam9pbihcIi5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBhLmhvc3RuYW1lID0gYS5ob3N0bmFtZS5sZW5ndGggPiBOZSA/IFwiXCIgOiBhLmhvc3RuYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGcgfHwgKGEuaG9zdG5hbWUgPSB1ZShhLmhvc3RuYW1lKSk7XG4gICAgICAgIGQgPSBhLnBvcnQgPyBcIjpcIiArIGEucG9ydCA6IFwiXCI7XG4gICAgICAgIGEuaG9zdCA9IChhLmhvc3RuYW1lIHx8IFwiXCIpICsgZDtcbiAgICAgICAgYS5ocmVmICs9IGEuaG9zdDtcbiAgICAgICAgZyAmJiAoYS5ob3N0bmFtZSA9IGEuaG9zdG5hbWUuc3Vic3RyKDEsIGEuaG9zdG5hbWUubGVuZ3RoIC0gMiksIFwiL1wiICE9PSBlWzBdICYmIChlID0gXCIvXCIgKyBlKSk7XG4gICAgfVxuICAgIGlmICghUWVbZl0pXG4gICAgICAgIGZvciAoZCA9IDAsIGIgPSBLZS5sZW5ndGg7IGQgPCBiOyBkKyspXG4gICAgICAgICAgICBnID0gS2VbZF0sIC0xICE9PSBlLmluZGV4T2YoZykgJiYgKGsgPSBlbmNvZGVVUklDb21wb25lbnQoZyksIGsgPT09IGcgJiYgKGsgPSBlc2NhcGUoZykpLCBlID0gZS5zcGxpdChnKS5qb2luKGspKTtcbiAgICBkID0gZS5pbmRleE9mKFwiI1wiKTtcbiAgICAtMSAhPT0gZCAmJiAoYS5oYXNoID0gZS5zdWJzdHIoZCksIGUgPSBlLnNsaWNlKDAsIGQpKTtcbiAgICBkID0gZS5pbmRleE9mKFwiP1wiKTtcbiAgICAtMSAhPT0gZCA/IChhLnNlYXJjaCA9IGUuc3Vic3RyKGQpLCBhLnF1ZXJ5ID0gZS5zdWJzdHIoZCArIDEpLCBjICYmIChhLnF1ZXJ5ID0gQWUoYS5xdWVyeSkpLCBlID0gZS5zbGljZSgwLCBkKSkgOiBjICYmIChhLnNlYXJjaCA9IFwiXCIsIGEucXVlcnkgPSB7fSk7XG4gICAgZSAmJiAoYS5wYXRobmFtZSA9IGUpO1xuICAgIFNlW2ZdICYmIGEuaG9zdG5hbWUgJiYgIWEucGF0aG5hbWUgJiYgKGEucGF0aG5hbWUgPSBcIi9cIik7XG4gICAgaWYgKGEucGF0aG5hbWUgfHxcbiAgICAgICAgYS5zZWFyY2gpXG4gICAgICAgIGQgPSBhLnBhdGhuYW1lIHx8IFwiXCIsIGEucGF0aCA9IGQgKyAoYS5zZWFyY2ggfHwgXCJcIik7XG4gICAgYS5ocmVmID0gVmUoYSk7XG4gICAgcmV0dXJuIGE7XG59XG5mdW5jdGlvbiBFZShhKSB7IEdiKGEpICYmIChhID0gVGUoe30sIGEpKTsgcmV0dXJuIFZlKGEpOyB9XG5mdW5jdGlvbiBWZShhKSB7XG4gICAgdmFyIGIgPSBhLmF1dGggfHwgXCJcIjtcbiAgICBiICYmIChiID0gZW5jb2RlVVJJQ29tcG9uZW50KGIpLCBiID0gYi5yZXBsYWNlKC8lM0EvaSwgXCI6XCIpLCBiICs9IFwiQFwiKTtcbiAgICB2YXIgYyA9IGEucHJvdG9jb2wgfHwgXCJcIiwgZCA9IGEucGF0aG5hbWUgfHwgXCJcIiwgZSA9IGEuaGFzaCB8fCBcIlwiLCBmID0gITEsIGcgPSBcIlwiO1xuICAgIGEuaG9zdCA/IGYgPSBiICsgYS5ob3N0IDogYS5ob3N0bmFtZSAmJiAoZiA9IGIgKyAoLTEgPT09IGEuaG9zdG5hbWUuaW5kZXhPZihcIjpcIikgPyBhLmhvc3RuYW1lIDogXCJbXCIgKyB0aGlzLmhvc3RuYW1lICsgXCJdXCIpLCBhLnBvcnQgJiYgKGYgKz0gXCI6XCIgKyBhLnBvcnQpKTtcbiAgICBhLnF1ZXJ5ICYmIEhiKGEucXVlcnkpICYmIE9iamVjdC5rZXlzKGEucXVlcnkpLmxlbmd0aCAmJiAoZyA9IHhlKGEucXVlcnkpKTtcbiAgICBiID0gYS5zZWFyY2ggfHwgZyAmJiBcIj9cIiArIGcgfHwgXCJcIjtcbiAgICBjICYmIFwiOlwiICE9PSBjLnN1YnN0cigtMSkgJiYgKGMgKz0gXCI6XCIpO1xuICAgIGEuc2xhc2hlcyB8fCAoIWMgfHwgU2VbY10pICYmICExICE9PSBmID8gKGYgPSBcIi8vXCIgKyAoZiB8fCBcIlwiKSwgZCAmJiBcIi9cIiAhPT0gZC5jaGFyQXQoMCkgJiYgKGQgPSBcIi9cIiArIGQpKSA6IGYgfHwgKGYgPSBcIlwiKTtcbiAgICBlICYmIFwiI1wiICE9PSBlLmNoYXJBdCgwKSAmJlxuICAgICAgICAoZSA9IFwiI1wiICsgZSk7XG4gICAgYiAmJiBcIj9cIiAhPT0gYi5jaGFyQXQoMCkgJiYgKGIgPSBcIj9cIiArIGIpO1xuICAgIGQgPSBkLnJlcGxhY2UoL1s/I10vZywgZnVuY3Rpb24gKGEpIHsgcmV0dXJuIGVuY29kZVVSSUNvbXBvbmVudChhKTsgfSk7XG4gICAgYiA9IGIucmVwbGFjZShcIiNcIiwgXCIlMjNcIik7XG4gICAgcmV0dXJuIGMgKyBmICsgZCArIGIgKyBlO1xufVxuWi5wcm90b3R5cGUuZm9ybWF0ID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gVmUodGhpcyk7IH07XG5mdW5jdGlvbiBDZShhLCBiKSB7IHJldHVybiBCZShhLCAhMSwgITApLnJlc29sdmUoYik7IH1cbloucHJvdG90eXBlLnJlc29sdmUgPSBmdW5jdGlvbiAoYSkgeyByZXR1cm4gdGhpcy5yZXNvbHZlT2JqZWN0KEJlKGEsICExLCAhMCkpLmZvcm1hdCgpOyB9O1xuZnVuY3Rpb24gRGUoYSwgYikgeyByZXR1cm4gYSA/IEJlKGEsICExLCAhMCkucmVzb2x2ZU9iamVjdChiKSA6IGI7IH1cbloucHJvdG90eXBlLnJlc29sdmVPYmplY3QgPSBmdW5jdGlvbiAoYSkge1xuICAgIGlmIChHYihhKSkge1xuICAgICAgICB2YXIgYiA9IG5ldyBaO1xuICAgICAgICBiLnBhcnNlKGEsICExLCAhMCk7XG4gICAgICAgIGEgPSBiO1xuICAgIH1cbiAgICBiID0gbmV3IFo7XG4gICAgZm9yICh2YXIgYyA9IE9iamVjdC5rZXlzKHRoaXMpLCBkID0gMDsgZCA8IGMubGVuZ3RoOyBkKyspIHtcbiAgICAgICAgdmFyIGUgPSBjW2RdO1xuICAgICAgICBiW2VdID0gdGhpc1tlXTtcbiAgICB9XG4gICAgYi5oYXNoID0gYS5oYXNoO1xuICAgIGlmIChcIlwiID09PSBhLmhyZWYpXG4gICAgICAgIHJldHVybiBiLmhyZWYgPSBiLmZvcm1hdCgpLCBiO1xuICAgIGlmIChhLnNsYXNoZXMgJiYgIWEucHJvdG9jb2wpIHtcbiAgICAgICAgYyA9IE9iamVjdC5rZXlzKGEpO1xuICAgICAgICBmb3IgKGQgPSAwOyBkIDwgYy5sZW5ndGg7IGQrKylcbiAgICAgICAgICAgIGUgPSBjW2RdLCBcInByb3RvY29sXCIgIT09IGUgJiYgKGJbZV0gPSBhW2VdKTtcbiAgICAgICAgU2VbYi5wcm90b2NvbF0gJiYgYi5ob3N0bmFtZSAmJiAhYi5wYXRobmFtZSAmJiAoYi5wYXRoID0gYi5wYXRobmFtZSA9IFwiL1wiKTtcbiAgICAgICAgYi5ocmVmID0gYi5mb3JtYXQoKTtcbiAgICAgICAgcmV0dXJuIGI7XG4gICAgfVxuICAgIHZhciBmO1xuICAgIGlmIChhLnByb3RvY29sICYmIGEucHJvdG9jb2wgIT09IGIucHJvdG9jb2wpIHtcbiAgICAgICAgaWYgKCFTZVthLnByb3RvY29sXSkge1xuICAgICAgICAgICAgYyA9IE9iamVjdC5rZXlzKGEpO1xuICAgICAgICAgICAgZm9yIChkID0gMDsgZCA8XG4gICAgICAgICAgICAgICAgYy5sZW5ndGg7IGQrKylcbiAgICAgICAgICAgICAgICBlID0gY1tkXSwgYltlXSA9IGFbZV07XG4gICAgICAgICAgICBiLmhyZWYgPSBiLmZvcm1hdCgpO1xuICAgICAgICAgICAgcmV0dXJuIGI7XG4gICAgICAgIH1cbiAgICAgICAgYi5wcm90b2NvbCA9IGEucHJvdG9jb2w7XG4gICAgICAgIGlmIChhLmhvc3QgfHwgUmVbYS5wcm90b2NvbF0pXG4gICAgICAgICAgICBiLnBhdGhuYW1lID0gYS5wYXRobmFtZTtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBmb3IgKGYgPSAoYS5wYXRobmFtZSB8fCBcIlwiKS5zcGxpdChcIi9cIik7IGYubGVuZ3RoICYmICEoYS5ob3N0ID0gZi5zaGlmdCgpKTspXG4gICAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgYS5ob3N0IHx8IChhLmhvc3QgPSBcIlwiKTtcbiAgICAgICAgICAgIGEuaG9zdG5hbWUgfHwgKGEuaG9zdG5hbWUgPSBcIlwiKTtcbiAgICAgICAgICAgIFwiXCIgIT09IGZbMF0gJiYgZi51bnNoaWZ0KFwiXCIpO1xuICAgICAgICAgICAgMiA+IGYubGVuZ3RoICYmIGYudW5zaGlmdChcIlwiKTtcbiAgICAgICAgICAgIGIucGF0aG5hbWUgPSBmLmpvaW4oXCIvXCIpO1xuICAgICAgICB9XG4gICAgICAgIGIuc2VhcmNoID0gYS5zZWFyY2g7XG4gICAgICAgIGIucXVlcnkgPSBhLnF1ZXJ5O1xuICAgICAgICBiLmhvc3QgPSBhLmhvc3QgfHwgXCJcIjtcbiAgICAgICAgYi5hdXRoID0gYS5hdXRoO1xuICAgICAgICBiLmhvc3RuYW1lID0gYS5ob3N0bmFtZSB8fCBhLmhvc3Q7XG4gICAgICAgIGIucG9ydCA9IGEucG9ydDtcbiAgICAgICAgaWYgKGIucGF0aG5hbWUgfHwgYi5zZWFyY2gpXG4gICAgICAgICAgICBiLnBhdGggPSAoYi5wYXRobmFtZSB8fCBcIlwiKSArIChiLnNlYXJjaCB8fCBcIlwiKTtcbiAgICAgICAgYi5zbGFzaGVzID1cbiAgICAgICAgICAgIGIuc2xhc2hlcyB8fCBhLnNsYXNoZXM7XG4gICAgICAgIGIuaHJlZiA9IGIuZm9ybWF0KCk7XG4gICAgICAgIHJldHVybiBiO1xuICAgIH1cbiAgICBjID0gYi5wYXRobmFtZSAmJiBcIi9cIiA9PT0gYi5wYXRobmFtZS5jaGFyQXQoMCk7XG4gICAgdmFyIGcgPSBhLmhvc3QgfHwgYS5wYXRobmFtZSAmJiBcIi9cIiA9PT0gYS5wYXRobmFtZS5jaGFyQXQoMCksIGggPSBjID0gZyB8fCBjIHx8IGIuaG9zdCAmJiBhLnBhdGhuYW1lO1xuICAgIGQgPSBiLnBhdGhuYW1lICYmIGIucGF0aG5hbWUuc3BsaXQoXCIvXCIpIHx8IFtdO1xuICAgIGUgPSBiLnByb3RvY29sICYmICFTZVtiLnByb3RvY29sXTtcbiAgICBmID0gYS5wYXRobmFtZSAmJiBhLnBhdGhuYW1lLnNwbGl0KFwiL1wiKSB8fCBbXTtcbiAgICBlICYmIChiLmhvc3RuYW1lID0gXCJcIiwgYi5wb3J0ID0gbnVsbCwgYi5ob3N0ICYmIChcIlwiID09PSBkWzBdID8gZFswXSA9IGIuaG9zdCA6IGQudW5zaGlmdChiLmhvc3QpKSwgYi5ob3N0ID0gXCJcIiwgYS5wcm90b2NvbCAmJiAoYS5ob3N0bmFtZSA9IG51bGwsIGEucG9ydCA9IG51bGwsIGEuaG9zdCAmJiAoXCJcIiA9PT0gZlswXSA/IGZbMF0gPSBhLmhvc3QgOiBmLnVuc2hpZnQoYS5ob3N0KSksIGEuaG9zdCA9IG51bGwpLCBjID0gYyAmJiAoXCJcIiA9PT0gZlswXSB8fCBcIlwiID09PSBkWzBdKSk7XG4gICAgaWYgKGcpXG4gICAgICAgIGIuaG9zdCA9IGEuaG9zdCB8fCBcIlwiID09PSBhLmhvc3QgPyBhLmhvc3QgOiBiLmhvc3QsIGIuaG9zdG5hbWUgPSBhLmhvc3RuYW1lIHx8IFwiXCIgPT09IGEuaG9zdG5hbWUgPyBhLmhvc3RuYW1lIDogYi5ob3N0bmFtZSwgYi5zZWFyY2ggPSBhLnNlYXJjaCwgYi5xdWVyeSA9IGEucXVlcnksIGQgPSBmO1xuICAgIGVsc2UgaWYgKGYubGVuZ3RoKVxuICAgICAgICBkIHx8IChkID0gW10pLCBkLnBvcCgpLCBkID0gZC5jb25jYXQoZiksIGIuc2VhcmNoID0gYS5zZWFyY2gsIGIucXVlcnkgPSBhLnF1ZXJ5O1xuICAgIGVsc2UgaWYgKG51bGwgIT0gYS5zZWFyY2gpIHtcbiAgICAgICAgZSAmJiAoYi5ob3N0bmFtZSA9IGIuaG9zdCA9IGQuc2hpZnQoKSwgZSA9IGIuaG9zdCAmJiAwIDwgYi5ob3N0LmluZGV4T2YoXCJAXCIpID8gYi5ob3N0LnNwbGl0KFwiQFwiKSA6ICExKSAmJiAoYi5hdXRoID0gZS5zaGlmdCgpLCBiLmhvc3QgPSBiLmhvc3RuYW1lID0gZS5zaGlmdCgpKTtcbiAgICAgICAgYi5zZWFyY2ggPSBhLnNlYXJjaDtcbiAgICAgICAgYi5xdWVyeSA9IGEucXVlcnk7XG4gICAgICAgIGlmIChudWxsICE9PSBiLnBhdGhuYW1lIHx8IG51bGwgIT09IGIuc2VhcmNoKVxuICAgICAgICAgICAgYi5wYXRoID0gKGIucGF0aG5hbWUgPyBiLnBhdGhuYW1lIDogXCJcIikgKyAoYi5zZWFyY2ggP1xuICAgICAgICAgICAgICAgIGIuc2VhcmNoIDogXCJcIik7XG4gICAgICAgIGIuaHJlZiA9IGIuZm9ybWF0KCk7XG4gICAgICAgIHJldHVybiBiO1xuICAgIH1cbiAgICBpZiAoIWQubGVuZ3RoKVxuICAgICAgICByZXR1cm4gYi5wYXRobmFtZSA9IG51bGwsIGIucGF0aCA9IGIuc2VhcmNoID8gXCIvXCIgKyBiLnNlYXJjaCA6IG51bGwsIGIuaHJlZiA9IGIuZm9ybWF0KCksIGI7XG4gICAgZyA9IGQuc2xpY2UoLTEpWzBdO1xuICAgIGYgPSAoYi5ob3N0IHx8IGEuaG9zdCB8fCAxIDwgZC5sZW5ndGgpICYmIChcIi5cIiA9PT0gZyB8fCBcIi4uXCIgPT09IGcpIHx8IFwiXCIgPT09IGc7XG4gICAgZm9yICh2YXIgayA9IDAsIHAgPSBkLmxlbmd0aDsgMCA8PSBwOyBwLS0pXG4gICAgICAgIGcgPSBkW3BdLCBcIi5cIiA9PT0gZyA/IGQuc3BsaWNlKHAsIDEpIDogXCIuLlwiID09PSBnID8gKGQuc3BsaWNlKHAsIDEpLCBrKyspIDogayAmJiAoZC5zcGxpY2UocCwgMSksIGstLSk7XG4gICAgaWYgKCFjICYmICFoKVxuICAgICAgICBmb3IgKDsgay0tOyBrKVxuICAgICAgICAgICAgZC51bnNoaWZ0KFwiLi5cIik7XG4gICAgIWMgfHwgXCJcIiA9PT0gZFswXSB8fCBkWzBdICYmIFwiL1wiID09PSBkWzBdLmNoYXJBdCgwKSB8fCBkLnVuc2hpZnQoXCJcIik7XG4gICAgZiAmJiBcIi9cIiAhPT0gZC5qb2luKFwiL1wiKS5zdWJzdHIoLTEpICYmIGQucHVzaChcIlwiKTtcbiAgICBoID0gXCJcIiA9PT0gZFswXSB8fCBkWzBdICYmIFwiL1wiID09PSBkWzBdLmNoYXJBdCgwKTtcbiAgICBlICYmXG4gICAgICAgIChiLmhvc3RuYW1lID0gYi5ob3N0ID0gaCA/IFwiXCIgOiBkLmxlbmd0aCA/IGQuc2hpZnQoKSA6IFwiXCIsIGUgPSBiLmhvc3QgJiYgMCA8IGIuaG9zdC5pbmRleE9mKFwiQFwiKSA/IGIuaG9zdC5zcGxpdChcIkBcIikgOiAhMSkgJiYgKGIuYXV0aCA9IGUuc2hpZnQoKSwgYi5ob3N0ID0gYi5ob3N0bmFtZSA9IGUuc2hpZnQoKSk7XG4gICAgKGMgPSBjIHx8IGIuaG9zdCAmJiBkLmxlbmd0aCkgJiYgIWggJiYgZC51bnNoaWZ0KFwiXCIpO1xuICAgIGQubGVuZ3RoID8gYi5wYXRobmFtZSA9IGQuam9pbihcIi9cIikgOiAoYi5wYXRobmFtZSA9IG51bGwsIGIucGF0aCA9IG51bGwpO1xuICAgIGlmIChudWxsICE9PSBiLnBhdGhuYW1lIHx8IG51bGwgIT09IGIuc2VhcmNoKVxuICAgICAgICBiLnBhdGggPSAoYi5wYXRobmFtZSA/IGIucGF0aG5hbWUgOiBcIlwiKSArIChiLnNlYXJjaCA/IGIuc2VhcmNoIDogXCJcIik7XG4gICAgYi5hdXRoID0gYS5hdXRoIHx8IGIuYXV0aDtcbiAgICBiLnNsYXNoZXMgPSBiLnNsYXNoZXMgfHwgYS5zbGFzaGVzO1xuICAgIGIuaHJlZiA9IGIuZm9ybWF0KCk7XG4gICAgcmV0dXJuIGI7XG59O1xuWi5wcm90b3R5cGUucGFyc2VIb3N0ID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gVWUodGhpcyk7IH07XG5mdW5jdGlvbiBVZShhKSB7IHZhciBiID0gYS5ob3N0LCBjID0gSGUuZXhlYyhiKTsgYyAmJiAoYyA9IGNbMF0sIFwiOlwiICE9PSBjICYmIChhLnBvcnQgPSBjLnN1YnN0cigxKSksIGIgPSBiLnN1YnN0cigwLCBiLmxlbmd0aCAtIGMubGVuZ3RoKSk7IGIgJiYgKGEuaG9zdG5hbWUgPSBiKTsgfVxudmFyIFdlID0gdShmdW5jdGlvbiAoYSwgYikge1xuICAgIGZ1bmN0aW9uIGMoYSwgYikgeyBhID0gYVtiXTsgcmV0dXJuIDAgPCBiICYmIChcIi9cIiA9PT0gYSB8fCBlICYmIFwiXFxcXFwiID09PSBhKTsgfVxuICAgIGZ1bmN0aW9uIGQoYSkgeyB2YXIgYiA9IDEgPCBhcmd1bWVudHMubGVuZ3RoICYmIHZvaWQgMCAhPT0gYXJndW1lbnRzWzFdID8gYXJndW1lbnRzWzFdIDogITA7IGlmIChlKSB7XG4gICAgICAgIHZhciBkID0gYTtcbiAgICAgICAgaWYgKFwic3RyaW5nXCIgIT09IHR5cGVvZiBkKVxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcImV4cGVjdGVkIGEgc3RyaW5nXCIpO1xuICAgICAgICBkID0gZC5yZXBsYWNlKC9bXFxcXFxcL10rL2csIFwiL1wiKTtcbiAgICAgICAgaWYgKCExICE9PSBiKVxuICAgICAgICAgICAgaWYgKGIgPSBkLCBkID0gYi5sZW5ndGggLSAxLCAyID4gZClcbiAgICAgICAgICAgICAgICBkID0gYjtcbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGZvciAoOyBjKGIsIGQpOylcbiAgICAgICAgICAgICAgICAgICAgZC0tO1xuICAgICAgICAgICAgICAgIGQgPSBiLnN1YnN0cigwLCBkICsgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIHJldHVybiBkLnJlcGxhY2UoL14oW2EtekEtWl0rOnxcXC5cXC8pLywgXCJcIik7XG4gICAgfSByZXR1cm4gYTsgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShiLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogITAgfSk7XG4gICAgYi51bml4aWZ5ID0gZDtcbiAgICBiLmNvcnJlY3RQYXRoID0gZnVuY3Rpb24gKGEpIHtcbiAgICAgICAgcmV0dXJuIGQoYS5yZXBsYWNlKC9eXFxcXFxcXFxcXD9cXFxcLjpcXFxcLywgXCJcXFxcXCIpKTtcbiAgICB9O1xuICAgIHZhciBlID0gXCJ3aW4zMlwiID09PSBDYi5wbGF0Zm9ybTtcbn0pO1xudChXZSk7XG52YXIgWGUgPSB1KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgZnVuY3Rpb24gYyhhLCBiKSB7IHZvaWQgMCA9PT0gYiAmJiAoYiA9IEwuZGVmYXVsdC5jd2QoKSk7IHJldHVybiBjZihiLCBhKTsgfVxuICAgIGZ1bmN0aW9uIGQoYSwgYikgeyByZXR1cm4gXCJmdW5jdGlvblwiID09PSB0eXBlb2YgYSA/IFtlKCksIGFdIDogW2UoYSksIHEoYildOyB9XG4gICAgZnVuY3Rpb24gZShhKSB7IHZvaWQgMCA9PT0gYSAmJiAoYSA9IHt9KTsgcmV0dXJuIGFhKHt9LCBkZiwgYSk7IH1cbiAgICBmdW5jdGlvbiBmKGEpIHsgcmV0dXJuIFwibnVtYmVyXCIgPT09IHR5cGVvZiBhID8gYWEoe30sIHVkLCB7IG1vZGU6IGEgfSkgOiBhYSh7fSwgdWQsIGEpOyB9XG4gICAgZnVuY3Rpb24gZyhhLCBiLCBjLCBkKSB7XG4gICAgICAgIHZvaWQgMCA9PT0gYiAmJiAoYiA9IFwiXCIpO1xuICAgICAgICB2b2lkIDAgPT09IGMgJiYgKGMgPSBcIlwiKTtcbiAgICAgICAgdm9pZCAwID09PSBkICYmIChkID0gXCJcIik7XG4gICAgICAgIHZhciBlID0gXCJcIjtcbiAgICAgICAgYyAmJiAoZSA9IFwiICdcIiArIGMgKyBcIidcIik7XG4gICAgICAgIGQgJiYgKGUgKz0gXCIgLT4gJ1wiICsgZCArIFwiJ1wiKTtcbiAgICAgICAgc3dpdGNoIChhKSB7XG4gICAgICAgICAgICBjYXNlIFwiRU5PRU5UXCI6IHJldHVybiBcIkVOT0VOVDogbm8gc3VjaCBmaWxlIG9yIGRpcmVjdG9yeSwgXCIgKyBiICsgZTtcbiAgICAgICAgICAgIGNhc2UgXCJFQkFERlwiOiByZXR1cm4gXCJFQkFERjogYmFkIGZpbGUgZGVzY3JpcHRvciwgXCIgK1xuICAgICAgICAgICAgICAgIGIgKyBlO1xuICAgICAgICAgICAgY2FzZSBcIkVJTlZBTFwiOiByZXR1cm4gXCJFSU5WQUw6IGludmFsaWQgYXJndW1lbnQsIFwiICsgYiArIGU7XG4gICAgICAgICAgICBjYXNlIFwiRVBFUk1cIjogcmV0dXJuIFwiRVBFUk06IG9wZXJhdGlvbiBub3QgcGVybWl0dGVkLCBcIiArIGIgKyBlO1xuICAgICAgICAgICAgY2FzZSBcIkVQUk9UT1wiOiByZXR1cm4gXCJFUFJPVE86IHByb3RvY29sIGVycm9yLCBcIiArIGIgKyBlO1xuICAgICAgICAgICAgY2FzZSBcIkVFWElTVFwiOiByZXR1cm4gXCJFRVhJU1Q6IGZpbGUgYWxyZWFkeSBleGlzdHMsIFwiICsgYiArIGU7XG4gICAgICAgICAgICBjYXNlIFwiRU5PVERJUlwiOiByZXR1cm4gXCJFTk9URElSOiBub3QgYSBkaXJlY3RvcnksIFwiICsgYiArIGU7XG4gICAgICAgICAgICBjYXNlIFwiRUlTRElSXCI6IHJldHVybiBcIkVJU0RJUjogaWxsZWdhbCBvcGVyYXRpb24gb24gYSBkaXJlY3RvcnksIFwiICsgYiArIGU7XG4gICAgICAgICAgICBjYXNlIFwiRUFDQ0VTXCI6IHJldHVybiBcIkVBQ0NFUzogcGVybWlzc2lvbiBkZW5pZWQsIFwiICsgYiArIGU7XG4gICAgICAgICAgICBjYXNlIFwiRU5PVEVNUFRZXCI6IHJldHVybiBcIkVOT1RFTVBUWTogZGlyZWN0b3J5IG5vdCBlbXB0eSwgXCIgKyBiICsgZTtcbiAgICAgICAgICAgIGNhc2UgXCJFTUZJTEVcIjogcmV0dXJuIFwiRU1GSUxFOiB0b28gbWFueSBvcGVuIGZpbGVzLCBcIiArXG4gICAgICAgICAgICAgICAgYiArIGU7XG4gICAgICAgICAgICBjYXNlIFwiRU5PU1lTXCI6IHJldHVybiBcIkVOT1NZUzogZnVuY3Rpb24gbm90IGltcGxlbWVudGVkLCBcIiArIGIgKyBlO1xuICAgICAgICAgICAgZGVmYXVsdDogcmV0dXJuIGEgKyBcIjogZXJyb3Igb2NjdXJyZWQsIFwiICsgYiArIGU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZnVuY3Rpb24gaChhLCBiLCBjLCBkLCBlKSB7IHZvaWQgMCA9PT0gYiAmJiAoYiA9IFwiXCIpOyB2b2lkIDAgPT09IGMgJiYgKGMgPSBcIlwiKTsgdm9pZCAwID09PSBkICYmIChkID0gXCJcIik7IHZvaWQgMCA9PT0gZSAmJiAoZSA9IEVycm9yKTsgYiA9IG5ldyBlKGcoYSwgYiwgYywgZCkpOyBiLmNvZGUgPSBhOyByZXR1cm4gYjsgfVxuICAgIGZ1bmN0aW9uIGsoYSkgeyBpZiAoXCJudW1iZXJcIiA9PT0gdHlwZW9mIGEpXG4gICAgICAgIHJldHVybiBhOyBpZiAoXCJzdHJpbmdcIiA9PT0gdHlwZW9mIGEpIHtcbiAgICAgICAgdmFyIGIgPSB1YVthXTtcbiAgICAgICAgaWYgKFwidW5kZWZpbmVkXCIgIT09IHR5cGVvZiBiKVxuICAgICAgICAgICAgcmV0dXJuIGI7XG4gICAgfSB0aHJvdyBuZXcgUGMuVHlwZUVycm9yKFwiRVJSX0lOVkFMSURfT1BUX1ZBTFVFXCIsIFwiZmxhZ3NcIiwgYSk7IH1cbiAgICBmdW5jdGlvbiBwKGEsIGIpIHtcbiAgICAgICAgaWYgKGIpIHtcbiAgICAgICAgICAgIHZhciBjID0gdHlwZW9mIGI7XG4gICAgICAgICAgICBzd2l0Y2ggKGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwic3RyaW5nXCI6XG4gICAgICAgICAgICAgICAgICAgIGEgPSBhYSh7fSwgYSwgeyBlbmNvZGluZzogYiB9KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcIm9iamVjdFwiOlxuICAgICAgICAgICAgICAgICAgICBhID0gYWEoe30sIGEsIGIpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiB0aHJvdyBUeXBlRXJyb3IoXCJFeHBlY3RlZCBvcHRpb25zIHRvIGJlIGVpdGhlciBhbiBvYmplY3Qgb3IgYSBzdHJpbmcsIGJ1dCBnb3QgXCIgKyBjICsgXCIgaW5zdGVhZFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICByZXR1cm4gYTtcbiAgICAgICAgXCJidWZmZXJcIiAhPT0gYS5lbmNvZGluZyAmJiBLLmFzc2VydEVuY29kaW5nKGEuZW5jb2RpbmcpO1xuICAgICAgICByZXR1cm4gYTtcbiAgICB9XG4gICAgZnVuY3Rpb24gbihhKSB7IHJldHVybiBmdW5jdGlvbiAoYikgeyByZXR1cm4gcChhLCBiKTsgfTsgfVxuICAgIGZ1bmN0aW9uIHEoYSkgeyBpZiAoXCJmdW5jdGlvblwiICE9PSB0eXBlb2YgYSlcbiAgICAgICAgdGhyb3cgVHlwZUVycm9yKGZhLkNCKTsgcmV0dXJuIGE7IH1cbiAgICBmdW5jdGlvbiBCKGEpIHsgcmV0dXJuIGZ1bmN0aW9uIChiLCBjKSB7IHJldHVybiBcImZ1bmN0aW9uXCIgPT09IHR5cGVvZiBiID8gW2EoKSwgYl0gOiBbYShiKSwgcShjKV07IH07IH1cbiAgICBmdW5jdGlvbiBtKGEpIHtcbiAgICAgICAgaWYgKFwic3RyaW5nXCIgIT09IHR5cGVvZiBhICYmICFGLkJ1ZmZlci5pc0J1ZmZlcihhKSkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBpZiAoIShhIGluc3RhbmNlb2ZcbiAgICAgICAgICAgICAgICAgICAgRmUuVVJMKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihmYS5QQVRIX1NUUik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoWGEpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKGZhLlBBVEhfU1RSKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChcIlwiICE9PSBhLmhvc3RuYW1lKVxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBQYy5UeXBlRXJyb3IoXCJFUlJfSU5WQUxJRF9GSUxFX1VSTF9IT1NUXCIsIEwuZGVmYXVsdC5wbGF0Zm9ybSk7XG4gICAgICAgICAgICBhID0gYS5wYXRobmFtZTtcbiAgICAgICAgICAgIGZvciAodmFyIGIgPSAwOyBiIDwgYS5sZW5ndGg7IGIrKylcbiAgICAgICAgICAgICAgICBpZiAoXCIlXCIgPT09IGFbYl0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBhLmNvZGVQb2ludEF0KGIgKyAyKSB8IDMyO1xuICAgICAgICAgICAgICAgICAgICBpZiAoXCIyXCIgPT09IGFbYiArIDFdICYmIDEwMiA9PT0gYylcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBQYy5UeXBlRXJyb3IoXCJFUlJfSU5WQUxJRF9GSUxFX1VSTF9QQVRIXCIsIFwibXVzdCBub3QgaW5jbHVkZSBlbmNvZGVkIC8gY2hhcmFjdGVyc1wiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBhID0gZGVjb2RlVVJJQ29tcG9uZW50KGEpO1xuICAgICAgICB9XG4gICAgICAgIGEgPSBTdHJpbmcoYSk7XG4gICAgICAgIHFiKGEpO1xuICAgICAgICByZXR1cm4gYTtcbiAgICB9XG4gICAgZnVuY3Rpb24gdihhLCBiKSB7IHJldHVybiAoYSA9IGMoYSwgYikuc3Vic3RyKDEpKSA/IGEuc3BsaXQoUykgOiBbXTsgfVxuICAgIGZ1bmN0aW9uIHhhKGEpIHsgcmV0dXJuIHYobShhKSk7IH1cbiAgICBmdW5jdGlvbiBMYShhLCBiKSB7IHZvaWQgMCA9PT0gYiAmJiAoYiA9IEsuRU5DT0RJTkdfVVRGOCk7IHJldHVybiBGLkJ1ZmZlci5pc0J1ZmZlcihhKSA/IGEgOiBhIGluc3RhbmNlb2YgVWludDhBcnJheSA/IEYuYnVmZmVyRnJvbShhKSA6IEYuYnVmZmVyRnJvbShTdHJpbmcoYSksIGIpOyB9XG4gICAgZnVuY3Rpb24gJGIoYSwgYikgeyByZXR1cm4gYiAmJiBcImJ1ZmZlclwiICE9PSBiID8gYS50b1N0cmluZyhiKSA6IGE7IH1cbiAgICBmdW5jdGlvbiBxYihhLCBiKSB7IGlmICgtMSAhPT0gKFwiXCIgKyBhKS5pbmRleE9mKFwiXFx4MDBcIikpIHtcbiAgICAgICAgYSA9IEVycm9yKFwiUGF0aCBtdXN0IGJlIGEgc3RyaW5nIHdpdGhvdXQgbnVsbCBieXRlc1wiKTtcbiAgICAgICAgYS5jb2RlID0gXCJFTk9FTlRcIjtcbiAgICAgICAgaWYgKFwiZnVuY3Rpb25cIiAhPT0gdHlwZW9mIGIpXG4gICAgICAgICAgICB0aHJvdyBhO1xuICAgICAgICBMLmRlZmF1bHQubmV4dFRpY2soYiwgYSk7XG4gICAgICAgIHJldHVybiAhMTtcbiAgICB9IHJldHVybiAhMDsgfVxuICAgIGZ1bmN0aW9uIE0oYSwgYikge1xuICAgICAgICBhID0gXCJudW1iZXJcIiA9PT0gdHlwZW9mIGEgPyBhIDogXCJzdHJpbmdcIiA9PT0gdHlwZW9mIGEgPyBwYXJzZUludChhLCA4KSA6IGIgPyBNKGIpIDogdm9pZCAwO1xuICAgICAgICBpZiAoXCJudW1iZXJcIiAhPT0gdHlwZW9mIGEgfHxcbiAgICAgICAgICAgIGlzTmFOKGEpKVxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihmYS5NT0RFX0lOVCk7XG4gICAgICAgIHJldHVybiBhO1xuICAgIH1cbiAgICBmdW5jdGlvbiBZYShhKSB7IGlmIChhID4+PiAwICE9PSBhKVxuICAgICAgICB0aHJvdyBUeXBlRXJyb3IoZmEuRkQpOyB9XG4gICAgZnVuY3Rpb24gaGEoYSkgeyBpZiAoXCJzdHJpbmdcIiA9PT0gdHlwZW9mIGEgJiYgK2EgPT0gYSlcbiAgICAgICAgcmV0dXJuICthOyBpZiAoYSBpbnN0YW5jZW9mIERhdGUpXG4gICAgICAgIHJldHVybiBhLmdldFRpbWUoKSAvIDFFMzsgaWYgKGlzRmluaXRlKGEpKVxuICAgICAgICByZXR1cm4gMCA+IGEgPyBEYXRlLm5vdygpIC8gMUUzIDogYTsgdGhyb3cgRXJyb3IoXCJDYW5ub3QgcGFyc2UgdGltZTogXCIgKyBhKTsgfVxuICAgIGZ1bmN0aW9uIEhhKGEpIHsgaWYgKFwibnVtYmVyXCIgIT09IHR5cGVvZiBhKVxuICAgICAgICB0aHJvdyBUeXBlRXJyb3IoZmEuVUlEKTsgfVxuICAgIGZ1bmN0aW9uIElhKGEpIHsgaWYgKFwibnVtYmVyXCIgIT09IHR5cGVvZiBhKVxuICAgICAgICB0aHJvdyBUeXBlRXJyb3IoZmEuR0lEKTsgfVxuICAgIGZ1bmN0aW9uIGVmKGEpIHsgYS5lbWl0KFwic3RvcFwiKTsgfVxuICAgIGZ1bmN0aW9uIFQoYSwgYiwgYykge1xuICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgVCkpXG4gICAgICAgICAgICByZXR1cm4gbmV3IFQoYSwgYiwgYyk7XG4gICAgICAgIHRoaXMuX3ZvbCA9XG4gICAgICAgICAgICBhO1xuICAgICAgICBjID0gYWEoe30sIHAoYywge30pKTtcbiAgICAgICAgdm9pZCAwID09PSBjLmhpZ2hXYXRlck1hcmsgJiYgKGMuaGlnaFdhdGVyTWFyayA9IDY1NTM2KTtcbiAgICAgICAgWS5SZWFkYWJsZS5jYWxsKHRoaXMsIGMpO1xuICAgICAgICB0aGlzLnBhdGggPSBtKGIpO1xuICAgICAgICB0aGlzLmZkID0gdm9pZCAwID09PSBjLmZkID8gbnVsbCA6IGMuZmQ7XG4gICAgICAgIHRoaXMuZmxhZ3MgPSB2b2lkIDAgPT09IGMuZmxhZ3MgPyBcInJcIiA6IGMuZmxhZ3M7XG4gICAgICAgIHRoaXMubW9kZSA9IHZvaWQgMCA9PT0gYy5tb2RlID8gNDM4IDogYy5tb2RlO1xuICAgICAgICB0aGlzLnN0YXJ0ID0gYy5zdGFydDtcbiAgICAgICAgdGhpcy5lbmQgPSBjLmVuZDtcbiAgICAgICAgdGhpcy5hdXRvQ2xvc2UgPSB2b2lkIDAgPT09IGMuYXV0b0Nsb3NlID8gITAgOiBjLmF1dG9DbG9zZTtcbiAgICAgICAgdGhpcy5wb3MgPSB2b2lkIDA7XG4gICAgICAgIHRoaXMuYnl0ZXNSZWFkID0gMDtcbiAgICAgICAgaWYgKHZvaWQgMCAhPT0gdGhpcy5zdGFydCkge1xuICAgICAgICAgICAgaWYgKFwibnVtYmVyXCIgIT09IHR5cGVvZiB0aGlzLnN0YXJ0KVxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1wic3RhcnRcIiBvcHRpb24gbXVzdCBiZSBhIE51bWJlcicpO1xuICAgICAgICAgICAgaWYgKHZvaWQgMCA9PT0gdGhpcy5lbmQpXG4gICAgICAgICAgICAgICAgdGhpcy5lbmQgPSBJbmZpbml0eTtcbiAgICAgICAgICAgIGVsc2UgaWYgKFwibnVtYmVyXCIgIT09XG4gICAgICAgICAgICAgICAgdHlwZW9mIHRoaXMuZW5kKVxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1wiZW5kXCIgb3B0aW9uIG11c3QgYmUgYSBOdW1iZXInKTtcbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXJ0ID4gdGhpcy5lbmQpXG4gICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ1wic3RhcnRcIiBvcHRpb24gbXVzdCBiZSA8PSBcImVuZFwiIG9wdGlvbicpO1xuICAgICAgICAgICAgdGhpcy5wb3MgPSB0aGlzLnN0YXJ0O1xuICAgICAgICB9XG4gICAgICAgIFwibnVtYmVyXCIgIT09IHR5cGVvZiB0aGlzLmZkICYmIHRoaXMub3BlbigpO1xuICAgICAgICB0aGlzLm9uKFwiZW5kXCIsIGZ1bmN0aW9uICgpIHsgdGhpcy5hdXRvQ2xvc2UgJiYgdGhpcy5kZXN0cm95ICYmIHRoaXMuZGVzdHJveSgpOyB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZmYoKSB7IHRoaXMuY2xvc2UoKTsgfVxuICAgIGZ1bmN0aW9uIFIoYSwgYiwgYykge1xuICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgUikpXG4gICAgICAgICAgICByZXR1cm4gbmV3IFIoYSwgYiwgYyk7XG4gICAgICAgIHRoaXMuX3ZvbCA9IGE7XG4gICAgICAgIGMgPSBhYSh7fSwgcChjLCB7fSkpO1xuICAgICAgICBZLldyaXRhYmxlLmNhbGwodGhpcywgYyk7XG4gICAgICAgIHRoaXMucGF0aCA9IG0oYik7XG4gICAgICAgIHRoaXMuZmQgPSB2b2lkIDAgPT09IGMuZmQgPyBudWxsIDogYy5mZDtcbiAgICAgICAgdGhpcy5mbGFncyA9IHZvaWQgMCA9PT0gYy5mbGFncyA/IFwid1wiIDogYy5mbGFncztcbiAgICAgICAgdGhpcy5tb2RlID0gdm9pZCAwID09PSBjLm1vZGUgPyA0MzggOiBjLm1vZGU7XG4gICAgICAgIHRoaXMuc3RhcnQgPSBjLnN0YXJ0O1xuICAgICAgICB0aGlzLmF1dG9DbG9zZSA9IHZvaWQgMCA9PT0gYy5hdXRvQ2xvc2UgPyAhMCA6ICEhYy5hdXRvQ2xvc2U7XG4gICAgICAgIHRoaXMucG9zID0gdm9pZCAwO1xuICAgICAgICB0aGlzLmJ5dGVzV3JpdHRlbiA9IDA7XG4gICAgICAgIGlmICh2b2lkIDAgIT09IHRoaXMuc3RhcnQpIHtcbiAgICAgICAgICAgIGlmIChcIm51bWJlclwiICE9PSB0eXBlb2YgdGhpcy5zdGFydClcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdcInN0YXJ0XCIgb3B0aW9uIG11c3QgYmUgYSBOdW1iZXInKTtcbiAgICAgICAgICAgIGlmICgwID4gdGhpcy5zdGFydClcbiAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcignXCJzdGFydFwiIG11c3QgYmUgPj0gemVybycpO1xuICAgICAgICAgICAgdGhpcy5wb3MgPSB0aGlzLnN0YXJ0O1xuICAgICAgICB9XG4gICAgICAgIGMuZW5jb2RpbmcgJiYgdGhpcy5zZXREZWZhdWx0RW5jb2RpbmcoYy5lbmNvZGluZyk7XG4gICAgICAgIFwibnVtYmVyXCIgIT09IHR5cGVvZiB0aGlzLmZkICYmIHRoaXMub3BlbigpO1xuICAgICAgICB0aGlzLm9uY2UoXCJmaW5pc2hcIiwgZnVuY3Rpb24gKCkgeyB0aGlzLmF1dG9DbG9zZSAmJiB0aGlzLmNsb3NlKCk7IH0pO1xuICAgIH1cbiAgICB2YXIgSmEgPSBsICYmIGwuX19leHRlbmRzIHx8XG4gICAgICAgIGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gYShiLCBjKSB7IGEgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoYSwgYikgeyBhLl9fcHJvdG9fXyA9IGI7IH0gfHwgZnVuY3Rpb24gKGEsIGIpIHsgZm9yICh2YXIgYyBpbiBiKVxuICAgICAgICAgICAgYi5oYXNPd25Qcm9wZXJ0eShjKSAmJiAoYVtjXSA9IGJbY10pOyB9OyByZXR1cm4gYShiLCBjKTsgfSByZXR1cm4gZnVuY3Rpb24gKGIsIGMpIHsgZnVuY3Rpb24gZCgpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGI7IH0gYShiLCBjKTsgYi5wcm90b3R5cGUgPSBudWxsID09PSBjID8gT2JqZWN0LmNyZWF0ZShjKSA6IChkLnByb3RvdHlwZSA9IGMucHJvdG90eXBlLCBuZXcgZCk7IH07IH0oKSwgWGIgPSBsICYmIGwuX19zcHJlYWRBcnJheXMgfHwgZnVuY3Rpb24gKCkge1xuICAgICAgICBmb3IgKHZhciBhID0gMCwgYiA9IDAsIGMgPSBhcmd1bWVudHMubGVuZ3RoOyBiIDwgYzsgYisrKVxuICAgICAgICAgICAgYSArPSBhcmd1bWVudHNbYl0ubGVuZ3RoO1xuICAgICAgICBhID0gQXJyYXkoYSk7XG4gICAgICAgIHZhciBkID0gMDtcbiAgICAgICAgZm9yIChiID0gMDsgYiA8IGM7IGIrKylcbiAgICAgICAgICAgIGZvciAodmFyIGUgPSBhcmd1bWVudHNbYl0sIGYgPSAwLCBnID0gZS5sZW5ndGg7IGYgPFxuICAgICAgICAgICAgICAgIGc7IGYrKywgZCsrKVxuICAgICAgICAgICAgICAgIGFbZF0gPSBlW2ZdO1xuICAgICAgICByZXR1cm4gYTtcbiAgICB9O1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShiLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogITAgfSk7XG4gICAgdmFyIGFhID0gbGUuZXh0ZW5kLCBjZiA9IFpjLnJlc29sdmUsIG1iID0gdy5jb25zdGFudHMuT19SRE9OTFksIEthID0gdy5jb25zdGFudHMuT19XUk9OTFksIG5hID0gdy5jb25zdGFudHMuT19SRFdSLCBVID0gdy5jb25zdGFudHMuT19DUkVBVCwgbmIgPSB3LmNvbnN0YW50cy5PX0VYQ0wsIFphID0gdy5jb25zdGFudHMuT19UUlVOQywgJGEgPSB3LmNvbnN0YW50cy5PX0FQUEVORCwgdmQgPSB3LmNvbnN0YW50cy5PX1NZTkMsIGdmID0gdy5jb25zdGFudHMuT19ESVJFQ1RPUlksIHdkID0gdy5jb25zdGFudHMuRl9PSywgaGYgPSB3LmNvbnN0YW50cy5DT1BZRklMRV9FWENMLCBqZiA9IHcuY29uc3RhbnRzLkNPUFlGSUxFX0ZJQ0xPTkVfRk9SQ0U7XG4gICAgdmFyIFMgPSBaYy5zZXA7XG4gICAgdmFyIHhkID0gWmMucmVsYXRpdmU7XG4gICAgdmFyIFliID0gXCJ3aW4zMlwiID09PSBMLmRlZmF1bHQucGxhdGZvcm0sIGZhID0geyBQQVRIX1NUUjogXCJwYXRoIG11c3QgYmUgYSBzdHJpbmcgb3IgQnVmZmVyXCIsXG4gICAgICAgIEZEOiBcImZkIG11c3QgYmUgYSBmaWxlIGRlc2NyaXB0b3JcIiwgTU9ERV9JTlQ6IFwibW9kZSBtdXN0IGJlIGFuIGludFwiLCBDQjogXCJjYWxsYmFjayBtdXN0IGJlIGEgZnVuY3Rpb25cIiwgVUlEOiBcInVpZCBtdXN0IGJlIGFuIHVuc2lnbmVkIGludFwiLCBHSUQ6IFwiZ2lkIG11c3QgYmUgYW4gdW5zaWduZWQgaW50XCIsIExFTjogXCJsZW4gbXVzdCBiZSBhbiBpbnRlZ2VyXCIsIEFUSU1FOiBcImF0aW1lIG11c3QgYmUgYW4gaW50ZWdlclwiLCBNVElNRTogXCJtdGltZSBtdXN0IGJlIGFuIGludGVnZXJcIiwgUFJFRklYOiBcImZpbGVuYW1lIHByZWZpeCBpcyByZXF1aXJlZFwiLCBCVUZGRVI6IFwiYnVmZmVyIG11c3QgYmUgYW4gaW5zdGFuY2Ugb2YgQnVmZmVyIG9yIFN0YXRpY0J1ZmZlclwiLCBPRkZTRVQ6IFwib2Zmc2V0IG11c3QgYmUgYW4gaW50ZWdlclwiLCBMRU5HVEg6IFwibGVuZ3RoIG11c3QgYmUgYW4gaW50ZWdlclwiLCBQT1NJVElPTjogXCJwb3NpdGlvbiBtdXN0IGJlIGFuIGludGVnZXJcIiB9LCB1YTtcbiAgICAoZnVuY3Rpb24gKGEpIHtcbiAgICAgICAgYVthLnIgPSBtYl0gPSBcInJcIjtcbiAgICAgICAgYVthW1wicitcIl0gPVxuICAgICAgICAgICAgbmFdID0gXCJyK1wiO1xuICAgICAgICBhW2EucnMgPSBtYiB8IHZkXSA9IFwicnNcIjtcbiAgICAgICAgYVthLnNyID0gYS5yc10gPSBcInNyXCI7XG4gICAgICAgIGFbYVtcInJzK1wiXSA9IG5hIHwgdmRdID0gXCJycytcIjtcbiAgICAgICAgYVthW1wic3IrXCJdID0gYVtcInJzK1wiXV0gPSBcInNyK1wiO1xuICAgICAgICBhW2EudyA9IEthIHwgVSB8IFphXSA9IFwid1wiO1xuICAgICAgICBhW2Eud3ggPSBLYSB8IFUgfCBaYSB8IG5iXSA9IFwid3hcIjtcbiAgICAgICAgYVthLnh3ID0gYS53eF0gPSBcInh3XCI7XG4gICAgICAgIGFbYVtcIncrXCJdID0gbmEgfCBVIHwgWmFdID0gXCJ3K1wiO1xuICAgICAgICBhW2FbXCJ3eCtcIl0gPSBuYSB8IFUgfCBaYSB8IG5iXSA9IFwid3grXCI7XG4gICAgICAgIGFbYVtcInh3K1wiXSA9IGFbXCJ3eCtcIl1dID0gXCJ4dytcIjtcbiAgICAgICAgYVthLmEgPSBLYSB8ICRhIHwgVV0gPSBcImFcIjtcbiAgICAgICAgYVthLmF4ID0gS2EgfCAkYSB8IFUgfCBuYl0gPSBcImF4XCI7XG4gICAgICAgIGFbYS54YSA9IGEuYXhdID0gXCJ4YVwiO1xuICAgICAgICBhW2FbXCJhK1wiXSA9IG5hIHwgJGEgfCBVXSA9IFwiYStcIjtcbiAgICAgICAgYVthW1wiYXgrXCJdID0gbmEgfCAkYSB8IFUgfCBuYl0gPSBcImF4K1wiO1xuICAgICAgICBhW2FbXCJ4YStcIl0gPSBhW1wiYXgrXCJdXSA9IFwieGErXCI7XG4gICAgfSkodWEgPSBiLkZMQUdTIHx8IChiLkZMQUdTID0ge30pKTtcbiAgICBiLmZsYWdzVG9OdW1iZXIgPSBrO1xuICAgIGEgPSB7IGVuY29kaW5nOiBcInV0ZjhcIiB9O1xuICAgIHZhciBvYiA9IG4oYSksIHlkID0gQihvYiksIHpkID0gbih7IGZsYWc6IFwiclwiIH0pLCBBZCA9IHsgZW5jb2Rpbmc6IFwidXRmOFwiLFxuICAgICAgICBtb2RlOiA0MzgsIGZsYWc6IHVhW3VhLnddIH0sIEJkID0gbihBZCksIENkID0geyBlbmNvZGluZzogXCJ1dGY4XCIsIG1vZGU6IDQzOCwgZmxhZzogdWFbdWEuYV0gfSwgRGQgPSBuKENkKSwga2YgPSBCKERkKSwgRWQgPSBuKGEpLCBsZiA9IEIoRWQpLCB1ZCA9IHsgbW9kZTogNTExLCByZWN1cnNpdmU6ICExIH0sIEZkID0geyByZWN1cnNpdmU6ICExIH0sIEdkID0gbih7IGVuY29kaW5nOiBcInV0ZjhcIiwgd2l0aEZpbGVUeXBlczogITEgfSksIG1mID0gQihHZCksIGRmID0geyBiaWdpbnQ6ICExIH07XG4gICAgYi5wYXRoVG9GaWxlbmFtZSA9IG07XG4gICAgaWYgKFliKSB7XG4gICAgICAgIHZhciBuZiA9IGMsIG9mID0gV2UudW5peGlmeTtcbiAgICAgICAgYyA9IGZ1bmN0aW9uIChhLCBiKSB7IHJldHVybiBvZihuZihhLCBiKSk7IH07XG4gICAgfVxuICAgIGIuZmlsZW5hbWVUb1N0ZXBzID0gdjtcbiAgICBiLnBhdGhUb1N0ZXBzID0geGE7XG4gICAgYi5kYXRhVG9TdHIgPSBmdW5jdGlvbiAoYSwgYikgeyB2b2lkIDAgPT09IGIgJiYgKGIgPSBLLkVOQ09ESU5HX1VURjgpOyByZXR1cm4gRi5CdWZmZXIuaXNCdWZmZXIoYSkgPyBhLnRvU3RyaW5nKGIpIDogYSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkgPyBGLmJ1ZmZlckZyb20oYSkudG9TdHJpbmcoYikgOiBTdHJpbmcoYSk7IH07XG4gICAgYi5kYXRhVG9CdWZmZXIgPSBMYTtcbiAgICBiLmJ1ZmZlclRvRW5jb2RpbmcgPSAkYjtcbiAgICBiLnRvVW5peFRpbWVzdGFtcCA9IGhhO1xuICAgIGEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZ1bmN0aW9uIGEoYSkge1xuICAgICAgICAgICAgdm9pZCAwID09PSBhICYmIChhID0ge30pO1xuICAgICAgICAgICAgdGhpcy5pbm8gPSAwO1xuICAgICAgICAgICAgdGhpcy5pbm9kZXMgPSB7fTtcbiAgICAgICAgICAgIHRoaXMucmVsZWFzZWRJbm9zID0gW107XG4gICAgICAgICAgICB0aGlzLmZkcyA9IHt9O1xuICAgICAgICAgICAgdGhpcy5yZWxlYXNlZEZkcyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5tYXhGaWxlcyA9IDFFNDtcbiAgICAgICAgICAgIHRoaXMub3BlbkZpbGVzID0gMDtcbiAgICAgICAgICAgIHRoaXMucHJvbWlzZXNBcGkgPSBtZS5kZWZhdWx0KHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5zdGF0V2F0Y2hlcnMgPSB7fTtcbiAgICAgICAgICAgIHRoaXMucHJvcHMgPSBhYSh7IE5vZGU6IGZkLk5vZGUsIExpbms6IGZkLkxpbmssIEZpbGU6IGZkLkZpbGUgfSwgYSk7XG4gICAgICAgICAgICBhID0gdGhpcy5jcmVhdGVMaW5rKCk7XG4gICAgICAgICAgICBhLnNldE5vZGUodGhpcy5jcmVhdGVOb2RlKCEwKSk7XG4gICAgICAgICAgICB2YXIgYiA9IHRoaXM7XG4gICAgICAgICAgICB0aGlzLlN0YXRXYXRjaGVyID0gZnVuY3Rpb24gKGEpIHsgZnVuY3Rpb24gYygpIHsgcmV0dXJuIGEuY2FsbCh0aGlzLCBiKSB8fCB0aGlzOyB9IEphKGMsIGEpOyByZXR1cm4gYzsgfShIZCk7XG4gICAgICAgICAgICB0aGlzLlJlYWRTdHJlYW0gPVxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChhKSB7IGZ1bmN0aW9uIGMoKSB7IGZvciAodmFyIGMgPSBbXSwgZCA9IDA7IGQgPCBhcmd1bWVudHMubGVuZ3RoOyBkKyspXG4gICAgICAgICAgICAgICAgICAgIGNbZF0gPSBhcmd1bWVudHNbZF07IHJldHVybiBhLmFwcGx5KHRoaXMsIFhiKFtiXSwgYykpIHx8IHRoaXM7IH0gSmEoYywgYSk7IHJldHVybiBjOyB9KFQpO1xuICAgICAgICAgICAgdGhpcy5Xcml0ZVN0cmVhbSA9IGZ1bmN0aW9uIChhKSB7IGZ1bmN0aW9uIGMoKSB7IGZvciAodmFyIGMgPSBbXSwgZCA9IDA7IGQgPCBhcmd1bWVudHMubGVuZ3RoOyBkKyspXG4gICAgICAgICAgICAgICAgY1tkXSA9IGFyZ3VtZW50c1tkXTsgcmV0dXJuIGEuYXBwbHkodGhpcywgWGIoW2JdLCBjKSkgfHwgdGhpczsgfSBKYShjLCBhKTsgcmV0dXJuIGM7IH0oUik7XG4gICAgICAgICAgICB0aGlzLkZTV2F0Y2hlciA9IGZ1bmN0aW9uIChhKSB7IGZ1bmN0aW9uIGMoKSB7IHJldHVybiBhLmNhbGwodGhpcywgYikgfHwgdGhpczsgfSBKYShjLCBhKTsgcmV0dXJuIGM7IH0oSWQpO1xuICAgICAgICAgICAgdGhpcy5yb290ID0gYTtcbiAgICAgICAgfVxuICAgICAgICBhLmZyb21KU09OID0gZnVuY3Rpb24gKGIsIGMpIHsgdmFyIGQgPSBuZXcgYTsgZC5mcm9tSlNPTihiLCBjKTsgcmV0dXJuIGQ7IH07XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShhLnByb3RvdHlwZSwgXCJwcm9taXNlc1wiLCB7IGdldDogZnVuY3Rpb24gKCkgeyBpZiAobnVsbCA9PT0gdGhpcy5wcm9taXNlc0FwaSlcbiAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcihcIlByb21pc2UgaXMgbm90IHN1cHBvcnRlZCBpbiB0aGlzIGVudmlyb25tZW50LlwiKTsgcmV0dXJuIHRoaXMucHJvbWlzZXNBcGk7IH0sIGVudW1lcmFibGU6ICEwLCBjb25maWd1cmFibGU6ICEwIH0pO1xuICAgICAgICBhLnByb3RvdHlwZS5jcmVhdGVMaW5rID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsgdm9pZCAwID09PSBjICYmIChjID0gITEpOyBpZiAoIWEpXG4gICAgICAgICAgICByZXR1cm4gbmV3IHRoaXMucHJvcHMuTGluayh0aGlzLCBudWxsLCBcIlwiKTsgaWYgKCFiKVxuICAgICAgICAgICAgdGhyb3cgRXJyb3IoXCJjcmVhdGVMaW5rOiBuYW1lIGNhbm5vdCBiZSBlbXB0eVwiKTsgcmV0dXJuIGEuY3JlYXRlQ2hpbGQoYiwgdGhpcy5jcmVhdGVOb2RlKGMsIGQpKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUuZGVsZXRlTGluayA9IGZ1bmN0aW9uIChhKSB7IHZhciBiID0gYS5wYXJlbnQ7IHJldHVybiBiID8gKGIuZGVsZXRlQ2hpbGQoYSksICEwKSA6ICExOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5uZXdJbm9OdW1iZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgYSA9IHRoaXMucmVsZWFzZWRJbm9zLnBvcCgpO1xuICAgICAgICAgICAgcmV0dXJuIGEgPyBhIDogdGhpcy5pbm8gPSAodGhpcy5pbm8gKyAxKSAlIDQyOTQ5NjcyOTU7XG4gICAgICAgIH07XG4gICAgICAgIGEucHJvdG90eXBlLm5ld0ZkTnVtYmVyID0gZnVuY3Rpb24gKCkgeyB2YXIgYiA9IHRoaXMucmVsZWFzZWRGZHMucG9wKCk7IHJldHVybiBcIm51bWJlclwiID09PSB0eXBlb2YgYiA/IGIgOiBhLmZkLS07IH07XG4gICAgICAgIGEucHJvdG90eXBlLmNyZWF0ZU5vZGUgPSBmdW5jdGlvbiAoYSwgYikgeyB2b2lkIDAgPT09IGEgJiYgKGEgPSAhMSk7IGIgPSBuZXcgdGhpcy5wcm9wcy5Ob2RlKHRoaXMubmV3SW5vTnVtYmVyKCksIGIpOyBhICYmIGIuc2V0SXNEaXJlY3RvcnkoKTsgcmV0dXJuIHRoaXMuaW5vZGVzW2IuaW5vXSA9IGI7IH07XG4gICAgICAgIGEucHJvdG90eXBlLmdldE5vZGUgPSBmdW5jdGlvbiAoYSkgeyByZXR1cm4gdGhpcy5pbm9kZXNbYV07IH07XG4gICAgICAgIGEucHJvdG90eXBlLmRlbGV0ZU5vZGUgPSBmdW5jdGlvbiAoYSkgeyBhLmRlbCgpOyBkZWxldGUgdGhpcy5pbm9kZXNbYS5pbm9dOyB0aGlzLnJlbGVhc2VkSW5vcy5wdXNoKGEuaW5vKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUuZ2VuUm5kU3RyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGEgPSAoTWF0aC5yYW5kb20oKSArXG4gICAgICAgICAgICAgICAgMSkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA2KTtcbiAgICAgICAgICAgIHJldHVybiA2ID09PSBhLmxlbmd0aCA/IGEgOiB0aGlzLmdlblJuZFN0cigpO1xuICAgICAgICB9O1xuICAgICAgICBhLnByb3RvdHlwZS5nZXRMaW5rID0gZnVuY3Rpb24gKGEpIHsgcmV0dXJuIHRoaXMucm9vdC53YWxrKGEpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5nZXRMaW5rT3JUaHJvdyA9IGZ1bmN0aW9uIChhLCBiKSB7IHZhciBjID0gdihhKTsgYyA9IHRoaXMuZ2V0TGluayhjKTsgaWYgKCFjKVxuICAgICAgICAgICAgdGhyb3cgaChcIkVOT0VOVFwiLCBiLCBhKTsgcmV0dXJuIGM7IH07XG4gICAgICAgIGEucHJvdG90eXBlLmdldFJlc29sdmVkTGluayA9IGZ1bmN0aW9uIChhKSB7IGEgPSBcInN0cmluZ1wiID09PSB0eXBlb2YgYSA/IHYoYSkgOiBhOyBmb3IgKHZhciBiID0gdGhpcy5yb290LCBjID0gMDsgYyA8IGEubGVuZ3RoOykge1xuICAgICAgICAgICAgYiA9IGIuZ2V0Q2hpbGQoYVtjXSk7XG4gICAgICAgICAgICBpZiAoIWIpXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB2YXIgZCA9IGIuZ2V0Tm9kZSgpO1xuICAgICAgICAgICAgZC5pc1N5bWxpbmsoKSA/IChhID0gZC5zeW1saW5rLmNvbmNhdChhLnNsaWNlKGMgKyAxKSksIGIgPSB0aGlzLnJvb3QsIGMgPSAwKSA6IGMrKztcbiAgICAgICAgfSByZXR1cm4gYjsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUuZ2V0UmVzb2x2ZWRMaW5rT3JUaHJvdyA9XG4gICAgICAgICAgICBmdW5jdGlvbiAoYSwgYikgeyB2YXIgYyA9IHRoaXMuZ2V0UmVzb2x2ZWRMaW5rKGEpOyBpZiAoIWMpXG4gICAgICAgICAgICAgICAgdGhyb3cgaChcIkVOT0VOVFwiLCBiLCBhKTsgcmV0dXJuIGM7IH07XG4gICAgICAgIGEucHJvdG90eXBlLnJlc29sdmVTeW1saW5rcyA9IGZ1bmN0aW9uIChhKSB7IHJldHVybiB0aGlzLmdldFJlc29sdmVkTGluayhhLnN0ZXBzLnNsaWNlKDEpKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUuZ2V0TGlua0FzRGlyT3JUaHJvdyA9IGZ1bmN0aW9uIChhLCBiKSB7IHZhciBjID0gdGhpcy5nZXRMaW5rT3JUaHJvdyhhLCBiKTsgaWYgKCFjLmdldE5vZGUoKS5pc0RpcmVjdG9yeSgpKVxuICAgICAgICAgICAgdGhyb3cgaChcIkVOT1RESVJcIiwgYiwgYSk7IHJldHVybiBjOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5nZXRMaW5rUGFyZW50ID0gZnVuY3Rpb24gKGEpIHsgcmV0dXJuIHRoaXMucm9vdC53YWxrKGEsIGEubGVuZ3RoIC0gMSk7IH07XG4gICAgICAgIGEucHJvdG90eXBlLmdldExpbmtQYXJlbnRBc0Rpck9yVGhyb3cgPSBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAgICAgYSA9IGEgaW5zdGFuY2VvZiBBcnJheSA/IGEgOiB2KGEpO1xuICAgICAgICAgICAgdmFyIGMgPSB0aGlzLmdldExpbmtQYXJlbnQoYSk7XG4gICAgICAgICAgICBpZiAoIWMpXG4gICAgICAgICAgICAgICAgdGhyb3cgaChcIkVOT0VOVFwiLCBiLCBTICsgYS5qb2luKFMpKTtcbiAgICAgICAgICAgIGlmICghYy5nZXROb2RlKCkuaXNEaXJlY3RvcnkoKSlcbiAgICAgICAgICAgICAgICB0aHJvdyBoKFwiRU5PVERJUlwiLCBiLCBTICsgYS5qb2luKFMpKTtcbiAgICAgICAgICAgIHJldHVybiBjO1xuICAgICAgICB9O1xuICAgICAgICBhLnByb3RvdHlwZS5nZXRGaWxlQnlGZCA9IGZ1bmN0aW9uIChhKSB7IHJldHVybiB0aGlzLmZkc1tTdHJpbmcoYSldOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5nZXRGaWxlQnlGZE9yVGhyb3cgPSBmdW5jdGlvbiAoYSwgYikgeyBpZiAoYSA+Pj4gMCAhPT0gYSlcbiAgICAgICAgICAgIHRocm93IFR5cGVFcnJvcihmYS5GRCk7IGEgPSB0aGlzLmdldEZpbGVCeUZkKGEpOyBpZiAoIWEpXG4gICAgICAgICAgICB0aHJvdyBoKFwiRUJBREZcIiwgYik7IHJldHVybiBhOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5nZXROb2RlQnlJZE9yQ3JlYXRlID0gZnVuY3Rpb24gKGEsIGIsIGMpIHtcbiAgICAgICAgICAgIGlmIChcIm51bWJlclwiID09PSB0eXBlb2YgYSkge1xuICAgICAgICAgICAgICAgIGEgPSB0aGlzLmdldEZpbGVCeUZkKGEpO1xuICAgICAgICAgICAgICAgIGlmICghYSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoXCJGaWxlIG50byBmb3VuZFwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gYS5ub2RlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGQgPSB4YShhKSwgZSA9IHRoaXMuZ2V0TGluayhkKTtcbiAgICAgICAgICAgIGlmIChlKVxuICAgICAgICAgICAgICAgIHJldHVybiBlLmdldE5vZGUoKTtcbiAgICAgICAgICAgIGlmIChiICYgVSAmJiAoYiA9IHRoaXMuZ2V0TGlua1BhcmVudChkKSkpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGUgPVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUxpbmsoYiwgZFtkLmxlbmd0aCAtIDFdLCAhMSwgYyksIGUuZ2V0Tm9kZSgpO1xuICAgICAgICAgICAgdGhyb3cgaChcIkVOT0VOVFwiLCBcImdldE5vZGVCeUlkT3JDcmVhdGVcIiwgbShhKSk7XG4gICAgICAgIH07XG4gICAgICAgIGEucHJvdG90eXBlLndyYXBBc3luYyA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IHZhciBkID0gdGhpczsgcShjKTsgJGMuZGVmYXVsdChmdW5jdGlvbiAoKSB7IHRyeSB7XG4gICAgICAgICAgICBjKG51bGwsIGEuYXBwbHkoZCwgYikpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoICh2YSkge1xuICAgICAgICAgICAgYyh2YSk7XG4gICAgICAgIH0gfSk7IH07XG4gICAgICAgIGEucHJvdG90eXBlLl90b0pTT04gPSBmdW5jdGlvbiAoYSwgYiwgYykge1xuICAgICAgICAgICAgdmFyIGQ7XG4gICAgICAgICAgICB2b2lkIDAgPT09IGEgJiYgKGEgPSB0aGlzLnJvb3QpO1xuICAgICAgICAgICAgdm9pZCAwID09PSBiICYmIChiID0ge30pO1xuICAgICAgICAgICAgdmFyIGUgPSAhMCwgciA9IGEuY2hpbGRyZW47XG4gICAgICAgICAgICBhLmdldE5vZGUoKS5pc0ZpbGUoKSAmJiAociA9IChkID0ge30sIGRbYS5nZXROYW1lKCldID0gYS5wYXJlbnQuZ2V0Q2hpbGQoYS5nZXROYW1lKCkpLCBkKSwgYSA9IGEucGFyZW50KTtcbiAgICAgICAgICAgIGZvciAodmFyIEQgaW4gcikge1xuICAgICAgICAgICAgICAgIGUgPSAhMTtcbiAgICAgICAgICAgICAgICByID0gYS5nZXRDaGlsZChEKTtcbiAgICAgICAgICAgICAgICBpZiAoIXIpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IEVycm9yKFwiX3RvSlNPTjogdW5leHBlY3RlZCB1bmRlZmluZWRcIik7XG4gICAgICAgICAgICAgICAgZCA9IHIuZ2V0Tm9kZSgpO1xuICAgICAgICAgICAgICAgIGQuaXNGaWxlKCkgPyAociA9IHIuZ2V0UGF0aCgpLCBjICYmIChyID0geGQoYywgcikpLCBiW3JdID0gZC5nZXRTdHJpbmcoKSkgOiBkLmlzRGlyZWN0b3J5KCkgJiYgdGhpcy5fdG9KU09OKHIsIGIsIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYSA9IGEuZ2V0UGF0aCgpO1xuICAgICAgICAgICAgYyAmJiAoYSA9IHhkKGMsIGEpKTtcbiAgICAgICAgICAgIGEgJiYgZSAmJiAoYlthXSA9IG51bGwpO1xuICAgICAgICAgICAgcmV0dXJuIGI7XG4gICAgICAgIH07XG4gICAgICAgIGEucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IHZvaWQgMCA9PT0gYiAmJiAoYiA9IHt9KTsgdm9pZCAwID09PSBjICYmIChjID0gITEpOyB2YXIgZCA9IFtdOyBpZiAoYSkge1xuICAgICAgICAgICAgYSBpbnN0YW5jZW9mIEFycmF5IHx8IChhID0gW2FdKTtcbiAgICAgICAgICAgIGZvciAodmFyIGUgPSAwOyBlIDwgYS5sZW5ndGg7IGUrKykge1xuICAgICAgICAgICAgICAgIHZhciByID0gbShhW2VdKTtcbiAgICAgICAgICAgICAgICAociA9IHRoaXMuZ2V0UmVzb2x2ZWRMaW5rKHIpKSAmJiBkLnB1c2gocik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgZC5wdXNoKHRoaXMucm9vdCk7IGlmICghZC5sZW5ndGgpXG4gICAgICAgICAgICByZXR1cm4gYjsgZm9yIChlID0gMDsgZSA8IGQubGVuZ3RoOyBlKyspXG4gICAgICAgICAgICByID0gZFtlXSwgdGhpcy5fdG9KU09OKHIsIGIsIGMgPyByLmdldFBhdGgoKSA6IFwiXCIpOyByZXR1cm4gYjsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUuZnJvbUpTT04gPVxuICAgICAgICAgICAgZnVuY3Rpb24gKGEsIGIpIHsgdm9pZCAwID09PSBiICYmIChiID0gTC5kZWZhdWx0LmN3ZCgpKTsgZm9yICh2YXIgZCBpbiBhKSB7XG4gICAgICAgICAgICAgICAgdmFyIGUgPSBhW2RdO1xuICAgICAgICAgICAgICAgIGlmIChcInN0cmluZ1wiID09PSB0eXBlb2YgZSkge1xuICAgICAgICAgICAgICAgICAgICBkID0gYyhkLCBiKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHIgPSB2KGQpO1xuICAgICAgICAgICAgICAgICAgICAxIDwgci5sZW5ndGggJiYgKHIgPSBTICsgci5zbGljZSgwLCByLmxlbmd0aCAtIDEpLmpvaW4oUyksIHRoaXMubWtkaXJwQmFzZShyLCA1MTEpKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy53cml0ZUZpbGVTeW5jKGQsIGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWtkaXJwQmFzZShkLCA1MTEpO1xuICAgICAgICAgICAgfSB9O1xuICAgICAgICBhLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uICgpIHsgdGhpcy5pbm8gPSAwOyB0aGlzLmlub2RlcyA9IHt9OyB0aGlzLnJlbGVhc2VkSW5vcyA9IFtdOyB0aGlzLmZkcyA9IHt9OyB0aGlzLnJlbGVhc2VkRmRzID0gW107IHRoaXMub3BlbkZpbGVzID0gMDsgdGhpcy5yb290ID0gdGhpcy5jcmVhdGVMaW5rKCk7IHRoaXMucm9vdC5zZXROb2RlKHRoaXMuY3JlYXRlTm9kZSghMCkpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5tb3VudFN5bmMgPSBmdW5jdGlvbiAoYSwgYikgeyB0aGlzLmZyb21KU09OKGIsIGEpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5vcGVuTGluayA9XG4gICAgICAgICAgICBmdW5jdGlvbiAoYSwgYiwgYykgeyB2b2lkIDAgPT09IGMgJiYgKGMgPSAhMCk7IGlmICh0aGlzLm9wZW5GaWxlcyA+PSB0aGlzLm1heEZpbGVzKVxuICAgICAgICAgICAgICAgIHRocm93IGgoXCJFTUZJTEVcIiwgXCJvcGVuXCIsIGEuZ2V0UGF0aCgpKTsgdmFyIGQgPSBhOyBjICYmIChkID0gdGhpcy5yZXNvbHZlU3ltbGlua3MoYSkpOyBpZiAoIWQpXG4gICAgICAgICAgICAgICAgdGhyb3cgaChcIkVOT0VOVFwiLCBcIm9wZW5cIiwgYS5nZXRQYXRoKCkpOyBjID0gZC5nZXROb2RlKCk7IGlmIChjLmlzRGlyZWN0b3J5KCkpIHtcbiAgICAgICAgICAgICAgICBpZiAoKGIgJiAobWIgfCBuYSB8IEthKSkgIT09IG1iKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBoKFwiRUlTRElSXCIsIFwib3BlblwiLCBhLmdldFBhdGgoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChiICYgZ2YpXG4gICAgICAgICAgICAgICAgdGhyb3cgaChcIkVOT1RESVJcIiwgXCJvcGVuXCIsIGEuZ2V0UGF0aCgpKTsgaWYgKCEoYiAmIEthIHx8IGMuY2FuUmVhZCgpKSlcbiAgICAgICAgICAgICAgICB0aHJvdyBoKFwiRUFDQ0VTXCIsIFwib3BlblwiLCBhLmdldFBhdGgoKSk7IGEgPSBuZXcgdGhpcy5wcm9wcy5GaWxlKGEsIGMsIGIsIHRoaXMubmV3RmROdW1iZXIoKSk7IHRoaXMuZmRzW2EuZmRdID0gYTsgdGhpcy5vcGVuRmlsZXMrKzsgYiAmIFphICYmIGEudHJ1bmNhdGUoKTsgcmV0dXJuIGE7IH07XG4gICAgICAgIGEucHJvdG90eXBlLm9wZW5GaWxlID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsgdm9pZCAwID09PSBkICYmIChkID0gITApOyB2YXIgZSA9IHYoYSksIHIgPSBkID8gdGhpcy5nZXRSZXNvbHZlZExpbmsoZSkgOiB0aGlzLmdldExpbmsoZSk7IGlmICghciAmJiBiICYgVSkge1xuICAgICAgICAgICAgdmFyIEQgPSB0aGlzLmdldFJlc29sdmVkTGluayhlLnNsaWNlKDAsIGUubGVuZ3RoIC0gMSkpO1xuICAgICAgICAgICAgaWYgKCFEKVxuICAgICAgICAgICAgICAgIHRocm93IGgoXCJFTk9FTlRcIiwgXCJvcGVuXCIsIFMgKyBlLmpvaW4oUykpO1xuICAgICAgICAgICAgYiAmIFUgJiYgXCJudW1iZXJcIiA9PT0gdHlwZW9mIGMgJiYgKHIgPSB0aGlzLmNyZWF0ZUxpbmsoRCwgZVtlLmxlbmd0aCAtIDFdLCAhMSwgYykpO1xuICAgICAgICB9IGlmIChyKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMub3BlbkxpbmsociwgYiwgZCk7IHRocm93IGgoXCJFTk9FTlRcIiwgXCJvcGVuXCIsIGEpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5vcGVuQmFzZSA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkKSB7IHZvaWQgMCA9PT0gZCAmJiAoZCA9ICEwKTsgYiA9IHRoaXMub3BlbkZpbGUoYSwgYiwgYywgZCk7IGlmICghYilcbiAgICAgICAgICAgIHRocm93IGgoXCJFTk9FTlRcIiwgXCJvcGVuXCIsIGEpOyByZXR1cm4gYi5mZDsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUub3BlblN5bmMgPSBmdW5jdGlvbiAoYSwgYiwgYykgeyB2b2lkIDAgPT09IGMgJiYgKGMgPSA0MzgpOyBjID0gTShjKTsgYSA9IG0oYSk7IGIgPSBrKGIpOyByZXR1cm4gdGhpcy5vcGVuQmFzZShhLCBiLCBjKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUub3BlbiA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkKSB7IHZhciBlID0gYzsgXCJmdW5jdGlvblwiID09PSB0eXBlb2YgYyAmJiAoZSA9IDQzOCwgZCA9IGMpOyBjID0gTShlIHx8IDQzOCk7IGEgPSBtKGEpOyBiID0gayhiKTsgdGhpcy53cmFwQXN5bmModGhpcy5vcGVuQmFzZSwgW2EsIGIsIGNdLCBkKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUuY2xvc2VGaWxlID0gZnVuY3Rpb24gKGEpIHsgdGhpcy5mZHNbYS5mZF0gJiYgKHRoaXMub3BlbkZpbGVzLS0sIGRlbGV0ZSB0aGlzLmZkc1thLmZkXSwgdGhpcy5yZWxlYXNlZEZkcy5wdXNoKGEuZmQpKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUuY2xvc2VTeW5jID0gZnVuY3Rpb24gKGEpIHsgWWEoYSk7IGEgPSB0aGlzLmdldEZpbGVCeUZkT3JUaHJvdyhhLCBcImNsb3NlXCIpOyB0aGlzLmNsb3NlRmlsZShhKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAgICAgWWEoYSk7XG4gICAgICAgICAgICB0aGlzLndyYXBBc3luYyh0aGlzLmNsb3NlU3luYywgW2FdLCBiKTtcbiAgICAgICAgfTtcbiAgICAgICAgYS5wcm90b3R5cGUub3BlbkZpbGVPckdldEJ5SWQgPSBmdW5jdGlvbiAoYSwgYiwgYykgeyBpZiAoXCJudW1iZXJcIiA9PT0gdHlwZW9mIGEpIHtcbiAgICAgICAgICAgIGEgPSB0aGlzLmZkc1thXTtcbiAgICAgICAgICAgIGlmICghYSlcbiAgICAgICAgICAgICAgICB0aHJvdyBoKFwiRU5PRU5UXCIpO1xuICAgICAgICAgICAgcmV0dXJuIGE7XG4gICAgICAgIH0gcmV0dXJuIHRoaXMub3BlbkZpbGUobShhKSwgYiwgYyk7IH07XG4gICAgICAgIGEucHJvdG90eXBlLnJlYWRCYXNlID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQsIGUpIHsgcmV0dXJuIHRoaXMuZ2V0RmlsZUJ5RmRPclRocm93KGEpLnJlYWQoYiwgTnVtYmVyKGMpLCBOdW1iZXIoZCksIGUpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5yZWFkU3luYyA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkLCBlKSB7IFlhKGEpOyByZXR1cm4gdGhpcy5yZWFkQmFzZShhLCBiLCBjLCBkLCBlKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUucmVhZCA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkLCBlLCBmKSB7XG4gICAgICAgICAgICB2YXIgciA9IHRoaXM7XG4gICAgICAgICAgICBxKGYpO1xuICAgICAgICAgICAgaWYgKDAgPT09IGQpXG4gICAgICAgICAgICAgICAgcmV0dXJuIEwuZGVmYXVsdC5uZXh0VGljayhmdW5jdGlvbiAoKSB7IGYgJiYgZihudWxsLCAwLCBiKTsgfSk7XG4gICAgICAgICAgICAkYy5kZWZhdWx0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgRCA9IHIucmVhZEJhc2UoYSwgYiwgYywgZCwgZSk7XG4gICAgICAgICAgICAgICAgICAgIGYobnVsbCwgRCwgYik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChwZikge1xuICAgICAgICAgICAgICAgICAgICBmKHBmKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgYS5wcm90b3R5cGUucmVhZEZpbGVCYXNlID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsgdmFyIGQgPSBcIm51bWJlclwiID09PSB0eXBlb2YgYSAmJiBhID4+PiAwID09PSBhOyBpZiAoIWQpIHtcbiAgICAgICAgICAgIHZhciBlID0gbShhKTtcbiAgICAgICAgICAgIGUgPSB2KGUpO1xuICAgICAgICAgICAgaWYgKChlID0gdGhpcy5nZXRSZXNvbHZlZExpbmsoZSkpICYmIGUuZ2V0Tm9kZSgpLmlzRGlyZWN0b3J5KCkpXG4gICAgICAgICAgICAgICAgdGhyb3cgaChcIkVJU0RJUlwiLCBcIm9wZW5cIiwgZS5nZXRQYXRoKCkpO1xuICAgICAgICAgICAgYSA9IHRoaXMub3BlblN5bmMoYSwgYik7XG4gICAgICAgIH0gdHJ5IHtcbiAgICAgICAgICAgIHZhciByID0gJGIodGhpcy5nZXRGaWxlQnlGZE9yVGhyb3coYSkuZ2V0QnVmZmVyKCksIGMpO1xuICAgICAgICB9XG4gICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgZCB8fCB0aGlzLmNsb3NlU3luYyhhKTtcbiAgICAgICAgfSByZXR1cm4gcjsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUucmVhZEZpbGVTeW5jID0gZnVuY3Rpb24gKGEsIGIpIHsgYiA9IHpkKGIpOyB2YXIgYyA9IGsoYi5mbGFnKTsgcmV0dXJuIHRoaXMucmVhZEZpbGVCYXNlKGEsIGMsIGIuZW5jb2RpbmcpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5yZWFkRmlsZSA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7XG4gICAgICAgICAgICBjID0gQih6ZCkoYiwgYyk7XG4gICAgICAgICAgICBiID0gY1swXTtcbiAgICAgICAgICAgIGMgPSBjWzFdO1xuICAgICAgICAgICAgdmFyIGQgPSBrKGIuZmxhZyk7XG4gICAgICAgICAgICB0aGlzLndyYXBBc3luYyh0aGlzLnJlYWRGaWxlQmFzZSwgW2EsIGQsIGIuZW5jb2RpbmddLCBjKTtcbiAgICAgICAgfTtcbiAgICAgICAgYS5wcm90b3R5cGUud3JpdGVCYXNlID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQsIGUpIHsgcmV0dXJuIHRoaXMuZ2V0RmlsZUJ5RmRPclRocm93KGEsIFwid3JpdGVcIikud3JpdGUoYiwgYywgZCwgZSk7IH07XG4gICAgICAgIGEucHJvdG90eXBlLndyaXRlU3luYyA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkLCBlKSB7IFlhKGEpOyB2YXIgciA9IFwic3RyaW5nXCIgIT09IHR5cGVvZiBiOyBpZiAocikge1xuICAgICAgICAgICAgdmFyIEQgPSAoYyB8fCAwKSB8IDA7XG4gICAgICAgICAgICB2YXIgZiA9IGQ7XG4gICAgICAgICAgICBjID0gZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICB2YXIgWGEgPSBkOyBiID0gTGEoYiwgWGEpOyByID8gXCJ1bmRlZmluZWRcIiA9PT0gdHlwZW9mIGYgJiYgKGYgPSBiLmxlbmd0aCkgOiAoRCA9IDAsIGYgPSBiLmxlbmd0aCk7IHJldHVybiB0aGlzLndyaXRlQmFzZShhLCBiLCBELCBmLCBjKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCwgZSwgZikge1xuICAgICAgICAgICAgdmFyIHIgPSB0aGlzO1xuICAgICAgICAgICAgWWEoYSk7XG4gICAgICAgICAgICB2YXIgRCA9IHR5cGVvZiBiLCBYYSA9IHR5cGVvZiBjLCBnID0gdHlwZW9mIGQsIGggPSB0eXBlb2YgZTtcbiAgICAgICAgICAgIGlmIChcInN0cmluZ1wiICE9PSBEKVxuICAgICAgICAgICAgICAgIGlmIChcImZ1bmN0aW9uXCIgPT09IFhhKVxuICAgICAgICAgICAgICAgICAgICB2YXIgayA9IGM7XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoXCJmdW5jdGlvblwiID09PSBnKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBsYiA9IGMgfCAwO1xuICAgICAgICAgICAgICAgICAgICBrID0gZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoXCJmdW5jdGlvblwiID09PSBoKSB7XG4gICAgICAgICAgICAgICAgICAgIGxiID0gYyB8IDA7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtID0gZDtcbiAgICAgICAgICAgICAgICAgICAgayA9IGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBsYiA9IGMgfCAwO1xuICAgICAgICAgICAgICAgICAgICBtID0gZDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSBlO1xuICAgICAgICAgICAgICAgICAgICBrID0gZjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChcImZ1bmN0aW9uXCIgPT09IFhhKVxuICAgICAgICAgICAgICAgIGsgPSBjO1xuICAgICAgICAgICAgZWxzZSBpZiAoXCJmdW5jdGlvblwiID09PSBnKVxuICAgICAgICAgICAgICAgIG4gPSBjLCBrID0gZDtcbiAgICAgICAgICAgIGVsc2UgaWYgKFwiZnVuY3Rpb25cIiA9PT0gaCkge1xuICAgICAgICAgICAgICAgIG4gPSBjO1xuICAgICAgICAgICAgICAgIHZhciB2YSA9IGQ7XG4gICAgICAgICAgICAgICAgayA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgcCA9IExhKGIsIHZhKTtcbiAgICAgICAgICAgIFwic3RyaW5nXCIgIT09IEQgPyBcInVuZGVmaW5lZFwiID09PSB0eXBlb2YgbSAmJiAobSA9IHAubGVuZ3RoKSA6IChsYiA9IDAsIG0gPSBwLmxlbmd0aCk7XG4gICAgICAgICAgICB2YXIgdiA9IHEoayk7XG4gICAgICAgICAgICAkYy5kZWZhdWx0KGZ1bmN0aW9uICgpIHsgdHJ5IHtcbiAgICAgICAgICAgICAgICB2YXIgYyA9IHIud3JpdGVCYXNlKGEsIHAsIGxiLCBtLCBuKTtcbiAgICAgICAgICAgICAgICBcInN0cmluZ1wiICE9PSBEID8gdihudWxsLCBjLCBwKSA6IHYobnVsbCwgYywgYik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAocWYpIHtcbiAgICAgICAgICAgICAgICB2KHFmKTtcbiAgICAgICAgICAgIH0gfSk7XG4gICAgICAgIH07XG4gICAgICAgIGEucHJvdG90eXBlLndyaXRlRmlsZUJhc2UgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCkgeyB2YXIgZSA9IFwibnVtYmVyXCIgPT09IHR5cGVvZiBhOyBhID0gZSA/IGEgOiB0aGlzLm9wZW5CYXNlKG0oYSksIGMsIGQpOyBkID0gMDsgdmFyIHIgPSBiLmxlbmd0aDsgYyA9IGMgJiAkYSA/IHZvaWQgMCA6IDA7IHRyeSB7XG4gICAgICAgICAgICBmb3IgKDsgMCA8IHI7KSB7XG4gICAgICAgICAgICAgICAgdmFyIEQgPSB0aGlzLndyaXRlU3luYyhhLCBiLCBkLCByLCBjKTtcbiAgICAgICAgICAgICAgICBkICs9IEQ7XG4gICAgICAgICAgICAgICAgciAtPSBEO1xuICAgICAgICAgICAgICAgIHZvaWQgMCAhPT0gYyAmJiAoYyArPSBEKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgIGUgfHwgdGhpcy5jbG9zZVN5bmMoYSk7XG4gICAgICAgIH0gfTtcbiAgICAgICAgYS5wcm90b3R5cGUud3JpdGVGaWxlU3luYyA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IHZhciBkID0gQmQoYyk7IGMgPSBrKGQuZmxhZyk7IHZhciBlID0gTShkLm1vZGUpOyBiID0gTGEoYiwgZC5lbmNvZGluZyk7IHRoaXMud3JpdGVGaWxlQmFzZShhLCBiLCBjLCBlKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUud3JpdGVGaWxlID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHtcbiAgICAgICAgICAgIHZhciBlID0gYztcbiAgICAgICAgICAgIFwiZnVuY3Rpb25cIiA9PT0gdHlwZW9mIGMgJiYgKGUgPSBBZCwgZCA9IGMpO1xuICAgICAgICAgICAgYyA9IHEoZCk7XG4gICAgICAgICAgICB2YXIgciA9IEJkKGUpO1xuICAgICAgICAgICAgZSA9IGsoci5mbGFnKTtcbiAgICAgICAgICAgIGQgPSBNKHIubW9kZSk7XG4gICAgICAgICAgICBiID0gTGEoYiwgci5lbmNvZGluZyk7XG4gICAgICAgICAgICB0aGlzLndyYXBBc3luYyh0aGlzLndyaXRlRmlsZUJhc2UsIFthLCBiLCBlLCBkXSwgYyk7XG4gICAgICAgIH07XG4gICAgICAgIGEucHJvdG90eXBlLmxpbmtCYXNlID0gZnVuY3Rpb24gKGEsIGIpIHsgdmFyIGMgPSB2KGEpLCBkID0gdGhpcy5nZXRMaW5rKGMpOyBpZiAoIWQpXG4gICAgICAgICAgICB0aHJvdyBoKFwiRU5PRU5UXCIsIFwibGlua1wiLCBhLCBiKTsgdmFyIGUgPSB2KGIpOyBjID0gdGhpcy5nZXRMaW5rUGFyZW50KGUpOyBpZiAoIWMpXG4gICAgICAgICAgICB0aHJvdyBoKFwiRU5PRU5UXCIsIFwibGlua1wiLCBhLCBiKTsgZSA9IGVbZS5sZW5ndGggLSAxXTsgaWYgKGMuZ2V0Q2hpbGQoZSkpXG4gICAgICAgICAgICB0aHJvdyBoKFwiRUVYSVNUXCIsIFwibGlua1wiLCBhLCBiKTsgYSA9IGQuZ2V0Tm9kZSgpOyBhLm5saW5rKys7IGMuY3JlYXRlQ2hpbGQoZSwgYSk7IH07XG4gICAgICAgIGEucHJvdG90eXBlLmNvcHlGaWxlQmFzZSA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IHZhciBkID0gdGhpcy5yZWFkRmlsZVN5bmMoYSk7IGlmIChjICYgaGYgJiYgdGhpcy5leGlzdHNTeW5jKGIpKVxuICAgICAgICAgICAgdGhyb3cgaChcIkVFWElTVFwiLCBcImNvcHlGaWxlXCIsIGEsIGIpOyBpZiAoYyAmIGpmKVxuICAgICAgICAgICAgdGhyb3cgaChcIkVOT1NZU1wiLCBcImNvcHlGaWxlXCIsIGEsIGIpOyB0aGlzLndyaXRlRmlsZUJhc2UoYiwgZCwgdWEudywgNDM4KTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUuY29weUZpbGVTeW5jID1cbiAgICAgICAgICAgIGZ1bmN0aW9uIChhLCBiLCBjKSB7IGEgPSBtKGEpOyBiID0gbShiKTsgcmV0dXJuIHRoaXMuY29weUZpbGVCYXNlKGEsIGIsIChjIHx8IDApIHwgMCk7IH07XG4gICAgICAgIGEucHJvdG90eXBlLmNvcHlGaWxlID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsgYSA9IG0oYSk7IGIgPSBtKGIpOyBpZiAoXCJmdW5jdGlvblwiID09PSB0eXBlb2YgYylcbiAgICAgICAgICAgIHZhciBlID0gMDtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgZSA9IGMsIGMgPSBkOyBxKGMpOyB0aGlzLndyYXBBc3luYyh0aGlzLmNvcHlGaWxlQmFzZSwgW2EsIGIsIGVdLCBjKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUubGlua1N5bmMgPSBmdW5jdGlvbiAoYSwgYikgeyBhID0gbShhKTsgYiA9IG0oYik7IHRoaXMubGlua0Jhc2UoYSwgYik7IH07XG4gICAgICAgIGEucHJvdG90eXBlLmxpbmsgPSBmdW5jdGlvbiAoYSwgYiwgYykgeyBhID0gbShhKTsgYiA9IG0oYik7IHRoaXMud3JhcEFzeW5jKHRoaXMubGlua0Jhc2UsIFthLCBiXSwgYyk7IH07XG4gICAgICAgIGEucHJvdG90eXBlLnVubGlua0Jhc2UgPSBmdW5jdGlvbiAoYSkge1xuICAgICAgICAgICAgdmFyIGIgPSB2KGEpO1xuICAgICAgICAgICAgYiA9IHRoaXMuZ2V0TGluayhiKTtcbiAgICAgICAgICAgIGlmICghYilcbiAgICAgICAgICAgICAgICB0aHJvdyBoKFwiRU5PRU5UXCIsIFwidW5saW5rXCIsIGEpO1xuICAgICAgICAgICAgaWYgKGIubGVuZ3RoKVxuICAgICAgICAgICAgICAgIHRocm93IEVycm9yKFwiRGlyIG5vdCBlbXB0eS4uLlwiKTtcbiAgICAgICAgICAgIHRoaXMuZGVsZXRlTGluayhiKTtcbiAgICAgICAgICAgIGEgPSBiLmdldE5vZGUoKTtcbiAgICAgICAgICAgIGEubmxpbmstLTtcbiAgICAgICAgICAgIDAgPj0gYS5ubGluayAmJiB0aGlzLmRlbGV0ZU5vZGUoYSk7XG4gICAgICAgIH07XG4gICAgICAgIGEucHJvdG90eXBlLnVubGlua1N5bmMgPSBmdW5jdGlvbiAoYSkgeyBhID0gbShhKTsgdGhpcy51bmxpbmtCYXNlKGEpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS51bmxpbmsgPSBmdW5jdGlvbiAoYSwgYikgeyBhID0gbShhKTsgdGhpcy53cmFwQXN5bmModGhpcy51bmxpbmtCYXNlLCBbYV0sIGIpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5zeW1saW5rQmFzZSA9IGZ1bmN0aW9uIChhLCBiKSB7IHZhciBjID0gdihiKSwgZCA9IHRoaXMuZ2V0TGlua1BhcmVudChjKTsgaWYgKCFkKVxuICAgICAgICAgICAgdGhyb3cgaChcIkVOT0VOVFwiLCBcInN5bWxpbmtcIiwgYSwgYik7IGMgPSBjW2MubGVuZ3RoIC0gMV07IGlmIChkLmdldENoaWxkKGMpKVxuICAgICAgICAgICAgdGhyb3cgaChcIkVFWElTVFwiLCBcInN5bWxpbmtcIiwgYSwgYik7IGIgPSBkLmNyZWF0ZUNoaWxkKGMpOyBiLmdldE5vZGUoKS5tYWtlU3ltbGluayh2KGEpKTsgcmV0dXJuIGI7IH07XG4gICAgICAgIGEucHJvdG90eXBlLnN5bWxpbmtTeW5jID0gZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgICAgIGEgPSBtKGEpO1xuICAgICAgICAgICAgYiA9IG0oYik7XG4gICAgICAgICAgICB0aGlzLnN5bWxpbmtCYXNlKGEsIGIpO1xuICAgICAgICB9O1xuICAgICAgICBhLnByb3RvdHlwZS5zeW1saW5rID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsgYyA9IHEoXCJmdW5jdGlvblwiID09PSB0eXBlb2YgYyA/IGMgOiBkKTsgYSA9IG0oYSk7IGIgPSBtKGIpOyB0aGlzLndyYXBBc3luYyh0aGlzLnN5bWxpbmtCYXNlLCBbYSwgYl0sIGMpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5yZWFscGF0aEJhc2UgPSBmdW5jdGlvbiAoYSwgYikgeyB2YXIgYyA9IHYoYSk7IGMgPSB0aGlzLmdldFJlc29sdmVkTGluayhjKTsgaWYgKCFjKVxuICAgICAgICAgICAgdGhyb3cgaChcIkVOT0VOVFwiLCBcInJlYWxwYXRoXCIsIGEpOyByZXR1cm4gSy5zdHJUb0VuY29kaW5nKGMuZ2V0UGF0aCgpLCBiKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUucmVhbHBhdGhTeW5jID0gZnVuY3Rpb24gKGEsIGIpIHsgcmV0dXJuIHRoaXMucmVhbHBhdGhCYXNlKG0oYSksIEVkKGIpLmVuY29kaW5nKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUucmVhbHBhdGggPSBmdW5jdGlvbiAoYSwgYiwgYykge1xuICAgICAgICAgICAgYyA9IGxmKGIsIGMpO1xuICAgICAgICAgICAgYiA9IGNbMF07XG4gICAgICAgICAgICBjID0gY1sxXTtcbiAgICAgICAgICAgIGEgPSBtKGEpO1xuICAgICAgICAgICAgdGhpcy53cmFwQXN5bmModGhpcy5yZWFscGF0aEJhc2UsIFthLCBiLmVuY29kaW5nXSwgYyk7XG4gICAgICAgIH07XG4gICAgICAgIGEucHJvdG90eXBlLmxzdGF0QmFzZSA9IGZ1bmN0aW9uIChhLCBiKSB7IHZvaWQgMCA9PT0gYiAmJiAoYiA9ICExKTsgdmFyIGMgPSB0aGlzLmdldExpbmsodihhKSk7IGlmICghYylcbiAgICAgICAgICAgIHRocm93IGgoXCJFTk9FTlRcIiwgXCJsc3RhdFwiLCBhKTsgcmV0dXJuIGthLmRlZmF1bHQuYnVpbGQoYy5nZXROb2RlKCksIGIpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5sc3RhdFN5bmMgPSBmdW5jdGlvbiAoYSwgYikgeyByZXR1cm4gdGhpcy5sc3RhdEJhc2UobShhKSwgZShiKS5iaWdpbnQpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5sc3RhdCA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IGMgPSBkKGIsIGMpOyBiID0gY1swXTsgYyA9IGNbMV07IHRoaXMud3JhcEFzeW5jKHRoaXMubHN0YXRCYXNlLCBbbShhKSwgYi5iaWdpbnRdLCBjKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUuc3RhdEJhc2UgPSBmdW5jdGlvbiAoYSwgYikgeyB2b2lkIDAgPT09IGIgJiYgKGIgPSAhMSk7IHZhciBjID0gdGhpcy5nZXRSZXNvbHZlZExpbmsodihhKSk7IGlmICghYylcbiAgICAgICAgICAgIHRocm93IGgoXCJFTk9FTlRcIiwgXCJzdGF0XCIsIGEpOyByZXR1cm4ga2EuZGVmYXVsdC5idWlsZChjLmdldE5vZGUoKSwgYik7IH07XG4gICAgICAgIGEucHJvdG90eXBlLnN0YXRTeW5jID0gZnVuY3Rpb24gKGEsIGIpIHsgcmV0dXJuIHRoaXMuc3RhdEJhc2UobShhKSwgZShiKS5iaWdpbnQpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5zdGF0ID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsgYyA9IGQoYiwgYyk7IGIgPSBjWzBdOyBjID0gY1sxXTsgdGhpcy53cmFwQXN5bmModGhpcy5zdGF0QmFzZSwgW20oYSksIGIuYmlnaW50XSwgYyk7IH07XG4gICAgICAgIGEucHJvdG90eXBlLmZzdGF0QmFzZSA9IGZ1bmN0aW9uIChhLCBiKSB7IHZvaWQgMCA9PT0gYiAmJiAoYiA9ICExKTsgYSA9IHRoaXMuZ2V0RmlsZUJ5RmQoYSk7IGlmICghYSlcbiAgICAgICAgICAgIHRocm93IGgoXCJFQkFERlwiLCBcImZzdGF0XCIpOyByZXR1cm4ga2EuZGVmYXVsdC5idWlsZChhLm5vZGUsIGIpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5mc3RhdFN5bmMgPSBmdW5jdGlvbiAoYSwgYikgeyByZXR1cm4gdGhpcy5mc3RhdEJhc2UoYSwgZShiKS5iaWdpbnQpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5mc3RhdCA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IGIgPSBkKGIsIGMpOyB0aGlzLndyYXBBc3luYyh0aGlzLmZzdGF0QmFzZSwgW2EsIGJbMF0uYmlnaW50XSwgYlsxXSk7IH07XG4gICAgICAgIGEucHJvdG90eXBlLnJlbmFtZUJhc2UgPVxuICAgICAgICAgICAgZnVuY3Rpb24gKGEsIGIpIHsgdmFyIGMgPSB0aGlzLmdldExpbmsodihhKSk7IGlmICghYylcbiAgICAgICAgICAgICAgICB0aHJvdyBoKFwiRU5PRU5UXCIsIFwicmVuYW1lXCIsIGEsIGIpOyB2YXIgZCA9IHYoYiksIGUgPSB0aGlzLmdldExpbmtQYXJlbnQoZCk7IGlmICghZSlcbiAgICAgICAgICAgICAgICB0aHJvdyBoKFwiRU5PRU5UXCIsIFwicmVuYW1lXCIsIGEsIGIpOyAoYSA9IGMucGFyZW50KSAmJiBhLmRlbGV0ZUNoaWxkKGMpOyBjLnN0ZXBzID0gWGIoZS5zdGVwcywgW2RbZC5sZW5ndGggLSAxXV0pOyBlLnNldENoaWxkKGMuZ2V0TmFtZSgpLCBjKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUucmVuYW1lU3luYyA9IGZ1bmN0aW9uIChhLCBiKSB7IGEgPSBtKGEpOyBiID0gbShiKTsgdGhpcy5yZW5hbWVCYXNlKGEsIGIpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5yZW5hbWUgPSBmdW5jdGlvbiAoYSwgYiwgYykgeyBhID0gbShhKTsgYiA9IG0oYik7IHRoaXMud3JhcEFzeW5jKHRoaXMucmVuYW1lQmFzZSwgW2EsIGJdLCBjKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUuZXhpc3RzQmFzZSA9IGZ1bmN0aW9uIChhKSB7IHJldHVybiAhIXRoaXMuc3RhdEJhc2UoYSk7IH07XG4gICAgICAgIGEucHJvdG90eXBlLmV4aXN0c1N5bmMgPSBmdW5jdGlvbiAoYSkgeyB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXhpc3RzQmFzZShtKGEpKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoRCkge1xuICAgICAgICAgICAgcmV0dXJuICExO1xuICAgICAgICB9IH07XG4gICAgICAgIGEucHJvdG90eXBlLmV4aXN0cyA9IGZ1bmN0aW9uIChhLCBiKSB7IHZhciBjID0gdGhpcywgZCA9IG0oYSk7IGlmIChcImZ1bmN0aW9uXCIgIT09IHR5cGVvZiBiKVxuICAgICAgICAgICAgdGhyb3cgRXJyb3IoZmEuQ0IpOyAkYy5kZWZhdWx0KGZ1bmN0aW9uICgpIHsgdHJ5IHtcbiAgICAgICAgICAgIGIoYy5leGlzdHNCYXNlKGQpKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAodmEpIHtcbiAgICAgICAgICAgIGIoITEpO1xuICAgICAgICB9IH0pOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5hY2Nlc3NCYXNlID0gZnVuY3Rpb24gKGEpIHsgdGhpcy5nZXRMaW5rT3JUaHJvdyhhLCBcImFjY2Vzc1wiKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUuYWNjZXNzU3luYyA9IGZ1bmN0aW9uIChhLCBiKSB7IHZvaWQgMCA9PT0gYiAmJiAoYiA9IHdkKTsgYSA9IG0oYSk7IHRoaXMuYWNjZXNzQmFzZShhLCBiIHwgMCk7IH07XG4gICAgICAgIGEucHJvdG90eXBlLmFjY2VzcyA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IHZhciBkID0gd2Q7IFwiZnVuY3Rpb25cIiAhPT0gdHlwZW9mIGIgJiYgKGQgPSBiIHwgMCwgYiA9IHEoYykpOyBhID0gbShhKTsgdGhpcy53cmFwQXN5bmModGhpcy5hY2Nlc3NCYXNlLCBbYSwgZF0sIGIpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5hcHBlbmRGaWxlU3luYyA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7XG4gICAgICAgICAgICB2b2lkIDAgPT09IGMgJiYgKGMgPVxuICAgICAgICAgICAgICAgIENkKTtcbiAgICAgICAgICAgIGMgPSBEZChjKTtcbiAgICAgICAgICAgIGMuZmxhZyAmJiBhID4+PiAwICE9PSBhIHx8IChjLmZsYWcgPSBcImFcIik7XG4gICAgICAgICAgICB0aGlzLndyaXRlRmlsZVN5bmMoYSwgYiwgYyk7XG4gICAgICAgIH07XG4gICAgICAgIGEucHJvdG90eXBlLmFwcGVuZEZpbGUgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCkgeyBkID0ga2YoYywgZCk7IGMgPSBkWzBdOyBkID0gZFsxXTsgYy5mbGFnICYmIGEgPj4+IDAgIT09IGEgfHwgKGMuZmxhZyA9IFwiYVwiKTsgdGhpcy53cml0ZUZpbGUoYSwgYiwgYywgZCk7IH07XG4gICAgICAgIGEucHJvdG90eXBlLnJlYWRkaXJCYXNlID0gZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgICAgIHZhciBjID0gdihhKTtcbiAgICAgICAgICAgIGMgPSB0aGlzLmdldFJlc29sdmVkTGluayhjKTtcbiAgICAgICAgICAgIGlmICghYylcbiAgICAgICAgICAgICAgICB0aHJvdyBoKFwiRU5PRU5UXCIsIFwicmVhZGRpclwiLCBhKTtcbiAgICAgICAgICAgIGlmICghYy5nZXROb2RlKCkuaXNEaXJlY3RvcnkoKSlcbiAgICAgICAgICAgICAgICB0aHJvdyBoKFwiRU5PVERJUlwiLCBcInNjYW5kaXJcIiwgYSk7XG4gICAgICAgICAgICBpZiAoYi53aXRoRmlsZVR5cGVzKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IgKGUgaW4gYy5jaGlsZHJlbilcbiAgICAgICAgICAgICAgICAgICAgKGEgPSBjLmdldENoaWxkKGUpKSAmJiBkLnB1c2goUWMuZGVmYXVsdC5idWlsZChhLCBiLmVuY29kaW5nKSk7XG4gICAgICAgICAgICAgICAgWWIgfHwgXCJidWZmZXJcIiA9PT0gYi5lbmNvZGluZyB8fCBkLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsgcmV0dXJuIGEubmFtZSA8IGIubmFtZSA/IC0xIDogYS5uYW1lID4gYi5uYW1lID8gMSA6IDA7IH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGUgPSBbXTtcbiAgICAgICAgICAgIGZvciAoZCBpbiBjLmNoaWxkcmVuKVxuICAgICAgICAgICAgICAgIGUucHVzaChLLnN0clRvRW5jb2RpbmcoZCwgYi5lbmNvZGluZykpO1xuICAgICAgICAgICAgWWIgfHwgXCJidWZmZXJcIiA9PT0gYi5lbmNvZGluZyB8fCBlLnNvcnQoKTtcbiAgICAgICAgICAgIHJldHVybiBlO1xuICAgICAgICB9O1xuICAgICAgICBhLnByb3RvdHlwZS5yZWFkZGlyU3luYyA9IGZ1bmN0aW9uIChhLCBiKSB7IGIgPSBHZChiKTsgYSA9IG0oYSk7IHJldHVybiB0aGlzLnJlYWRkaXJCYXNlKGEsIGIpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5yZWFkZGlyID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsgYyA9IG1mKGIsIGMpOyBiID0gY1swXTsgYyA9IGNbMV07IGEgPSBtKGEpOyB0aGlzLndyYXBBc3luYyh0aGlzLnJlYWRkaXJCYXNlLCBbYSwgYl0sIGMpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5yZWFkbGlua0Jhc2UgPSBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAgICAgdmFyIGMgPSB0aGlzLmdldExpbmtPclRocm93KGEsIFwicmVhZGxpbmtcIikuZ2V0Tm9kZSgpO1xuICAgICAgICAgICAgaWYgKCFjLmlzU3ltbGluaygpKVxuICAgICAgICAgICAgICAgIHRocm93IGgoXCJFSU5WQUxcIiwgXCJyZWFkbGlua1wiLCBhKTtcbiAgICAgICAgICAgIGEgPVxuICAgICAgICAgICAgICAgIFMgKyBjLnN5bWxpbmsuam9pbihTKTtcbiAgICAgICAgICAgIHJldHVybiBLLnN0clRvRW5jb2RpbmcoYSwgYik7XG4gICAgICAgIH07XG4gICAgICAgIGEucHJvdG90eXBlLnJlYWRsaW5rU3luYyA9IGZ1bmN0aW9uIChhLCBiKSB7IGIgPSBvYihiKTsgYSA9IG0oYSk7IHJldHVybiB0aGlzLnJlYWRsaW5rQmFzZShhLCBiLmVuY29kaW5nKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUucmVhZGxpbmsgPSBmdW5jdGlvbiAoYSwgYiwgYykgeyBjID0geWQoYiwgYyk7IGIgPSBjWzBdOyBjID0gY1sxXTsgYSA9IG0oYSk7IHRoaXMud3JhcEFzeW5jKHRoaXMucmVhZGxpbmtCYXNlLCBbYSwgYi5lbmNvZGluZ10sIGMpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5mc3luY0Jhc2UgPSBmdW5jdGlvbiAoYSkgeyB0aGlzLmdldEZpbGVCeUZkT3JUaHJvdyhhLCBcImZzeW5jXCIpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5mc3luY1N5bmMgPSBmdW5jdGlvbiAoYSkgeyB0aGlzLmZzeW5jQmFzZShhKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUuZnN5bmMgPSBmdW5jdGlvbiAoYSwgYikgeyB0aGlzLndyYXBBc3luYyh0aGlzLmZzeW5jQmFzZSwgW2FdLCBiKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUuZmRhdGFzeW5jQmFzZSA9IGZ1bmN0aW9uIChhKSB7XG4gICAgICAgICAgICB0aGlzLmdldEZpbGVCeUZkT3JUaHJvdyhhLCBcImZkYXRhc3luY1wiKTtcbiAgICAgICAgfTtcbiAgICAgICAgYS5wcm90b3R5cGUuZmRhdGFzeW5jU3luYyA9IGZ1bmN0aW9uIChhKSB7IHRoaXMuZmRhdGFzeW5jQmFzZShhKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUuZmRhdGFzeW5jID0gZnVuY3Rpb24gKGEsIGIpIHsgdGhpcy53cmFwQXN5bmModGhpcy5mZGF0YXN5bmNCYXNlLCBbYV0sIGIpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5mdHJ1bmNhdGVCYXNlID0gZnVuY3Rpb24gKGEsIGIpIHsgdGhpcy5nZXRGaWxlQnlGZE9yVGhyb3coYSwgXCJmdHJ1bmNhdGVcIikudHJ1bmNhdGUoYik7IH07XG4gICAgICAgIGEucHJvdG90eXBlLmZ0cnVuY2F0ZVN5bmMgPSBmdW5jdGlvbiAoYSwgYikgeyB0aGlzLmZ0cnVuY2F0ZUJhc2UoYSwgYik7IH07XG4gICAgICAgIGEucHJvdG90eXBlLmZ0cnVuY2F0ZSA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IHZhciBkID0gXCJudW1iZXJcIiA9PT0gdHlwZW9mIGIgPyBiIDogMDsgYiA9IHEoXCJudW1iZXJcIiA9PT0gdHlwZW9mIGIgPyBjIDogYik7IHRoaXMud3JhcEFzeW5jKHRoaXMuZnRydW5jYXRlQmFzZSwgW2EsIGRdLCBiKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUudHJ1bmNhdGVCYXNlID0gZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgICAgIGEgPSB0aGlzLm9wZW5TeW5jKGEsIFwicitcIik7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHRoaXMuZnRydW5jYXRlU3luYyhhLCBiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VTeW5jKGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBhLnByb3RvdHlwZS50cnVuY2F0ZVN5bmMgPSBmdW5jdGlvbiAoYSwgYikgeyBpZiAoYSA+Pj4gMCA9PT0gYSlcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZ0cnVuY2F0ZVN5bmMoYSwgYik7IHRoaXMudHJ1bmNhdGVCYXNlKGEsIGIpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS50cnVuY2F0ZSA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IHZhciBkID0gXCJudW1iZXJcIiA9PT0gdHlwZW9mIGIgPyBiIDogMDsgYiA9IHEoXCJudW1iZXJcIiA9PT0gdHlwZW9mIGIgPyBjIDogYik7IGlmIChhID4+PiAwID09PSBhKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZnRydW5jYXRlKGEsIGQsIGIpOyB0aGlzLndyYXBBc3luYyh0aGlzLnRydW5jYXRlQmFzZSwgW2EsIGRdLCBiKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUuZnV0aW1lc0Jhc2UgPSBmdW5jdGlvbiAoYSwgYiwgYykgeyBhID0gdGhpcy5nZXRGaWxlQnlGZE9yVGhyb3coYSwgXCJmdXRpbWVzXCIpLm5vZGU7IGEuYXRpbWUgPSBuZXcgRGF0ZSgxRTMgKiBiKTsgYS5tdGltZSA9IG5ldyBEYXRlKDFFMyAqIGMpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5mdXRpbWVzU3luYyA9XG4gICAgICAgICAgICBmdW5jdGlvbiAoYSwgYiwgYykgeyB0aGlzLmZ1dGltZXNCYXNlKGEsIGhhKGIpLCBoYShjKSk7IH07XG4gICAgICAgIGEucHJvdG90eXBlLmZ1dGltZXMgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCkgeyB0aGlzLndyYXBBc3luYyh0aGlzLmZ1dGltZXNCYXNlLCBbYSwgaGEoYiksIGhhKGMpXSwgZCk7IH07XG4gICAgICAgIGEucHJvdG90eXBlLnV0aW1lc0Jhc2UgPSBmdW5jdGlvbiAoYSwgYiwgYykgeyBhID0gdGhpcy5vcGVuU3luYyhhLCBcInIrXCIpOyB0cnkge1xuICAgICAgICAgICAgdGhpcy5mdXRpbWVzQmFzZShhLCBiLCBjKTtcbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgIHRoaXMuY2xvc2VTeW5jKGEpO1xuICAgICAgICB9IH07XG4gICAgICAgIGEucHJvdG90eXBlLnV0aW1lc1N5bmMgPSBmdW5jdGlvbiAoYSwgYiwgYykgeyB0aGlzLnV0aW1lc0Jhc2UobShhKSwgaGEoYiksIGhhKGMpKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUudXRpbWVzID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsgdGhpcy53cmFwQXN5bmModGhpcy51dGltZXNCYXNlLCBbbShhKSwgaGEoYiksIGhhKGMpXSwgZCk7IH07XG4gICAgICAgIGEucHJvdG90eXBlLm1rZGlyQmFzZSA9IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICB2YXIgYyA9IHYoYSk7XG4gICAgICAgICAgICBpZiAoIWMubGVuZ3RoKVxuICAgICAgICAgICAgICAgIHRocm93IGgoXCJFSVNESVJcIiwgXCJta2RpclwiLCBhKTtcbiAgICAgICAgICAgIHZhciBkID0gdGhpcy5nZXRMaW5rUGFyZW50QXNEaXJPclRocm93KGEsIFwibWtkaXJcIik7XG4gICAgICAgICAgICBjID0gY1tjLmxlbmd0aCAtIDFdO1xuICAgICAgICAgICAgaWYgKGQuZ2V0Q2hpbGQoYykpXG4gICAgICAgICAgICAgICAgdGhyb3cgaChcIkVFWElTVFwiLCBcIm1rZGlyXCIsIGEpO1xuICAgICAgICAgICAgZC5jcmVhdGVDaGlsZChjLCB0aGlzLmNyZWF0ZU5vZGUoITAsIGIpKTtcbiAgICAgICAgfTtcbiAgICAgICAgYS5wcm90b3R5cGUubWtkaXJwQmFzZSA9IGZ1bmN0aW9uIChhLCBiKSB7IGEgPSB2KGEpOyBmb3IgKHZhciBjID0gdGhpcy5yb290LCBkID0gMDsgZCA8IGEubGVuZ3RoOyBkKyspIHtcbiAgICAgICAgICAgIHZhciBlID0gYVtkXTtcbiAgICAgICAgICAgIGlmICghYy5nZXROb2RlKCkuaXNEaXJlY3RvcnkoKSlcbiAgICAgICAgICAgICAgICB0aHJvdyBoKFwiRU5PVERJUlwiLCBcIm1rZGlyXCIsIGMuZ2V0UGF0aCgpKTtcbiAgICAgICAgICAgIHZhciBmID0gYy5nZXRDaGlsZChlKTtcbiAgICAgICAgICAgIGlmIChmKVxuICAgICAgICAgICAgICAgIGlmIChmLmdldE5vZGUoKS5pc0RpcmVjdG9yeSgpKVxuICAgICAgICAgICAgICAgICAgICBjID0gZjtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHRocm93IGgoXCJFTk9URElSXCIsIFwibWtkaXJcIiwgZi5nZXRQYXRoKCkpO1xuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIGMgPSBjLmNyZWF0ZUNoaWxkKGUsIHRoaXMuY3JlYXRlTm9kZSghMCwgYikpO1xuICAgICAgICB9IH07XG4gICAgICAgIGEucHJvdG90eXBlLm1rZGlyU3luYyA9IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICBiID1cbiAgICAgICAgICAgICAgICBmKGIpO1xuICAgICAgICAgICAgdmFyIGMgPSBNKGIubW9kZSwgNTExKTtcbiAgICAgICAgICAgIGEgPSBtKGEpO1xuICAgICAgICAgICAgYi5yZWN1cnNpdmUgPyB0aGlzLm1rZGlycEJhc2UoYSwgYykgOiB0aGlzLm1rZGlyQmFzZShhLCBjKTtcbiAgICAgICAgfTtcbiAgICAgICAgYS5wcm90b3R5cGUubWtkaXIgPSBmdW5jdGlvbiAoYSwgYiwgYykgeyB2YXIgZCA9IGYoYik7IGIgPSBxKFwiZnVuY3Rpb25cIiA9PT0gdHlwZW9mIGIgPyBiIDogYyk7IGMgPSBNKGQubW9kZSwgNTExKTsgYSA9IG0oYSk7IGQucmVjdXJzaXZlID8gdGhpcy53cmFwQXN5bmModGhpcy5ta2RpcnBCYXNlLCBbYSwgY10sIGIpIDogdGhpcy53cmFwQXN5bmModGhpcy5ta2RpckJhc2UsIFthLCBjXSwgYik7IH07XG4gICAgICAgIGEucHJvdG90eXBlLm1rZGlycFN5bmMgPSBmdW5jdGlvbiAoYSwgYikgeyB0aGlzLm1rZGlyU3luYyhhLCB7IG1vZGU6IGIsIHJlY3Vyc2l2ZTogITAgfSk7IH07XG4gICAgICAgIGEucHJvdG90eXBlLm1rZGlycCA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IHZhciBkID0gXCJmdW5jdGlvblwiID09PSB0eXBlb2YgYiA/IHZvaWQgMCA6IGI7IGIgPSBxKFwiZnVuY3Rpb25cIiA9PT0gdHlwZW9mIGIgPyBiIDogYyk7IHRoaXMubWtkaXIoYSwgeyBtb2RlOiBkLCByZWN1cnNpdmU6ICEwIH0sIGIpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5ta2R0ZW1wQmFzZSA9XG4gICAgICAgICAgICBmdW5jdGlvbiAoYSwgYiwgYykgeyB2b2lkIDAgPT09IGMgJiYgKGMgPSA1KTsgdmFyIGQgPSBhICsgdGhpcy5nZW5SbmRTdHIoKTsgdHJ5IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5ta2RpckJhc2UoZCwgNTExKSwgSy5zdHJUb0VuY29kaW5nKGQsIGIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKHZhKSB7XG4gICAgICAgICAgICAgICAgaWYgKFwiRUVYSVNUXCIgPT09IHZhLmNvZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKDEgPCBjKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubWtkdGVtcEJhc2UoYSwgYiwgYyAtIDEpO1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcihcIkNvdWxkIG5vdCBjcmVhdGUgdGVtcCBkaXIuXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aHJvdyB2YTtcbiAgICAgICAgICAgIH0gfTtcbiAgICAgICAgYS5wcm90b3R5cGUubWtkdGVtcFN5bmMgPSBmdW5jdGlvbiAoYSwgYikgeyBiID0gb2IoYikuZW5jb2Rpbmc7IGlmICghYSB8fCBcInN0cmluZ1wiICE9PSB0eXBlb2YgYSlcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJmaWxlbmFtZSBwcmVmaXggaXMgcmVxdWlyZWRcIik7IHFiKGEpOyByZXR1cm4gdGhpcy5ta2R0ZW1wQmFzZShhLCBiKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUubWtkdGVtcCA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7XG4gICAgICAgICAgICBjID0geWQoYiwgYyk7XG4gICAgICAgICAgICBiID0gY1swXS5lbmNvZGluZztcbiAgICAgICAgICAgIGMgPSBjWzFdO1xuICAgICAgICAgICAgaWYgKCFhIHx8IFwic3RyaW5nXCIgIT09IHR5cGVvZiBhKVxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJmaWxlbmFtZSBwcmVmaXggaXMgcmVxdWlyZWRcIik7XG4gICAgICAgICAgICBxYihhKSAmJiB0aGlzLndyYXBBc3luYyh0aGlzLm1rZHRlbXBCYXNlLCBbYSwgYl0sIGMpO1xuICAgICAgICB9O1xuICAgICAgICBhLnByb3RvdHlwZS5ybWRpckJhc2UgPSBmdW5jdGlvbiAoYSwgYikgeyBiID0gYWEoe30sIEZkLCBiKTsgdmFyIGMgPSB0aGlzLmdldExpbmtBc0Rpck9yVGhyb3coYSwgXCJybWRpclwiKTsgaWYgKGMubGVuZ3RoICYmICFiLnJlY3Vyc2l2ZSlcbiAgICAgICAgICAgIHRocm93IGgoXCJFTk9URU1QVFlcIiwgXCJybWRpclwiLCBhKTsgdGhpcy5kZWxldGVMaW5rKGMpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5ybWRpclN5bmMgPSBmdW5jdGlvbiAoYSwgYikgeyB0aGlzLnJtZGlyQmFzZShtKGEpLCBiKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUucm1kaXIgPSBmdW5jdGlvbiAoYSwgYiwgYykgeyB2YXIgZCA9IGFhKHt9LCBGZCwgYik7IGIgPSBxKFwiZnVuY3Rpb25cIiA9PT0gdHlwZW9mIGIgPyBiIDogYyk7IHRoaXMud3JhcEFzeW5jKHRoaXMucm1kaXJCYXNlLCBbbShhKSwgZF0sIGIpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5mY2htb2RCYXNlID0gZnVuY3Rpb24gKGEsIGIpIHsgdGhpcy5nZXRGaWxlQnlGZE9yVGhyb3coYSwgXCJmY2htb2RcIikuY2htb2QoYik7IH07XG4gICAgICAgIGEucHJvdG90eXBlLmZjaG1vZFN5bmMgPVxuICAgICAgICAgICAgZnVuY3Rpb24gKGEsIGIpIHsgdGhpcy5mY2htb2RCYXNlKGEsIE0oYikpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5mY2htb2QgPSBmdW5jdGlvbiAoYSwgYiwgYykgeyB0aGlzLndyYXBBc3luYyh0aGlzLmZjaG1vZEJhc2UsIFthLCBNKGIpXSwgYyk7IH07XG4gICAgICAgIGEucHJvdG90eXBlLmNobW9kQmFzZSA9IGZ1bmN0aW9uIChhLCBiKSB7IGEgPSB0aGlzLm9wZW5TeW5jKGEsIFwicitcIik7IHRyeSB7XG4gICAgICAgICAgICB0aGlzLmZjaG1vZEJhc2UoYSwgYik7XG4gICAgICAgIH1cbiAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICB0aGlzLmNsb3NlU3luYyhhKTtcbiAgICAgICAgfSB9O1xuICAgICAgICBhLnByb3RvdHlwZS5jaG1vZFN5bmMgPSBmdW5jdGlvbiAoYSwgYikgeyBiID0gTShiKTsgYSA9IG0oYSk7IHRoaXMuY2htb2RCYXNlKGEsIGIpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5jaG1vZCA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IGIgPSBNKGIpOyBhID0gbShhKTsgdGhpcy53cmFwQXN5bmModGhpcy5jaG1vZEJhc2UsIFthLCBiXSwgYyk7IH07XG4gICAgICAgIGEucHJvdG90eXBlLmxjaG1vZEJhc2UgPSBmdW5jdGlvbiAoYSwgYikgeyBhID0gdGhpcy5vcGVuQmFzZShhLCBuYSwgMCwgITEpOyB0cnkge1xuICAgICAgICAgICAgdGhpcy5mY2htb2RCYXNlKGEsIGIpO1xuICAgICAgICB9XG4gICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgdGhpcy5jbG9zZVN5bmMoYSk7XG4gICAgICAgIH0gfTtcbiAgICAgICAgYS5wcm90b3R5cGUubGNobW9kU3luYyA9IGZ1bmN0aW9uIChhLCBiKSB7IGIgPSBNKGIpOyBhID0gbShhKTsgdGhpcy5sY2htb2RCYXNlKGEsIGIpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5sY2htb2QgPSBmdW5jdGlvbiAoYSwgYiwgYykgeyBiID0gTShiKTsgYSA9IG0oYSk7IHRoaXMud3JhcEFzeW5jKHRoaXMubGNobW9kQmFzZSwgW2EsIGJdLCBjKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUuZmNob3duQmFzZSA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IHRoaXMuZ2V0RmlsZUJ5RmRPclRocm93KGEsIFwiZmNob3duXCIpLmNob3duKGIsIGMpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5mY2hvd25TeW5jID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsgSGEoYik7IElhKGMpOyB0aGlzLmZjaG93bkJhc2UoYSwgYiwgYyk7IH07XG4gICAgICAgIGEucHJvdG90eXBlLmZjaG93biA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkKSB7IEhhKGIpOyBJYShjKTsgdGhpcy53cmFwQXN5bmModGhpcy5mY2hvd25CYXNlLCBbYSwgYiwgY10sIGQpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5jaG93bkJhc2UgPSBmdW5jdGlvbiAoYSwgYiwgYykge1xuICAgICAgICAgICAgdGhpcy5nZXRSZXNvbHZlZExpbmtPclRocm93KGEsIFwiY2hvd25cIikuZ2V0Tm9kZSgpLmNob3duKGIsIGMpO1xuICAgICAgICB9O1xuICAgICAgICBhLnByb3RvdHlwZS5jaG93blN5bmMgPSBmdW5jdGlvbiAoYSwgYiwgYykgeyBIYShiKTsgSWEoYyk7IHRoaXMuY2hvd25CYXNlKG0oYSksIGIsIGMpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5jaG93biA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkKSB7IEhhKGIpOyBJYShjKTsgdGhpcy53cmFwQXN5bmModGhpcy5jaG93bkJhc2UsIFttKGEpLCBiLCBjXSwgZCk7IH07XG4gICAgICAgIGEucHJvdG90eXBlLmxjaG93bkJhc2UgPSBmdW5jdGlvbiAoYSwgYiwgYykgeyB0aGlzLmdldExpbmtPclRocm93KGEsIFwibGNob3duXCIpLmdldE5vZGUoKS5jaG93bihiLCBjKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUubGNob3duU3luYyA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IEhhKGIpOyBJYShjKTsgdGhpcy5sY2hvd25CYXNlKG0oYSksIGIsIGMpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS5sY2hvd24gPSBmdW5jdGlvbiAoYSwgYiwgYywgZCkgeyBIYShiKTsgSWEoYyk7IHRoaXMud3JhcEFzeW5jKHRoaXMubGNob3duQmFzZSwgW20oYSksIGIsIGNdLCBkKTsgfTtcbiAgICAgICAgYS5wcm90b3R5cGUud2F0Y2hGaWxlID0gZnVuY3Rpb24gKGEsIGIsIGMpIHtcbiAgICAgICAgICAgIGEgPSBtKGEpO1xuICAgICAgICAgICAgdmFyIGQgPSBiO1xuICAgICAgICAgICAgXCJmdW5jdGlvblwiID09PVxuICAgICAgICAgICAgICAgIHR5cGVvZiBkICYmIChjID0gYiwgZCA9IG51bGwpO1xuICAgICAgICAgICAgaWYgKFwiZnVuY3Rpb25cIiAhPT0gdHlwZW9mIGMpXG4gICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ1wid2F0Y2hGaWxlKClcIiByZXF1aXJlcyBhIGxpc3RlbmVyIGZ1bmN0aW9uJyk7XG4gICAgICAgICAgICBiID0gNTAwNztcbiAgICAgICAgICAgIHZhciBlID0gITA7XG4gICAgICAgICAgICBkICYmIFwib2JqZWN0XCIgPT09IHR5cGVvZiBkICYmIChcIm51bWJlclwiID09PSB0eXBlb2YgZC5pbnRlcnZhbCAmJiAoYiA9IGQuaW50ZXJ2YWwpLCBcImJvb2xlYW5cIiA9PT0gdHlwZW9mIGQucGVyc2lzdGVudCAmJiAoZSA9IGQucGVyc2lzdGVudCkpO1xuICAgICAgICAgICAgZCA9IHRoaXMuc3RhdFdhdGNoZXJzW2FdO1xuICAgICAgICAgICAgZCB8fCAoZCA9IG5ldyB0aGlzLlN0YXRXYXRjaGVyLCBkLnN0YXJ0KGEsIGUsIGIpLCB0aGlzLnN0YXRXYXRjaGVyc1thXSA9IGQpO1xuICAgICAgICAgICAgZC5hZGRMaXN0ZW5lcihcImNoYW5nZVwiLCBjKTtcbiAgICAgICAgICAgIHJldHVybiBkO1xuICAgICAgICB9O1xuICAgICAgICBhLnByb3RvdHlwZS51bndhdGNoRmlsZSA9IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICBhID0gbShhKTtcbiAgICAgICAgICAgIHZhciBjID0gdGhpcy5zdGF0V2F0Y2hlcnNbYV07XG4gICAgICAgICAgICBjICYmIChcImZ1bmN0aW9uXCIgPT09IHR5cGVvZiBiID8gYy5yZW1vdmVMaXN0ZW5lcihcImNoYW5nZVwiLCBiKSA6IGMucmVtb3ZlQWxsTGlzdGVuZXJzKFwiY2hhbmdlXCIpLFxuICAgICAgICAgICAgICAgIDAgPT09IGMubGlzdGVuZXJDb3VudChcImNoYW5nZVwiKSAmJiAoYy5zdG9wKCksIGRlbGV0ZSB0aGlzLnN0YXRXYXRjaGVyc1thXSkpO1xuICAgICAgICB9O1xuICAgICAgICBhLnByb3RvdHlwZS5jcmVhdGVSZWFkU3RyZWFtID0gZnVuY3Rpb24gKGEsIGIpIHsgcmV0dXJuIG5ldyB0aGlzLlJlYWRTdHJlYW0oYSwgYik7IH07XG4gICAgICAgIGEucHJvdG90eXBlLmNyZWF0ZVdyaXRlU3RyZWFtID0gZnVuY3Rpb24gKGEsIGIpIHsgcmV0dXJuIG5ldyB0aGlzLldyaXRlU3RyZWFtKGEsIGIpOyB9O1xuICAgICAgICBhLnByb3RvdHlwZS53YXRjaCA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7IGEgPSBtKGEpOyB2YXIgZCA9IGI7IFwiZnVuY3Rpb25cIiA9PT0gdHlwZW9mIGIgJiYgKGMgPSBiLCBkID0gbnVsbCk7IHZhciBlID0gb2IoZCk7IGIgPSBlLnBlcnNpc3RlbnQ7IGQgPSBlLnJlY3Vyc2l2ZTsgZSA9IGUuZW5jb2Rpbmc7IHZvaWQgMCA9PT0gYiAmJiAoYiA9ICEwKTsgdm9pZCAwID09PSBkICYmIChkID0gITEpOyB2YXIgZiA9IG5ldyB0aGlzLkZTV2F0Y2hlcjsgZi5zdGFydChhLCBiLCBkLCBlKTsgYyAmJiBmLmFkZExpc3RlbmVyKFwiY2hhbmdlXCIsIGMpOyByZXR1cm4gZjsgfTtcbiAgICAgICAgYS5mZCA9IDIxNDc0ODM2NDc7XG4gICAgICAgIHJldHVybiBhO1xuICAgIH0oKTtcbiAgICBiLlZvbHVtZSA9IGE7XG4gICAgdmFyIEhkID0gZnVuY3Rpb24gKGEpIHtcbiAgICAgICAgZnVuY3Rpb24gYihiKSB7IHZhciBjID0gYS5jYWxsKHRoaXMpIHx8IHRoaXM7IGMub25JbnRlcnZhbCA9IGZ1bmN0aW9uICgpIHsgdHJ5IHtcbiAgICAgICAgICAgIHZhciBhID0gYy52b2wuc3RhdFN5bmMoYy5maWxlbmFtZSk7XG4gICAgICAgICAgICBjLmhhc0NoYW5nZWQoYSkgJiYgKGMuZW1pdChcImNoYW5nZVwiLCBhLCBjLnByZXYpLCBjLnByZXYgPSBhKTtcbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgIGMubG9vcCgpO1xuICAgICAgICB9IH07IGMudm9sID0gYjsgcmV0dXJuIGM7IH1cbiAgICAgICAgSmEoYiwgYSk7XG4gICAgICAgIGIucHJvdG90eXBlLmxvb3AgPSBmdW5jdGlvbiAoKSB7IHRoaXMudGltZW91dFJlZiA9IHRoaXMuc2V0VGltZW91dCh0aGlzLm9uSW50ZXJ2YWwsIHRoaXMuaW50ZXJ2YWwpOyB9O1xuICAgICAgICBiLnByb3RvdHlwZS5oYXNDaGFuZ2VkID0gZnVuY3Rpb24gKGEpIHsgcmV0dXJuIGEubXRpbWVNcyA+IHRoaXMucHJldi5tdGltZU1zIHx8IGEubmxpbmsgIT09IHRoaXMucHJldi5ubGluayA/ICEwIDogITE7IH07XG4gICAgICAgIGIucHJvdG90eXBlLnN0YXJ0ID0gZnVuY3Rpb24gKGEsIGIsIGMpIHtcbiAgICAgICAgICAgIHZvaWQgMCA9PT0gYiAmJiAoYiA9ICEwKTtcbiAgICAgICAgICAgIHZvaWQgMCA9PT0gYyAmJiAoYyA9IDUwMDcpO1xuICAgICAgICAgICAgdGhpcy5maWxlbmFtZSA9XG4gICAgICAgICAgICAgICAgbShhKTtcbiAgICAgICAgICAgIHRoaXMuc2V0VGltZW91dCA9IGIgPyBzZXRUaW1lb3V0IDogaGQuZGVmYXVsdDtcbiAgICAgICAgICAgIHRoaXMuaW50ZXJ2YWwgPSBjO1xuICAgICAgICAgICAgdGhpcy5wcmV2ID0gdGhpcy52b2wuc3RhdFN5bmModGhpcy5maWxlbmFtZSk7XG4gICAgICAgICAgICB0aGlzLmxvb3AoKTtcbiAgICAgICAgfTtcbiAgICAgICAgYi5wcm90b3R5cGUuc3RvcCA9IGZ1bmN0aW9uICgpIHsgY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dFJlZik7IEwuZGVmYXVsdC5uZXh0VGljayhlZiwgdGhpcyk7IH07XG4gICAgICAgIHJldHVybiBiO1xuICAgIH0oTy5FdmVudEVtaXR0ZXIpO1xuICAgIGIuU3RhdFdhdGNoZXIgPSBIZDtcbiAgICB2YXIgTjtcbiAgICBsYy5pbmhlcml0cyhULCBZLlJlYWRhYmxlKTtcbiAgICBiLlJlYWRTdHJlYW0gPSBUO1xuICAgIFQucHJvdG90eXBlLm9wZW4gPSBmdW5jdGlvbiAoKSB7IHZhciBhID0gdGhpczsgdGhpcy5fdm9sLm9wZW4odGhpcy5wYXRoLCB0aGlzLmZsYWdzLCB0aGlzLm1vZGUsIGZ1bmN0aW9uIChiLCBjKSB7IGIgPyAoYS5hdXRvQ2xvc2UgJiYgYS5kZXN0cm95ICYmIGEuZGVzdHJveSgpLCBhLmVtaXQoXCJlcnJvclwiLCBiKSkgOiAoYS5mZCA9IGMsIGEuZW1pdChcIm9wZW5cIiwgYyksIGEucmVhZCgpKTsgfSk7IH07XG4gICAgVC5wcm90b3R5cGUuX3JlYWQgPVxuICAgICAgICBmdW5jdGlvbiAoYSkge1xuICAgICAgICAgICAgaWYgKFwibnVtYmVyXCIgIT09IHR5cGVvZiB0aGlzLmZkKVxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm9uY2UoXCJvcGVuXCIsIGZ1bmN0aW9uICgpIHsgdGhpcy5fcmVhZChhKTsgfSk7XG4gICAgICAgICAgICBpZiAoIXRoaXMuZGVzdHJveWVkKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFOIHx8IDEyOCA+IE4ubGVuZ3RoIC0gTi51c2VkKVxuICAgICAgICAgICAgICAgICAgICBOID0gRi5idWZmZXJBbGxvY1Vuc2FmZSh0aGlzLl9yZWFkYWJsZVN0YXRlLmhpZ2hXYXRlck1hcmspLCBOLnVzZWQgPSAwO1xuICAgICAgICAgICAgICAgIHZhciBiID0gTiwgYyA9IE1hdGgubWluKE4ubGVuZ3RoIC0gTi51c2VkLCBhKSwgZCA9IE4udXNlZDtcbiAgICAgICAgICAgICAgICB2b2lkIDAgIT09IHRoaXMucG9zICYmIChjID0gTWF0aC5taW4odGhpcy5lbmQgLSB0aGlzLnBvcyArIDEsIGMpKTtcbiAgICAgICAgICAgICAgICBpZiAoMCA+PSBjKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wdXNoKG51bGwpO1xuICAgICAgICAgICAgICAgIHZhciBlID0gdGhpcztcbiAgICAgICAgICAgICAgICB0aGlzLl92b2wucmVhZCh0aGlzLmZkLCBOLCBOLnVzZWQsIGMsIHRoaXMucG9zLCBmdW5jdGlvbiAoYSwgYykge1xuICAgICAgICAgICAgICAgICAgICBhID8gKGUuYXV0b0Nsb3NlICYmIGUuZGVzdHJveSAmJiBlLmRlc3Ryb3koKSwgZS5lbWl0KFwiZXJyb3JcIiwgYSkpIDogKGEgPSBudWxsLCAwIDwgYyAmJiAoZS5ieXRlc1JlYWQgKz0gYywgYSA9IGIuc2xpY2UoZCwgZCArIGMpKSwgZS5wdXNoKGEpKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB2b2lkIDAgIT09IHRoaXMucG9zICYmICh0aGlzLnBvcyArPSBjKTtcbiAgICAgICAgICAgICAgICBOLnVzZWQgKz0gYztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICBULnByb3RvdHlwZS5fZGVzdHJveSA9IGZ1bmN0aW9uIChhLCBiKSB7IHRoaXMuY2xvc2UoZnVuY3Rpb24gKGMpIHsgYihhIHx8IGMpOyB9KTsgfTtcbiAgICBULnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uIChhKSB7IHZhciBiID0gdGhpczsgaWYgKGEpXG4gICAgICAgIHRoaXMub25jZShcImNsb3NlXCIsIGEpOyBpZiAodGhpcy5jbG9zZWQgfHwgXCJudW1iZXJcIiAhPT0gdHlwZW9mIHRoaXMuZmQpIHtcbiAgICAgICAgaWYgKFwibnVtYmVyXCIgIT09IHR5cGVvZiB0aGlzLmZkKSB7XG4gICAgICAgICAgICB0aGlzLm9uY2UoXCJvcGVuXCIsIGZmKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gTC5kZWZhdWx0Lm5leHRUaWNrKGZ1bmN0aW9uICgpIHsgcmV0dXJuIGIuZW1pdChcImNsb3NlXCIpOyB9KTtcbiAgICB9IHRoaXMuY2xvc2VkID0gITA7IHRoaXMuX3ZvbC5jbG9zZSh0aGlzLmZkLCBmdW5jdGlvbiAoYSkgeyBhID8gYi5lbWl0KFwiZXJyb3JcIiwgYSkgOiBiLmVtaXQoXCJjbG9zZVwiKTsgfSk7IHRoaXMuZmQgPSBudWxsOyB9O1xuICAgIGxjLmluaGVyaXRzKFIsIFkuV3JpdGFibGUpO1xuICAgIGIuV3JpdGVTdHJlYW0gPVxuICAgICAgICBSO1xuICAgIFIucHJvdG90eXBlLm9wZW4gPSBmdW5jdGlvbiAoKSB7IHRoaXMuX3ZvbC5vcGVuKHRoaXMucGF0aCwgdGhpcy5mbGFncywgdGhpcy5tb2RlLCBmdW5jdGlvbiAoYSwgYikgeyBhID8gKHRoaXMuYXV0b0Nsb3NlICYmIHRoaXMuZGVzdHJveSAmJiB0aGlzLmRlc3Ryb3koKSwgdGhpcy5lbWl0KFwiZXJyb3JcIiwgYSkpIDogKHRoaXMuZmQgPSBiLCB0aGlzLmVtaXQoXCJvcGVuXCIsIGIpKTsgfS5iaW5kKHRoaXMpKTsgfTtcbiAgICBSLnByb3RvdHlwZS5fd3JpdGUgPSBmdW5jdGlvbiAoYSwgYiwgYykge1xuICAgICAgICBpZiAoIShhIGluc3RhbmNlb2YgRi5CdWZmZXIpKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZW1pdChcImVycm9yXCIsIEVycm9yKFwiSW52YWxpZCBkYXRhXCIpKTtcbiAgICAgICAgaWYgKFwibnVtYmVyXCIgIT09IHR5cGVvZiB0aGlzLmZkKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMub25jZShcIm9wZW5cIiwgZnVuY3Rpb24gKCkgeyB0aGlzLl93cml0ZShhLCBiLCBjKTsgfSk7XG4gICAgICAgIHZhciBkID0gdGhpcztcbiAgICAgICAgdGhpcy5fdm9sLndyaXRlKHRoaXMuZmQsIGEsIDAsIGEubGVuZ3RoLCB0aGlzLnBvcywgZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgICAgIGlmIChhKVxuICAgICAgICAgICAgICAgIHJldHVybiBkLmF1dG9DbG9zZSAmJiBkLmRlc3Ryb3kgJiZcbiAgICAgICAgICAgICAgICAgICAgZC5kZXN0cm95KCksIGMoYSk7XG4gICAgICAgICAgICBkLmJ5dGVzV3JpdHRlbiArPSBiO1xuICAgICAgICAgICAgYygpO1xuICAgICAgICB9KTtcbiAgICAgICAgdm9pZCAwICE9PSB0aGlzLnBvcyAmJiAodGhpcy5wb3MgKz0gYS5sZW5ndGgpO1xuICAgIH07XG4gICAgUi5wcm90b3R5cGUuX3dyaXRldiA9IGZ1bmN0aW9uIChhLCBiKSB7IGlmIChcIm51bWJlclwiICE9PSB0eXBlb2YgdGhpcy5mZClcbiAgICAgICAgcmV0dXJuIHRoaXMub25jZShcIm9wZW5cIiwgZnVuY3Rpb24gKCkgeyB0aGlzLl93cml0ZXYoYSwgYik7IH0pOyBmb3IgKHZhciBjID0gdGhpcywgZCA9IGEubGVuZ3RoLCBlID0gQXJyYXkoZCksIGYgPSAwLCBnID0gMDsgZyA8IGQ7IGcrKykge1xuICAgICAgICB2YXIgaCA9IGFbZ10uY2h1bms7XG4gICAgICAgIGVbZ10gPSBoO1xuICAgICAgICBmICs9IGgubGVuZ3RoO1xuICAgIH0gZCA9IEYuQnVmZmVyLmNvbmNhdChlKTsgdGhpcy5fdm9sLndyaXRlKHRoaXMuZmQsIGQsIDAsIGQubGVuZ3RoLCB0aGlzLnBvcywgZnVuY3Rpb24gKGEsIGQpIHsgaWYgKGEpXG4gICAgICAgIHJldHVybiBjLmRlc3Ryb3kgJiYgYy5kZXN0cm95KCksIGIoYSk7IGMuYnl0ZXNXcml0dGVuICs9IGQ7IGIoKTsgfSk7IHZvaWQgMCAhPT0gdGhpcy5wb3MgJiYgKHRoaXMucG9zICs9IGYpOyB9O1xuICAgIFIucHJvdG90eXBlLl9kZXN0cm95ID0gVC5wcm90b3R5cGUuX2Rlc3Ryb3k7XG4gICAgUi5wcm90b3R5cGUuY2xvc2UgPSBULnByb3RvdHlwZS5jbG9zZTtcbiAgICBSLnByb3RvdHlwZS5kZXN0cm95U29vbiA9IFIucHJvdG90eXBlLmVuZDtcbiAgICB2YXIgSWQgPSBmdW5jdGlvbiAoYSkge1xuICAgICAgICBmdW5jdGlvbiBiKGIpIHsgdmFyIGMgPSBhLmNhbGwodGhpcykgfHwgdGhpczsgYy5fZmlsZW5hbWUgPSBcIlwiOyBjLl9maWxlbmFtZUVuY29kZWQgPSBcIlwiOyBjLl9yZWN1cnNpdmUgPSAhMTsgYy5fZW5jb2RpbmcgPSBLLkVOQ09ESU5HX1VURjg7IGMuX29uTm9kZUNoYW5nZSA9IGZ1bmN0aW9uICgpIHsgYy5fZW1pdChcImNoYW5nZVwiKTsgfTsgYy5fb25QYXJlbnRDaGlsZCA9IGZ1bmN0aW9uIChhKSB7IGEuZ2V0TmFtZSgpID09PSBjLl9nZXROYW1lKCkgJiYgYy5fZW1pdChcInJlbmFtZVwiKTsgfTsgYy5fZW1pdCA9IGZ1bmN0aW9uIChhKSB7IGMuZW1pdChcImNoYW5nZVwiLCBhLCBjLl9maWxlbmFtZUVuY29kZWQpOyB9OyBjLl9wZXJzaXN0ID0gZnVuY3Rpb24gKCkgeyBjLl90aW1lciA9IHNldFRpbWVvdXQoYy5fcGVyc2lzdCwgMUU2KTsgfTsgYy5fdm9sID0gYjsgcmV0dXJuIGM7IH1cbiAgICAgICAgSmEoYiwgYSk7XG4gICAgICAgIGIucHJvdG90eXBlLl9nZXROYW1lID1cbiAgICAgICAgICAgIGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX3N0ZXBzW3RoaXMuX3N0ZXBzLmxlbmd0aCAtIDFdOyB9O1xuICAgICAgICBiLnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkKSB7XG4gICAgICAgICAgICB2b2lkIDAgPT09IGIgJiYgKGIgPSAhMCk7XG4gICAgICAgICAgICB2b2lkIDAgPT09IGMgJiYgKGMgPSAhMSk7XG4gICAgICAgICAgICB2b2lkIDAgPT09IGQgJiYgKGQgPSBLLkVOQ09ESU5HX1VURjgpO1xuICAgICAgICAgICAgdGhpcy5fZmlsZW5hbWUgPSBtKGEpO1xuICAgICAgICAgICAgdGhpcy5fc3RlcHMgPSB2KHRoaXMuX2ZpbGVuYW1lKTtcbiAgICAgICAgICAgIHRoaXMuX2ZpbGVuYW1lRW5jb2RlZCA9IEsuc3RyVG9FbmNvZGluZyh0aGlzLl9maWxlbmFtZSk7XG4gICAgICAgICAgICB0aGlzLl9yZWN1cnNpdmUgPSBjO1xuICAgICAgICAgICAgdGhpcy5fZW5jb2RpbmcgPSBkO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICB0aGlzLl9saW5rID0gdGhpcy5fdm9sLmdldExpbmtPclRocm93KHRoaXMuX2ZpbGVuYW1lLCBcIkZTV2F0Y2hlclwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChXYikge1xuICAgICAgICAgICAgICAgIHRocm93IGIgPSBFcnJvcihcIndhdGNoIFwiICsgdGhpcy5fZmlsZW5hbWUgKyBcIiBcIiArIFdiLmNvZGUpLCBiLmNvZGUgPSBXYi5jb2RlLCBiLmVycm5vID0gV2IuY29kZSwgYjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX2xpbmsuZ2V0Tm9kZSgpLm9uKFwiY2hhbmdlXCIsIHRoaXMuX29uTm9kZUNoYW5nZSk7XG4gICAgICAgICAgICB0aGlzLl9saW5rLm9uKFwiY2hpbGQ6YWRkXCIsIHRoaXMuX29uTm9kZUNoYW5nZSk7XG4gICAgICAgICAgICB0aGlzLl9saW5rLm9uKFwiY2hpbGQ6ZGVsZXRlXCIsIHRoaXMuX29uTm9kZUNoYW5nZSk7XG4gICAgICAgICAgICBpZiAoYSA9IHRoaXMuX2xpbmsucGFyZW50KVxuICAgICAgICAgICAgICAgIGEuc2V0TWF4TGlzdGVuZXJzKGEuZ2V0TWF4TGlzdGVuZXJzKCkgKyAxKSwgYS5vbihcImNoaWxkOmRlbGV0ZVwiLCB0aGlzLl9vblBhcmVudENoaWxkKTtcbiAgICAgICAgICAgIGIgJiYgdGhpcy5fcGVyc2lzdCgpO1xuICAgICAgICB9O1xuICAgICAgICBiLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHsgY2xlYXJUaW1lb3V0KHRoaXMuX3RpbWVyKTsgdGhpcy5fbGluay5nZXROb2RlKCkucmVtb3ZlTGlzdGVuZXIoXCJjaGFuZ2VcIiwgdGhpcy5fb25Ob2RlQ2hhbmdlKTsgdmFyIGEgPSB0aGlzLl9saW5rLnBhcmVudDsgYSAmJiBhLnJlbW92ZUxpc3RlbmVyKFwiY2hpbGQ6ZGVsZXRlXCIsIHRoaXMuX29uUGFyZW50Q2hpbGQpOyB9O1xuICAgICAgICByZXR1cm4gYjtcbiAgICB9KE8uRXZlbnRFbWl0dGVyKTtcbiAgICBiLkZTV2F0Y2hlciA9IElkO1xufSk7XG50KFhlKTtcbnZhciBZZSA9IFhlLnBhdGhUb0ZpbGVuYW1lLCBaZSA9IFhlLmZpbGVuYW1lVG9TdGVwcywgJGUgPSBYZS5Wb2x1bWUsIGFmID0gdShmdW5jdGlvbiAoYSwgYikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShiLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogITAgfSk7XG4gICAgYi5mc1Byb3BzID0gXCJjb25zdGFudHMgRl9PSyBSX09LIFdfT0sgWF9PSyBTdGF0c1wiLnNwbGl0KFwiIFwiKTtcbiAgICBiLmZzU3luY01ldGhvZHMgPSBcInJlbmFtZVN5bmMgZnRydW5jYXRlU3luYyB0cnVuY2F0ZVN5bmMgY2hvd25TeW5jIGZjaG93blN5bmMgbGNob3duU3luYyBjaG1vZFN5bmMgZmNobW9kU3luYyBsY2htb2RTeW5jIHN0YXRTeW5jIGxzdGF0U3luYyBmc3RhdFN5bmMgbGlua1N5bmMgc3ltbGlua1N5bmMgcmVhZGxpbmtTeW5jIHJlYWxwYXRoU3luYyB1bmxpbmtTeW5jIHJtZGlyU3luYyBta2RpclN5bmMgbWtkaXJwU3luYyByZWFkZGlyU3luYyBjbG9zZVN5bmMgb3BlblN5bmMgdXRpbWVzU3luYyBmdXRpbWVzU3luYyBmc3luY1N5bmMgd3JpdGVTeW5jIHJlYWRTeW5jIHJlYWRGaWxlU3luYyB3cml0ZUZpbGVTeW5jIGFwcGVuZEZpbGVTeW5jIGV4aXN0c1N5bmMgYWNjZXNzU3luYyBmZGF0YXN5bmNTeW5jIG1rZHRlbXBTeW5jIGNvcHlGaWxlU3luYyBjcmVhdGVSZWFkU3RyZWFtIGNyZWF0ZVdyaXRlU3RyZWFtXCIuc3BsaXQoXCIgXCIpO1xuICAgIGIuZnNBc3luY01ldGhvZHMgPSBcInJlbmFtZSBmdHJ1bmNhdGUgdHJ1bmNhdGUgY2hvd24gZmNob3duIGxjaG93biBjaG1vZCBmY2htb2QgbGNobW9kIHN0YXQgbHN0YXQgZnN0YXQgbGluayBzeW1saW5rIHJlYWRsaW5rIHJlYWxwYXRoIHVubGluayBybWRpciBta2RpciBta2RpcnAgcmVhZGRpciBjbG9zZSBvcGVuIHV0aW1lcyBmdXRpbWVzIGZzeW5jIHdyaXRlIHJlYWQgcmVhZEZpbGUgd3JpdGVGaWxlIGFwcGVuZEZpbGUgZXhpc3RzIGFjY2VzcyBmZGF0YXN5bmMgbWtkdGVtcCBjb3B5RmlsZSB3YXRjaEZpbGUgdW53YXRjaEZpbGUgd2F0Y2hcIi5zcGxpdChcIiBcIik7XG59KTtcbnQoYWYpO1xudmFyIGJmID0gdShmdW5jdGlvbiAoYSwgYikge1xuICAgIGZ1bmN0aW9uIGMoYSkgeyBmb3IgKHZhciBiID0geyBGX09LOiBnLCBSX09LOiBoLCBXX09LOiBrLCBYX09LOiBwLCBjb25zdGFudHM6IHcuY29uc3RhbnRzLCBTdGF0czoga2EuZGVmYXVsdCwgRGlyZW50OiBRYy5kZWZhdWx0IH0sIGMgPSAwLCBkID0gZTsgYyA8IGQubGVuZ3RoOyBjKyspIHtcbiAgICAgICAgdmFyIG4gPSBkW2NdO1xuICAgICAgICBcImZ1bmN0aW9uXCIgPT09IHR5cGVvZiBhW25dICYmIChiW25dID0gYVtuXS5iaW5kKGEpKTtcbiAgICB9IGMgPSAwOyBmb3IgKGQgPSBmOyBjIDwgZC5sZW5ndGg7IGMrKylcbiAgICAgICAgbiA9IGRbY10sIFwiZnVuY3Rpb25cIiA9PT0gdHlwZW9mIGFbbl0gJiYgKGJbbl0gPSBhW25dLmJpbmQoYSkpOyBiLlN0YXRXYXRjaGVyID0gYS5TdGF0V2F0Y2hlcjsgYi5GU1dhdGNoZXIgPSBhLkZTV2F0Y2hlcjsgYi5Xcml0ZVN0cmVhbSA9IGEuV3JpdGVTdHJlYW07IGIuUmVhZFN0cmVhbSA9IGEuUmVhZFN0cmVhbTsgYi5wcm9taXNlcyA9IGEucHJvbWlzZXM7IGIuX3RvVW5peFRpbWVzdGFtcCA9IFhlLnRvVW5peFRpbWVzdGFtcDsgcmV0dXJuIGI7IH1cbiAgICB2YXIgZCA9IGwgJiYgbC5fX2Fzc2lnbiB8fCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGQgPVxuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAoYSkgeyBmb3IgKHZhciBiLCBjID0gMSwgZCA9IGFyZ3VtZW50cy5sZW5ndGg7IGMgPCBkOyBjKyspIHtcbiAgICAgICAgICAgICAgICBiID0gYXJndW1lbnRzW2NdO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGUgaW4gYilcbiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGIsIGUpICYmIChhW2VdID0gYltlXSk7XG4gICAgICAgICAgICB9IHJldHVybiBhOyB9O1xuICAgICAgICByZXR1cm4gZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIH07XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGIsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiAhMCB9KTtcbiAgICB2YXIgZSA9IGFmLmZzU3luY01ldGhvZHMsIGYgPSBhZi5mc0FzeW5jTWV0aG9kcywgZyA9IHcuY29uc3RhbnRzLkZfT0ssIGggPSB3LmNvbnN0YW50cy5SX09LLCBrID0gdy5jb25zdGFudHMuV19PSywgcCA9IHcuY29uc3RhbnRzLlhfT0s7XG4gICAgYi5Wb2x1bWUgPSBYZS5Wb2x1bWU7XG4gICAgYi52b2wgPSBuZXcgWGUuVm9sdW1lO1xuICAgIGIuY3JlYXRlRnNGcm9tVm9sdW1lID0gYztcbiAgICBiLmZzID0gYyhiLnZvbCk7XG4gICAgYS5leHBvcnRzID0gZChkKHt9LCBhLmV4cG9ydHMpLCBiLmZzKTtcbiAgICBhLmV4cG9ydHMuc2VtYW50aWMgPSAhMDtcbn0pO1xudChiZik7XG52YXIgcmYgPSBiZi5jcmVhdGVGc0Zyb21Wb2x1bWU7XG5nZC5wcm90b3R5cGUuZW1pdCA9IGZ1bmN0aW9uIChhKSB7IGZvciAodmFyIGIsIGMsIGQgPSBbXSwgZSA9IDE7IGUgPCBhcmd1bWVudHMubGVuZ3RoOyBlKyspXG4gICAgZFtlIC0gMV0gPSBhcmd1bWVudHNbZV07IGUgPSB0aGlzLmxpc3RlbmVycyhhKTsgdHJ5IHtcbiAgICBmb3IgKHZhciBmID0gZGEoZSksIGcgPSBmLm5leHQoKTsgIWcuZG9uZTsgZyA9IGYubmV4dCgpKSB7XG4gICAgICAgIHZhciBoID0gZy52YWx1ZTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGguYXBwbHkodm9pZCAwLCBpYShkKSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGspIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3Ioayk7XG4gICAgICAgIH1cbiAgICB9XG59XG5jYXRjaCAoaykge1xuICAgIGIgPSB7IGVycm9yOiBrIH07XG59XG5maW5hbGx5IHtcbiAgICB0cnkge1xuICAgICAgICBnICYmICFnLmRvbmUgJiYgKGMgPSBmLnJldHVybikgJiYgYy5jYWxsKGYpO1xuICAgIH1cbiAgICBmaW5hbGx5IHtcbiAgICAgICAgaWYgKGIpXG4gICAgICAgICAgICB0aHJvdyBiLmVycm9yO1xuICAgIH1cbn0gcmV0dXJuIDAgPCBlLmxlbmd0aDsgfTtcbnZhciBzZiA9IGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBhKCkgeyB0aGlzLnZvbHVtZSA9IG5ldyAkZTsgdGhpcy5mcyA9IHJmKHRoaXMudm9sdW1lKTsgdGhpcy5mcm9tSlNPTih7IFwiL2Rldi9zdGRpblwiOiBcIlwiLCBcIi9kZXYvc3Rkb3V0XCI6IFwiXCIsIFwiL2Rldi9zdGRlcnJcIjogXCJcIiB9KTsgfVxuICAgIGEucHJvdG90eXBlLl90b0pTT04gPSBmdW5jdGlvbiAoYSwgYywgZCkgeyB2b2lkIDAgPT09IGMgJiYgKGMgPSB7fSk7IHZhciBiID0gITAsIGY7IGZvciAoZiBpbiBhLmNoaWxkcmVuKSB7XG4gICAgICAgIGIgPSAhMTtcbiAgICAgICAgdmFyIGcgPSBhLmdldENoaWxkKGYpO1xuICAgICAgICBpZiAoZykge1xuICAgICAgICAgICAgdmFyIGggPSBnLmdldE5vZGUoKTtcbiAgICAgICAgICAgIGggJiYgaC5pc0ZpbGUoKSA/IChnID0gZy5nZXRQYXRoKCksIGQgJiYgKGcgPSBZYyhkLCBnKSksIGNbZ10gPSBoLmdldEJ1ZmZlcigpKSA6IGggJiYgaC5pc0RpcmVjdG9yeSgpICYmIHRoaXMuX3RvSlNPTihnLCBjLCBkKTtcbiAgICAgICAgfVxuICAgIH0gYSA9IGEuZ2V0UGF0aCgpOyBkICYmIChhID0gWWMoZCwgYSkpOyBhICYmIGIgJiYgKGNbYV0gPSBudWxsKTsgcmV0dXJuIGM7IH07XG4gICAgYS5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gKGEsIGMsIGQpIHtcbiAgICAgICAgdmFyIGIsIGY7XG4gICAgICAgIHZvaWQgMCA9PT0gYyAmJiAoYyA9IHt9KTtcbiAgICAgICAgdm9pZCAwID09PSBkICYmIChkID0gITEpO1xuICAgICAgICB2YXIgZyA9IFtdO1xuICAgICAgICBpZiAoYSkge1xuICAgICAgICAgICAgYSBpbnN0YW5jZW9mIEFycmF5IHx8IChhID0gW2FdKTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaCA9IGRhKGEpLCBrID0gaC5uZXh0KCk7ICFrLmRvbmU7IGsgPSBoLm5leHQoKSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcCA9IFllKGsudmFsdWUpLCBuID0gdGhpcy52b2x1bWUuZ2V0UmVzb2x2ZWRMaW5rKHApO1xuICAgICAgICAgICAgICAgICAgICBuICYmIGcucHVzaChuKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoeGEpIHtcbiAgICAgICAgICAgICAgICB2YXIgcSA9IHsgZXJyb3I6IHhhIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBrICYmICFrLmRvbmUgJiYgKGIgPSBoLnJldHVybikgJiYgYi5jYWxsKGgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHEpXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBxLmVycm9yO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBnLnB1c2godGhpcy52b2x1bWUucm9vdCk7XG4gICAgICAgIGlmICghZy5sZW5ndGgpXG4gICAgICAgICAgICByZXR1cm4gYztcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGZvciAodmFyIEIgPSBkYShnKSwgbSA9IEIubmV4dCgpOyAhbS5kb25lOyBtID0gQi5uZXh0KCkpXG4gICAgICAgICAgICAgICAgbiA9IG0udmFsdWUsIHRoaXMuX3RvSlNPTihuLCBjLCBkID8gbi5nZXRQYXRoKCkgOiBcIlwiKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoeGEpIHtcbiAgICAgICAgICAgIHZhciB2ID0geyBlcnJvcjogeGEgfTtcbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgbSAmJiAhbS5kb25lICYmIChmID0gQi5yZXR1cm4pICYmIGYuY2FsbChCKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgICAgIGlmICh2KVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyB2LmVycm9yO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjO1xuICAgIH07XG4gICAgYS5wcm90b3R5cGUuZnJvbUpTT05GaXhlZCA9IGZ1bmN0aW9uIChhLCBjKSB7IGZvciAodmFyIGIgaW4gYykge1xuICAgICAgICB2YXIgZSA9IGNbYl07XG4gICAgICAgIGlmIChlID8gbnVsbCAhPT0gT2JqZWN0LmdldFByb3RvdHlwZU9mKGUpIDogbnVsbCAhPT0gZSkge1xuICAgICAgICAgICAgdmFyIGYgPSBaZShiKTtcbiAgICAgICAgICAgIDEgPCBmLmxlbmd0aCAmJiAoZiA9IFwiL1wiICsgZi5zbGljZSgwLCBmLmxlbmd0aCAtIDEpLmpvaW4oXCIvXCIpLCBhLm1rZGlycEJhc2UoZiwgNTExKSk7XG4gICAgICAgICAgICBhLndyaXRlRmlsZVN5bmMoYiwgZSB8fCBcIlwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBhLm1rZGlycEJhc2UoYiwgNTExKTtcbiAgICB9IH07XG4gICAgYS5wcm90b3R5cGUuZnJvbUpTT04gPSBmdW5jdGlvbiAoYSkge1xuICAgICAgICB0aGlzLnZvbHVtZSA9IG5ldyAkZTtcbiAgICAgICAgdGhpcy5mcm9tSlNPTkZpeGVkKHRoaXMudm9sdW1lLCBhKTtcbiAgICAgICAgdGhpcy5mcyA9IHJmKHRoaXMudm9sdW1lKTtcbiAgICAgICAgdGhpcy52b2x1bWUucmVsZWFzZWRGZHMgPSBbMCwgMSwgMl07XG4gICAgICAgIGEgPSB0aGlzLnZvbHVtZS5vcGVuU3luYyhcIi9kZXYvc3RkZXJyXCIsIFwid1wiKTtcbiAgICAgICAgdmFyIGIgPSB0aGlzLnZvbHVtZS5vcGVuU3luYyhcIi9kZXYvc3Rkb3V0XCIsIFwid1wiKSwgZCA9IHRoaXMudm9sdW1lLm9wZW5TeW5jKFwiL2Rldi9zdGRpblwiLCBcInJcIik7XG4gICAgICAgIGlmICgyICE9PSBhKVxuICAgICAgICAgICAgdGhyb3cgRXJyb3IoXCJpbnZhbGlkIGhhbmRsZSBmb3Igc3RkZXJyOiBcIiArIGEpO1xuICAgICAgICBpZiAoMSAhPT0gYilcbiAgICAgICAgICAgIHRocm93IEVycm9yKFwiaW52YWxpZCBoYW5kbGUgZm9yIHN0ZG91dDogXCIgKyBiKTtcbiAgICAgICAgaWYgKDAgIT09IGQpXG4gICAgICAgICAgICB0aHJvdyBFcnJvcihcImludmFsaWQgaGFuZGxlIGZvciBzdGRpbjogXCIgKyBkKTtcbiAgICB9O1xuICAgIGEucHJvdG90eXBlLmdldFN0ZE91dCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGJhKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7IHZhciBhLCBjID0gdGhpczsgcmV0dXJuIGNhKHRoaXMsIGZ1bmN0aW9uICgpIHsgYSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uIChhKSB7IGEoYy5mcy5yZWFkRmlsZVN5bmMoXCIvZGV2L3N0ZG91dFwiLCBcInV0ZjhcIikpOyB9KTsgcmV0dXJuIFsyLCBhXTsgfSk7IH0pOyB9O1xuICAgIHJldHVybiBhO1xufSgpO1xuZXhwb3J0cy5XYXNtRnMgPSBzZjtcbmV4cG9ydHMuZGVmYXVsdCA9IHNmO1xuXG4vKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi99LmNhbGwodGhpcywgX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi8uLi8uLi8uLi8uLi8uLi93ZWJwYWNrQDQuNDYuMF93ZWJwYWNrLWNsaUA0LjEwLjAvbm9kZV9tb2R1bGVzL3dlYnBhY2svYnVpbGRpbi9nbG9iYWwuanMgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vd2VicGFja0A0LjQ2LjBfd2VicGFjay1jbGlANC4xMC4wL25vZGVfbW9kdWxlcy93ZWJwYWNrL2J1aWxkaW4vZ2xvYmFsLmpzXCIpLCBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuLy4uLy4uLy4uLy4uLy4uL3RpbWVycy1icm93c2VyaWZ5QDIuMC4xMi9ub2RlX21vZHVsZXMvdGltZXJzLWJyb3dzZXJpZnkvbWFpbi5qcyAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS90aW1lcnMtYnJvd3NlcmlmeUAyLjAuMTIvbm9kZV9tb2R1bGVzL3RpbWVycy1icm93c2VyaWZ5L21haW4uanNcIikuc2V0SW1tZWRpYXRlKSlcblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9Ad2FzbWVyK3dhc21mc0AwLjEyLjAvbm9kZV9tb2R1bGVzL0B3YXNtZXIvd2FzbWZzL2xpYi9pbmRleC5lc20uanM/Iik7CgovKioqLyB9KSwKCi8qKiovICIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vYmFzZTY0LWpzQDEuNS4xL25vZGVfbW9kdWxlcy9iYXNlNjQtanMvaW5kZXguanMiOgovKiEqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiEqXAogICEqKiogL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL2Jhc2U2NC1qc0AxLjUuMS9ub2RlX21vZHVsZXMvYmFzZTY0LWpzL2luZGV4LmpzICoqKiEKICBcKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CmV2YWwoIlxuZXhwb3J0cy5ieXRlTGVuZ3RoID0gYnl0ZUxlbmd0aDtcbmV4cG9ydHMudG9CeXRlQXJyYXkgPSB0b0J5dGVBcnJheTtcbmV4cG9ydHMuZnJvbUJ5dGVBcnJheSA9IGZyb21CeXRlQXJyYXk7XG52YXIgbG9va3VwID0gW107XG52YXIgcmV2TG9va3VwID0gW107XG52YXIgQXJyID0gdHlwZW9mIFVpbnQ4QXJyYXkgIT09ICd1bmRlZmluZWQnID8gVWludDhBcnJheSA6IEFycmF5O1xudmFyIGNvZGUgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLyc7XG5mb3IgKHZhciBpID0gMCwgbGVuID0gY29kZS5sZW5ndGg7IGkgPCBsZW47ICsraSkge1xuICAgIGxvb2t1cFtpXSA9IGNvZGVbaV07XG4gICAgcmV2TG9va3VwW2NvZGUuY2hhckNvZGVBdChpKV0gPSBpO1xufVxuLy8gU3VwcG9ydCBkZWNvZGluZyBVUkwtc2FmZSBiYXNlNjQgc3RyaW5ncywgYXMgTm9kZS5qcyBkb2VzLlxuLy8gU2VlOiBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9CYXNlNjQjVVJMX2FwcGxpY2F0aW9uc1xucmV2TG9va3VwWyctJy5jaGFyQ29kZUF0KDApXSA9IDYyO1xucmV2TG9va3VwWydfJy5jaGFyQ29kZUF0KDApXSA9IDYzO1xuZnVuY3Rpb24gZ2V0TGVucyhiNjQpIHtcbiAgICB2YXIgbGVuID0gYjY0Lmxlbmd0aDtcbiAgICBpZiAobGVuICUgNCA+IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHN0cmluZy4gTGVuZ3RoIG11c3QgYmUgYSBtdWx0aXBsZSBvZiA0Jyk7XG4gICAgfVxuICAgIC8vIFRyaW0gb2ZmIGV4dHJhIGJ5dGVzIGFmdGVyIHBsYWNlaG9sZGVyIGJ5dGVzIGFyZSBmb3VuZFxuICAgIC8vIFNlZTogaHR0cHM6Ly9naXRodWIuY29tL2JlYXRnYW1taXQvYmFzZTY0LWpzL2lzc3Vlcy80MlxuICAgIHZhciB2YWxpZExlbiA9IGI2NC5pbmRleE9mKCc9Jyk7XG4gICAgaWYgKHZhbGlkTGVuID09PSAtMSlcbiAgICAgICAgdmFsaWRMZW4gPSBsZW47XG4gICAgdmFyIHBsYWNlSG9sZGVyc0xlbiA9IHZhbGlkTGVuID09PSBsZW5cbiAgICAgICAgPyAwXG4gICAgICAgIDogNCAtICh2YWxpZExlbiAlIDQpO1xuICAgIHJldHVybiBbdmFsaWRMZW4sIHBsYWNlSG9sZGVyc0xlbl07XG59XG4vLyBiYXNlNjQgaXMgNC8zICsgdXAgdG8gdHdvIGNoYXJhY3RlcnMgb2YgdGhlIG9yaWdpbmFsIGRhdGFcbmZ1bmN0aW9uIGJ5dGVMZW5ndGgoYjY0KSB7XG4gICAgdmFyIGxlbnMgPSBnZXRMZW5zKGI2NCk7XG4gICAgdmFyIHZhbGlkTGVuID0gbGVuc1swXTtcbiAgICB2YXIgcGxhY2VIb2xkZXJzTGVuID0gbGVuc1sxXTtcbiAgICByZXR1cm4gKCh2YWxpZExlbiArIHBsYWNlSG9sZGVyc0xlbikgKiAzIC8gNCkgLSBwbGFjZUhvbGRlcnNMZW47XG59XG5mdW5jdGlvbiBfYnl0ZUxlbmd0aChiNjQsIHZhbGlkTGVuLCBwbGFjZUhvbGRlcnNMZW4pIHtcbiAgICByZXR1cm4gKCh2YWxpZExlbiArIHBsYWNlSG9sZGVyc0xlbikgKiAzIC8gNCkgLSBwbGFjZUhvbGRlcnNMZW47XG59XG5mdW5jdGlvbiB0b0J5dGVBcnJheShiNjQpIHtcbiAgICB2YXIgdG1wO1xuICAgIHZhciBsZW5zID0gZ2V0TGVucyhiNjQpO1xuICAgIHZhciB2YWxpZExlbiA9IGxlbnNbMF07XG4gICAgdmFyIHBsYWNlSG9sZGVyc0xlbiA9IGxlbnNbMV07XG4gICAgdmFyIGFyciA9IG5ldyBBcnIoX2J5dGVMZW5ndGgoYjY0LCB2YWxpZExlbiwgcGxhY2VIb2xkZXJzTGVuKSk7XG4gICAgdmFyIGN1ckJ5dGUgPSAwO1xuICAgIC8vIGlmIHRoZXJlIGFyZSBwbGFjZWhvbGRlcnMsIG9ubHkgZ2V0IHVwIHRvIHRoZSBsYXN0IGNvbXBsZXRlIDQgY2hhcnNcbiAgICB2YXIgbGVuID0gcGxhY2VIb2xkZXJzTGVuID4gMFxuICAgICAgICA/IHZhbGlkTGVuIC0gNFxuICAgICAgICA6IHZhbGlkTGVuO1xuICAgIHZhciBpO1xuICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkgKz0gNCkge1xuICAgICAgICB0bXAgPVxuICAgICAgICAgICAgKHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpKV0gPDwgMTgpIHxcbiAgICAgICAgICAgICAgICAocmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkgKyAxKV0gPDwgMTIpIHxcbiAgICAgICAgICAgICAgICAocmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkgKyAyKV0gPDwgNikgfFxuICAgICAgICAgICAgICAgIHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpICsgMyldO1xuICAgICAgICBhcnJbY3VyQnl0ZSsrXSA9ICh0bXAgPj4gMTYpICYgMHhGRjtcbiAgICAgICAgYXJyW2N1ckJ5dGUrK10gPSAodG1wID4+IDgpICYgMHhGRjtcbiAgICAgICAgYXJyW2N1ckJ5dGUrK10gPSB0bXAgJiAweEZGO1xuICAgIH1cbiAgICBpZiAocGxhY2VIb2xkZXJzTGVuID09PSAyKSB7XG4gICAgICAgIHRtcCA9XG4gICAgICAgICAgICAocmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkpXSA8PCAyKSB8XG4gICAgICAgICAgICAgICAgKHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpICsgMSldID4+IDQpO1xuICAgICAgICBhcnJbY3VyQnl0ZSsrXSA9IHRtcCAmIDB4RkY7XG4gICAgfVxuICAgIGlmIChwbGFjZUhvbGRlcnNMZW4gPT09IDEpIHtcbiAgICAgICAgdG1wID1cbiAgICAgICAgICAgIChyZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaSldIDw8IDEwKSB8XG4gICAgICAgICAgICAgICAgKHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpICsgMSldIDw8IDQpIHxcbiAgICAgICAgICAgICAgICAocmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkgKyAyKV0gPj4gMik7XG4gICAgICAgIGFycltjdXJCeXRlKytdID0gKHRtcCA+PiA4KSAmIDB4RkY7XG4gICAgICAgIGFycltjdXJCeXRlKytdID0gdG1wICYgMHhGRjtcbiAgICB9XG4gICAgcmV0dXJuIGFycjtcbn1cbmZ1bmN0aW9uIHRyaXBsZXRUb0Jhc2U2NChudW0pIHtcbiAgICByZXR1cm4gbG9va3VwW251bSA+PiAxOCAmIDB4M0ZdICtcbiAgICAgICAgbG9va3VwW251bSA+PiAxMiAmIDB4M0ZdICtcbiAgICAgICAgbG9va3VwW251bSA+PiA2ICYgMHgzRl0gK1xuICAgICAgICBsb29rdXBbbnVtICYgMHgzRl07XG59XG5mdW5jdGlvbiBlbmNvZGVDaHVuayh1aW50OCwgc3RhcnQsIGVuZCkge1xuICAgIHZhciB0bXA7XG4gICAgdmFyIG91dHB1dCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IGVuZDsgaSArPSAzKSB7XG4gICAgICAgIHRtcCA9XG4gICAgICAgICAgICAoKHVpbnQ4W2ldIDw8IDE2KSAmIDB4RkYwMDAwKSArXG4gICAgICAgICAgICAgICAgKCh1aW50OFtpICsgMV0gPDwgOCkgJiAweEZGMDApICtcbiAgICAgICAgICAgICAgICAodWludDhbaSArIDJdICYgMHhGRik7XG4gICAgICAgIG91dHB1dC5wdXNoKHRyaXBsZXRUb0Jhc2U2NCh0bXApKTtcbiAgICB9XG4gICAgcmV0dXJuIG91dHB1dC5qb2luKCcnKTtcbn1cbmZ1bmN0aW9uIGZyb21CeXRlQXJyYXkodWludDgpIHtcbiAgICB2YXIgdG1wO1xuICAgIHZhciBsZW4gPSB1aW50OC5sZW5ndGg7XG4gICAgdmFyIGV4dHJhQnl0ZXMgPSBsZW4gJSAzOyAvLyBpZiB3ZSBoYXZlIDEgYnl0ZSBsZWZ0LCBwYWQgMiBieXRlc1xuICAgIHZhciBwYXJ0cyA9IFtdO1xuICAgIHZhciBtYXhDaHVua0xlbmd0aCA9IDE2MzgzOyAvLyBtdXN0IGJlIG11bHRpcGxlIG9mIDNcbiAgICAvLyBnbyB0aHJvdWdoIHRoZSBhcnJheSBldmVyeSB0aHJlZSBieXRlcywgd2UnbGwgZGVhbCB3aXRoIHRyYWlsaW5nIHN0dWZmIGxhdGVyXG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbjIgPSBsZW4gLSBleHRyYUJ5dGVzOyBpIDwgbGVuMjsgaSArPSBtYXhDaHVua0xlbmd0aCkge1xuICAgICAgICBwYXJ0cy5wdXNoKGVuY29kZUNodW5rKHVpbnQ4LCBpLCAoaSArIG1heENodW5rTGVuZ3RoKSA+IGxlbjIgPyBsZW4yIDogKGkgKyBtYXhDaHVua0xlbmd0aCkpKTtcbiAgICB9XG4gICAgLy8gcGFkIHRoZSBlbmQgd2l0aCB6ZXJvcywgYnV0IG1ha2Ugc3VyZSB0byBub3QgZm9yZ2V0IHRoZSBleHRyYSBieXRlc1xuICAgIGlmIChleHRyYUJ5dGVzID09PSAxKSB7XG4gICAgICAgIHRtcCA9IHVpbnQ4W2xlbiAtIDFdO1xuICAgICAgICBwYXJ0cy5wdXNoKGxvb2t1cFt0bXAgPj4gMl0gK1xuICAgICAgICAgICAgbG9va3VwWyh0bXAgPDwgNCkgJiAweDNGXSArXG4gICAgICAgICAgICAnPT0nKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoZXh0cmFCeXRlcyA9PT0gMikge1xuICAgICAgICB0bXAgPSAodWludDhbbGVuIC0gMl0gPDwgOCkgKyB1aW50OFtsZW4gLSAxXTtcbiAgICAgICAgcGFydHMucHVzaChsb29rdXBbdG1wID4+IDEwXSArXG4gICAgICAgICAgICBsb29rdXBbKHRtcCA+PiA0KSAmIDB4M0ZdICtcbiAgICAgICAgICAgIGxvb2t1cFsodG1wIDw8IDIpICYgMHgzRl0gK1xuICAgICAgICAgICAgJz0nKTtcbiAgICB9XG4gICAgcmV0dXJuIHBhcnRzLmpvaW4oJycpO1xufVxuXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8vaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vYmFzZTY0LWpzQDEuNS4xL25vZGVfbW9kdWxlcy9iYXNlNjQtanMvaW5kZXguanM/Iik7CgovKioqLyB9KSwKCi8qKiovICIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vYnVmZmVyQDQuOS4yL25vZGVfbW9kdWxlcy9idWZmZXIvaW5kZXguanMiOgovKiEqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiEqXAogICEqKiogL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL2J1ZmZlckA0LjkuMi9ub2RlX21vZHVsZXMvYnVmZmVyL2luZGV4LmpzICoqKiEKICBcKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CmV2YWwoIi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLyhmdW5jdGlvbihnbG9iYWwpIHsvKiFcbiAqIFRoZSBidWZmZXIgbW9kdWxlIGZyb20gbm9kZS5qcywgZm9yIHRoZSBicm93c2VyLlxuICpcbiAqIEBhdXRob3IgICBGZXJvc3MgQWJvdWtoYWRpamVoIDxodHRwOi8vZmVyb3NzLm9yZz5cbiAqIEBsaWNlbnNlICBNSVRcbiAqL1xuLyogZXNsaW50LWRpc2FibGUgbm8tcHJvdG8gKi9cblxudmFyIGJhc2U2NCA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIGJhc2U2NC1qcyAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9iYXNlNjQtanNAMS41LjEvbm9kZV9tb2R1bGVzL2Jhc2U2NC1qcy9pbmRleC5qc1wiKTtcbnZhciBpZWVlNzU0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgaWVlZTc1NCAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9pZWVlNzU0QDEuMi4xL25vZGVfbW9kdWxlcy9pZWVlNzU0L2luZGV4LmpzXCIpO1xudmFyIGlzQXJyYXkgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISBpc2FycmF5ICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2lzYXJyYXlAMS4wLjAvbm9kZV9tb2R1bGVzL2lzYXJyYXkvaW5kZXguanNcIik7XG5leHBvcnRzLkJ1ZmZlciA9IEJ1ZmZlcjtcbmV4cG9ydHMuU2xvd0J1ZmZlciA9IFNsb3dCdWZmZXI7XG5leHBvcnRzLklOU1BFQ1RfTUFYX0JZVEVTID0gNTA7XG4vKipcbiAqIElmIGBCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVGA6XG4gKiAgID09PSB0cnVlICAgIFVzZSBVaW50OEFycmF5IGltcGxlbWVudGF0aW9uIChmYXN0ZXN0KVxuICogICA9PT0gZmFsc2UgICBVc2UgT2JqZWN0IGltcGxlbWVudGF0aW9uIChtb3N0IGNvbXBhdGlibGUsIGV2ZW4gSUU2KVxuICpcbiAqIEJyb3dzZXJzIHRoYXQgc3VwcG9ydCB0eXBlZCBhcnJheXMgYXJlIElFIDEwKywgRmlyZWZveCA0KywgQ2hyb21lIDcrLCBTYWZhcmkgNS4xKyxcbiAqIE9wZXJhIDExLjYrLCBpT1MgNC4yKy5cbiAqXG4gKiBEdWUgdG8gdmFyaW91cyBicm93c2VyIGJ1Z3MsIHNvbWV0aW1lcyB0aGUgT2JqZWN0IGltcGxlbWVudGF0aW9uIHdpbGwgYmUgdXNlZCBldmVuXG4gKiB3aGVuIHRoZSBicm93c2VyIHN1cHBvcnRzIHR5cGVkIGFycmF5cy5cbiAqXG4gKiBOb3RlOlxuICpcbiAqICAgLSBGaXJlZm94IDQtMjkgbGFja3Mgc3VwcG9ydCBmb3IgYWRkaW5nIG5ldyBwcm9wZXJ0aWVzIHRvIGBVaW50OEFycmF5YCBpbnN0YW5jZXMsXG4gKiAgICAgU2VlOiBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD02OTU0MzguXG4gKlxuICogICAtIENocm9tZSA5LTEwIGlzIG1pc3NpbmcgdGhlIGBUeXBlZEFycmF5LnByb3RvdHlwZS5zdWJhcnJheWAgZnVuY3Rpb24uXG4gKlxuICogICAtIElFMTAgaGFzIGEgYnJva2VuIGBUeXBlZEFycmF5LnByb3RvdHlwZS5zdWJhcnJheWAgZnVuY3Rpb24gd2hpY2ggcmV0dXJucyBhcnJheXMgb2ZcbiAqICAgICBpbmNvcnJlY3QgbGVuZ3RoIGluIHNvbWUgc2l0dWF0aW9ucy5cblxuICogV2UgZGV0ZWN0IHRoZXNlIGJ1Z2d5IGJyb3dzZXJzIGFuZCBzZXQgYEJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUYCB0byBgZmFsc2VgIHNvIHRoZXlcbiAqIGdldCB0aGUgT2JqZWN0IGltcGxlbWVudGF0aW9uLCB3aGljaCBpcyBzbG93ZXIgYnV0IGJlaGF2ZXMgY29ycmVjdGx5LlxuICovXG5CdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCA9IGdsb2JhbC5UWVBFRF9BUlJBWV9TVVBQT1JUICE9PSB1bmRlZmluZWRcbiAgICA/IGdsb2JhbC5UWVBFRF9BUlJBWV9TVVBQT1JUXG4gICAgOiB0eXBlZEFycmF5U3VwcG9ydCgpO1xuLypcbiAqIEV4cG9ydCBrTWF4TGVuZ3RoIGFmdGVyIHR5cGVkIGFycmF5IHN1cHBvcnQgaXMgZGV0ZXJtaW5lZC5cbiAqL1xuZXhwb3J0cy5rTWF4TGVuZ3RoID0ga01heExlbmd0aCgpO1xuZnVuY3Rpb24gdHlwZWRBcnJheVN1cHBvcnQoKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgdmFyIGFyciA9IG5ldyBVaW50OEFycmF5KDEpO1xuICAgICAgICBhcnIuX19wcm90b19fID0geyBfX3Byb3RvX186IFVpbnQ4QXJyYXkucHJvdG90eXBlLCBmb286IGZ1bmN0aW9uICgpIHsgcmV0dXJuIDQyOyB9IH07XG4gICAgICAgIHJldHVybiBhcnIuZm9vKCkgPT09IDQyICYmIC8vIHR5cGVkIGFycmF5IGluc3RhbmNlcyBjYW4gYmUgYXVnbWVudGVkXG4gICAgICAgICAgICB0eXBlb2YgYXJyLnN1YmFycmF5ID09PSAnZnVuY3Rpb24nICYmIC8vIGNocm9tZSA5LTEwIGxhY2sgYHN1YmFycmF5YFxuICAgICAgICAgICAgYXJyLnN1YmFycmF5KDEsIDEpLmJ5dGVMZW5ndGggPT09IDA7IC8vIGllMTAgaGFzIGJyb2tlbiBgc3ViYXJyYXlgXG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59XG5mdW5jdGlvbiBrTWF4TGVuZ3RoKCkge1xuICAgIHJldHVybiBCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVFxuICAgICAgICA/IDB4N2ZmZmZmZmZcbiAgICAgICAgOiAweDNmZmZmZmZmO1xufVxuZnVuY3Rpb24gY3JlYXRlQnVmZmVyKHRoYXQsIGxlbmd0aCkge1xuICAgIGlmIChrTWF4TGVuZ3RoKCkgPCBsZW5ndGgpIHtcbiAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ0ludmFsaWQgdHlwZWQgYXJyYXkgbGVuZ3RoJyk7XG4gICAgfVxuICAgIGlmIChCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkge1xuICAgICAgICAvLyBSZXR1cm4gYW4gYXVnbWVudGVkIGBVaW50OEFycmF5YCBpbnN0YW5jZSwgZm9yIGJlc3QgcGVyZm9ybWFuY2VcbiAgICAgICAgdGhhdCA9IG5ldyBVaW50OEFycmF5KGxlbmd0aCk7XG4gICAgICAgIHRoYXQuX19wcm90b19fID0gQnVmZmVyLnByb3RvdHlwZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIEZhbGxiYWNrOiBSZXR1cm4gYW4gb2JqZWN0IGluc3RhbmNlIG9mIHRoZSBCdWZmZXIgY2xhc3NcbiAgICAgICAgaWYgKHRoYXQgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHRoYXQgPSBuZXcgQnVmZmVyKGxlbmd0aCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhhdC5sZW5ndGggPSBsZW5ndGg7XG4gICAgfVxuICAgIHJldHVybiB0aGF0O1xufVxuLyoqXG4gKiBUaGUgQnVmZmVyIGNvbnN0cnVjdG9yIHJldHVybnMgaW5zdGFuY2VzIG9mIGBVaW50OEFycmF5YCB0aGF0IGhhdmUgdGhlaXJcbiAqIHByb3RvdHlwZSBjaGFuZ2VkIHRvIGBCdWZmZXIucHJvdG90eXBlYC4gRnVydGhlcm1vcmUsIGBCdWZmZXJgIGlzIGEgc3ViY2xhc3Mgb2ZcbiAqIGBVaW50OEFycmF5YCwgc28gdGhlIHJldHVybmVkIGluc3RhbmNlcyB3aWxsIGhhdmUgYWxsIHRoZSBub2RlIGBCdWZmZXJgIG1ldGhvZHNcbiAqIGFuZCB0aGUgYFVpbnQ4QXJyYXlgIG1ldGhvZHMuIFNxdWFyZSBicmFja2V0IG5vdGF0aW9uIHdvcmtzIGFzIGV4cGVjdGVkIC0tIGl0XG4gKiByZXR1cm5zIGEgc2luZ2xlIG9jdGV0LlxuICpcbiAqIFRoZSBgVWludDhBcnJheWAgcHJvdG90eXBlIHJlbWFpbnMgdW5tb2RpZmllZC5cbiAqL1xuZnVuY3Rpb24gQnVmZmVyKGFyZywgZW5jb2RpbmdPck9mZnNldCwgbGVuZ3RoKSB7XG4gICAgaWYgKCFCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCAmJiAhKHRoaXMgaW5zdGFuY2VvZiBCdWZmZXIpKSB7XG4gICAgICAgIHJldHVybiBuZXcgQnVmZmVyKGFyZywgZW5jb2RpbmdPck9mZnNldCwgbGVuZ3RoKTtcbiAgICB9XG4gICAgLy8gQ29tbW9uIGNhc2UuXG4gICAgaWYgKHR5cGVvZiBhcmcgPT09ICdudW1iZXInKSB7XG4gICAgICAgIGlmICh0eXBlb2YgZW5jb2RpbmdPck9mZnNldCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSWYgZW5jb2RpbmcgaXMgc3BlY2lmaWVkIHRoZW4gdGhlIGZpcnN0IGFyZ3VtZW50IG11c3QgYmUgYSBzdHJpbmcnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYWxsb2NVbnNhZmUodGhpcywgYXJnKTtcbiAgICB9XG4gICAgcmV0dXJuIGZyb20odGhpcywgYXJnLCBlbmNvZGluZ09yT2Zmc2V0LCBsZW5ndGgpO1xufVxuQnVmZmVyLnBvb2xTaXplID0gODE5MjsgLy8gbm90IHVzZWQgYnkgdGhpcyBpbXBsZW1lbnRhdGlvblxuLy8gVE9ETzogTGVnYWN5LCBub3QgbmVlZGVkIGFueW1vcmUuIFJlbW92ZSBpbiBuZXh0IG1ham9yIHZlcnNpb24uXG5CdWZmZXIuX2F1Z21lbnQgPSBmdW5jdGlvbiAoYXJyKSB7XG4gICAgYXJyLl9fcHJvdG9fXyA9IEJ1ZmZlci5wcm90b3R5cGU7XG4gICAgcmV0dXJuIGFycjtcbn07XG5mdW5jdGlvbiBmcm9tKHRoYXQsIHZhbHVlLCBlbmNvZGluZ09yT2Zmc2V0LCBsZW5ndGgpIHtcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJykge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdcInZhbHVlXCIgYXJndW1lbnQgbXVzdCBub3QgYmUgYSBudW1iZXInKTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBBcnJheUJ1ZmZlciAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikge1xuICAgICAgICByZXR1cm4gZnJvbUFycmF5QnVmZmVyKHRoYXQsIHZhbHVlLCBlbmNvZGluZ09yT2Zmc2V0LCBsZW5ndGgpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICByZXR1cm4gZnJvbVN0cmluZyh0aGF0LCB2YWx1ZSwgZW5jb2RpbmdPck9mZnNldCk7XG4gICAgfVxuICAgIHJldHVybiBmcm9tT2JqZWN0KHRoYXQsIHZhbHVlKTtcbn1cbi8qKlxuICogRnVuY3Rpb25hbGx5IGVxdWl2YWxlbnQgdG8gQnVmZmVyKGFyZywgZW5jb2RpbmcpIGJ1dCB0aHJvd3MgYSBUeXBlRXJyb3JcbiAqIGlmIHZhbHVlIGlzIGEgbnVtYmVyLlxuICogQnVmZmVyLmZyb20oc3RyWywgZW5jb2RpbmddKVxuICogQnVmZmVyLmZyb20oYXJyYXkpXG4gKiBCdWZmZXIuZnJvbShidWZmZXIpXG4gKiBCdWZmZXIuZnJvbShhcnJheUJ1ZmZlclssIGJ5dGVPZmZzZXRbLCBsZW5ndGhdXSlcbiAqKi9cbkJ1ZmZlci5mcm9tID0gZnVuY3Rpb24gKHZhbHVlLCBlbmNvZGluZ09yT2Zmc2V0LCBsZW5ndGgpIHtcbiAgICByZXR1cm4gZnJvbShudWxsLCB2YWx1ZSwgZW5jb2RpbmdPck9mZnNldCwgbGVuZ3RoKTtcbn07XG5pZiAoQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQpIHtcbiAgICBCdWZmZXIucHJvdG90eXBlLl9fcHJvdG9fXyA9IFVpbnQ4QXJyYXkucHJvdG90eXBlO1xuICAgIEJ1ZmZlci5fX3Byb3RvX18gPSBVaW50OEFycmF5O1xuICAgIGlmICh0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wuc3BlY2llcyAmJlxuICAgICAgICBCdWZmZXJbU3ltYm9sLnNwZWNpZXNdID09PSBCdWZmZXIpIHtcbiAgICAgICAgLy8gRml4IHN1YmFycmF5KCkgaW4gRVMyMDE2LiBTZWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9mZXJvc3MvYnVmZmVyL3B1bGwvOTdcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEJ1ZmZlciwgU3ltYm9sLnNwZWNpZXMsIHtcbiAgICAgICAgICAgIHZhbHVlOiBudWxsLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGFzc2VydFNpemUoc2l6ZSkge1xuICAgIGlmICh0eXBlb2Ygc2l6ZSAhPT0gJ251bWJlcicpIHtcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignXCJzaXplXCIgYXJndW1lbnQgbXVzdCBiZSBhIG51bWJlcicpO1xuICAgIH1cbiAgICBlbHNlIGlmIChzaXplIDwgMCkge1xuICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignXCJzaXplXCIgYXJndW1lbnQgbXVzdCBub3QgYmUgbmVnYXRpdmUnKTtcbiAgICB9XG59XG5mdW5jdGlvbiBhbGxvYyh0aGF0LCBzaXplLCBmaWxsLCBlbmNvZGluZykge1xuICAgIGFzc2VydFNpemUoc2l6ZSk7XG4gICAgaWYgKHNpemUgPD0gMCkge1xuICAgICAgICByZXR1cm4gY3JlYXRlQnVmZmVyKHRoYXQsIHNpemUpO1xuICAgIH1cbiAgICBpZiAoZmlsbCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIC8vIE9ubHkgcGF5IGF0dGVudGlvbiB0byBlbmNvZGluZyBpZiBpdCdzIGEgc3RyaW5nLiBUaGlzXG4gICAgICAgIC8vIHByZXZlbnRzIGFjY2lkZW50YWxseSBzZW5kaW5nIGluIGEgbnVtYmVyIHRoYXQgd291bGRcbiAgICAgICAgLy8gYmUgaW50ZXJwcmV0dGVkIGFzIGEgc3RhcnQgb2Zmc2V0LlxuICAgICAgICByZXR1cm4gdHlwZW9mIGVuY29kaW5nID09PSAnc3RyaW5nJ1xuICAgICAgICAgICAgPyBjcmVhdGVCdWZmZXIodGhhdCwgc2l6ZSkuZmlsbChmaWxsLCBlbmNvZGluZylcbiAgICAgICAgICAgIDogY3JlYXRlQnVmZmVyKHRoYXQsIHNpemUpLmZpbGwoZmlsbCk7XG4gICAgfVxuICAgIHJldHVybiBjcmVhdGVCdWZmZXIodGhhdCwgc2l6ZSk7XG59XG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgZmlsbGVkIEJ1ZmZlciBpbnN0YW5jZS5cbiAqIGFsbG9jKHNpemVbLCBmaWxsWywgZW5jb2RpbmddXSlcbiAqKi9cbkJ1ZmZlci5hbGxvYyA9IGZ1bmN0aW9uIChzaXplLCBmaWxsLCBlbmNvZGluZykge1xuICAgIHJldHVybiBhbGxvYyhudWxsLCBzaXplLCBmaWxsLCBlbmNvZGluZyk7XG59O1xuZnVuY3Rpb24gYWxsb2NVbnNhZmUodGhhdCwgc2l6ZSkge1xuICAgIGFzc2VydFNpemUoc2l6ZSk7XG4gICAgdGhhdCA9IGNyZWF0ZUJ1ZmZlcih0aGF0LCBzaXplIDwgMCA/IDAgOiBjaGVja2VkKHNpemUpIHwgMCk7XG4gICAgaWYgKCFCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNpemU7ICsraSkge1xuICAgICAgICAgICAgdGhhdFtpXSA9IDA7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoYXQ7XG59XG4vKipcbiAqIEVxdWl2YWxlbnQgdG8gQnVmZmVyKG51bSksIGJ5IGRlZmF1bHQgY3JlYXRlcyBhIG5vbi16ZXJvLWZpbGxlZCBCdWZmZXIgaW5zdGFuY2UuXG4gKiAqL1xuQnVmZmVyLmFsbG9jVW5zYWZlID0gZnVuY3Rpb24gKHNpemUpIHtcbiAgICByZXR1cm4gYWxsb2NVbnNhZmUobnVsbCwgc2l6ZSk7XG59O1xuLyoqXG4gKiBFcXVpdmFsZW50IHRvIFNsb3dCdWZmZXIobnVtKSwgYnkgZGVmYXVsdCBjcmVhdGVzIGEgbm9uLXplcm8tZmlsbGVkIEJ1ZmZlciBpbnN0YW5jZS5cbiAqL1xuQnVmZmVyLmFsbG9jVW5zYWZlU2xvdyA9IGZ1bmN0aW9uIChzaXplKSB7XG4gICAgcmV0dXJuIGFsbG9jVW5zYWZlKG51bGwsIHNpemUpO1xufTtcbmZ1bmN0aW9uIGZyb21TdHJpbmcodGhhdCwgc3RyaW5nLCBlbmNvZGluZykge1xuICAgIGlmICh0eXBlb2YgZW5jb2RpbmcgIT09ICdzdHJpbmcnIHx8IGVuY29kaW5nID09PSAnJykge1xuICAgICAgICBlbmNvZGluZyA9ICd1dGY4JztcbiAgICB9XG4gICAgaWYgKCFCdWZmZXIuaXNFbmNvZGluZyhlbmNvZGluZykpIHtcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignXCJlbmNvZGluZ1wiIG11c3QgYmUgYSB2YWxpZCBzdHJpbmcgZW5jb2RpbmcnKTtcbiAgICB9XG4gICAgdmFyIGxlbmd0aCA9IGJ5dGVMZW5ndGgoc3RyaW5nLCBlbmNvZGluZykgfCAwO1xuICAgIHRoYXQgPSBjcmVhdGVCdWZmZXIodGhhdCwgbGVuZ3RoKTtcbiAgICB2YXIgYWN0dWFsID0gdGhhdC53cml0ZShzdHJpbmcsIGVuY29kaW5nKTtcbiAgICBpZiAoYWN0dWFsICE9PSBsZW5ndGgpIHtcbiAgICAgICAgLy8gV3JpdGluZyBhIGhleCBzdHJpbmcsIGZvciBleGFtcGxlLCB0aGF0IGNvbnRhaW5zIGludmFsaWQgY2hhcmFjdGVycyB3aWxsXG4gICAgICAgIC8vIGNhdXNlIGV2ZXJ5dGhpbmcgYWZ0ZXIgdGhlIGZpcnN0IGludmFsaWQgY2hhcmFjdGVyIHRvIGJlIGlnbm9yZWQuIChlLmcuXG4gICAgICAgIC8vICdhYnh4Y2QnIHdpbGwgYmUgdHJlYXRlZCBhcyAnYWInKVxuICAgICAgICB0aGF0ID0gdGhhdC5zbGljZSgwLCBhY3R1YWwpO1xuICAgIH1cbiAgICByZXR1cm4gdGhhdDtcbn1cbmZ1bmN0aW9uIGZyb21BcnJheUxpa2UodGhhdCwgYXJyYXkpIHtcbiAgICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoIDwgMCA/IDAgOiBjaGVja2VkKGFycmF5Lmxlbmd0aCkgfCAwO1xuICAgIHRoYXQgPSBjcmVhdGVCdWZmZXIodGhhdCwgbGVuZ3RoKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgIHRoYXRbaV0gPSBhcnJheVtpXSAmIDI1NTtcbiAgICB9XG4gICAgcmV0dXJuIHRoYXQ7XG59XG5mdW5jdGlvbiBmcm9tQXJyYXlCdWZmZXIodGhhdCwgYXJyYXksIGJ5dGVPZmZzZXQsIGxlbmd0aCkge1xuICAgIGFycmF5LmJ5dGVMZW5ndGg7IC8vIHRoaXMgdGhyb3dzIGlmIGBhcnJheWAgaXMgbm90IGEgdmFsaWQgQXJyYXlCdWZmZXJcbiAgICBpZiAoYnl0ZU9mZnNldCA8IDAgfHwgYXJyYXkuYnl0ZUxlbmd0aCA8IGJ5dGVPZmZzZXQpIHtcbiAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ1xcJ29mZnNldFxcJyBpcyBvdXQgb2YgYm91bmRzJyk7XG4gICAgfVxuICAgIGlmIChhcnJheS5ieXRlTGVuZ3RoIDwgYnl0ZU9mZnNldCArIChsZW5ndGggfHwgMCkpIHtcbiAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ1xcJ2xlbmd0aFxcJyBpcyBvdXQgb2YgYm91bmRzJyk7XG4gICAgfVxuICAgIGlmIChieXRlT2Zmc2V0ID09PSB1bmRlZmluZWQgJiYgbGVuZ3RoID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgYXJyYXkgPSBuZXcgVWludDhBcnJheShhcnJheSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGxlbmd0aCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGFycmF5ID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXksIGJ5dGVPZmZzZXQpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgYXJyYXkgPSBuZXcgVWludDhBcnJheShhcnJheSwgYnl0ZU9mZnNldCwgbGVuZ3RoKTtcbiAgICB9XG4gICAgaWYgKEJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUKSB7XG4gICAgICAgIC8vIFJldHVybiBhbiBhdWdtZW50ZWQgYFVpbnQ4QXJyYXlgIGluc3RhbmNlLCBmb3IgYmVzdCBwZXJmb3JtYW5jZVxuICAgICAgICB0aGF0ID0gYXJyYXk7XG4gICAgICAgIHRoYXQuX19wcm90b19fID0gQnVmZmVyLnByb3RvdHlwZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIEZhbGxiYWNrOiBSZXR1cm4gYW4gb2JqZWN0IGluc3RhbmNlIG9mIHRoZSBCdWZmZXIgY2xhc3NcbiAgICAgICAgdGhhdCA9IGZyb21BcnJheUxpa2UodGhhdCwgYXJyYXkpO1xuICAgIH1cbiAgICByZXR1cm4gdGhhdDtcbn1cbmZ1bmN0aW9uIGZyb21PYmplY3QodGhhdCwgb2JqKSB7XG4gICAgaWYgKEJ1ZmZlci5pc0J1ZmZlcihvYmopKSB7XG4gICAgICAgIHZhciBsZW4gPSBjaGVja2VkKG9iai5sZW5ndGgpIHwgMDtcbiAgICAgICAgdGhhdCA9IGNyZWF0ZUJ1ZmZlcih0aGF0LCBsZW4pO1xuICAgICAgICBpZiAodGhhdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiB0aGF0O1xuICAgICAgICB9XG4gICAgICAgIG9iai5jb3B5KHRoYXQsIDAsIDAsIGxlbik7XG4gICAgICAgIHJldHVybiB0aGF0O1xuICAgIH1cbiAgICBpZiAob2JqKSB7XG4gICAgICAgIGlmICgodHlwZW9mIEFycmF5QnVmZmVyICE9PSAndW5kZWZpbmVkJyAmJlxuICAgICAgICAgICAgb2JqLmJ1ZmZlciBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSB8fCAnbGVuZ3RoJyBpbiBvYmopIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygb2JqLmxlbmd0aCAhPT0gJ251bWJlcicgfHwgaXNuYW4ob2JqLmxlbmd0aCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY3JlYXRlQnVmZmVyKHRoYXQsIDApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZyb21BcnJheUxpa2UodGhhdCwgb2JqKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob2JqLnR5cGUgPT09ICdCdWZmZXInICYmIGlzQXJyYXkob2JqLmRhdGEpKSB7XG4gICAgICAgICAgICByZXR1cm4gZnJvbUFycmF5TGlrZSh0aGF0LCBvYmouZGF0YSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcignRmlyc3QgYXJndW1lbnQgbXVzdCBiZSBhIHN0cmluZywgQnVmZmVyLCBBcnJheUJ1ZmZlciwgQXJyYXksIG9yIGFycmF5LWxpa2Ugb2JqZWN0LicpO1xufVxuZnVuY3Rpb24gY2hlY2tlZChsZW5ndGgpIHtcbiAgICAvLyBOb3RlOiBjYW5ub3QgdXNlIGBsZW5ndGggPCBrTWF4TGVuZ3RoKClgIGhlcmUgYmVjYXVzZSB0aGF0IGZhaWxzIHdoZW5cbiAgICAvLyBsZW5ndGggaXMgTmFOICh3aGljaCBpcyBvdGhlcndpc2UgY29lcmNlZCB0byB6ZXJvLilcbiAgICBpZiAobGVuZ3RoID49IGtNYXhMZW5ndGgoKSkge1xuICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignQXR0ZW1wdCB0byBhbGxvY2F0ZSBCdWZmZXIgbGFyZ2VyIHRoYW4gbWF4aW11bSAnICtcbiAgICAgICAgICAgICdzaXplOiAweCcgKyBrTWF4TGVuZ3RoKCkudG9TdHJpbmcoMTYpICsgJyBieXRlcycpO1xuICAgIH1cbiAgICByZXR1cm4gbGVuZ3RoIHwgMDtcbn1cbmZ1bmN0aW9uIFNsb3dCdWZmZXIobGVuZ3RoKSB7XG4gICAgaWYgKCtsZW5ndGggIT0gbGVuZ3RoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgZXFlcWVxXG4gICAgICAgIGxlbmd0aCA9IDA7XG4gICAgfVxuICAgIHJldHVybiBCdWZmZXIuYWxsb2MoK2xlbmd0aCk7XG59XG5CdWZmZXIuaXNCdWZmZXIgPSBmdW5jdGlvbiBpc0J1ZmZlcihiKSB7XG4gICAgcmV0dXJuICEhKGIgIT0gbnVsbCAmJiBiLl9pc0J1ZmZlcik7XG59O1xuQnVmZmVyLmNvbXBhcmUgPSBmdW5jdGlvbiBjb21wYXJlKGEsIGIpIHtcbiAgICBpZiAoIUJ1ZmZlci5pc0J1ZmZlcihhKSB8fCAhQnVmZmVyLmlzQnVmZmVyKGIpKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0FyZ3VtZW50cyBtdXN0IGJlIEJ1ZmZlcnMnKTtcbiAgICB9XG4gICAgaWYgKGEgPT09IGIpXG4gICAgICAgIHJldHVybiAwO1xuICAgIHZhciB4ID0gYS5sZW5ndGg7XG4gICAgdmFyIHkgPSBiLmxlbmd0aDtcbiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gTWF0aC5taW4oeCwgeSk7IGkgPCBsZW47ICsraSkge1xuICAgICAgICBpZiAoYVtpXSAhPT0gYltpXSkge1xuICAgICAgICAgICAgeCA9IGFbaV07XG4gICAgICAgICAgICB5ID0gYltpXTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmICh4IDwgeSlcbiAgICAgICAgcmV0dXJuIC0xO1xuICAgIGlmICh5IDwgeClcbiAgICAgICAgcmV0dXJuIDE7XG4gICAgcmV0dXJuIDA7XG59O1xuQnVmZmVyLmlzRW5jb2RpbmcgPSBmdW5jdGlvbiBpc0VuY29kaW5nKGVuY29kaW5nKSB7XG4gICAgc3dpdGNoIChTdHJpbmcoZW5jb2RpbmcpLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgICAgY2FzZSAnaGV4JzpcbiAgICAgICAgY2FzZSAndXRmOCc6XG4gICAgICAgIGNhc2UgJ3V0Zi04JzpcbiAgICAgICAgY2FzZSAnYXNjaWknOlxuICAgICAgICBjYXNlICdsYXRpbjEnOlxuICAgICAgICBjYXNlICdiaW5hcnknOlxuICAgICAgICBjYXNlICdiYXNlNjQnOlxuICAgICAgICBjYXNlICd1Y3MyJzpcbiAgICAgICAgY2FzZSAndWNzLTInOlxuICAgICAgICBjYXNlICd1dGYxNmxlJzpcbiAgICAgICAgY2FzZSAndXRmLTE2bGUnOlxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufTtcbkJ1ZmZlci5jb25jYXQgPSBmdW5jdGlvbiBjb25jYXQobGlzdCwgbGVuZ3RoKSB7XG4gICAgaWYgKCFpc0FycmF5KGxpc3QpKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1wibGlzdFwiIGFyZ3VtZW50IG11c3QgYmUgYW4gQXJyYXkgb2YgQnVmZmVycycpO1xuICAgIH1cbiAgICBpZiAobGlzdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIEJ1ZmZlci5hbGxvYygwKTtcbiAgICB9XG4gICAgdmFyIGk7XG4gICAgaWYgKGxlbmd0aCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGxlbmd0aCA9IDA7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBsZW5ndGggKz0gbGlzdFtpXS5sZW5ndGg7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdmFyIGJ1ZmZlciA9IEJ1ZmZlci5hbGxvY1Vuc2FmZShsZW5ndGgpO1xuICAgIHZhciBwb3MgPSAwO1xuICAgIGZvciAoaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgKytpKSB7XG4gICAgICAgIHZhciBidWYgPSBsaXN0W2ldO1xuICAgICAgICBpZiAoIUJ1ZmZlci5pc0J1ZmZlcihidWYpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdcImxpc3RcIiBhcmd1bWVudCBtdXN0IGJlIGFuIEFycmF5IG9mIEJ1ZmZlcnMnKTtcbiAgICAgICAgfVxuICAgICAgICBidWYuY29weShidWZmZXIsIHBvcyk7XG4gICAgICAgIHBvcyArPSBidWYubGVuZ3RoO1xuICAgIH1cbiAgICByZXR1cm4gYnVmZmVyO1xufTtcbmZ1bmN0aW9uIGJ5dGVMZW5ndGgoc3RyaW5nLCBlbmNvZGluZykge1xuICAgIGlmIChCdWZmZXIuaXNCdWZmZXIoc3RyaW5nKSkge1xuICAgICAgICByZXR1cm4gc3RyaW5nLmxlbmd0aDtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBBcnJheUJ1ZmZlciAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIEFycmF5QnVmZmVyLmlzVmlldyA9PT0gJ2Z1bmN0aW9uJyAmJlxuICAgICAgICAoQXJyYXlCdWZmZXIuaXNWaWV3KHN0cmluZykgfHwgc3RyaW5nIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpKSB7XG4gICAgICAgIHJldHVybiBzdHJpbmcuYnl0ZUxlbmd0aDtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBzdHJpbmcgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHN0cmluZyA9ICcnICsgc3RyaW5nO1xuICAgIH1cbiAgICB2YXIgbGVuID0gc3RyaW5nLmxlbmd0aDtcbiAgICBpZiAobGVuID09PSAwKVxuICAgICAgICByZXR1cm4gMDtcbiAgICAvLyBVc2UgYSBmb3IgbG9vcCB0byBhdm9pZCByZWN1cnNpb25cbiAgICB2YXIgbG93ZXJlZENhc2UgPSBmYWxzZTtcbiAgICBmb3IgKDs7KSB7XG4gICAgICAgIHN3aXRjaCAoZW5jb2RpbmcpIHtcbiAgICAgICAgICAgIGNhc2UgJ2FzY2lpJzpcbiAgICAgICAgICAgIGNhc2UgJ2xhdGluMSc6XG4gICAgICAgICAgICBjYXNlICdiaW5hcnknOlxuICAgICAgICAgICAgICAgIHJldHVybiBsZW47XG4gICAgICAgICAgICBjYXNlICd1dGY4JzpcbiAgICAgICAgICAgIGNhc2UgJ3V0Zi04JzpcbiAgICAgICAgICAgIGNhc2UgdW5kZWZpbmVkOlxuICAgICAgICAgICAgICAgIHJldHVybiB1dGY4VG9CeXRlcyhzdHJpbmcpLmxlbmd0aDtcbiAgICAgICAgICAgIGNhc2UgJ3VjczInOlxuICAgICAgICAgICAgY2FzZSAndWNzLTInOlxuICAgICAgICAgICAgY2FzZSAndXRmMTZsZSc6XG4gICAgICAgICAgICBjYXNlICd1dGYtMTZsZSc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxlbiAqIDI7XG4gICAgICAgICAgICBjYXNlICdoZXgnOlxuICAgICAgICAgICAgICAgIHJldHVybiBsZW4gPj4+IDE7XG4gICAgICAgICAgICBjYXNlICdiYXNlNjQnOlxuICAgICAgICAgICAgICAgIHJldHVybiBiYXNlNjRUb0J5dGVzKHN0cmluZykubGVuZ3RoO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBpZiAobG93ZXJlZENhc2UpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1dGY4VG9CeXRlcyhzdHJpbmcpLmxlbmd0aDsgLy8gYXNzdW1lIHV0ZjhcbiAgICAgICAgICAgICAgICBlbmNvZGluZyA9ICgnJyArIGVuY29kaW5nKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgIGxvd2VyZWRDYXNlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbn1cbkJ1ZmZlci5ieXRlTGVuZ3RoID0gYnl0ZUxlbmd0aDtcbmZ1bmN0aW9uIHNsb3dUb1N0cmluZyhlbmNvZGluZywgc3RhcnQsIGVuZCkge1xuICAgIHZhciBsb3dlcmVkQ2FzZSA9IGZhbHNlO1xuICAgIC8vIE5vIG5lZWQgdG8gdmVyaWZ5IHRoYXQgXCJ0aGlzLmxlbmd0aCA8PSBNQVhfVUlOVDMyXCIgc2luY2UgaXQncyBhIHJlYWQtb25seVxuICAgIC8vIHByb3BlcnR5IG9mIGEgdHlwZWQgYXJyYXkuXG4gICAgLy8gVGhpcyBiZWhhdmVzIG5laXRoZXIgbGlrZSBTdHJpbmcgbm9yIFVpbnQ4QXJyYXkgaW4gdGhhdCB3ZSBzZXQgc3RhcnQvZW5kXG4gICAgLy8gdG8gdGhlaXIgdXBwZXIvbG93ZXIgYm91bmRzIGlmIHRoZSB2YWx1ZSBwYXNzZWQgaXMgb3V0IG9mIHJhbmdlLlxuICAgIC8vIHVuZGVmaW5lZCBpcyBoYW5kbGVkIHNwZWNpYWxseSBhcyBwZXIgRUNNQS0yNjIgNnRoIEVkaXRpb24sXG4gICAgLy8gU2VjdGlvbiAxMy4zLjMuNyBSdW50aW1lIFNlbWFudGljczogS2V5ZWRCaW5kaW5nSW5pdGlhbGl6YXRpb24uXG4gICAgaWYgKHN0YXJ0ID09PSB1bmRlZmluZWQgfHwgc3RhcnQgPCAwKSB7XG4gICAgICAgIHN0YXJ0ID0gMDtcbiAgICB9XG4gICAgLy8gUmV0dXJuIGVhcmx5IGlmIHN0YXJ0ID4gdGhpcy5sZW5ndGguIERvbmUgaGVyZSB0byBwcmV2ZW50IHBvdGVudGlhbCB1aW50MzJcbiAgICAvLyBjb2VyY2lvbiBmYWlsIGJlbG93LlxuICAgIGlmIChzdGFydCA+IHRoaXMubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiAnJztcbiAgICB9XG4gICAgaWYgKGVuZCA9PT0gdW5kZWZpbmVkIHx8IGVuZCA+IHRoaXMubGVuZ3RoKSB7XG4gICAgICAgIGVuZCA9IHRoaXMubGVuZ3RoO1xuICAgIH1cbiAgICBpZiAoZW5kIDw9IDApIHtcbiAgICAgICAgcmV0dXJuICcnO1xuICAgIH1cbiAgICAvLyBGb3JjZSBjb2Vyc2lvbiB0byB1aW50MzIuIFRoaXMgd2lsbCBhbHNvIGNvZXJjZSBmYWxzZXkvTmFOIHZhbHVlcyB0byAwLlxuICAgIGVuZCA+Pj49IDA7XG4gICAgc3RhcnQgPj4+PSAwO1xuICAgIGlmIChlbmQgPD0gc3RhcnQpIHtcbiAgICAgICAgcmV0dXJuICcnO1xuICAgIH1cbiAgICBpZiAoIWVuY29kaW5nKVxuICAgICAgICBlbmNvZGluZyA9ICd1dGY4JztcbiAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICBzd2l0Y2ggKGVuY29kaW5nKSB7XG4gICAgICAgICAgICBjYXNlICdoZXgnOlxuICAgICAgICAgICAgICAgIHJldHVybiBoZXhTbGljZSh0aGlzLCBzdGFydCwgZW5kKTtcbiAgICAgICAgICAgIGNhc2UgJ3V0ZjgnOlxuICAgICAgICAgICAgY2FzZSAndXRmLTgnOlxuICAgICAgICAgICAgICAgIHJldHVybiB1dGY4U2xpY2UodGhpcywgc3RhcnQsIGVuZCk7XG4gICAgICAgICAgICBjYXNlICdhc2NpaSc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFzY2lpU2xpY2UodGhpcywgc3RhcnQsIGVuZCk7XG4gICAgICAgICAgICBjYXNlICdsYXRpbjEnOlxuICAgICAgICAgICAgY2FzZSAnYmluYXJ5JzpcbiAgICAgICAgICAgICAgICByZXR1cm4gbGF0aW4xU2xpY2UodGhpcywgc3RhcnQsIGVuZCk7XG4gICAgICAgICAgICBjYXNlICdiYXNlNjQnOlxuICAgICAgICAgICAgICAgIHJldHVybiBiYXNlNjRTbGljZSh0aGlzLCBzdGFydCwgZW5kKTtcbiAgICAgICAgICAgIGNhc2UgJ3VjczInOlxuICAgICAgICAgICAgY2FzZSAndWNzLTInOlxuICAgICAgICAgICAgY2FzZSAndXRmMTZsZSc6XG4gICAgICAgICAgICBjYXNlICd1dGYtMTZsZSc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHV0ZjE2bGVTbGljZSh0aGlzLCBzdGFydCwgZW5kKTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgaWYgKGxvd2VyZWRDYXNlKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdVbmtub3duIGVuY29kaW5nOiAnICsgZW5jb2RpbmcpO1xuICAgICAgICAgICAgICAgIGVuY29kaW5nID0gKGVuY29kaW5nICsgJycpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgbG93ZXJlZENhc2UgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfVxufVxuLy8gVGhlIHByb3BlcnR5IGlzIHVzZWQgYnkgYEJ1ZmZlci5pc0J1ZmZlcmAgYW5kIGBpcy1idWZmZXJgIChpbiBTYWZhcmkgNS03KSB0byBkZXRlY3Rcbi8vIEJ1ZmZlciBpbnN0YW5jZXMuXG5CdWZmZXIucHJvdG90eXBlLl9pc0J1ZmZlciA9IHRydWU7XG5mdW5jdGlvbiBzd2FwKGIsIG4sIG0pIHtcbiAgICB2YXIgaSA9IGJbbl07XG4gICAgYltuXSA9IGJbbV07XG4gICAgYlttXSA9IGk7XG59XG5CdWZmZXIucHJvdG90eXBlLnN3YXAxNiA9IGZ1bmN0aW9uIHN3YXAxNigpIHtcbiAgICB2YXIgbGVuID0gdGhpcy5sZW5ndGg7XG4gICAgaWYgKGxlbiAlIDIgIT09IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ0J1ZmZlciBzaXplIG11c3QgYmUgYSBtdWx0aXBsZSBvZiAxNi1iaXRzJyk7XG4gICAgfVxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpICs9IDIpIHtcbiAgICAgICAgc3dhcCh0aGlzLCBpLCBpICsgMSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xufTtcbkJ1ZmZlci5wcm90b3R5cGUuc3dhcDMyID0gZnVuY3Rpb24gc3dhcDMyKCkge1xuICAgIHZhciBsZW4gPSB0aGlzLmxlbmd0aDtcbiAgICBpZiAobGVuICUgNCAhPT0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignQnVmZmVyIHNpemUgbXVzdCBiZSBhIG11bHRpcGxlIG9mIDMyLWJpdHMnKTtcbiAgICB9XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkgKz0gNCkge1xuICAgICAgICBzd2FwKHRoaXMsIGksIGkgKyAzKTtcbiAgICAgICAgc3dhcCh0aGlzLCBpICsgMSwgaSArIDIpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbn07XG5CdWZmZXIucHJvdG90eXBlLnN3YXA2NCA9IGZ1bmN0aW9uIHN3YXA2NCgpIHtcbiAgICB2YXIgbGVuID0gdGhpcy5sZW5ndGg7XG4gICAgaWYgKGxlbiAlIDggIT09IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ0J1ZmZlciBzaXplIG11c3QgYmUgYSBtdWx0aXBsZSBvZiA2NC1iaXRzJyk7XG4gICAgfVxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpICs9IDgpIHtcbiAgICAgICAgc3dhcCh0aGlzLCBpLCBpICsgNyk7XG4gICAgICAgIHN3YXAodGhpcywgaSArIDEsIGkgKyA2KTtcbiAgICAgICAgc3dhcCh0aGlzLCBpICsgMiwgaSArIDUpO1xuICAgICAgICBzd2FwKHRoaXMsIGkgKyAzLCBpICsgNCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xufTtcbkJ1ZmZlci5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiB0b1N0cmluZygpIHtcbiAgICB2YXIgbGVuZ3RoID0gdGhpcy5sZW5ndGggfCAwO1xuICAgIGlmIChsZW5ndGggPT09IDApXG4gICAgICAgIHJldHVybiAnJztcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMClcbiAgICAgICAgcmV0dXJuIHV0ZjhTbGljZSh0aGlzLCAwLCBsZW5ndGgpO1xuICAgIHJldHVybiBzbG93VG9TdHJpbmcuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbn07XG5CdWZmZXIucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uIGVxdWFscyhiKSB7XG4gICAgaWYgKCFCdWZmZXIuaXNCdWZmZXIoYikpXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0FyZ3VtZW50IG11c3QgYmUgYSBCdWZmZXInKTtcbiAgICBpZiAodGhpcyA9PT0gYilcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgcmV0dXJuIEJ1ZmZlci5jb21wYXJlKHRoaXMsIGIpID09PSAwO1xufTtcbkJ1ZmZlci5wcm90b3R5cGUuaW5zcGVjdCA9IGZ1bmN0aW9uIGluc3BlY3QoKSB7XG4gICAgdmFyIHN0ciA9ICcnO1xuICAgIHZhciBtYXggPSBleHBvcnRzLklOU1BFQ1RfTUFYX0JZVEVTO1xuICAgIGlmICh0aGlzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgc3RyID0gdGhpcy50b1N0cmluZygnaGV4JywgMCwgbWF4KS5tYXRjaCgvLnsyfS9nKS5qb2luKCcgJyk7XG4gICAgICAgIGlmICh0aGlzLmxlbmd0aCA+IG1heClcbiAgICAgICAgICAgIHN0ciArPSAnIC4uLiAnO1xuICAgIH1cbiAgICByZXR1cm4gJzxCdWZmZXIgJyArIHN0ciArICc+Jztcbn07XG5CdWZmZXIucHJvdG90eXBlLmNvbXBhcmUgPSBmdW5jdGlvbiBjb21wYXJlKHRhcmdldCwgc3RhcnQsIGVuZCwgdGhpc1N0YXJ0LCB0aGlzRW5kKSB7XG4gICAgaWYgKCFCdWZmZXIuaXNCdWZmZXIodGFyZ2V0KSkge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdBcmd1bWVudCBtdXN0IGJlIGEgQnVmZmVyJyk7XG4gICAgfVxuICAgIGlmIChzdGFydCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHN0YXJ0ID0gMDtcbiAgICB9XG4gICAgaWYgKGVuZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGVuZCA9IHRhcmdldCA/IHRhcmdldC5sZW5ndGggOiAwO1xuICAgIH1cbiAgICBpZiAodGhpc1N0YXJ0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhpc1N0YXJ0ID0gMDtcbiAgICB9XG4gICAgaWYgKHRoaXNFbmQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzRW5kID0gdGhpcy5sZW5ndGg7XG4gICAgfVxuICAgIGlmIChzdGFydCA8IDAgfHwgZW5kID4gdGFyZ2V0Lmxlbmd0aCB8fCB0aGlzU3RhcnQgPCAwIHx8IHRoaXNFbmQgPiB0aGlzLmxlbmd0aCkge1xuICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignb3V0IG9mIHJhbmdlIGluZGV4Jyk7XG4gICAgfVxuICAgIGlmICh0aGlzU3RhcnQgPj0gdGhpc0VuZCAmJiBzdGFydCA+PSBlbmQpIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICAgIGlmICh0aGlzU3RhcnQgPj0gdGhpc0VuZCkge1xuICAgICAgICByZXR1cm4gLTE7XG4gICAgfVxuICAgIGlmIChzdGFydCA+PSBlbmQpIHtcbiAgICAgICAgcmV0dXJuIDE7XG4gICAgfVxuICAgIHN0YXJ0ID4+Pj0gMDtcbiAgICBlbmQgPj4+PSAwO1xuICAgIHRoaXNTdGFydCA+Pj49IDA7XG4gICAgdGhpc0VuZCA+Pj49IDA7XG4gICAgaWYgKHRoaXMgPT09IHRhcmdldClcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgdmFyIHggPSB0aGlzRW5kIC0gdGhpc1N0YXJ0O1xuICAgIHZhciB5ID0gZW5kIC0gc3RhcnQ7XG4gICAgdmFyIGxlbiA9IE1hdGgubWluKHgsIHkpO1xuICAgIHZhciB0aGlzQ29weSA9IHRoaXMuc2xpY2UodGhpc1N0YXJ0LCB0aGlzRW5kKTtcbiAgICB2YXIgdGFyZ2V0Q29weSA9IHRhcmdldC5zbGljZShzdGFydCwgZW5kKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgKytpKSB7XG4gICAgICAgIGlmICh0aGlzQ29weVtpXSAhPT0gdGFyZ2V0Q29weVtpXSkge1xuICAgICAgICAgICAgeCA9IHRoaXNDb3B5W2ldO1xuICAgICAgICAgICAgeSA9IHRhcmdldENvcHlbaV07XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoeCA8IHkpXG4gICAgICAgIHJldHVybiAtMTtcbiAgICBpZiAoeSA8IHgpXG4gICAgICAgIHJldHVybiAxO1xuICAgIHJldHVybiAwO1xufTtcbi8vIEZpbmRzIGVpdGhlciB0aGUgZmlyc3QgaW5kZXggb2YgYHZhbGAgaW4gYGJ1ZmZlcmAgYXQgb2Zmc2V0ID49IGBieXRlT2Zmc2V0YCxcbi8vIE9SIHRoZSBsYXN0IGluZGV4IG9mIGB2YWxgIGluIGBidWZmZXJgIGF0IG9mZnNldCA8PSBgYnl0ZU9mZnNldGAuXG4vL1xuLy8gQXJndW1lbnRzOlxuLy8gLSBidWZmZXIgLSBhIEJ1ZmZlciB0byBzZWFyY2hcbi8vIC0gdmFsIC0gYSBzdHJpbmcsIEJ1ZmZlciwgb3IgbnVtYmVyXG4vLyAtIGJ5dGVPZmZzZXQgLSBhbiBpbmRleCBpbnRvIGBidWZmZXJgOyB3aWxsIGJlIGNsYW1wZWQgdG8gYW4gaW50MzJcbi8vIC0gZW5jb2RpbmcgLSBhbiBvcHRpb25hbCBlbmNvZGluZywgcmVsZXZhbnQgaXMgdmFsIGlzIGEgc3RyaW5nXG4vLyAtIGRpciAtIHRydWUgZm9yIGluZGV4T2YsIGZhbHNlIGZvciBsYXN0SW5kZXhPZlxuZnVuY3Rpb24gYmlkaXJlY3Rpb25hbEluZGV4T2YoYnVmZmVyLCB2YWwsIGJ5dGVPZmZzZXQsIGVuY29kaW5nLCBkaXIpIHtcbiAgICAvLyBFbXB0eSBidWZmZXIgbWVhbnMgbm8gbWF0Y2hcbiAgICBpZiAoYnVmZmVyLmxlbmd0aCA9PT0gMClcbiAgICAgICAgcmV0dXJuIC0xO1xuICAgIC8vIE5vcm1hbGl6ZSBieXRlT2Zmc2V0XG4gICAgaWYgKHR5cGVvZiBieXRlT2Zmc2V0ID09PSAnc3RyaW5nJykge1xuICAgICAgICBlbmNvZGluZyA9IGJ5dGVPZmZzZXQ7XG4gICAgICAgIGJ5dGVPZmZzZXQgPSAwO1xuICAgIH1cbiAgICBlbHNlIGlmIChieXRlT2Zmc2V0ID4gMHg3ZmZmZmZmZikge1xuICAgICAgICBieXRlT2Zmc2V0ID0gMHg3ZmZmZmZmZjtcbiAgICB9XG4gICAgZWxzZSBpZiAoYnl0ZU9mZnNldCA8IC0weDgwMDAwMDAwKSB7XG4gICAgICAgIGJ5dGVPZmZzZXQgPSAtMHg4MDAwMDAwMDtcbiAgICB9XG4gICAgYnl0ZU9mZnNldCA9ICtieXRlT2Zmc2V0OyAvLyBDb2VyY2UgdG8gTnVtYmVyLlxuICAgIGlmIChpc05hTihieXRlT2Zmc2V0KSkge1xuICAgICAgICAvLyBieXRlT2Zmc2V0OiBpdCBpdCdzIHVuZGVmaW5lZCwgbnVsbCwgTmFOLCBcImZvb1wiLCBldGMsIHNlYXJjaCB3aG9sZSBidWZmZXJcbiAgICAgICAgYnl0ZU9mZnNldCA9IGRpciA/IDAgOiAoYnVmZmVyLmxlbmd0aCAtIDEpO1xuICAgIH1cbiAgICAvLyBOb3JtYWxpemUgYnl0ZU9mZnNldDogbmVnYXRpdmUgb2Zmc2V0cyBzdGFydCBmcm9tIHRoZSBlbmQgb2YgdGhlIGJ1ZmZlclxuICAgIGlmIChieXRlT2Zmc2V0IDwgMClcbiAgICAgICAgYnl0ZU9mZnNldCA9IGJ1ZmZlci5sZW5ndGggKyBieXRlT2Zmc2V0O1xuICAgIGlmIChieXRlT2Zmc2V0ID49IGJ1ZmZlci5sZW5ndGgpIHtcbiAgICAgICAgaWYgKGRpcilcbiAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgYnl0ZU9mZnNldCA9IGJ1ZmZlci5sZW5ndGggLSAxO1xuICAgIH1cbiAgICBlbHNlIGlmIChieXRlT2Zmc2V0IDwgMCkge1xuICAgICAgICBpZiAoZGlyKVxuICAgICAgICAgICAgYnl0ZU9mZnNldCA9IDA7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICB9XG4gICAgLy8gTm9ybWFsaXplIHZhbFxuICAgIGlmICh0eXBlb2YgdmFsID09PSAnc3RyaW5nJykge1xuICAgICAgICB2YWwgPSBCdWZmZXIuZnJvbSh2YWwsIGVuY29kaW5nKTtcbiAgICB9XG4gICAgLy8gRmluYWxseSwgc2VhcmNoIGVpdGhlciBpbmRleE9mIChpZiBkaXIgaXMgdHJ1ZSkgb3IgbGFzdEluZGV4T2ZcbiAgICBpZiAoQnVmZmVyLmlzQnVmZmVyKHZhbCkpIHtcbiAgICAgICAgLy8gU3BlY2lhbCBjYXNlOiBsb29raW5nIGZvciBlbXB0eSBzdHJpbmcvYnVmZmVyIGFsd2F5cyBmYWlsc1xuICAgICAgICBpZiAodmFsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhcnJheUluZGV4T2YoYnVmZmVyLCB2YWwsIGJ5dGVPZmZzZXQsIGVuY29kaW5nLCBkaXIpO1xuICAgIH1cbiAgICBlbHNlIGlmICh0eXBlb2YgdmFsID09PSAnbnVtYmVyJykge1xuICAgICAgICB2YWwgPSB2YWwgJiAweEZGOyAvLyBTZWFyY2ggZm9yIGEgYnl0ZSB2YWx1ZSBbMC0yNTVdXG4gICAgICAgIGlmIChCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCAmJlxuICAgICAgICAgICAgdHlwZW9mIFVpbnQ4QXJyYXkucHJvdG90eXBlLmluZGV4T2YgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIGlmIChkaXIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gVWludDhBcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKGJ1ZmZlciwgdmFsLCBieXRlT2Zmc2V0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBVaW50OEFycmF5LnByb3RvdHlwZS5sYXN0SW5kZXhPZi5jYWxsKGJ1ZmZlciwgdmFsLCBieXRlT2Zmc2V0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXJyYXlJbmRleE9mKGJ1ZmZlciwgW3ZhbF0sIGJ5dGVPZmZzZXQsIGVuY29kaW5nLCBkaXIpO1xuICAgIH1cbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCd2YWwgbXVzdCBiZSBzdHJpbmcsIG51bWJlciBvciBCdWZmZXInKTtcbn1cbmZ1bmN0aW9uIGFycmF5SW5kZXhPZihhcnIsIHZhbCwgYnl0ZU9mZnNldCwgZW5jb2RpbmcsIGRpcikge1xuICAgIHZhciBpbmRleFNpemUgPSAxO1xuICAgIHZhciBhcnJMZW5ndGggPSBhcnIubGVuZ3RoO1xuICAgIHZhciB2YWxMZW5ndGggPSB2YWwubGVuZ3RoO1xuICAgIGlmIChlbmNvZGluZyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGVuY29kaW5nID0gU3RyaW5nKGVuY29kaW5nKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBpZiAoZW5jb2RpbmcgPT09ICd1Y3MyJyB8fCBlbmNvZGluZyA9PT0gJ3Vjcy0yJyB8fFxuICAgICAgICAgICAgZW5jb2RpbmcgPT09ICd1dGYxNmxlJyB8fCBlbmNvZGluZyA9PT0gJ3V0Zi0xNmxlJykge1xuICAgICAgICAgICAgaWYgKGFyci5sZW5ndGggPCAyIHx8IHZhbC5sZW5ndGggPCAyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaW5kZXhTaXplID0gMjtcbiAgICAgICAgICAgIGFyckxlbmd0aCAvPSAyO1xuICAgICAgICAgICAgdmFsTGVuZ3RoIC89IDI7XG4gICAgICAgICAgICBieXRlT2Zmc2V0IC89IDI7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZnVuY3Rpb24gcmVhZChidWYsIGkpIHtcbiAgICAgICAgaWYgKGluZGV4U2l6ZSA9PT0gMSkge1xuICAgICAgICAgICAgcmV0dXJuIGJ1ZltpXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBidWYucmVhZFVJbnQxNkJFKGkgKiBpbmRleFNpemUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHZhciBpO1xuICAgIGlmIChkaXIpIHtcbiAgICAgICAgdmFyIGZvdW5kSW5kZXggPSAtMTtcbiAgICAgICAgZm9yIChpID0gYnl0ZU9mZnNldDsgaSA8IGFyckxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAocmVhZChhcnIsIGkpID09PSByZWFkKHZhbCwgZm91bmRJbmRleCA9PT0gLTEgPyAwIDogaSAtIGZvdW5kSW5kZXgpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGZvdW5kSW5kZXggPT09IC0xKVxuICAgICAgICAgICAgICAgICAgICBmb3VuZEluZGV4ID0gaTtcbiAgICAgICAgICAgICAgICBpZiAoaSAtIGZvdW5kSW5kZXggKyAxID09PSB2YWxMZW5ndGgpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmb3VuZEluZGV4ICogaW5kZXhTaXplO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGZvdW5kSW5kZXggIT09IC0xKVxuICAgICAgICAgICAgICAgICAgICBpIC09IGkgLSBmb3VuZEluZGV4O1xuICAgICAgICAgICAgICAgIGZvdW5kSW5kZXggPSAtMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKGJ5dGVPZmZzZXQgKyB2YWxMZW5ndGggPiBhcnJMZW5ndGgpXG4gICAgICAgICAgICBieXRlT2Zmc2V0ID0gYXJyTGVuZ3RoIC0gdmFsTGVuZ3RoO1xuICAgICAgICBmb3IgKGkgPSBieXRlT2Zmc2V0OyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgdmFyIGZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgdmFsTGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICBpZiAocmVhZChhcnIsIGkgKyBqKSAhPT0gcmVhZCh2YWwsIGopKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvdW5kID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChmb3VuZClcbiAgICAgICAgICAgICAgICByZXR1cm4gaTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gLTE7XG59XG5CdWZmZXIucHJvdG90eXBlLmluY2x1ZGVzID0gZnVuY3Rpb24gaW5jbHVkZXModmFsLCBieXRlT2Zmc2V0LCBlbmNvZGluZykge1xuICAgIHJldHVybiB0aGlzLmluZGV4T2YodmFsLCBieXRlT2Zmc2V0LCBlbmNvZGluZykgIT09IC0xO1xufTtcbkJ1ZmZlci5wcm90b3R5cGUuaW5kZXhPZiA9IGZ1bmN0aW9uIGluZGV4T2YodmFsLCBieXRlT2Zmc2V0LCBlbmNvZGluZykge1xuICAgIHJldHVybiBiaWRpcmVjdGlvbmFsSW5kZXhPZih0aGlzLCB2YWwsIGJ5dGVPZmZzZXQsIGVuY29kaW5nLCB0cnVlKTtcbn07XG5CdWZmZXIucHJvdG90eXBlLmxhc3RJbmRleE9mID0gZnVuY3Rpb24gbGFzdEluZGV4T2YodmFsLCBieXRlT2Zmc2V0LCBlbmNvZGluZykge1xuICAgIHJldHVybiBiaWRpcmVjdGlvbmFsSW5kZXhPZih0aGlzLCB2YWwsIGJ5dGVPZmZzZXQsIGVuY29kaW5nLCBmYWxzZSk7XG59O1xuZnVuY3Rpb24gaGV4V3JpdGUoYnVmLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKSB7XG4gICAgb2Zmc2V0ID0gTnVtYmVyKG9mZnNldCkgfHwgMDtcbiAgICB2YXIgcmVtYWluaW5nID0gYnVmLmxlbmd0aCAtIG9mZnNldDtcbiAgICBpZiAoIWxlbmd0aCkge1xuICAgICAgICBsZW5ndGggPSByZW1haW5pbmc7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBsZW5ndGggPSBOdW1iZXIobGVuZ3RoKTtcbiAgICAgICAgaWYgKGxlbmd0aCA+IHJlbWFpbmluZykge1xuICAgICAgICAgICAgbGVuZ3RoID0gcmVtYWluaW5nO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIG11c3QgYmUgYW4gZXZlbiBudW1iZXIgb2YgZGlnaXRzXG4gICAgdmFyIHN0ckxlbiA9IHN0cmluZy5sZW5ndGg7XG4gICAgaWYgKHN0ckxlbiAlIDIgIT09IDApXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0ludmFsaWQgaGV4IHN0cmluZycpO1xuICAgIGlmIChsZW5ndGggPiBzdHJMZW4gLyAyKSB7XG4gICAgICAgIGxlbmd0aCA9IHN0ckxlbiAvIDI7XG4gICAgfVxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHtcbiAgICAgICAgdmFyIHBhcnNlZCA9IHBhcnNlSW50KHN0cmluZy5zdWJzdHIoaSAqIDIsIDIpLCAxNik7XG4gICAgICAgIGlmIChpc05hTihwYXJzZWQpKVxuICAgICAgICAgICAgcmV0dXJuIGk7XG4gICAgICAgIGJ1ZltvZmZzZXQgKyBpXSA9IHBhcnNlZDtcbiAgICB9XG4gICAgcmV0dXJuIGk7XG59XG5mdW5jdGlvbiB1dGY4V3JpdGUoYnVmLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKSB7XG4gICAgcmV0dXJuIGJsaXRCdWZmZXIodXRmOFRvQnl0ZXMoc3RyaW5nLCBidWYubGVuZ3RoIC0gb2Zmc2V0KSwgYnVmLCBvZmZzZXQsIGxlbmd0aCk7XG59XG5mdW5jdGlvbiBhc2NpaVdyaXRlKGJ1Ziwgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCkge1xuICAgIHJldHVybiBibGl0QnVmZmVyKGFzY2lpVG9CeXRlcyhzdHJpbmcpLCBidWYsIG9mZnNldCwgbGVuZ3RoKTtcbn1cbmZ1bmN0aW9uIGxhdGluMVdyaXRlKGJ1Ziwgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCkge1xuICAgIHJldHVybiBhc2NpaVdyaXRlKGJ1Ziwgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCk7XG59XG5mdW5jdGlvbiBiYXNlNjRXcml0ZShidWYsIHN0cmluZywgb2Zmc2V0LCBsZW5ndGgpIHtcbiAgICByZXR1cm4gYmxpdEJ1ZmZlcihiYXNlNjRUb0J5dGVzKHN0cmluZyksIGJ1Ziwgb2Zmc2V0LCBsZW5ndGgpO1xufVxuZnVuY3Rpb24gdWNzMldyaXRlKGJ1Ziwgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCkge1xuICAgIHJldHVybiBibGl0QnVmZmVyKHV0ZjE2bGVUb0J5dGVzKHN0cmluZywgYnVmLmxlbmd0aCAtIG9mZnNldCksIGJ1Ziwgb2Zmc2V0LCBsZW5ndGgpO1xufVxuQnVmZmVyLnByb3RvdHlwZS53cml0ZSA9IGZ1bmN0aW9uIHdyaXRlKHN0cmluZywgb2Zmc2V0LCBsZW5ndGgsIGVuY29kaW5nKSB7XG4gICAgLy8gQnVmZmVyI3dyaXRlKHN0cmluZylcbiAgICBpZiAob2Zmc2V0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgZW5jb2RpbmcgPSAndXRmOCc7XG4gICAgICAgIGxlbmd0aCA9IHRoaXMubGVuZ3RoO1xuICAgICAgICBvZmZzZXQgPSAwO1xuICAgICAgICAvLyBCdWZmZXIjd3JpdGUoc3RyaW5nLCBlbmNvZGluZylcbiAgICB9XG4gICAgZWxzZSBpZiAobGVuZ3RoID09PSB1bmRlZmluZWQgJiYgdHlwZW9mIG9mZnNldCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgZW5jb2RpbmcgPSBvZmZzZXQ7XG4gICAgICAgIGxlbmd0aCA9IHRoaXMubGVuZ3RoO1xuICAgICAgICBvZmZzZXQgPSAwO1xuICAgICAgICAvLyBCdWZmZXIjd3JpdGUoc3RyaW5nLCBvZmZzZXRbLCBsZW5ndGhdWywgZW5jb2RpbmddKVxuICAgIH1cbiAgICBlbHNlIGlmIChpc0Zpbml0ZShvZmZzZXQpKSB7XG4gICAgICAgIG9mZnNldCA9IG9mZnNldCB8IDA7XG4gICAgICAgIGlmIChpc0Zpbml0ZShsZW5ndGgpKSB7XG4gICAgICAgICAgICBsZW5ndGggPSBsZW5ndGggfCAwO1xuICAgICAgICAgICAgaWYgKGVuY29kaW5nID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgZW5jb2RpbmcgPSAndXRmOCc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBlbmNvZGluZyA9IGxlbmd0aDtcbiAgICAgICAgICAgIGxlbmd0aCA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICAvLyBsZWdhY3kgd3JpdGUoc3RyaW5nLCBlbmNvZGluZywgb2Zmc2V0LCBsZW5ndGgpIC0gcmVtb3ZlIGluIHYwLjEzXG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0J1ZmZlci53cml0ZShzdHJpbmcsIGVuY29kaW5nLCBvZmZzZXRbLCBsZW5ndGhdKSBpcyBubyBsb25nZXIgc3VwcG9ydGVkJyk7XG4gICAgfVxuICAgIHZhciByZW1haW5pbmcgPSB0aGlzLmxlbmd0aCAtIG9mZnNldDtcbiAgICBpZiAobGVuZ3RoID09PSB1bmRlZmluZWQgfHwgbGVuZ3RoID4gcmVtYWluaW5nKVxuICAgICAgICBsZW5ndGggPSByZW1haW5pbmc7XG4gICAgaWYgKChzdHJpbmcubGVuZ3RoID4gMCAmJiAobGVuZ3RoIDwgMCB8fCBvZmZzZXQgPCAwKSkgfHwgb2Zmc2V0ID4gdGhpcy5sZW5ndGgpIHtcbiAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ0F0dGVtcHQgdG8gd3JpdGUgb3V0c2lkZSBidWZmZXIgYm91bmRzJyk7XG4gICAgfVxuICAgIGlmICghZW5jb2RpbmcpXG4gICAgICAgIGVuY29kaW5nID0gJ3V0ZjgnO1xuICAgIHZhciBsb3dlcmVkQ2FzZSA9IGZhbHNlO1xuICAgIGZvciAoOzspIHtcbiAgICAgICAgc3dpdGNoIChlbmNvZGluZykge1xuICAgICAgICAgICAgY2FzZSAnaGV4JzpcbiAgICAgICAgICAgICAgICByZXR1cm4gaGV4V3JpdGUodGhpcywgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCk7XG4gICAgICAgICAgICBjYXNlICd1dGY4JzpcbiAgICAgICAgICAgIGNhc2UgJ3V0Zi04JzpcbiAgICAgICAgICAgICAgICByZXR1cm4gdXRmOFdyaXRlKHRoaXMsIHN0cmluZywgb2Zmc2V0LCBsZW5ndGgpO1xuICAgICAgICAgICAgY2FzZSAnYXNjaWknOlxuICAgICAgICAgICAgICAgIHJldHVybiBhc2NpaVdyaXRlKHRoaXMsIHN0cmluZywgb2Zmc2V0LCBsZW5ndGgpO1xuICAgICAgICAgICAgY2FzZSAnbGF0aW4xJzpcbiAgICAgICAgICAgIGNhc2UgJ2JpbmFyeSc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxhdGluMVdyaXRlKHRoaXMsIHN0cmluZywgb2Zmc2V0LCBsZW5ndGgpO1xuICAgICAgICAgICAgY2FzZSAnYmFzZTY0JzpcbiAgICAgICAgICAgICAgICAvLyBXYXJuaW5nOiBtYXhMZW5ndGggbm90IHRha2VuIGludG8gYWNjb3VudCBpbiBiYXNlNjRXcml0ZVxuICAgICAgICAgICAgICAgIHJldHVybiBiYXNlNjRXcml0ZSh0aGlzLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKTtcbiAgICAgICAgICAgIGNhc2UgJ3VjczInOlxuICAgICAgICAgICAgY2FzZSAndWNzLTInOlxuICAgICAgICAgICAgY2FzZSAndXRmMTZsZSc6XG4gICAgICAgICAgICBjYXNlICd1dGYtMTZsZSc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVjczJXcml0ZSh0aGlzLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgaWYgKGxvd2VyZWRDYXNlKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdVbmtub3duIGVuY29kaW5nOiAnICsgZW5jb2RpbmcpO1xuICAgICAgICAgICAgICAgIGVuY29kaW5nID0gKCcnICsgZW5jb2RpbmcpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgbG93ZXJlZENhc2UgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfVxufTtcbkJ1ZmZlci5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gdG9KU09OKCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6ICdCdWZmZXInLFxuICAgICAgICBkYXRhOiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbCh0aGlzLl9hcnIgfHwgdGhpcywgMClcbiAgICB9O1xufTtcbmZ1bmN0aW9uIGJhc2U2NFNsaWNlKGJ1Ziwgc3RhcnQsIGVuZCkge1xuICAgIGlmIChzdGFydCA9PT0gMCAmJiBlbmQgPT09IGJ1Zi5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIGJhc2U2NC5mcm9tQnl0ZUFycmF5KGJ1Zik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gYmFzZTY0LmZyb21CeXRlQXJyYXkoYnVmLnNsaWNlKHN0YXJ0LCBlbmQpKTtcbiAgICB9XG59XG5mdW5jdGlvbiB1dGY4U2xpY2UoYnVmLCBzdGFydCwgZW5kKSB7XG4gICAgZW5kID0gTWF0aC5taW4oYnVmLmxlbmd0aCwgZW5kKTtcbiAgICB2YXIgcmVzID0gW107XG4gICAgdmFyIGkgPSBzdGFydDtcbiAgICB3aGlsZSAoaSA8IGVuZCkge1xuICAgICAgICB2YXIgZmlyc3RCeXRlID0gYnVmW2ldO1xuICAgICAgICB2YXIgY29kZVBvaW50ID0gbnVsbDtcbiAgICAgICAgdmFyIGJ5dGVzUGVyU2VxdWVuY2UgPSAoZmlyc3RCeXRlID4gMHhFRikgPyA0XG4gICAgICAgICAgICA6IChmaXJzdEJ5dGUgPiAweERGKSA/IDNcbiAgICAgICAgICAgICAgICA6IChmaXJzdEJ5dGUgPiAweEJGKSA/IDJcbiAgICAgICAgICAgICAgICAgICAgOiAxO1xuICAgICAgICBpZiAoaSArIGJ5dGVzUGVyU2VxdWVuY2UgPD0gZW5kKSB7XG4gICAgICAgICAgICB2YXIgc2Vjb25kQnl0ZSwgdGhpcmRCeXRlLCBmb3VydGhCeXRlLCB0ZW1wQ29kZVBvaW50O1xuICAgICAgICAgICAgc3dpdGNoIChieXRlc1BlclNlcXVlbmNlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICBpZiAoZmlyc3RCeXRlIDwgMHg4MCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29kZVBvaW50ID0gZmlyc3RCeXRlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgc2Vjb25kQnl0ZSA9IGJ1ZltpICsgMV07XG4gICAgICAgICAgICAgICAgICAgIGlmICgoc2Vjb25kQnl0ZSAmIDB4QzApID09PSAweDgwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wQ29kZVBvaW50ID0gKGZpcnN0Qnl0ZSAmIDB4MUYpIDw8IDB4NiB8IChzZWNvbmRCeXRlICYgMHgzRik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGVtcENvZGVQb2ludCA+IDB4N0YpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlUG9pbnQgPSB0ZW1wQ29kZVBvaW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgc2Vjb25kQnl0ZSA9IGJ1ZltpICsgMV07XG4gICAgICAgICAgICAgICAgICAgIHRoaXJkQnl0ZSA9IGJ1ZltpICsgMl07XG4gICAgICAgICAgICAgICAgICAgIGlmICgoc2Vjb25kQnl0ZSAmIDB4QzApID09PSAweDgwICYmICh0aGlyZEJ5dGUgJiAweEMwKSA9PT0gMHg4MCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcENvZGVQb2ludCA9IChmaXJzdEJ5dGUgJiAweEYpIDw8IDB4QyB8IChzZWNvbmRCeXRlICYgMHgzRikgPDwgMHg2IHwgKHRoaXJkQnl0ZSAmIDB4M0YpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRlbXBDb2RlUG9pbnQgPiAweDdGRiAmJiAodGVtcENvZGVQb2ludCA8IDB4RDgwMCB8fCB0ZW1wQ29kZVBvaW50ID4gMHhERkZGKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGVQb2ludCA9IHRlbXBDb2RlUG9pbnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICBzZWNvbmRCeXRlID0gYnVmW2kgKyAxXTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcmRCeXRlID0gYnVmW2kgKyAyXTtcbiAgICAgICAgICAgICAgICAgICAgZm91cnRoQnl0ZSA9IGJ1ZltpICsgM107XG4gICAgICAgICAgICAgICAgICAgIGlmICgoc2Vjb25kQnl0ZSAmIDB4QzApID09PSAweDgwICYmICh0aGlyZEJ5dGUgJiAweEMwKSA9PT0gMHg4MCAmJiAoZm91cnRoQnl0ZSAmIDB4QzApID09PSAweDgwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wQ29kZVBvaW50ID0gKGZpcnN0Qnl0ZSAmIDB4RikgPDwgMHgxMiB8IChzZWNvbmRCeXRlICYgMHgzRikgPDwgMHhDIHwgKHRoaXJkQnl0ZSAmIDB4M0YpIDw8IDB4NiB8IChmb3VydGhCeXRlICYgMHgzRik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGVtcENvZGVQb2ludCA+IDB4RkZGRiAmJiB0ZW1wQ29kZVBvaW50IDwgMHgxMTAwMDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlUG9pbnQgPSB0ZW1wQ29kZVBvaW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvZGVQb2ludCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgLy8gd2UgZGlkIG5vdCBnZW5lcmF0ZSBhIHZhbGlkIGNvZGVQb2ludCBzbyBpbnNlcnQgYVxuICAgICAgICAgICAgLy8gcmVwbGFjZW1lbnQgY2hhciAoVStGRkZEKSBhbmQgYWR2YW5jZSBvbmx5IDEgYnl0ZVxuICAgICAgICAgICAgY29kZVBvaW50ID0gMHhGRkZEO1xuICAgICAgICAgICAgYnl0ZXNQZXJTZXF1ZW5jZSA9IDE7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29kZVBvaW50ID4gMHhGRkZGKSB7XG4gICAgICAgICAgICAvLyBlbmNvZGUgdG8gdXRmMTYgKHN1cnJvZ2F0ZSBwYWlyIGRhbmNlKVxuICAgICAgICAgICAgY29kZVBvaW50IC09IDB4MTAwMDA7XG4gICAgICAgICAgICByZXMucHVzaChjb2RlUG9pbnQgPj4+IDEwICYgMHgzRkYgfCAweEQ4MDApO1xuICAgICAgICAgICAgY29kZVBvaW50ID0gMHhEQzAwIHwgY29kZVBvaW50ICYgMHgzRkY7XG4gICAgICAgIH1cbiAgICAgICAgcmVzLnB1c2goY29kZVBvaW50KTtcbiAgICAgICAgaSArPSBieXRlc1BlclNlcXVlbmNlO1xuICAgIH1cbiAgICByZXR1cm4gZGVjb2RlQ29kZVBvaW50c0FycmF5KHJlcyk7XG59XG4vLyBCYXNlZCBvbiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8yMjc0NzI3Mi82ODA3NDIsIHRoZSBicm93c2VyIHdpdGhcbi8vIHRoZSBsb3dlc3QgbGltaXQgaXMgQ2hyb21lLCB3aXRoIDB4MTAwMDAgYXJncy5cbi8vIFdlIGdvIDEgbWFnbml0dWRlIGxlc3MsIGZvciBzYWZldHlcbnZhciBNQVhfQVJHVU1FTlRTX0xFTkdUSCA9IDB4MTAwMDtcbmZ1bmN0aW9uIGRlY29kZUNvZGVQb2ludHNBcnJheShjb2RlUG9pbnRzKSB7XG4gICAgdmFyIGxlbiA9IGNvZGVQb2ludHMubGVuZ3RoO1xuICAgIGlmIChsZW4gPD0gTUFYX0FSR1VNRU5UU19MRU5HVEgpIHtcbiAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkoU3RyaW5nLCBjb2RlUG9pbnRzKTsgLy8gYXZvaWQgZXh0cmEgc2xpY2UoKVxuICAgIH1cbiAgICAvLyBEZWNvZGUgaW4gY2h1bmtzIHRvIGF2b2lkIFwiY2FsbCBzdGFjayBzaXplIGV4Y2VlZGVkXCIuXG4gICAgdmFyIHJlcyA9ICcnO1xuICAgIHZhciBpID0gMDtcbiAgICB3aGlsZSAoaSA8IGxlbikge1xuICAgICAgICByZXMgKz0gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShTdHJpbmcsIGNvZGVQb2ludHMuc2xpY2UoaSwgaSArPSBNQVhfQVJHVU1FTlRTX0xFTkdUSCkpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzO1xufVxuZnVuY3Rpb24gYXNjaWlTbGljZShidWYsIHN0YXJ0LCBlbmQpIHtcbiAgICB2YXIgcmV0ID0gJyc7XG4gICAgZW5kID0gTWF0aC5taW4oYnVmLmxlbmd0aCwgZW5kKTtcbiAgICBmb3IgKHZhciBpID0gc3RhcnQ7IGkgPCBlbmQ7ICsraSkge1xuICAgICAgICByZXQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShidWZbaV0gJiAweDdGKTtcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn1cbmZ1bmN0aW9uIGxhdGluMVNsaWNlKGJ1Ziwgc3RhcnQsIGVuZCkge1xuICAgIHZhciByZXQgPSAnJztcbiAgICBlbmQgPSBNYXRoLm1pbihidWYubGVuZ3RoLCBlbmQpO1xuICAgIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IGVuZDsgKytpKSB7XG4gICAgICAgIHJldCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGJ1ZltpXSk7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59XG5mdW5jdGlvbiBoZXhTbGljZShidWYsIHN0YXJ0LCBlbmQpIHtcbiAgICB2YXIgbGVuID0gYnVmLmxlbmd0aDtcbiAgICBpZiAoIXN0YXJ0IHx8IHN0YXJ0IDwgMClcbiAgICAgICAgc3RhcnQgPSAwO1xuICAgIGlmICghZW5kIHx8IGVuZCA8IDAgfHwgZW5kID4gbGVuKVxuICAgICAgICBlbmQgPSBsZW47XG4gICAgdmFyIG91dCA9ICcnO1xuICAgIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IGVuZDsgKytpKSB7XG4gICAgICAgIG91dCArPSB0b0hleChidWZbaV0pO1xuICAgIH1cbiAgICByZXR1cm4gb3V0O1xufVxuZnVuY3Rpb24gdXRmMTZsZVNsaWNlKGJ1Ziwgc3RhcnQsIGVuZCkge1xuICAgIHZhciBieXRlcyA9IGJ1Zi5zbGljZShzdGFydCwgZW5kKTtcbiAgICB2YXIgcmVzID0gJyc7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBieXRlcy5sZW5ndGg7IGkgKz0gMikge1xuICAgICAgICByZXMgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShieXRlc1tpXSArIGJ5dGVzW2kgKyAxXSAqIDI1Nik7XG4gICAgfVxuICAgIHJldHVybiByZXM7XG59XG5CdWZmZXIucHJvdG90eXBlLnNsaWNlID0gZnVuY3Rpb24gc2xpY2Uoc3RhcnQsIGVuZCkge1xuICAgIHZhciBsZW4gPSB0aGlzLmxlbmd0aDtcbiAgICBzdGFydCA9IH5+c3RhcnQ7XG4gICAgZW5kID0gZW5kID09PSB1bmRlZmluZWQgPyBsZW4gOiB+fmVuZDtcbiAgICBpZiAoc3RhcnQgPCAwKSB7XG4gICAgICAgIHN0YXJ0ICs9IGxlbjtcbiAgICAgICAgaWYgKHN0YXJ0IDwgMClcbiAgICAgICAgICAgIHN0YXJ0ID0gMDtcbiAgICB9XG4gICAgZWxzZSBpZiAoc3RhcnQgPiBsZW4pIHtcbiAgICAgICAgc3RhcnQgPSBsZW47XG4gICAgfVxuICAgIGlmIChlbmQgPCAwKSB7XG4gICAgICAgIGVuZCArPSBsZW47XG4gICAgICAgIGlmIChlbmQgPCAwKVxuICAgICAgICAgICAgZW5kID0gMDtcbiAgICB9XG4gICAgZWxzZSBpZiAoZW5kID4gbGVuKSB7XG4gICAgICAgIGVuZCA9IGxlbjtcbiAgICB9XG4gICAgaWYgKGVuZCA8IHN0YXJ0KVxuICAgICAgICBlbmQgPSBzdGFydDtcbiAgICB2YXIgbmV3QnVmO1xuICAgIGlmIChCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkge1xuICAgICAgICBuZXdCdWYgPSB0aGlzLnN1YmFycmF5KHN0YXJ0LCBlbmQpO1xuICAgICAgICBuZXdCdWYuX19wcm90b19fID0gQnVmZmVyLnByb3RvdHlwZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHZhciBzbGljZUxlbiA9IGVuZCAtIHN0YXJ0O1xuICAgICAgICBuZXdCdWYgPSBuZXcgQnVmZmVyKHNsaWNlTGVuLCB1bmRlZmluZWQpO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNsaWNlTGVuOyArK2kpIHtcbiAgICAgICAgICAgIG5ld0J1ZltpXSA9IHRoaXNbaSArIHN0YXJ0XTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbmV3QnVmO1xufTtcbi8qXG4gKiBOZWVkIHRvIG1ha2Ugc3VyZSB0aGF0IGJ1ZmZlciBpc24ndCB0cnlpbmcgdG8gd3JpdGUgb3V0IG9mIGJvdW5kcy5cbiAqL1xuZnVuY3Rpb24gY2hlY2tPZmZzZXQob2Zmc2V0LCBleHQsIGxlbmd0aCkge1xuICAgIGlmICgob2Zmc2V0ICUgMSkgIT09IDAgfHwgb2Zmc2V0IDwgMClcbiAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ29mZnNldCBpcyBub3QgdWludCcpO1xuICAgIGlmIChvZmZzZXQgKyBleHQgPiBsZW5ndGgpXG4gICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdUcnlpbmcgdG8gYWNjZXNzIGJleW9uZCBidWZmZXIgbGVuZ3RoJyk7XG59XG5CdWZmZXIucHJvdG90eXBlLnJlYWRVSW50TEUgPSBmdW5jdGlvbiByZWFkVUludExFKG9mZnNldCwgYnl0ZUxlbmd0aCwgbm9Bc3NlcnQpIHtcbiAgICBvZmZzZXQgPSBvZmZzZXQgfCAwO1xuICAgIGJ5dGVMZW5ndGggPSBieXRlTGVuZ3RoIHwgMDtcbiAgICBpZiAoIW5vQXNzZXJ0KVxuICAgICAgICBjaGVja09mZnNldChvZmZzZXQsIGJ5dGVMZW5ndGgsIHRoaXMubGVuZ3RoKTtcbiAgICB2YXIgdmFsID0gdGhpc1tvZmZzZXRdO1xuICAgIHZhciBtdWwgPSAxO1xuICAgIHZhciBpID0gMDtcbiAgICB3aGlsZSAoKytpIDwgYnl0ZUxlbmd0aCAmJiAobXVsICo9IDB4MTAwKSkge1xuICAgICAgICB2YWwgKz0gdGhpc1tvZmZzZXQgKyBpXSAqIG11bDtcbiAgICB9XG4gICAgcmV0dXJuIHZhbDtcbn07XG5CdWZmZXIucHJvdG90eXBlLnJlYWRVSW50QkUgPSBmdW5jdGlvbiByZWFkVUludEJFKG9mZnNldCwgYnl0ZUxlbmd0aCwgbm9Bc3NlcnQpIHtcbiAgICBvZmZzZXQgPSBvZmZzZXQgfCAwO1xuICAgIGJ5dGVMZW5ndGggPSBieXRlTGVuZ3RoIHwgMDtcbiAgICBpZiAoIW5vQXNzZXJ0KSB7XG4gICAgICAgIGNoZWNrT2Zmc2V0KG9mZnNldCwgYnl0ZUxlbmd0aCwgdGhpcy5sZW5ndGgpO1xuICAgIH1cbiAgICB2YXIgdmFsID0gdGhpc1tvZmZzZXQgKyAtLWJ5dGVMZW5ndGhdO1xuICAgIHZhciBtdWwgPSAxO1xuICAgIHdoaWxlIChieXRlTGVuZ3RoID4gMCAmJiAobXVsICo9IDB4MTAwKSkge1xuICAgICAgICB2YWwgKz0gdGhpc1tvZmZzZXQgKyAtLWJ5dGVMZW5ndGhdICogbXVsO1xuICAgIH1cbiAgICByZXR1cm4gdmFsO1xufTtcbkJ1ZmZlci5wcm90b3R5cGUucmVhZFVJbnQ4ID0gZnVuY3Rpb24gcmVhZFVJbnQ4KG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgICBpZiAoIW5vQXNzZXJ0KVxuICAgICAgICBjaGVja09mZnNldChvZmZzZXQsIDEsIHRoaXMubGVuZ3RoKTtcbiAgICByZXR1cm4gdGhpc1tvZmZzZXRdO1xufTtcbkJ1ZmZlci5wcm90b3R5cGUucmVhZFVJbnQxNkxFID0gZnVuY3Rpb24gcmVhZFVJbnQxNkxFKG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgICBpZiAoIW5vQXNzZXJ0KVxuICAgICAgICBjaGVja09mZnNldChvZmZzZXQsIDIsIHRoaXMubGVuZ3RoKTtcbiAgICByZXR1cm4gdGhpc1tvZmZzZXRdIHwgKHRoaXNbb2Zmc2V0ICsgMV0gPDwgOCk7XG59O1xuQnVmZmVyLnByb3RvdHlwZS5yZWFkVUludDE2QkUgPSBmdW5jdGlvbiByZWFkVUludDE2QkUob2Zmc2V0LCBub0Fzc2VydCkge1xuICAgIGlmICghbm9Bc3NlcnQpXG4gICAgICAgIGNoZWNrT2Zmc2V0KG9mZnNldCwgMiwgdGhpcy5sZW5ndGgpO1xuICAgIHJldHVybiAodGhpc1tvZmZzZXRdIDw8IDgpIHwgdGhpc1tvZmZzZXQgKyAxXTtcbn07XG5CdWZmZXIucHJvdG90eXBlLnJlYWRVSW50MzJMRSA9IGZ1bmN0aW9uIHJlYWRVSW50MzJMRShvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gICAgaWYgKCFub0Fzc2VydClcbiAgICAgICAgY2hlY2tPZmZzZXQob2Zmc2V0LCA0LCB0aGlzLmxlbmd0aCk7XG4gICAgcmV0dXJuICgodGhpc1tvZmZzZXRdKSB8XG4gICAgICAgICh0aGlzW29mZnNldCArIDFdIDw8IDgpIHxcbiAgICAgICAgKHRoaXNbb2Zmc2V0ICsgMl0gPDwgMTYpKSArXG4gICAgICAgICh0aGlzW29mZnNldCArIDNdICogMHgxMDAwMDAwKTtcbn07XG5CdWZmZXIucHJvdG90eXBlLnJlYWRVSW50MzJCRSA9IGZ1bmN0aW9uIHJlYWRVSW50MzJCRShvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gICAgaWYgKCFub0Fzc2VydClcbiAgICAgICAgY2hlY2tPZmZzZXQob2Zmc2V0LCA0LCB0aGlzLmxlbmd0aCk7XG4gICAgcmV0dXJuICh0aGlzW29mZnNldF0gKiAweDEwMDAwMDApICtcbiAgICAgICAgKCh0aGlzW29mZnNldCArIDFdIDw8IDE2KSB8XG4gICAgICAgICAgICAodGhpc1tvZmZzZXQgKyAyXSA8PCA4KSB8XG4gICAgICAgICAgICB0aGlzW29mZnNldCArIDNdKTtcbn07XG5CdWZmZXIucHJvdG90eXBlLnJlYWRJbnRMRSA9IGZ1bmN0aW9uIHJlYWRJbnRMRShvZmZzZXQsIGJ5dGVMZW5ndGgsIG5vQXNzZXJ0KSB7XG4gICAgb2Zmc2V0ID0gb2Zmc2V0IHwgMDtcbiAgICBieXRlTGVuZ3RoID0gYnl0ZUxlbmd0aCB8IDA7XG4gICAgaWYgKCFub0Fzc2VydClcbiAgICAgICAgY2hlY2tPZmZzZXQob2Zmc2V0LCBieXRlTGVuZ3RoLCB0aGlzLmxlbmd0aCk7XG4gICAgdmFyIHZhbCA9IHRoaXNbb2Zmc2V0XTtcbiAgICB2YXIgbXVsID0gMTtcbiAgICB2YXIgaSA9IDA7XG4gICAgd2hpbGUgKCsraSA8IGJ5dGVMZW5ndGggJiYgKG11bCAqPSAweDEwMCkpIHtcbiAgICAgICAgdmFsICs9IHRoaXNbb2Zmc2V0ICsgaV0gKiBtdWw7XG4gICAgfVxuICAgIG11bCAqPSAweDgwO1xuICAgIGlmICh2YWwgPj0gbXVsKVxuICAgICAgICB2YWwgLT0gTWF0aC5wb3coMiwgOCAqIGJ5dGVMZW5ndGgpO1xuICAgIHJldHVybiB2YWw7XG59O1xuQnVmZmVyLnByb3RvdHlwZS5yZWFkSW50QkUgPSBmdW5jdGlvbiByZWFkSW50QkUob2Zmc2V0LCBieXRlTGVuZ3RoLCBub0Fzc2VydCkge1xuICAgIG9mZnNldCA9IG9mZnNldCB8IDA7XG4gICAgYnl0ZUxlbmd0aCA9IGJ5dGVMZW5ndGggfCAwO1xuICAgIGlmICghbm9Bc3NlcnQpXG4gICAgICAgIGNoZWNrT2Zmc2V0KG9mZnNldCwgYnl0ZUxlbmd0aCwgdGhpcy5sZW5ndGgpO1xuICAgIHZhciBpID0gYnl0ZUxlbmd0aDtcbiAgICB2YXIgbXVsID0gMTtcbiAgICB2YXIgdmFsID0gdGhpc1tvZmZzZXQgKyAtLWldO1xuICAgIHdoaWxlIChpID4gMCAmJiAobXVsICo9IDB4MTAwKSkge1xuICAgICAgICB2YWwgKz0gdGhpc1tvZmZzZXQgKyAtLWldICogbXVsO1xuICAgIH1cbiAgICBtdWwgKj0gMHg4MDtcbiAgICBpZiAodmFsID49IG11bClcbiAgICAgICAgdmFsIC09IE1hdGgucG93KDIsIDggKiBieXRlTGVuZ3RoKTtcbiAgICByZXR1cm4gdmFsO1xufTtcbkJ1ZmZlci5wcm90b3R5cGUucmVhZEludDggPSBmdW5jdGlvbiByZWFkSW50OChvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gICAgaWYgKCFub0Fzc2VydClcbiAgICAgICAgY2hlY2tPZmZzZXQob2Zmc2V0LCAxLCB0aGlzLmxlbmd0aCk7XG4gICAgaWYgKCEodGhpc1tvZmZzZXRdICYgMHg4MCkpXG4gICAgICAgIHJldHVybiAodGhpc1tvZmZzZXRdKTtcbiAgICByZXR1cm4gKCgweGZmIC0gdGhpc1tvZmZzZXRdICsgMSkgKiAtMSk7XG59O1xuQnVmZmVyLnByb3RvdHlwZS5yZWFkSW50MTZMRSA9IGZ1bmN0aW9uIHJlYWRJbnQxNkxFKG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgICBpZiAoIW5vQXNzZXJ0KVxuICAgICAgICBjaGVja09mZnNldChvZmZzZXQsIDIsIHRoaXMubGVuZ3RoKTtcbiAgICB2YXIgdmFsID0gdGhpc1tvZmZzZXRdIHwgKHRoaXNbb2Zmc2V0ICsgMV0gPDwgOCk7XG4gICAgcmV0dXJuICh2YWwgJiAweDgwMDApID8gdmFsIHwgMHhGRkZGMDAwMCA6IHZhbDtcbn07XG5CdWZmZXIucHJvdG90eXBlLnJlYWRJbnQxNkJFID0gZnVuY3Rpb24gcmVhZEludDE2QkUob2Zmc2V0LCBub0Fzc2VydCkge1xuICAgIGlmICghbm9Bc3NlcnQpXG4gICAgICAgIGNoZWNrT2Zmc2V0KG9mZnNldCwgMiwgdGhpcy5sZW5ndGgpO1xuICAgIHZhciB2YWwgPSB0aGlzW29mZnNldCArIDFdIHwgKHRoaXNbb2Zmc2V0XSA8PCA4KTtcbiAgICByZXR1cm4gKHZhbCAmIDB4ODAwMCkgPyB2YWwgfCAweEZGRkYwMDAwIDogdmFsO1xufTtcbkJ1ZmZlci5wcm90b3R5cGUucmVhZEludDMyTEUgPSBmdW5jdGlvbiByZWFkSW50MzJMRShvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gICAgaWYgKCFub0Fzc2VydClcbiAgICAgICAgY2hlY2tPZmZzZXQob2Zmc2V0LCA0LCB0aGlzLmxlbmd0aCk7XG4gICAgcmV0dXJuICh0aGlzW29mZnNldF0pIHxcbiAgICAgICAgKHRoaXNbb2Zmc2V0ICsgMV0gPDwgOCkgfFxuICAgICAgICAodGhpc1tvZmZzZXQgKyAyXSA8PCAxNikgfFxuICAgICAgICAodGhpc1tvZmZzZXQgKyAzXSA8PCAyNCk7XG59O1xuQnVmZmVyLnByb3RvdHlwZS5yZWFkSW50MzJCRSA9IGZ1bmN0aW9uIHJlYWRJbnQzMkJFKG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgICBpZiAoIW5vQXNzZXJ0KVxuICAgICAgICBjaGVja09mZnNldChvZmZzZXQsIDQsIHRoaXMubGVuZ3RoKTtcbiAgICByZXR1cm4gKHRoaXNbb2Zmc2V0XSA8PCAyNCkgfFxuICAgICAgICAodGhpc1tvZmZzZXQgKyAxXSA8PCAxNikgfFxuICAgICAgICAodGhpc1tvZmZzZXQgKyAyXSA8PCA4KSB8XG4gICAgICAgICh0aGlzW29mZnNldCArIDNdKTtcbn07XG5CdWZmZXIucHJvdG90eXBlLnJlYWRGbG9hdExFID0gZnVuY3Rpb24gcmVhZEZsb2F0TEUob2Zmc2V0LCBub0Fzc2VydCkge1xuICAgIGlmICghbm9Bc3NlcnQpXG4gICAgICAgIGNoZWNrT2Zmc2V0KG9mZnNldCwgNCwgdGhpcy5sZW5ndGgpO1xuICAgIHJldHVybiBpZWVlNzU0LnJlYWQodGhpcywgb2Zmc2V0LCB0cnVlLCAyMywgNCk7XG59O1xuQnVmZmVyLnByb3RvdHlwZS5yZWFkRmxvYXRCRSA9IGZ1bmN0aW9uIHJlYWRGbG9hdEJFKG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgICBpZiAoIW5vQXNzZXJ0KVxuICAgICAgICBjaGVja09mZnNldChvZmZzZXQsIDQsIHRoaXMubGVuZ3RoKTtcbiAgICByZXR1cm4gaWVlZTc1NC5yZWFkKHRoaXMsIG9mZnNldCwgZmFsc2UsIDIzLCA0KTtcbn07XG5CdWZmZXIucHJvdG90eXBlLnJlYWREb3VibGVMRSA9IGZ1bmN0aW9uIHJlYWREb3VibGVMRShvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gICAgaWYgKCFub0Fzc2VydClcbiAgICAgICAgY2hlY2tPZmZzZXQob2Zmc2V0LCA4LCB0aGlzLmxlbmd0aCk7XG4gICAgcmV0dXJuIGllZWU3NTQucmVhZCh0aGlzLCBvZmZzZXQsIHRydWUsIDUyLCA4KTtcbn07XG5CdWZmZXIucHJvdG90eXBlLnJlYWREb3VibGVCRSA9IGZ1bmN0aW9uIHJlYWREb3VibGVCRShvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gICAgaWYgKCFub0Fzc2VydClcbiAgICAgICAgY2hlY2tPZmZzZXQob2Zmc2V0LCA4LCB0aGlzLmxlbmd0aCk7XG4gICAgcmV0dXJuIGllZWU3NTQucmVhZCh0aGlzLCBvZmZzZXQsIGZhbHNlLCA1MiwgOCk7XG59O1xuZnVuY3Rpb24gY2hlY2tJbnQoYnVmLCB2YWx1ZSwgb2Zmc2V0LCBleHQsIG1heCwgbWluKSB7XG4gICAgaWYgKCFCdWZmZXIuaXNCdWZmZXIoYnVmKSlcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignXCJidWZmZXJcIiBhcmd1bWVudCBtdXN0IGJlIGEgQnVmZmVyIGluc3RhbmNlJyk7XG4gICAgaWYgKHZhbHVlID4gbWF4IHx8IHZhbHVlIDwgbWluKVxuICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignXCJ2YWx1ZVwiIGFyZ3VtZW50IGlzIG91dCBvZiBib3VuZHMnKTtcbiAgICBpZiAob2Zmc2V0ICsgZXh0ID4gYnVmLmxlbmd0aClcbiAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ0luZGV4IG91dCBvZiByYW5nZScpO1xufVxuQnVmZmVyLnByb3RvdHlwZS53cml0ZVVJbnRMRSA9IGZ1bmN0aW9uIHdyaXRlVUludExFKHZhbHVlLCBvZmZzZXQsIGJ5dGVMZW5ndGgsIG5vQXNzZXJ0KSB7XG4gICAgdmFsdWUgPSArdmFsdWU7XG4gICAgb2Zmc2V0ID0gb2Zmc2V0IHwgMDtcbiAgICBieXRlTGVuZ3RoID0gYnl0ZUxlbmd0aCB8IDA7XG4gICAgaWYgKCFub0Fzc2VydCkge1xuICAgICAgICB2YXIgbWF4Qnl0ZXMgPSBNYXRoLnBvdygyLCA4ICogYnl0ZUxlbmd0aCkgLSAxO1xuICAgICAgICBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCBieXRlTGVuZ3RoLCBtYXhCeXRlcywgMCk7XG4gICAgfVxuICAgIHZhciBtdWwgPSAxO1xuICAgIHZhciBpID0gMDtcbiAgICB0aGlzW29mZnNldF0gPSB2YWx1ZSAmIDB4RkY7XG4gICAgd2hpbGUgKCsraSA8IGJ5dGVMZW5ndGggJiYgKG11bCAqPSAweDEwMCkpIHtcbiAgICAgICAgdGhpc1tvZmZzZXQgKyBpXSA9ICh2YWx1ZSAvIG11bCkgJiAweEZGO1xuICAgIH1cbiAgICByZXR1cm4gb2Zmc2V0ICsgYnl0ZUxlbmd0aDtcbn07XG5CdWZmZXIucHJvdG90eXBlLndyaXRlVUludEJFID0gZnVuY3Rpb24gd3JpdGVVSW50QkUodmFsdWUsIG9mZnNldCwgYnl0ZUxlbmd0aCwgbm9Bc3NlcnQpIHtcbiAgICB2YWx1ZSA9ICt2YWx1ZTtcbiAgICBvZmZzZXQgPSBvZmZzZXQgfCAwO1xuICAgIGJ5dGVMZW5ndGggPSBieXRlTGVuZ3RoIHwgMDtcbiAgICBpZiAoIW5vQXNzZXJ0KSB7XG4gICAgICAgIHZhciBtYXhCeXRlcyA9IE1hdGgucG93KDIsIDggKiBieXRlTGVuZ3RoKSAtIDE7XG4gICAgICAgIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIGJ5dGVMZW5ndGgsIG1heEJ5dGVzLCAwKTtcbiAgICB9XG4gICAgdmFyIGkgPSBieXRlTGVuZ3RoIC0gMTtcbiAgICB2YXIgbXVsID0gMTtcbiAgICB0aGlzW29mZnNldCArIGldID0gdmFsdWUgJiAweEZGO1xuICAgIHdoaWxlICgtLWkgPj0gMCAmJiAobXVsICo9IDB4MTAwKSkge1xuICAgICAgICB0aGlzW29mZnNldCArIGldID0gKHZhbHVlIC8gbXVsKSAmIDB4RkY7XG4gICAgfVxuICAgIHJldHVybiBvZmZzZXQgKyBieXRlTGVuZ3RoO1xufTtcbkJ1ZmZlci5wcm90b3R5cGUud3JpdGVVSW50OCA9IGZ1bmN0aW9uIHdyaXRlVUludDgodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgICB2YWx1ZSA9ICt2YWx1ZTtcbiAgICBvZmZzZXQgPSBvZmZzZXQgfCAwO1xuICAgIGlmICghbm9Bc3NlcnQpXG4gICAgICAgIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDEsIDB4ZmYsIDApO1xuICAgIGlmICghQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQpXG4gICAgICAgIHZhbHVlID0gTWF0aC5mbG9vcih2YWx1ZSk7XG4gICAgdGhpc1tvZmZzZXRdID0gKHZhbHVlICYgMHhmZik7XG4gICAgcmV0dXJuIG9mZnNldCArIDE7XG59O1xuZnVuY3Rpb24gb2JqZWN0V3JpdGVVSW50MTYoYnVmLCB2YWx1ZSwgb2Zmc2V0LCBsaXR0bGVFbmRpYW4pIHtcbiAgICBpZiAodmFsdWUgPCAwKVxuICAgICAgICB2YWx1ZSA9IDB4ZmZmZiArIHZhbHVlICsgMTtcbiAgICBmb3IgKHZhciBpID0gMCwgaiA9IE1hdGgubWluKGJ1Zi5sZW5ndGggLSBvZmZzZXQsIDIpOyBpIDwgajsgKytpKSB7XG4gICAgICAgIGJ1ZltvZmZzZXQgKyBpXSA9ICh2YWx1ZSAmICgweGZmIDw8ICg4ICogKGxpdHRsZUVuZGlhbiA/IGkgOiAxIC0gaSkpKSkgPj4+XG4gICAgICAgICAgICAobGl0dGxlRW5kaWFuID8gaSA6IDEgLSBpKSAqIDg7XG4gICAgfVxufVxuQnVmZmVyLnByb3RvdHlwZS53cml0ZVVJbnQxNkxFID0gZnVuY3Rpb24gd3JpdGVVSW50MTZMRSh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkge1xuICAgIHZhbHVlID0gK3ZhbHVlO1xuICAgIG9mZnNldCA9IG9mZnNldCB8IDA7XG4gICAgaWYgKCFub0Fzc2VydClcbiAgICAgICAgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgMiwgMHhmZmZmLCAwKTtcbiAgICBpZiAoQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQpIHtcbiAgICAgICAgdGhpc1tvZmZzZXRdID0gKHZhbHVlICYgMHhmZik7XG4gICAgICAgIHRoaXNbb2Zmc2V0ICsgMV0gPSAodmFsdWUgPj4+IDgpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgb2JqZWN0V3JpdGVVSW50MTYodGhpcywgdmFsdWUsIG9mZnNldCwgdHJ1ZSk7XG4gICAgfVxuICAgIHJldHVybiBvZmZzZXQgKyAyO1xufTtcbkJ1ZmZlci5wcm90b3R5cGUud3JpdGVVSW50MTZCRSA9IGZ1bmN0aW9uIHdyaXRlVUludDE2QkUodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgICB2YWx1ZSA9ICt2YWx1ZTtcbiAgICBvZmZzZXQgPSBvZmZzZXQgfCAwO1xuICAgIGlmICghbm9Bc3NlcnQpXG4gICAgICAgIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDIsIDB4ZmZmZiwgMCk7XG4gICAgaWYgKEJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUKSB7XG4gICAgICAgIHRoaXNbb2Zmc2V0XSA9ICh2YWx1ZSA+Pj4gOCk7XG4gICAgICAgIHRoaXNbb2Zmc2V0ICsgMV0gPSAodmFsdWUgJiAweGZmKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIG9iamVjdFdyaXRlVUludDE2KHRoaXMsIHZhbHVlLCBvZmZzZXQsIGZhbHNlKTtcbiAgICB9XG4gICAgcmV0dXJuIG9mZnNldCArIDI7XG59O1xuZnVuY3Rpb24gb2JqZWN0V3JpdGVVSW50MzIoYnVmLCB2YWx1ZSwgb2Zmc2V0LCBsaXR0bGVFbmRpYW4pIHtcbiAgICBpZiAodmFsdWUgPCAwKVxuICAgICAgICB2YWx1ZSA9IDB4ZmZmZmZmZmYgKyB2YWx1ZSArIDE7XG4gICAgZm9yICh2YXIgaSA9IDAsIGogPSBNYXRoLm1pbihidWYubGVuZ3RoIC0gb2Zmc2V0LCA0KTsgaSA8IGo7ICsraSkge1xuICAgICAgICBidWZbb2Zmc2V0ICsgaV0gPSAodmFsdWUgPj4+IChsaXR0bGVFbmRpYW4gPyBpIDogMyAtIGkpICogOCkgJiAweGZmO1xuICAgIH1cbn1cbkJ1ZmZlci5wcm90b3R5cGUud3JpdGVVSW50MzJMRSA9IGZ1bmN0aW9uIHdyaXRlVUludDMyTEUodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgICB2YWx1ZSA9ICt2YWx1ZTtcbiAgICBvZmZzZXQgPSBvZmZzZXQgfCAwO1xuICAgIGlmICghbm9Bc3NlcnQpXG4gICAgICAgIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDQsIDB4ZmZmZmZmZmYsIDApO1xuICAgIGlmIChCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkge1xuICAgICAgICB0aGlzW29mZnNldCArIDNdID0gKHZhbHVlID4+PiAyNCk7XG4gICAgICAgIHRoaXNbb2Zmc2V0ICsgMl0gPSAodmFsdWUgPj4+IDE2KTtcbiAgICAgICAgdGhpc1tvZmZzZXQgKyAxXSA9ICh2YWx1ZSA+Pj4gOCk7XG4gICAgICAgIHRoaXNbb2Zmc2V0XSA9ICh2YWx1ZSAmIDB4ZmYpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgb2JqZWN0V3JpdGVVSW50MzIodGhpcywgdmFsdWUsIG9mZnNldCwgdHJ1ZSk7XG4gICAgfVxuICAgIHJldHVybiBvZmZzZXQgKyA0O1xufTtcbkJ1ZmZlci5wcm90b3R5cGUud3JpdGVVSW50MzJCRSA9IGZ1bmN0aW9uIHdyaXRlVUludDMyQkUodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgICB2YWx1ZSA9ICt2YWx1ZTtcbiAgICBvZmZzZXQgPSBvZmZzZXQgfCAwO1xuICAgIGlmICghbm9Bc3NlcnQpXG4gICAgICAgIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDQsIDB4ZmZmZmZmZmYsIDApO1xuICAgIGlmIChCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkge1xuICAgICAgICB0aGlzW29mZnNldF0gPSAodmFsdWUgPj4+IDI0KTtcbiAgICAgICAgdGhpc1tvZmZzZXQgKyAxXSA9ICh2YWx1ZSA+Pj4gMTYpO1xuICAgICAgICB0aGlzW29mZnNldCArIDJdID0gKHZhbHVlID4+PiA4KTtcbiAgICAgICAgdGhpc1tvZmZzZXQgKyAzXSA9ICh2YWx1ZSAmIDB4ZmYpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgb2JqZWN0V3JpdGVVSW50MzIodGhpcywgdmFsdWUsIG9mZnNldCwgZmFsc2UpO1xuICAgIH1cbiAgICByZXR1cm4gb2Zmc2V0ICsgNDtcbn07XG5CdWZmZXIucHJvdG90eXBlLndyaXRlSW50TEUgPSBmdW5jdGlvbiB3cml0ZUludExFKHZhbHVlLCBvZmZzZXQsIGJ5dGVMZW5ndGgsIG5vQXNzZXJ0KSB7XG4gICAgdmFsdWUgPSArdmFsdWU7XG4gICAgb2Zmc2V0ID0gb2Zmc2V0IHwgMDtcbiAgICBpZiAoIW5vQXNzZXJ0KSB7XG4gICAgICAgIHZhciBsaW1pdCA9IE1hdGgucG93KDIsIDggKiBieXRlTGVuZ3RoIC0gMSk7XG4gICAgICAgIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIGJ5dGVMZW5ndGgsIGxpbWl0IC0gMSwgLWxpbWl0KTtcbiAgICB9XG4gICAgdmFyIGkgPSAwO1xuICAgIHZhciBtdWwgPSAxO1xuICAgIHZhciBzdWIgPSAwO1xuICAgIHRoaXNbb2Zmc2V0XSA9IHZhbHVlICYgMHhGRjtcbiAgICB3aGlsZSAoKytpIDwgYnl0ZUxlbmd0aCAmJiAobXVsICo9IDB4MTAwKSkge1xuICAgICAgICBpZiAodmFsdWUgPCAwICYmIHN1YiA9PT0gMCAmJiB0aGlzW29mZnNldCArIGkgLSAxXSAhPT0gMCkge1xuICAgICAgICAgICAgc3ViID0gMTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzW29mZnNldCArIGldID0gKCh2YWx1ZSAvIG11bCkgPj4gMCkgLSBzdWIgJiAweEZGO1xuICAgIH1cbiAgICByZXR1cm4gb2Zmc2V0ICsgYnl0ZUxlbmd0aDtcbn07XG5CdWZmZXIucHJvdG90eXBlLndyaXRlSW50QkUgPSBmdW5jdGlvbiB3cml0ZUludEJFKHZhbHVlLCBvZmZzZXQsIGJ5dGVMZW5ndGgsIG5vQXNzZXJ0KSB7XG4gICAgdmFsdWUgPSArdmFsdWU7XG4gICAgb2Zmc2V0ID0gb2Zmc2V0IHwgMDtcbiAgICBpZiAoIW5vQXNzZXJ0KSB7XG4gICAgICAgIHZhciBsaW1pdCA9IE1hdGgucG93KDIsIDggKiBieXRlTGVuZ3RoIC0gMSk7XG4gICAgICAgIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIGJ5dGVMZW5ndGgsIGxpbWl0IC0gMSwgLWxpbWl0KTtcbiAgICB9XG4gICAgdmFyIGkgPSBieXRlTGVuZ3RoIC0gMTtcbiAgICB2YXIgbXVsID0gMTtcbiAgICB2YXIgc3ViID0gMDtcbiAgICB0aGlzW29mZnNldCArIGldID0gdmFsdWUgJiAweEZGO1xuICAgIHdoaWxlICgtLWkgPj0gMCAmJiAobXVsICo9IDB4MTAwKSkge1xuICAgICAgICBpZiAodmFsdWUgPCAwICYmIHN1YiA9PT0gMCAmJiB0aGlzW29mZnNldCArIGkgKyAxXSAhPT0gMCkge1xuICAgICAgICAgICAgc3ViID0gMTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzW29mZnNldCArIGldID0gKCh2YWx1ZSAvIG11bCkgPj4gMCkgLSBzdWIgJiAweEZGO1xuICAgIH1cbiAgICByZXR1cm4gb2Zmc2V0ICsgYnl0ZUxlbmd0aDtcbn07XG5CdWZmZXIucHJvdG90eXBlLndyaXRlSW50OCA9IGZ1bmN0aW9uIHdyaXRlSW50OCh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkge1xuICAgIHZhbHVlID0gK3ZhbHVlO1xuICAgIG9mZnNldCA9IG9mZnNldCB8IDA7XG4gICAgaWYgKCFub0Fzc2VydClcbiAgICAgICAgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgMSwgMHg3ZiwgLTB4ODApO1xuICAgIGlmICghQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQpXG4gICAgICAgIHZhbHVlID0gTWF0aC5mbG9vcih2YWx1ZSk7XG4gICAgaWYgKHZhbHVlIDwgMClcbiAgICAgICAgdmFsdWUgPSAweGZmICsgdmFsdWUgKyAxO1xuICAgIHRoaXNbb2Zmc2V0XSA9ICh2YWx1ZSAmIDB4ZmYpO1xuICAgIHJldHVybiBvZmZzZXQgKyAxO1xufTtcbkJ1ZmZlci5wcm90b3R5cGUud3JpdGVJbnQxNkxFID0gZnVuY3Rpb24gd3JpdGVJbnQxNkxFKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gICAgdmFsdWUgPSArdmFsdWU7XG4gICAgb2Zmc2V0ID0gb2Zmc2V0IHwgMDtcbiAgICBpZiAoIW5vQXNzZXJ0KVxuICAgICAgICBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCAyLCAweDdmZmYsIC0weDgwMDApO1xuICAgIGlmIChCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkge1xuICAgICAgICB0aGlzW29mZnNldF0gPSAodmFsdWUgJiAweGZmKTtcbiAgICAgICAgdGhpc1tvZmZzZXQgKyAxXSA9ICh2YWx1ZSA+Pj4gOCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBvYmplY3RXcml0ZVVJbnQxNih0aGlzLCB2YWx1ZSwgb2Zmc2V0LCB0cnVlKTtcbiAgICB9XG4gICAgcmV0dXJuIG9mZnNldCArIDI7XG59O1xuQnVmZmVyLnByb3RvdHlwZS53cml0ZUludDE2QkUgPSBmdW5jdGlvbiB3cml0ZUludDE2QkUodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgICB2YWx1ZSA9ICt2YWx1ZTtcbiAgICBvZmZzZXQgPSBvZmZzZXQgfCAwO1xuICAgIGlmICghbm9Bc3NlcnQpXG4gICAgICAgIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDIsIDB4N2ZmZiwgLTB4ODAwMCk7XG4gICAgaWYgKEJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUKSB7XG4gICAgICAgIHRoaXNbb2Zmc2V0XSA9ICh2YWx1ZSA+Pj4gOCk7XG4gICAgICAgIHRoaXNbb2Zmc2V0ICsgMV0gPSAodmFsdWUgJiAweGZmKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIG9iamVjdFdyaXRlVUludDE2KHRoaXMsIHZhbHVlLCBvZmZzZXQsIGZhbHNlKTtcbiAgICB9XG4gICAgcmV0dXJuIG9mZnNldCArIDI7XG59O1xuQnVmZmVyLnByb3RvdHlwZS53cml0ZUludDMyTEUgPSBmdW5jdGlvbiB3cml0ZUludDMyTEUodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgICB2YWx1ZSA9ICt2YWx1ZTtcbiAgICBvZmZzZXQgPSBvZmZzZXQgfCAwO1xuICAgIGlmICghbm9Bc3NlcnQpXG4gICAgICAgIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDQsIDB4N2ZmZmZmZmYsIC0weDgwMDAwMDAwKTtcbiAgICBpZiAoQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQpIHtcbiAgICAgICAgdGhpc1tvZmZzZXRdID0gKHZhbHVlICYgMHhmZik7XG4gICAgICAgIHRoaXNbb2Zmc2V0ICsgMV0gPSAodmFsdWUgPj4+IDgpO1xuICAgICAgICB0aGlzW29mZnNldCArIDJdID0gKHZhbHVlID4+PiAxNik7XG4gICAgICAgIHRoaXNbb2Zmc2V0ICsgM10gPSAodmFsdWUgPj4+IDI0KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIG9iamVjdFdyaXRlVUludDMyKHRoaXMsIHZhbHVlLCBvZmZzZXQsIHRydWUpO1xuICAgIH1cbiAgICByZXR1cm4gb2Zmc2V0ICsgNDtcbn07XG5CdWZmZXIucHJvdG90eXBlLndyaXRlSW50MzJCRSA9IGZ1bmN0aW9uIHdyaXRlSW50MzJCRSh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkge1xuICAgIHZhbHVlID0gK3ZhbHVlO1xuICAgIG9mZnNldCA9IG9mZnNldCB8IDA7XG4gICAgaWYgKCFub0Fzc2VydClcbiAgICAgICAgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgNCwgMHg3ZmZmZmZmZiwgLTB4ODAwMDAwMDApO1xuICAgIGlmICh2YWx1ZSA8IDApXG4gICAgICAgIHZhbHVlID0gMHhmZmZmZmZmZiArIHZhbHVlICsgMTtcbiAgICBpZiAoQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQpIHtcbiAgICAgICAgdGhpc1tvZmZzZXRdID0gKHZhbHVlID4+PiAyNCk7XG4gICAgICAgIHRoaXNbb2Zmc2V0ICsgMV0gPSAodmFsdWUgPj4+IDE2KTtcbiAgICAgICAgdGhpc1tvZmZzZXQgKyAyXSA9ICh2YWx1ZSA+Pj4gOCk7XG4gICAgICAgIHRoaXNbb2Zmc2V0ICsgM10gPSAodmFsdWUgJiAweGZmKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIG9iamVjdFdyaXRlVUludDMyKHRoaXMsIHZhbHVlLCBvZmZzZXQsIGZhbHNlKTtcbiAgICB9XG4gICAgcmV0dXJuIG9mZnNldCArIDQ7XG59O1xuZnVuY3Rpb24gY2hlY2tJRUVFNzU0KGJ1ZiwgdmFsdWUsIG9mZnNldCwgZXh0LCBtYXgsIG1pbikge1xuICAgIGlmIChvZmZzZXQgKyBleHQgPiBidWYubGVuZ3RoKVxuICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignSW5kZXggb3V0IG9mIHJhbmdlJyk7XG4gICAgaWYgKG9mZnNldCA8IDApXG4gICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdJbmRleCBvdXQgb2YgcmFuZ2UnKTtcbn1cbmZ1bmN0aW9uIHdyaXRlRmxvYXQoYnVmLCB2YWx1ZSwgb2Zmc2V0LCBsaXR0bGVFbmRpYW4sIG5vQXNzZXJ0KSB7XG4gICAgaWYgKCFub0Fzc2VydCkge1xuICAgICAgICBjaGVja0lFRUU3NTQoYnVmLCB2YWx1ZSwgb2Zmc2V0LCA0LCAzLjQwMjgyMzQ2NjM4NTI4ODZlKzM4LCAtMy40MDI4MjM0NjYzODUyODg2ZSszOCk7XG4gICAgfVxuICAgIGllZWU3NTQud3JpdGUoYnVmLCB2YWx1ZSwgb2Zmc2V0LCBsaXR0bGVFbmRpYW4sIDIzLCA0KTtcbiAgICByZXR1cm4gb2Zmc2V0ICsgNDtcbn1cbkJ1ZmZlci5wcm90b3R5cGUud3JpdGVGbG9hdExFID0gZnVuY3Rpb24gd3JpdGVGbG9hdExFKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gICAgcmV0dXJuIHdyaXRlRmxvYXQodGhpcywgdmFsdWUsIG9mZnNldCwgdHJ1ZSwgbm9Bc3NlcnQpO1xufTtcbkJ1ZmZlci5wcm90b3R5cGUud3JpdGVGbG9hdEJFID0gZnVuY3Rpb24gd3JpdGVGbG9hdEJFKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gICAgcmV0dXJuIHdyaXRlRmxvYXQodGhpcywgdmFsdWUsIG9mZnNldCwgZmFsc2UsIG5vQXNzZXJ0KTtcbn07XG5mdW5jdGlvbiB3cml0ZURvdWJsZShidWYsIHZhbHVlLCBvZmZzZXQsIGxpdHRsZUVuZGlhbiwgbm9Bc3NlcnQpIHtcbiAgICBpZiAoIW5vQXNzZXJ0KSB7XG4gICAgICAgIGNoZWNrSUVFRTc1NChidWYsIHZhbHVlLCBvZmZzZXQsIDgsIDEuNzk3NjkzMTM0ODYyMzE1N0UrMzA4LCAtMS43OTc2OTMxMzQ4NjIzMTU3RSszMDgpO1xuICAgIH1cbiAgICBpZWVlNzU0LndyaXRlKGJ1ZiwgdmFsdWUsIG9mZnNldCwgbGl0dGxlRW5kaWFuLCA1MiwgOCk7XG4gICAgcmV0dXJuIG9mZnNldCArIDg7XG59XG5CdWZmZXIucHJvdG90eXBlLndyaXRlRG91YmxlTEUgPSBmdW5jdGlvbiB3cml0ZURvdWJsZUxFKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gICAgcmV0dXJuIHdyaXRlRG91YmxlKHRoaXMsIHZhbHVlLCBvZmZzZXQsIHRydWUsIG5vQXNzZXJ0KTtcbn07XG5CdWZmZXIucHJvdG90eXBlLndyaXRlRG91YmxlQkUgPSBmdW5jdGlvbiB3cml0ZURvdWJsZUJFKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gICAgcmV0dXJuIHdyaXRlRG91YmxlKHRoaXMsIHZhbHVlLCBvZmZzZXQsIGZhbHNlLCBub0Fzc2VydCk7XG59O1xuLy8gY29weSh0YXJnZXRCdWZmZXIsIHRhcmdldFN0YXJ0PTAsIHNvdXJjZVN0YXJ0PTAsIHNvdXJjZUVuZD1idWZmZXIubGVuZ3RoKVxuQnVmZmVyLnByb3RvdHlwZS5jb3B5ID0gZnVuY3Rpb24gY29weSh0YXJnZXQsIHRhcmdldFN0YXJ0LCBzdGFydCwgZW5kKSB7XG4gICAgaWYgKCFzdGFydClcbiAgICAgICAgc3RhcnQgPSAwO1xuICAgIGlmICghZW5kICYmIGVuZCAhPT0gMClcbiAgICAgICAgZW5kID0gdGhpcy5sZW5ndGg7XG4gICAgaWYgKHRhcmdldFN0YXJ0ID49IHRhcmdldC5sZW5ndGgpXG4gICAgICAgIHRhcmdldFN0YXJ0ID0gdGFyZ2V0Lmxlbmd0aDtcbiAgICBpZiAoIXRhcmdldFN0YXJ0KVxuICAgICAgICB0YXJnZXRTdGFydCA9IDA7XG4gICAgaWYgKGVuZCA+IDAgJiYgZW5kIDwgc3RhcnQpXG4gICAgICAgIGVuZCA9IHN0YXJ0O1xuICAgIC8vIENvcHkgMCBieXRlczsgd2UncmUgZG9uZVxuICAgIGlmIChlbmQgPT09IHN0YXJ0KVxuICAgICAgICByZXR1cm4gMDtcbiAgICBpZiAodGFyZ2V0Lmxlbmd0aCA9PT0gMCB8fCB0aGlzLmxlbmd0aCA9PT0gMClcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgLy8gRmF0YWwgZXJyb3IgY29uZGl0aW9uc1xuICAgIGlmICh0YXJnZXRTdGFydCA8IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ3RhcmdldFN0YXJ0IG91dCBvZiBib3VuZHMnKTtcbiAgICB9XG4gICAgaWYgKHN0YXJ0IDwgMCB8fCBzdGFydCA+PSB0aGlzLmxlbmd0aClcbiAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ3NvdXJjZVN0YXJ0IG91dCBvZiBib3VuZHMnKTtcbiAgICBpZiAoZW5kIDwgMClcbiAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ3NvdXJjZUVuZCBvdXQgb2YgYm91bmRzJyk7XG4gICAgLy8gQXJlIHdlIG9vYj9cbiAgICBpZiAoZW5kID4gdGhpcy5sZW5ndGgpXG4gICAgICAgIGVuZCA9IHRoaXMubGVuZ3RoO1xuICAgIGlmICh0YXJnZXQubGVuZ3RoIC0gdGFyZ2V0U3RhcnQgPCBlbmQgLSBzdGFydCkge1xuICAgICAgICBlbmQgPSB0YXJnZXQubGVuZ3RoIC0gdGFyZ2V0U3RhcnQgKyBzdGFydDtcbiAgICB9XG4gICAgdmFyIGxlbiA9IGVuZCAtIHN0YXJ0O1xuICAgIHZhciBpO1xuICAgIGlmICh0aGlzID09PSB0YXJnZXQgJiYgc3RhcnQgPCB0YXJnZXRTdGFydCAmJiB0YXJnZXRTdGFydCA8IGVuZCkge1xuICAgICAgICAvLyBkZXNjZW5kaW5nIGNvcHkgZnJvbSBlbmRcbiAgICAgICAgZm9yIChpID0gbGVuIC0gMTsgaSA+PSAwOyAtLWkpIHtcbiAgICAgICAgICAgIHRhcmdldFtpICsgdGFyZ2V0U3RhcnRdID0gdGhpc1tpICsgc3RhcnRdO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2UgaWYgKGxlbiA8IDEwMDAgfHwgIUJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUKSB7XG4gICAgICAgIC8vIGFzY2VuZGluZyBjb3B5IGZyb20gc3RhcnRcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbjsgKytpKSB7XG4gICAgICAgICAgICB0YXJnZXRbaSArIHRhcmdldFN0YXJ0XSA9IHRoaXNbaSArIHN0YXJ0XTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgVWludDhBcnJheS5wcm90b3R5cGUuc2V0LmNhbGwodGFyZ2V0LCB0aGlzLnN1YmFycmF5KHN0YXJ0LCBzdGFydCArIGxlbiksIHRhcmdldFN0YXJ0KTtcbiAgICB9XG4gICAgcmV0dXJuIGxlbjtcbn07XG4vLyBVc2FnZTpcbi8vICAgIGJ1ZmZlci5maWxsKG51bWJlclssIG9mZnNldFssIGVuZF1dKVxuLy8gICAgYnVmZmVyLmZpbGwoYnVmZmVyWywgb2Zmc2V0WywgZW5kXV0pXG4vLyAgICBidWZmZXIuZmlsbChzdHJpbmdbLCBvZmZzZXRbLCBlbmRdXVssIGVuY29kaW5nXSlcbkJ1ZmZlci5wcm90b3R5cGUuZmlsbCA9IGZ1bmN0aW9uIGZpbGwodmFsLCBzdGFydCwgZW5kLCBlbmNvZGluZykge1xuICAgIC8vIEhhbmRsZSBzdHJpbmcgY2FzZXM6XG4gICAgaWYgKHR5cGVvZiB2YWwgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGlmICh0eXBlb2Ygc3RhcnQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBlbmNvZGluZyA9IHN0YXJ0O1xuICAgICAgICAgICAgc3RhcnQgPSAwO1xuICAgICAgICAgICAgZW5kID0gdGhpcy5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodHlwZW9mIGVuZCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIGVuY29kaW5nID0gZW5kO1xuICAgICAgICAgICAgZW5kID0gdGhpcy5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHZhbC5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgIHZhciBjb2RlID0gdmFsLmNoYXJDb2RlQXQoMCk7XG4gICAgICAgICAgICBpZiAoY29kZSA8IDI1Nikge1xuICAgICAgICAgICAgICAgIHZhbCA9IGNvZGU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVuY29kaW5nICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIGVuY29kaW5nICE9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignZW5jb2RpbmcgbXVzdCBiZSBhIHN0cmluZycpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgZW5jb2RpbmcgPT09ICdzdHJpbmcnICYmICFCdWZmZXIuaXNFbmNvZGluZyhlbmNvZGluZykpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1Vua25vd24gZW5jb2Rpbmc6ICcgKyBlbmNvZGluZyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSBpZiAodHlwZW9mIHZhbCA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgdmFsID0gdmFsICYgMjU1O1xuICAgIH1cbiAgICAvLyBJbnZhbGlkIHJhbmdlcyBhcmUgbm90IHNldCB0byBhIGRlZmF1bHQsIHNvIGNhbiByYW5nZSBjaGVjayBlYXJseS5cbiAgICBpZiAoc3RhcnQgPCAwIHx8IHRoaXMubGVuZ3RoIDwgc3RhcnQgfHwgdGhpcy5sZW5ndGggPCBlbmQpIHtcbiAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ091dCBvZiByYW5nZSBpbmRleCcpO1xuICAgIH1cbiAgICBpZiAoZW5kIDw9IHN0YXJ0KSB7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBzdGFydCA9IHN0YXJ0ID4+PiAwO1xuICAgIGVuZCA9IGVuZCA9PT0gdW5kZWZpbmVkID8gdGhpcy5sZW5ndGggOiBlbmQgPj4+IDA7XG4gICAgaWYgKCF2YWwpXG4gICAgICAgIHZhbCA9IDA7XG4gICAgdmFyIGk7XG4gICAgaWYgKHR5cGVvZiB2YWwgPT09ICdudW1iZXInKSB7XG4gICAgICAgIGZvciAoaSA9IHN0YXJ0OyBpIDwgZW5kOyArK2kpIHtcbiAgICAgICAgICAgIHRoaXNbaV0gPSB2YWw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHZhciBieXRlcyA9IEJ1ZmZlci5pc0J1ZmZlcih2YWwpXG4gICAgICAgICAgICA/IHZhbFxuICAgICAgICAgICAgOiB1dGY4VG9CeXRlcyhuZXcgQnVmZmVyKHZhbCwgZW5jb2RpbmcpLnRvU3RyaW5nKCkpO1xuICAgICAgICB2YXIgbGVuID0gYnl0ZXMubGVuZ3RoO1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZW5kIC0gc3RhcnQ7ICsraSkge1xuICAgICAgICAgICAgdGhpc1tpICsgc3RhcnRdID0gYnl0ZXNbaSAlIGxlbl07XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG59O1xuLy8gSEVMUEVSIEZVTkNUSU9OU1xuLy8gPT09PT09PT09PT09PT09PVxudmFyIElOVkFMSURfQkFTRTY0X1JFID0gL1teK1xcLzAtOUEtWmEtei1fXS9nO1xuZnVuY3Rpb24gYmFzZTY0Y2xlYW4oc3RyKSB7XG4gICAgLy8gTm9kZSBzdHJpcHMgb3V0IGludmFsaWQgY2hhcmFjdGVycyBsaWtlIFxcbiBhbmQgXFx0IGZyb20gdGhlIHN0cmluZywgYmFzZTY0LWpzIGRvZXMgbm90XG4gICAgc3RyID0gc3RyaW5ndHJpbShzdHIpLnJlcGxhY2UoSU5WQUxJRF9CQVNFNjRfUkUsICcnKTtcbiAgICAvLyBOb2RlIGNvbnZlcnRzIHN0cmluZ3Mgd2l0aCBsZW5ndGggPCAyIHRvICcnXG4gICAgaWYgKHN0ci5sZW5ndGggPCAyKVxuICAgICAgICByZXR1cm4gJyc7XG4gICAgLy8gTm9kZSBhbGxvd3MgZm9yIG5vbi1wYWRkZWQgYmFzZTY0IHN0cmluZ3MgKG1pc3NpbmcgdHJhaWxpbmcgPT09KSwgYmFzZTY0LWpzIGRvZXMgbm90XG4gICAgd2hpbGUgKHN0ci5sZW5ndGggJSA0ICE9PSAwKSB7XG4gICAgICAgIHN0ciA9IHN0ciArICc9JztcbiAgICB9XG4gICAgcmV0dXJuIHN0cjtcbn1cbmZ1bmN0aW9uIHN0cmluZ3RyaW0oc3RyKSB7XG4gICAgaWYgKHN0ci50cmltKVxuICAgICAgICByZXR1cm4gc3RyLnRyaW0oKTtcbiAgICByZXR1cm4gc3RyLnJlcGxhY2UoL15cXHMrfFxccyskL2csICcnKTtcbn1cbmZ1bmN0aW9uIHRvSGV4KG4pIHtcbiAgICBpZiAobiA8IDE2KVxuICAgICAgICByZXR1cm4gJzAnICsgbi50b1N0cmluZygxNik7XG4gICAgcmV0dXJuIG4udG9TdHJpbmcoMTYpO1xufVxuZnVuY3Rpb24gdXRmOFRvQnl0ZXMoc3RyaW5nLCB1bml0cykge1xuICAgIHVuaXRzID0gdW5pdHMgfHwgSW5maW5pdHk7XG4gICAgdmFyIGNvZGVQb2ludDtcbiAgICB2YXIgbGVuZ3RoID0gc3RyaW5nLmxlbmd0aDtcbiAgICB2YXIgbGVhZFN1cnJvZ2F0ZSA9IG51bGw7XG4gICAgdmFyIGJ5dGVzID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkge1xuICAgICAgICBjb2RlUG9pbnQgPSBzdHJpbmcuY2hhckNvZGVBdChpKTtcbiAgICAgICAgLy8gaXMgc3Vycm9nYXRlIGNvbXBvbmVudFxuICAgICAgICBpZiAoY29kZVBvaW50ID4gMHhEN0ZGICYmIGNvZGVQb2ludCA8IDB4RTAwMCkge1xuICAgICAgICAgICAgLy8gbGFzdCBjaGFyIHdhcyBhIGxlYWRcbiAgICAgICAgICAgIGlmICghbGVhZFN1cnJvZ2F0ZSkge1xuICAgICAgICAgICAgICAgIC8vIG5vIGxlYWQgeWV0XG4gICAgICAgICAgICAgICAgaWYgKGNvZGVQb2ludCA+IDB4REJGRikge1xuICAgICAgICAgICAgICAgICAgICAvLyB1bmV4cGVjdGVkIHRyYWlsXG4gICAgICAgICAgICAgICAgICAgIGlmICgodW5pdHMgLT0gMykgPiAtMSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ5dGVzLnB1c2goMHhFRiwgMHhCRiwgMHhCRCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChpICsgMSA9PT0gbGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHVucGFpcmVkIGxlYWRcbiAgICAgICAgICAgICAgICAgICAgaWYgKCh1bml0cyAtPSAzKSA+IC0xKVxuICAgICAgICAgICAgICAgICAgICAgICAgYnl0ZXMucHVzaCgweEVGLCAweEJGLCAweEJEKTtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIHZhbGlkIGxlYWRcbiAgICAgICAgICAgICAgICBsZWFkU3Vycm9nYXRlID0gY29kZVBvaW50O1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gMiBsZWFkcyBpbiBhIHJvd1xuICAgICAgICAgICAgaWYgKGNvZGVQb2ludCA8IDB4REMwMCkge1xuICAgICAgICAgICAgICAgIGlmICgodW5pdHMgLT0gMykgPiAtMSlcbiAgICAgICAgICAgICAgICAgICAgYnl0ZXMucHVzaCgweEVGLCAweEJGLCAweEJEKTtcbiAgICAgICAgICAgICAgICBsZWFkU3Vycm9nYXRlID0gY29kZVBvaW50O1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gdmFsaWQgc3Vycm9nYXRlIHBhaXJcbiAgICAgICAgICAgIGNvZGVQb2ludCA9IChsZWFkU3Vycm9nYXRlIC0gMHhEODAwIDw8IDEwIHwgY29kZVBvaW50IC0gMHhEQzAwKSArIDB4MTAwMDA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAobGVhZFN1cnJvZ2F0ZSkge1xuICAgICAgICAgICAgLy8gdmFsaWQgYm1wIGNoYXIsIGJ1dCBsYXN0IGNoYXIgd2FzIGEgbGVhZFxuICAgICAgICAgICAgaWYgKCh1bml0cyAtPSAzKSA+IC0xKVxuICAgICAgICAgICAgICAgIGJ5dGVzLnB1c2goMHhFRiwgMHhCRiwgMHhCRCk7XG4gICAgICAgIH1cbiAgICAgICAgbGVhZFN1cnJvZ2F0ZSA9IG51bGw7XG4gICAgICAgIC8vIGVuY29kZSB1dGY4XG4gICAgICAgIGlmIChjb2RlUG9pbnQgPCAweDgwKSB7XG4gICAgICAgICAgICBpZiAoKHVuaXRzIC09IDEpIDwgMClcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGJ5dGVzLnB1c2goY29kZVBvaW50KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb2RlUG9pbnQgPCAweDgwMCkge1xuICAgICAgICAgICAgaWYgKCh1bml0cyAtPSAyKSA8IDApXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBieXRlcy5wdXNoKGNvZGVQb2ludCA+PiAweDYgfCAweEMwLCBjb2RlUG9pbnQgJiAweDNGIHwgMHg4MCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29kZVBvaW50IDwgMHgxMDAwMCkge1xuICAgICAgICAgICAgaWYgKCh1bml0cyAtPSAzKSA8IDApXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBieXRlcy5wdXNoKGNvZGVQb2ludCA+PiAweEMgfCAweEUwLCBjb2RlUG9pbnQgPj4gMHg2ICYgMHgzRiB8IDB4ODAsIGNvZGVQb2ludCAmIDB4M0YgfCAweDgwKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb2RlUG9pbnQgPCAweDExMDAwMCkge1xuICAgICAgICAgICAgaWYgKCh1bml0cyAtPSA0KSA8IDApXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBieXRlcy5wdXNoKGNvZGVQb2ludCA+PiAweDEyIHwgMHhGMCwgY29kZVBvaW50ID4+IDB4QyAmIDB4M0YgfCAweDgwLCBjb2RlUG9pbnQgPj4gMHg2ICYgMHgzRiB8IDB4ODAsIGNvZGVQb2ludCAmIDB4M0YgfCAweDgwKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBjb2RlIHBvaW50Jyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGJ5dGVzO1xufVxuZnVuY3Rpb24gYXNjaWlUb0J5dGVzKHN0cikge1xuICAgIHZhciBieXRlQXJyYXkgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0ci5sZW5ndGg7ICsraSkge1xuICAgICAgICAvLyBOb2RlJ3MgY29kZSBzZWVtcyB0byBiZSBkb2luZyB0aGlzIGFuZCBub3QgJiAweDdGLi5cbiAgICAgICAgYnl0ZUFycmF5LnB1c2goc3RyLmNoYXJDb2RlQXQoaSkgJiAweEZGKTtcbiAgICB9XG4gICAgcmV0dXJuIGJ5dGVBcnJheTtcbn1cbmZ1bmN0aW9uIHV0ZjE2bGVUb0J5dGVzKHN0ciwgdW5pdHMpIHtcbiAgICB2YXIgYywgaGksIGxvO1xuICAgIHZhciBieXRlQXJyYXkgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0ci5sZW5ndGg7ICsraSkge1xuICAgICAgICBpZiAoKHVuaXRzIC09IDIpIDwgMClcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjID0gc3RyLmNoYXJDb2RlQXQoaSk7XG4gICAgICAgIGhpID0gYyA+PiA4O1xuICAgICAgICBsbyA9IGMgJSAyNTY7XG4gICAgICAgIGJ5dGVBcnJheS5wdXNoKGxvKTtcbiAgICAgICAgYnl0ZUFycmF5LnB1c2goaGkpO1xuICAgIH1cbiAgICByZXR1cm4gYnl0ZUFycmF5O1xufVxuZnVuY3Rpb24gYmFzZTY0VG9CeXRlcyhzdHIpIHtcbiAgICByZXR1cm4gYmFzZTY0LnRvQnl0ZUFycmF5KGJhc2U2NGNsZWFuKHN0cikpO1xufVxuZnVuY3Rpb24gYmxpdEJ1ZmZlcihzcmMsIGRzdCwgb2Zmc2V0LCBsZW5ndGgpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7XG4gICAgICAgIGlmICgoaSArIG9mZnNldCA+PSBkc3QubGVuZ3RoKSB8fCAoaSA+PSBzcmMubGVuZ3RoKSlcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkc3RbaSArIG9mZnNldF0gPSBzcmNbaV07XG4gICAgfVxuICAgIHJldHVybiBpO1xufVxuZnVuY3Rpb24gaXNuYW4odmFsKSB7XG4gICAgcmV0dXJuIHZhbCAhPT0gdmFsOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXNlbGYtY29tcGFyZVxufVxuXG4vKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi99LmNhbGwodGhpcywgX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi8uLi8uLi8uLi93ZWJwYWNrQDQuNDYuMF93ZWJwYWNrLWNsaUA0LjEwLjAvbm9kZV9tb2R1bGVzL3dlYnBhY2svYnVpbGRpbi9nbG9iYWwuanMgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vd2VicGFja0A0LjQ2LjBfd2VicGFjay1jbGlANC4xMC4wL25vZGVfbW9kdWxlcy93ZWJwYWNrL2J1aWxkaW4vZ2xvYmFsLmpzXCIpKSlcblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9idWZmZXJANC45LjIvbm9kZV9tb2R1bGVzL2J1ZmZlci9pbmRleC5qcz8iKTsKCi8qKiovIH0pLAoKLyoqKi8gIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9kZWJ1Z0A0LjMuNC9ub2RlX21vZHVsZXMvZGVidWcvc3JjL2Jyb3dzZXIuanMiOgovKiEqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlwKICAhKioqIC9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9kZWJ1Z0A0LjMuNC9ub2RlX21vZHVsZXMvZGVidWcvc3JjL2Jyb3dzZXIuanMgKioqIQogIFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CmV2YWwoIi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLyhmdW5jdGlvbihwcm9jZXNzKSB7XG4vKiBlc2xpbnQtZW52IGJyb3dzZXIgKi9cbi8qKlxuICogVGhpcyBpcyB0aGUgd2ViIGJyb3dzZXIgaW1wbGVtZW50YXRpb24gb2YgYGRlYnVnKClgLlxuICovXG5leHBvcnRzLmZvcm1hdEFyZ3MgPSBmb3JtYXRBcmdzO1xuZXhwb3J0cy5zYXZlID0gc2F2ZTtcbmV4cG9ydHMubG9hZCA9IGxvYWQ7XG5leHBvcnRzLnVzZUNvbG9ycyA9IHVzZUNvbG9ycztcbmV4cG9ydHMuc3RvcmFnZSA9IGxvY2Fsc3RvcmFnZSgpO1xuZXhwb3J0cy5kZXN0cm95ID0gKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgd2FybmVkID0gZmFsc2U7XG4gICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCF3YXJuZWQpIHtcbiAgICAgICAgICAgIHdhcm5lZCA9IHRydWU7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ0luc3RhbmNlIG1ldGhvZCBgZGVidWcuZGVzdHJveSgpYCBpcyBkZXByZWNhdGVkIGFuZCBubyBsb25nZXIgZG9lcyBhbnl0aGluZy4gSXQgd2lsbCBiZSByZW1vdmVkIGluIHRoZSBuZXh0IG1ham9yIHZlcnNpb24gb2YgYGRlYnVnYC4nKTtcbiAgICAgICAgfVxuICAgIH07XG59KSgpO1xuLyoqXG4gKiBDb2xvcnMuXG4gKi9cbmV4cG9ydHMuY29sb3JzID0gW1xuICAgICcjMDAwMENDJyxcbiAgICAnIzAwMDBGRicsXG4gICAgJyMwMDMzQ0MnLFxuICAgICcjMDAzM0ZGJyxcbiAgICAnIzAwNjZDQycsXG4gICAgJyMwMDY2RkYnLFxuICAgICcjMDA5OUNDJyxcbiAgICAnIzAwOTlGRicsXG4gICAgJyMwMENDMDAnLFxuICAgICcjMDBDQzMzJyxcbiAgICAnIzAwQ0M2NicsXG4gICAgJyMwMENDOTknLFxuICAgICcjMDBDQ0NDJyxcbiAgICAnIzAwQ0NGRicsXG4gICAgJyMzMzAwQ0MnLFxuICAgICcjMzMwMEZGJyxcbiAgICAnIzMzMzNDQycsXG4gICAgJyMzMzMzRkYnLFxuICAgICcjMzM2NkNDJyxcbiAgICAnIzMzNjZGRicsXG4gICAgJyMzMzk5Q0MnLFxuICAgICcjMzM5OUZGJyxcbiAgICAnIzMzQ0MwMCcsXG4gICAgJyMzM0NDMzMnLFxuICAgICcjMzNDQzY2JyxcbiAgICAnIzMzQ0M5OScsXG4gICAgJyMzM0NDQ0MnLFxuICAgICcjMzNDQ0ZGJyxcbiAgICAnIzY2MDBDQycsXG4gICAgJyM2NjAwRkYnLFxuICAgICcjNjYzM0NDJyxcbiAgICAnIzY2MzNGRicsXG4gICAgJyM2NkNDMDAnLFxuICAgICcjNjZDQzMzJyxcbiAgICAnIzk5MDBDQycsXG4gICAgJyM5OTAwRkYnLFxuICAgICcjOTkzM0NDJyxcbiAgICAnIzk5MzNGRicsXG4gICAgJyM5OUNDMDAnLFxuICAgICcjOTlDQzMzJyxcbiAgICAnI0NDMDAwMCcsXG4gICAgJyNDQzAwMzMnLFxuICAgICcjQ0MwMDY2JyxcbiAgICAnI0NDMDA5OScsXG4gICAgJyNDQzAwQ0MnLFxuICAgICcjQ0MwMEZGJyxcbiAgICAnI0NDMzMwMCcsXG4gICAgJyNDQzMzMzMnLFxuICAgICcjQ0MzMzY2JyxcbiAgICAnI0NDMzM5OScsXG4gICAgJyNDQzMzQ0MnLFxuICAgICcjQ0MzM0ZGJyxcbiAgICAnI0NDNjYwMCcsXG4gICAgJyNDQzY2MzMnLFxuICAgICcjQ0M5OTAwJyxcbiAgICAnI0NDOTkzMycsXG4gICAgJyNDQ0NDMDAnLFxuICAgICcjQ0NDQzMzJyxcbiAgICAnI0ZGMDAwMCcsXG4gICAgJyNGRjAwMzMnLFxuICAgICcjRkYwMDY2JyxcbiAgICAnI0ZGMDA5OScsXG4gICAgJyNGRjAwQ0MnLFxuICAgICcjRkYwMEZGJyxcbiAgICAnI0ZGMzMwMCcsXG4gICAgJyNGRjMzMzMnLFxuICAgICcjRkYzMzY2JyxcbiAgICAnI0ZGMzM5OScsXG4gICAgJyNGRjMzQ0MnLFxuICAgICcjRkYzM0ZGJyxcbiAgICAnI0ZGNjYwMCcsXG4gICAgJyNGRjY2MzMnLFxuICAgICcjRkY5OTAwJyxcbiAgICAnI0ZGOTkzMycsXG4gICAgJyNGRkNDMDAnLFxuICAgICcjRkZDQzMzJ1xuXTtcbi8qKlxuICogQ3VycmVudGx5IG9ubHkgV2ViS2l0LWJhc2VkIFdlYiBJbnNwZWN0b3JzLCBGaXJlZm94ID49IHYzMSxcbiAqIGFuZCB0aGUgRmlyZWJ1ZyBleHRlbnNpb24gKGFueSBGaXJlZm94IHZlcnNpb24pIGFyZSBrbm93blxuICogdG8gc3VwcG9ydCBcIiVjXCIgQ1NTIGN1c3RvbWl6YXRpb25zLlxuICpcbiAqIFRPRE86IGFkZCBhIGBsb2NhbFN0b3JhZ2VgIHZhcmlhYmxlIHRvIGV4cGxpY2l0bHkgZW5hYmxlL2Rpc2FibGUgY29sb3JzXG4gKi9cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjb21wbGV4aXR5XG5mdW5jdGlvbiB1c2VDb2xvcnMoKSB7XG4gICAgLy8gTkI6IEluIGFuIEVsZWN0cm9uIHByZWxvYWQgc2NyaXB0LCBkb2N1bWVudCB3aWxsIGJlIGRlZmluZWQgYnV0IG5vdCBmdWxseVxuICAgIC8vIGluaXRpYWxpemVkLiBTaW5jZSB3ZSBrbm93IHdlJ3JlIGluIENocm9tZSwgd2UnbGwganVzdCBkZXRlY3QgdGhpcyBjYXNlXG4gICAgLy8gZXhwbGljaXRseVxuICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cucHJvY2VzcyAmJiAod2luZG93LnByb2Nlc3MudHlwZSA9PT0gJ3JlbmRlcmVyJyB8fCB3aW5kb3cucHJvY2Vzcy5fX253anMpKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICAvLyBJbnRlcm5ldCBFeHBsb3JlciBhbmQgRWRnZSBkbyBub3Qgc3VwcG9ydCBjb2xvcnMuXG4gICAgaWYgKHR5cGVvZiBuYXZpZ2F0b3IgIT09ICd1bmRlZmluZWQnICYmIG5hdmlnYXRvci51c2VyQWdlbnQgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLm1hdGNoKC8oZWRnZXx0cmlkZW50KVxcLyhcXGQrKS8pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgLy8gSXMgd2Via2l0PyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8xNjQ1OTYwNi8zNzY3NzNcbiAgICAvLyBkb2N1bWVudCBpcyB1bmRlZmluZWQgaW4gcmVhY3QtbmF0aXZlOiBodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svcmVhY3QtbmF0aXZlL3B1bGwvMTYzMlxuICAgIHJldHVybiAodHlwZW9mIGRvY3VtZW50ICE9PSAndW5kZWZpbmVkJyAmJiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgJiYgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlICYmIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5XZWJraXRBcHBlYXJhbmNlKSB8fFxuICAgICAgICAvLyBJcyBmaXJlYnVnPyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8zOTgxMjAvMzc2NzczXG4gICAgICAgICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuY29uc29sZSAmJiAod2luZG93LmNvbnNvbGUuZmlyZWJ1ZyB8fCAod2luZG93LmNvbnNvbGUuZXhjZXB0aW9uICYmIHdpbmRvdy5jb25zb2xlLnRhYmxlKSkpIHx8XG4gICAgICAgIC8vIElzIGZpcmVmb3ggPj0gdjMxP1xuICAgICAgICAvLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1Rvb2xzL1dlYl9Db25zb2xlI1N0eWxpbmdfbWVzc2FnZXNcbiAgICAgICAgKHR5cGVvZiBuYXZpZ2F0b3IgIT09ICd1bmRlZmluZWQnICYmIG5hdmlnYXRvci51c2VyQWdlbnQgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLm1hdGNoKC9maXJlZm94XFwvKFxcZCspLykgJiYgcGFyc2VJbnQoUmVnRXhwLiQxLCAxMCkgPj0gMzEpIHx8XG4gICAgICAgIC8vIERvdWJsZSBjaGVjayB3ZWJraXQgaW4gdXNlckFnZW50IGp1c3QgaW4gY2FzZSB3ZSBhcmUgaW4gYSB3b3JrZXJcbiAgICAgICAgKHR5cGVvZiBuYXZpZ2F0b3IgIT09ICd1bmRlZmluZWQnICYmIG5hdmlnYXRvci51c2VyQWdlbnQgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLm1hdGNoKC9hcHBsZXdlYmtpdFxcLyhcXGQrKS8pKTtcbn1cbi8qKlxuICogQ29sb3JpemUgbG9nIGFyZ3VtZW50cyBpZiBlbmFibGVkLlxuICpcbiAqIEBhcGkgcHVibGljXG4gKi9cbmZ1bmN0aW9uIGZvcm1hdEFyZ3MoYXJncykge1xuICAgIGFyZ3NbMF0gPSAodGhpcy51c2VDb2xvcnMgPyAnJWMnIDogJycpICtcbiAgICAgICAgdGhpcy5uYW1lc3BhY2UgK1xuICAgICAgICAodGhpcy51c2VDb2xvcnMgPyAnICVjJyA6ICcgJykgK1xuICAgICAgICBhcmdzWzBdICtcbiAgICAgICAgKHRoaXMudXNlQ29sb3JzID8gJyVjICcgOiAnICcpICtcbiAgICAgICAgJysnICsgbW9kdWxlLmV4cG9ydHMuaHVtYW5pemUodGhpcy5kaWZmKTtcbiAgICBpZiAoIXRoaXMudXNlQ29sb3JzKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIGMgPSAnY29sb3I6ICcgKyB0aGlzLmNvbG9yO1xuICAgIGFyZ3Muc3BsaWNlKDEsIDAsIGMsICdjb2xvcjogaW5oZXJpdCcpO1xuICAgIC8vIFRoZSBmaW5hbCBcIiVjXCIgaXMgc29tZXdoYXQgdHJpY2t5LCBiZWNhdXNlIHRoZXJlIGNvdWxkIGJlIG90aGVyXG4gICAgLy8gYXJndW1lbnRzIHBhc3NlZCBlaXRoZXIgYmVmb3JlIG9yIGFmdGVyIHRoZSAlYywgc28gd2UgbmVlZCB0b1xuICAgIC8vIGZpZ3VyZSBvdXQgdGhlIGNvcnJlY3QgaW5kZXggdG8gaW5zZXJ0IHRoZSBDU1MgaW50b1xuICAgIHZhciBpbmRleCA9IDA7XG4gICAgdmFyIGxhc3RDID0gMDtcbiAgICBhcmdzWzBdLnJlcGxhY2UoLyVbYS16QS1aJV0vZywgZnVuY3Rpb24gKG1hdGNoKSB7XG4gICAgICAgIGlmIChtYXRjaCA9PT0gJyUlJykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGluZGV4Kys7XG4gICAgICAgIGlmIChtYXRjaCA9PT0gJyVjJykge1xuICAgICAgICAgICAgLy8gV2Ugb25seSBhcmUgaW50ZXJlc3RlZCBpbiB0aGUgKmxhc3QqICVjXG4gICAgICAgICAgICAvLyAodGhlIHVzZXIgbWF5IGhhdmUgcHJvdmlkZWQgdGhlaXIgb3duKVxuICAgICAgICAgICAgbGFzdEMgPSBpbmRleDtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIGFyZ3Muc3BsaWNlKGxhc3RDLCAwLCBjKTtcbn1cbi8qKlxuICogSW52b2tlcyBgY29uc29sZS5kZWJ1ZygpYCB3aGVuIGF2YWlsYWJsZS5cbiAqIE5vLW9wIHdoZW4gYGNvbnNvbGUuZGVidWdgIGlzIG5vdCBhIFwiZnVuY3Rpb25cIi5cbiAqIElmIGBjb25zb2xlLmRlYnVnYCBpcyBub3QgYXZhaWxhYmxlLCBmYWxscyBiYWNrXG4gKiB0byBgY29uc29sZS5sb2dgLlxuICpcbiAqIEBhcGkgcHVibGljXG4gKi9cbmV4cG9ydHMubG9nID0gY29uc29sZS5kZWJ1ZyB8fCBjb25zb2xlLmxvZyB8fCAoZnVuY3Rpb24gKCkgeyB9KTtcbi8qKlxuICogU2F2ZSBgbmFtZXNwYWNlc2AuXG4gKlxuICogQHBhcmFtIHtTdHJpbmd9IG5hbWVzcGFjZXNcbiAqIEBhcGkgcHJpdmF0ZVxuICovXG5mdW5jdGlvbiBzYXZlKG5hbWVzcGFjZXMpIHtcbiAgICB0cnkge1xuICAgICAgICBpZiAobmFtZXNwYWNlcykge1xuICAgICAgICAgICAgZXhwb3J0cy5zdG9yYWdlLnNldEl0ZW0oJ2RlYnVnJywgbmFtZXNwYWNlcyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBleHBvcnRzLnN0b3JhZ2UucmVtb3ZlSXRlbSgnZGVidWcnKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgLy8gU3dhbGxvd1xuICAgICAgICAvLyBYWFggKEBRaXgtKSBzaG91bGQgd2UgYmUgbG9nZ2luZyB0aGVzZT9cbiAgICB9XG59XG4vKipcbiAqIExvYWQgYG5hbWVzcGFjZXNgLlxuICpcbiAqIEByZXR1cm4ge1N0cmluZ30gcmV0dXJucyB0aGUgcHJldmlvdXNseSBwZXJzaXN0ZWQgZGVidWcgbW9kZXNcbiAqIEBhcGkgcHJpdmF0ZVxuICovXG5mdW5jdGlvbiBsb2FkKCkge1xuICAgIHZhciByO1xuICAgIHRyeSB7XG4gICAgICAgIHIgPSBleHBvcnRzLnN0b3JhZ2UuZ2V0SXRlbSgnZGVidWcnKTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIC8vIFN3YWxsb3dcbiAgICAgICAgLy8gWFhYIChAUWl4LSkgc2hvdWxkIHdlIGJlIGxvZ2dpbmcgdGhlc2U/XG4gICAgfVxuICAgIC8vIElmIGRlYnVnIGlzbid0IHNldCBpbiBMUywgYW5kIHdlJ3JlIGluIEVsZWN0cm9uLCB0cnkgdG8gbG9hZCAkREVCVUdcbiAgICBpZiAoIXIgJiYgdHlwZW9mIHByb2Nlc3MgIT09ICd1bmRlZmluZWQnICYmICdlbnYnIGluIHByb2Nlc3MpIHtcbiAgICAgICAgciA9IHByb2Nlc3MuZW52LkRFQlVHO1xuICAgIH1cbiAgICByZXR1cm4gcjtcbn1cbi8qKlxuICogTG9jYWxzdG9yYWdlIGF0dGVtcHRzIHRvIHJldHVybiB0aGUgbG9jYWxzdG9yYWdlLlxuICpcbiAqIFRoaXMgaXMgbmVjZXNzYXJ5IGJlY2F1c2Ugc2FmYXJpIHRocm93c1xuICogd2hlbiBhIHVzZXIgZGlzYWJsZXMgY29va2llcy9sb2NhbHN0b3JhZ2VcbiAqIGFuZCB5b3UgYXR0ZW1wdCB0byBhY2Nlc3MgaXQuXG4gKlxuICogQHJldHVybiB7TG9jYWxTdG9yYWdlfVxuICogQGFwaSBwcml2YXRlXG4gKi9cbmZ1bmN0aW9uIGxvY2Fsc3RvcmFnZSgpIHtcbiAgICB0cnkge1xuICAgICAgICAvLyBUVk1MS2l0IChBcHBsZSBUViBKUyBSdW50aW1lKSBkb2VzIG5vdCBoYXZlIGEgd2luZG93IG9iamVjdCwganVzdCBsb2NhbFN0b3JhZ2UgaW4gdGhlIGdsb2JhbCBjb250ZXh0XG4gICAgICAgIC8vIFRoZSBCcm93c2VyIGFsc28gaGFzIGxvY2FsU3RvcmFnZSBpbiB0aGUgZ2xvYmFsIGNvbnRleHQuXG4gICAgICAgIHJldHVybiBsb2NhbFN0b3JhZ2U7XG4gICAgfVxuICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAvLyBTd2FsbG93XG4gICAgICAgIC8vIFhYWCAoQFFpeC0pIHNob3VsZCB3ZSBiZSBsb2dnaW5nIHRoZXNlP1xuICAgIH1cbn1cbm1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9jb21tb24gKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vZGVidWdANC4zLjQvbm9kZV9tb2R1bGVzL2RlYnVnL3NyYy9jb21tb24uanNcIikoZXhwb3J0cyk7XG52YXIgZm9ybWF0dGVycyA9IG1vZHVsZS5leHBvcnRzLmZvcm1hdHRlcnM7XG4vKipcbiAqIE1hcCAlaiB0byBgSlNPTi5zdHJpbmdpZnkoKWAsIHNpbmNlIG5vIFdlYiBJbnNwZWN0b3JzIGRvIHRoYXQgYnkgZGVmYXVsdC5cbiAqL1xuZm9ybWF0dGVycy5qID0gZnVuY3Rpb24gKHYpIHtcbiAgICB0cnkge1xuICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodik7XG4gICAgfVxuICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXR1cm4gJ1tVbmV4cGVjdGVkSlNPTlBhcnNlRXJyb3JdOiAnICsgZXJyb3IubWVzc2FnZTtcbiAgICB9XG59O1xuXG4vKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi99LmNhbGwodGhpcywgX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi8uLi8uLi8uLi8uLi9wcm9jZXNzQDAuMTEuMTAvbm9kZV9tb2R1bGVzL3Byb2Nlc3MvYnJvd3Nlci5qcyAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9wcm9jZXNzQDAuMTEuMTAvbm9kZV9tb2R1bGVzL3Byb2Nlc3MvYnJvd3Nlci5qc1wiKSkpXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8vaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vZGVidWdANC4zLjQvbm9kZV9tb2R1bGVzL2RlYnVnL3NyYy9icm93c2VyLmpzPyIpOwoKLyoqKi8gfSksCgovKioqLyAiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2RlYnVnQDQuMy40L25vZGVfbW9kdWxlcy9kZWJ1Zy9zcmMvY29tbW9uLmpzIjoKLyohKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlwKICAhKioqIC9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9kZWJ1Z0A0LjMuNC9ub2RlX21vZHVsZXMvZGVidWcvc3JjL2NvbW1vbi5qcyAqKiohCiAgXCoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKiEgbm8gc3RhdGljIGV4cG9ydHMgZm91bmQgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwpldmFsKCJcbi8qKlxuICogVGhpcyBpcyB0aGUgY29tbW9uIGxvZ2ljIGZvciBib3RoIHRoZSBOb2RlLmpzIGFuZCB3ZWIgYnJvd3NlclxuICogaW1wbGVtZW50YXRpb25zIG9mIGBkZWJ1ZygpYC5cbiAqL1xudmFyIF9fc3ByZWFkQXJyYXkgPSAodGhpcyAmJiB0aGlzLl9fc3ByZWFkQXJyYXkpIHx8IGZ1bmN0aW9uICh0bywgZnJvbSwgcGFjaykge1xuICAgIGlmIChwYWNrIHx8IGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIGZvciAodmFyIGkgPSAwLCBsID0gZnJvbS5sZW5ndGgsIGFyOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgIGlmIChhciB8fCAhKGkgaW4gZnJvbSkpIHtcbiAgICAgICAgICAgIGlmICghYXIpIGFyID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZnJvbSwgMCwgaSk7XG4gICAgICAgICAgICBhcltpXSA9IGZyb21baV07XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRvLmNvbmNhdChhciB8fCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChmcm9tKSk7XG59O1xuZnVuY3Rpb24gc2V0dXAoZW52KSB7XG4gICAgY3JlYXRlRGVidWcuZGVidWcgPSBjcmVhdGVEZWJ1ZztcbiAgICBjcmVhdGVEZWJ1Zy5kZWZhdWx0ID0gY3JlYXRlRGVidWc7XG4gICAgY3JlYXRlRGVidWcuY29lcmNlID0gY29lcmNlO1xuICAgIGNyZWF0ZURlYnVnLmRpc2FibGUgPSBkaXNhYmxlO1xuICAgIGNyZWF0ZURlYnVnLmVuYWJsZSA9IGVuYWJsZTtcbiAgICBjcmVhdGVEZWJ1Zy5lbmFibGVkID0gZW5hYmxlZDtcbiAgICBjcmVhdGVEZWJ1Zy5odW1hbml6ZSA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIG1zICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL21zQDIuMS4yL25vZGVfbW9kdWxlcy9tcy9pbmRleC5qc1wiKTtcbiAgICBjcmVhdGVEZWJ1Zy5kZXN0cm95ID0gZGVzdHJveTtcbiAgICBPYmplY3Qua2V5cyhlbnYpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICBjcmVhdGVEZWJ1Z1trZXldID0gZW52W2tleV07XG4gICAgfSk7XG4gICAgLyoqXG4gICAgKiBUaGUgY3VycmVudGx5IGFjdGl2ZSBkZWJ1ZyBtb2RlIG5hbWVzLCBhbmQgbmFtZXMgdG8gc2tpcC5cbiAgICAqL1xuICAgIGNyZWF0ZURlYnVnLm5hbWVzID0gW107XG4gICAgY3JlYXRlRGVidWcuc2tpcHMgPSBbXTtcbiAgICAvKipcbiAgICAqIE1hcCBvZiBzcGVjaWFsIFwiJW5cIiBoYW5kbGluZyBmdW5jdGlvbnMsIGZvciB0aGUgZGVidWcgXCJmb3JtYXRcIiBhcmd1bWVudC5cbiAgICAqXG4gICAgKiBWYWxpZCBrZXkgbmFtZXMgYXJlIGEgc2luZ2xlLCBsb3dlciBvciB1cHBlci1jYXNlIGxldHRlciwgaS5lLiBcIm5cIiBhbmQgXCJOXCIuXG4gICAgKi9cbiAgICBjcmVhdGVEZWJ1Zy5mb3JtYXR0ZXJzID0ge307XG4gICAgLyoqXG4gICAgKiBTZWxlY3RzIGEgY29sb3IgZm9yIGEgZGVidWcgbmFtZXNwYWNlXG4gICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZXNwYWNlIFRoZSBuYW1lc3BhY2Ugc3RyaW5nIGZvciB0aGUgZGVidWcgaW5zdGFuY2UgdG8gYmUgY29sb3JlZFxuICAgICogQHJldHVybiB7TnVtYmVyfFN0cmluZ30gQW4gQU5TSSBjb2xvciBjb2RlIGZvciB0aGUgZ2l2ZW4gbmFtZXNwYWNlXG4gICAgKiBAYXBpIHByaXZhdGVcbiAgICAqL1xuICAgIGZ1bmN0aW9uIHNlbGVjdENvbG9yKG5hbWVzcGFjZSkge1xuICAgICAgICB2YXIgaGFzaCA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbmFtZXNwYWNlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBoYXNoID0gKChoYXNoIDw8IDUpIC0gaGFzaCkgKyBuYW1lc3BhY2UuY2hhckNvZGVBdChpKTtcbiAgICAgICAgICAgIGhhc2ggfD0gMDsgLy8gQ29udmVydCB0byAzMmJpdCBpbnRlZ2VyXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNyZWF0ZURlYnVnLmNvbG9yc1tNYXRoLmFicyhoYXNoKSAlIGNyZWF0ZURlYnVnLmNvbG9ycy5sZW5ndGhdO1xuICAgIH1cbiAgICBjcmVhdGVEZWJ1Zy5zZWxlY3RDb2xvciA9IHNlbGVjdENvbG9yO1xuICAgIC8qKlxuICAgICogQ3JlYXRlIGEgZGVidWdnZXIgd2l0aCB0aGUgZ2l2ZW4gYG5hbWVzcGFjZWAuXG4gICAgKlxuICAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWVzcGFjZVxuICAgICogQHJldHVybiB7RnVuY3Rpb259XG4gICAgKiBAYXBpIHB1YmxpY1xuICAgICovXG4gICAgZnVuY3Rpb24gY3JlYXRlRGVidWcobmFtZXNwYWNlKSB7XG4gICAgICAgIHZhciBwcmV2VGltZTtcbiAgICAgICAgdmFyIGVuYWJsZU92ZXJyaWRlID0gbnVsbDtcbiAgICAgICAgdmFyIG5hbWVzcGFjZXNDYWNoZTtcbiAgICAgICAgdmFyIGVuYWJsZWRDYWNoZTtcbiAgICAgICAgZnVuY3Rpb24gZGVidWcoKSB7XG4gICAgICAgICAgICB2YXIgYXJncyA9IFtdO1xuICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgICAgICBhcmdzW19pXSA9IGFyZ3VtZW50c1tfaV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBEaXNhYmxlZD9cbiAgICAgICAgICAgIGlmICghZGVidWcuZW5hYmxlZCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBzZWxmID0gZGVidWc7XG4gICAgICAgICAgICAvLyBTZXQgYGRpZmZgIHRpbWVzdGFtcFxuICAgICAgICAgICAgdmFyIGN1cnIgPSBOdW1iZXIobmV3IERhdGUoKSk7XG4gICAgICAgICAgICB2YXIgbXMgPSBjdXJyIC0gKHByZXZUaW1lIHx8IGN1cnIpO1xuICAgICAgICAgICAgc2VsZi5kaWZmID0gbXM7XG4gICAgICAgICAgICBzZWxmLnByZXYgPSBwcmV2VGltZTtcbiAgICAgICAgICAgIHNlbGYuY3VyciA9IGN1cnI7XG4gICAgICAgICAgICBwcmV2VGltZSA9IGN1cnI7XG4gICAgICAgICAgICBhcmdzWzBdID0gY3JlYXRlRGVidWcuY29lcmNlKGFyZ3NbMF0pO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBhcmdzWzBdICE9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vIEFueXRoaW5nIGVsc2UgbGV0J3MgaW5zcGVjdCB3aXRoICVPXG4gICAgICAgICAgICAgICAgYXJncy51bnNoaWZ0KCclTycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gQXBwbHkgYW55IGBmb3JtYXR0ZXJzYCB0cmFuc2Zvcm1hdGlvbnNcbiAgICAgICAgICAgIHZhciBpbmRleCA9IDA7XG4gICAgICAgICAgICBhcmdzWzBdID0gYXJnc1swXS5yZXBsYWNlKC8lKFthLXpBLVolXSkvZywgZnVuY3Rpb24gKG1hdGNoLCBmb3JtYXQpIHtcbiAgICAgICAgICAgICAgICAvLyBJZiB3ZSBlbmNvdW50ZXIgYW4gZXNjYXBlZCAlIHRoZW4gZG9uJ3QgaW5jcmVhc2UgdGhlIGFycmF5IGluZGV4XG4gICAgICAgICAgICAgICAgaWYgKG1hdGNoID09PSAnJSUnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnJSc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGluZGV4Kys7XG4gICAgICAgICAgICAgICAgdmFyIGZvcm1hdHRlciA9IGNyZWF0ZURlYnVnLmZvcm1hdHRlcnNbZm9ybWF0XTtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGZvcm1hdHRlciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsID0gYXJnc1tpbmRleF07XG4gICAgICAgICAgICAgICAgICAgIG1hdGNoID0gZm9ybWF0dGVyLmNhbGwoc2VsZiwgdmFsKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gTm93IHdlIG5lZWQgdG8gcmVtb3ZlIGBhcmdzW2luZGV4XWAgc2luY2UgaXQncyBpbmxpbmVkIGluIHRoZSBgZm9ybWF0YFxuICAgICAgICAgICAgICAgICAgICBhcmdzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgICAgIGluZGV4LS07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gQXBwbHkgZW52LXNwZWNpZmljIGZvcm1hdHRpbmcgKGNvbG9ycywgZXRjLilcbiAgICAgICAgICAgIGNyZWF0ZURlYnVnLmZvcm1hdEFyZ3MuY2FsbChzZWxmLCBhcmdzKTtcbiAgICAgICAgICAgIHZhciBsb2dGbiA9IHNlbGYubG9nIHx8IGNyZWF0ZURlYnVnLmxvZztcbiAgICAgICAgICAgIGxvZ0ZuLmFwcGx5KHNlbGYsIGFyZ3MpO1xuICAgICAgICB9XG4gICAgICAgIGRlYnVnLm5hbWVzcGFjZSA9IG5hbWVzcGFjZTtcbiAgICAgICAgZGVidWcudXNlQ29sb3JzID0gY3JlYXRlRGVidWcudXNlQ29sb3JzKCk7XG4gICAgICAgIGRlYnVnLmNvbG9yID0gY3JlYXRlRGVidWcuc2VsZWN0Q29sb3IobmFtZXNwYWNlKTtcbiAgICAgICAgZGVidWcuZXh0ZW5kID0gZXh0ZW5kO1xuICAgICAgICBkZWJ1Zy5kZXN0cm95ID0gY3JlYXRlRGVidWcuZGVzdHJveTsgLy8gWFhYIFRlbXBvcmFyeS4gV2lsbCBiZSByZW1vdmVkIGluIHRoZSBuZXh0IG1ham9yIHJlbGVhc2UuXG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShkZWJ1ZywgJ2VuYWJsZWQnLCB7XG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiBmYWxzZSxcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmIChlbmFibGVPdmVycmlkZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZW5hYmxlT3ZlcnJpZGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChuYW1lc3BhY2VzQ2FjaGUgIT09IGNyZWF0ZURlYnVnLm5hbWVzcGFjZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZXNwYWNlc0NhY2hlID0gY3JlYXRlRGVidWcubmFtZXNwYWNlcztcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlZENhY2hlID0gY3JlYXRlRGVidWcuZW5hYmxlZChuYW1lc3BhY2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZW5hYmxlZENhY2hlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldDogZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgICAgICAgICBlbmFibGVPdmVycmlkZSA9IHY7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBFbnYtc3BlY2lmaWMgaW5pdGlhbGl6YXRpb24gbG9naWMgZm9yIGRlYnVnIGluc3RhbmNlc1xuICAgICAgICBpZiAodHlwZW9mIGNyZWF0ZURlYnVnLmluaXQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIGNyZWF0ZURlYnVnLmluaXQoZGVidWcpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkZWJ1ZztcbiAgICB9XG4gICAgZnVuY3Rpb24gZXh0ZW5kKG5hbWVzcGFjZSwgZGVsaW1pdGVyKSB7XG4gICAgICAgIHZhciBuZXdEZWJ1ZyA9IGNyZWF0ZURlYnVnKHRoaXMubmFtZXNwYWNlICsgKHR5cGVvZiBkZWxpbWl0ZXIgPT09ICd1bmRlZmluZWQnID8gJzonIDogZGVsaW1pdGVyKSArIG5hbWVzcGFjZSk7XG4gICAgICAgIG5ld0RlYnVnLmxvZyA9IHRoaXMubG9nO1xuICAgICAgICByZXR1cm4gbmV3RGVidWc7XG4gICAgfVxuICAgIC8qKlxuICAgICogRW5hYmxlcyBhIGRlYnVnIG1vZGUgYnkgbmFtZXNwYWNlcy4gVGhpcyBjYW4gaW5jbHVkZSBtb2Rlc1xuICAgICogc2VwYXJhdGVkIGJ5IGEgY29sb24gYW5kIHdpbGRjYXJkcy5cbiAgICAqXG4gICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZXNwYWNlc1xuICAgICogQGFwaSBwdWJsaWNcbiAgICAqL1xuICAgIGZ1bmN0aW9uIGVuYWJsZShuYW1lc3BhY2VzKSB7XG4gICAgICAgIGNyZWF0ZURlYnVnLnNhdmUobmFtZXNwYWNlcyk7XG4gICAgICAgIGNyZWF0ZURlYnVnLm5hbWVzcGFjZXMgPSBuYW1lc3BhY2VzO1xuICAgICAgICBjcmVhdGVEZWJ1Zy5uYW1lcyA9IFtdO1xuICAgICAgICBjcmVhdGVEZWJ1Zy5za2lwcyA9IFtdO1xuICAgICAgICB2YXIgaTtcbiAgICAgICAgdmFyIHNwbGl0ID0gKHR5cGVvZiBuYW1lc3BhY2VzID09PSAnc3RyaW5nJyA/IG5hbWVzcGFjZXMgOiAnJykuc3BsaXQoL1tcXHMsXSsvKTtcbiAgICAgICAgdmFyIGxlbiA9IHNwbGl0Lmxlbmd0aDtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoIXNwbGl0W2ldKSB7XG4gICAgICAgICAgICAgICAgLy8gaWdub3JlIGVtcHR5IHN0cmluZ3NcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG5hbWVzcGFjZXMgPSBzcGxpdFtpXS5yZXBsYWNlKC9cXCovZywgJy4qPycpO1xuICAgICAgICAgICAgaWYgKG5hbWVzcGFjZXNbMF0gPT09ICctJykge1xuICAgICAgICAgICAgICAgIGNyZWF0ZURlYnVnLnNraXBzLnB1c2gobmV3IFJlZ0V4cCgnXicgKyBuYW1lc3BhY2VzLnNsaWNlKDEpICsgJyQnKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjcmVhdGVEZWJ1Zy5uYW1lcy5wdXNoKG5ldyBSZWdFeHAoJ14nICsgbmFtZXNwYWNlcyArICckJykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICogRGlzYWJsZSBkZWJ1ZyBvdXRwdXQuXG4gICAgKlxuICAgICogQHJldHVybiB7U3RyaW5nfSBuYW1lc3BhY2VzXG4gICAgKiBAYXBpIHB1YmxpY1xuICAgICovXG4gICAgZnVuY3Rpb24gZGlzYWJsZSgpIHtcbiAgICAgICAgdmFyIG5hbWVzcGFjZXMgPSBfX3NwcmVhZEFycmF5KF9fc3ByZWFkQXJyYXkoW10sIGNyZWF0ZURlYnVnLm5hbWVzLm1hcCh0b05hbWVzcGFjZSksIHRydWUpLCBjcmVhdGVEZWJ1Zy5za2lwcy5tYXAodG9OYW1lc3BhY2UpLm1hcChmdW5jdGlvbiAobmFtZXNwYWNlKSB7IHJldHVybiAnLScgKyBuYW1lc3BhY2U7IH0pLCB0cnVlKS5qb2luKCcsJyk7XG4gICAgICAgIGNyZWF0ZURlYnVnLmVuYWJsZSgnJyk7XG4gICAgICAgIHJldHVybiBuYW1lc3BhY2VzO1xuICAgIH1cbiAgICAvKipcbiAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gbW9kZSBuYW1lIGlzIGVuYWJsZWQsIGZhbHNlIG90aGVyd2lzZS5cbiAgICAqXG4gICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZVxuICAgICogQHJldHVybiB7Qm9vbGVhbn1cbiAgICAqIEBhcGkgcHVibGljXG4gICAgKi9cbiAgICBmdW5jdGlvbiBlbmFibGVkKG5hbWUpIHtcbiAgICAgICAgaWYgKG5hbWVbbmFtZS5sZW5ndGggLSAxXSA9PT0gJyonKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgaTtcbiAgICAgICAgdmFyIGxlbjtcbiAgICAgICAgZm9yIChpID0gMCwgbGVuID0gY3JlYXRlRGVidWcuc2tpcHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChjcmVhdGVEZWJ1Zy5za2lwc1tpXS50ZXN0KG5hbWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZvciAoaSA9IDAsIGxlbiA9IGNyZWF0ZURlYnVnLm5hbWVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoY3JlYXRlRGVidWcubmFtZXNbaV0udGVzdChuYW1lKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgLyoqXG4gICAgKiBDb252ZXJ0IHJlZ2V4cCB0byBuYW1lc3BhY2VcbiAgICAqXG4gICAgKiBAcGFyYW0ge1JlZ0V4cH0gcmVneGVwXG4gICAgKiBAcmV0dXJuIHtTdHJpbmd9IG5hbWVzcGFjZVxuICAgICogQGFwaSBwcml2YXRlXG4gICAgKi9cbiAgICBmdW5jdGlvbiB0b05hbWVzcGFjZShyZWdleHApIHtcbiAgICAgICAgcmV0dXJuIHJlZ2V4cC50b1N0cmluZygpXG4gICAgICAgICAgICAuc3Vic3RyaW5nKDIsIHJlZ2V4cC50b1N0cmluZygpLmxlbmd0aCAtIDIpXG4gICAgICAgICAgICAucmVwbGFjZSgvXFwuXFwqXFw/JC8sICcqJyk7XG4gICAgfVxuICAgIC8qKlxuICAgICogQ29lcmNlIGB2YWxgLlxuICAgICpcbiAgICAqIEBwYXJhbSB7TWl4ZWR9IHZhbFxuICAgICogQHJldHVybiB7TWl4ZWR9XG4gICAgKiBAYXBpIHByaXZhdGVcbiAgICAqL1xuICAgIGZ1bmN0aW9uIGNvZXJjZSh2YWwpIHtcbiAgICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAgICAgICByZXR1cm4gdmFsLnN0YWNrIHx8IHZhbC5tZXNzYWdlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2YWw7XG4gICAgfVxuICAgIC8qKlxuICAgICogWFhYIERPIE5PVCBVU0UuIFRoaXMgaXMgYSB0ZW1wb3Jhcnkgc3R1YiBmdW5jdGlvbi5cbiAgICAqIFhYWCBJdCBXSUxMIGJlIHJlbW92ZWQgaW4gdGhlIG5leHQgbWFqb3IgcmVsZWFzZS5cbiAgICAqL1xuICAgIGZ1bmN0aW9uIGRlc3Ryb3koKSB7XG4gICAgICAgIGNvbnNvbGUud2FybignSW5zdGFuY2UgbWV0aG9kIGBkZWJ1Zy5kZXN0cm95KClgIGlzIGRlcHJlY2F0ZWQgYW5kIG5vIGxvbmdlciBkb2VzIGFueXRoaW5nLiBJdCB3aWxsIGJlIHJlbW92ZWQgaW4gdGhlIG5leHQgbWFqb3IgdmVyc2lvbiBvZiBgZGVidWdgLicpO1xuICAgIH1cbiAgICBjcmVhdGVEZWJ1Zy5lbmFibGUoY3JlYXRlRGVidWcubG9hZCgpKTtcbiAgICByZXR1cm4gY3JlYXRlRGVidWc7XG59XG5tb2R1bGUuZXhwb3J0cyA9IHNldHVwO1xuXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8vaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vZGVidWdANC4zLjQvbm9kZV9tb2R1bGVzL2RlYnVnL3NyYy9jb21tb24uanM/Iik7CgovKioqLyB9KSwKCi8qKiovICIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vaWVlZTc1NEAxLjIuMS9ub2RlX21vZHVsZXMvaWVlZTc1NC9pbmRleC5qcyI6Ci8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlwKICAhKioqIC9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9pZWVlNzU0QDEuMi4xL25vZGVfbW9kdWxlcy9pZWVlNzU0L2luZGV4LmpzICoqKiEKICBcKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKZXZhbCgiXG4vKiEgaWVlZTc1NC4gQlNELTMtQ2xhdXNlIExpY2Vuc2UuIEZlcm9zcyBBYm91a2hhZGlqZWggPGh0dHBzOi8vZmVyb3NzLm9yZy9vcGVuc291cmNlPiAqL1xuZXhwb3J0cy5yZWFkID0gZnVuY3Rpb24gKGJ1ZmZlciwgb2Zmc2V0LCBpc0xFLCBtTGVuLCBuQnl0ZXMpIHtcbiAgICB2YXIgZSwgbTtcbiAgICB2YXIgZUxlbiA9IChuQnl0ZXMgKiA4KSAtIG1MZW4gLSAxO1xuICAgIHZhciBlTWF4ID0gKDEgPDwgZUxlbikgLSAxO1xuICAgIHZhciBlQmlhcyA9IGVNYXggPj4gMTtcbiAgICB2YXIgbkJpdHMgPSAtNztcbiAgICB2YXIgaSA9IGlzTEUgPyAobkJ5dGVzIC0gMSkgOiAwO1xuICAgIHZhciBkID0gaXNMRSA/IC0xIDogMTtcbiAgICB2YXIgcyA9IGJ1ZmZlcltvZmZzZXQgKyBpXTtcbiAgICBpICs9IGQ7XG4gICAgZSA9IHMgJiAoKDEgPDwgKC1uQml0cykpIC0gMSk7XG4gICAgcyA+Pj0gKC1uQml0cyk7XG4gICAgbkJpdHMgKz0gZUxlbjtcbiAgICBmb3IgKDsgbkJpdHMgPiAwOyBlID0gKGUgKiAyNTYpICsgYnVmZmVyW29mZnNldCArIGldLCBpICs9IGQsIG5CaXRzIC09IDgpIHsgfVxuICAgIG0gPSBlICYgKCgxIDw8ICgtbkJpdHMpKSAtIDEpO1xuICAgIGUgPj49ICgtbkJpdHMpO1xuICAgIG5CaXRzICs9IG1MZW47XG4gICAgZm9yICg7IG5CaXRzID4gMDsgbSA9IChtICogMjU2KSArIGJ1ZmZlcltvZmZzZXQgKyBpXSwgaSArPSBkLCBuQml0cyAtPSA4KSB7IH1cbiAgICBpZiAoZSA9PT0gMCkge1xuICAgICAgICBlID0gMSAtIGVCaWFzO1xuICAgIH1cbiAgICBlbHNlIGlmIChlID09PSBlTWF4KSB7XG4gICAgICAgIHJldHVybiBtID8gTmFOIDogKChzID8gLTEgOiAxKSAqIEluZmluaXR5KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIG0gPSBtICsgTWF0aC5wb3coMiwgbUxlbik7XG4gICAgICAgIGUgPSBlIC0gZUJpYXM7XG4gICAgfVxuICAgIHJldHVybiAocyA/IC0xIDogMSkgKiBtICogTWF0aC5wb3coMiwgZSAtIG1MZW4pO1xufTtcbmV4cG9ydHMud3JpdGUgPSBmdW5jdGlvbiAoYnVmZmVyLCB2YWx1ZSwgb2Zmc2V0LCBpc0xFLCBtTGVuLCBuQnl0ZXMpIHtcbiAgICB2YXIgZSwgbSwgYztcbiAgICB2YXIgZUxlbiA9IChuQnl0ZXMgKiA4KSAtIG1MZW4gLSAxO1xuICAgIHZhciBlTWF4ID0gKDEgPDwgZUxlbikgLSAxO1xuICAgIHZhciBlQmlhcyA9IGVNYXggPj4gMTtcbiAgICB2YXIgcnQgPSAobUxlbiA9PT0gMjMgPyBNYXRoLnBvdygyLCAtMjQpIC0gTWF0aC5wb3coMiwgLTc3KSA6IDApO1xuICAgIHZhciBpID0gaXNMRSA/IDAgOiAobkJ5dGVzIC0gMSk7XG4gICAgdmFyIGQgPSBpc0xFID8gMSA6IC0xO1xuICAgIHZhciBzID0gdmFsdWUgPCAwIHx8ICh2YWx1ZSA9PT0gMCAmJiAxIC8gdmFsdWUgPCAwKSA/IDEgOiAwO1xuICAgIHZhbHVlID0gTWF0aC5hYnModmFsdWUpO1xuICAgIGlmIChpc05hTih2YWx1ZSkgfHwgdmFsdWUgPT09IEluZmluaXR5KSB7XG4gICAgICAgIG0gPSBpc05hTih2YWx1ZSkgPyAxIDogMDtcbiAgICAgICAgZSA9IGVNYXg7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBlID0gTWF0aC5mbG9vcihNYXRoLmxvZyh2YWx1ZSkgLyBNYXRoLkxOMik7XG4gICAgICAgIGlmICh2YWx1ZSAqIChjID0gTWF0aC5wb3coMiwgLWUpKSA8IDEpIHtcbiAgICAgICAgICAgIGUtLTtcbiAgICAgICAgICAgIGMgKj0gMjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZSArIGVCaWFzID49IDEpIHtcbiAgICAgICAgICAgIHZhbHVlICs9IHJ0IC8gYztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHZhbHVlICs9IHJ0ICogTWF0aC5wb3coMiwgMSAtIGVCaWFzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodmFsdWUgKiBjID49IDIpIHtcbiAgICAgICAgICAgIGUrKztcbiAgICAgICAgICAgIGMgLz0gMjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZSArIGVCaWFzID49IGVNYXgpIHtcbiAgICAgICAgICAgIG0gPSAwO1xuICAgICAgICAgICAgZSA9IGVNYXg7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZSArIGVCaWFzID49IDEpIHtcbiAgICAgICAgICAgIG0gPSAoKHZhbHVlICogYykgLSAxKSAqIE1hdGgucG93KDIsIG1MZW4pO1xuICAgICAgICAgICAgZSA9IGUgKyBlQmlhcztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG0gPSB2YWx1ZSAqIE1hdGgucG93KDIsIGVCaWFzIC0gMSkgKiBNYXRoLnBvdygyLCBtTGVuKTtcbiAgICAgICAgICAgIGUgPSAwO1xuICAgICAgICB9XG4gICAgfVxuICAgIGZvciAoOyBtTGVuID49IDg7IGJ1ZmZlcltvZmZzZXQgKyBpXSA9IG0gJiAweGZmLCBpICs9IGQsIG0gLz0gMjU2LCBtTGVuIC09IDgpIHsgfVxuICAgIGUgPSAoZSA8PCBtTGVuKSB8IG07XG4gICAgZUxlbiArPSBtTGVuO1xuICAgIGZvciAoOyBlTGVuID4gMDsgYnVmZmVyW29mZnNldCArIGldID0gZSAmIDB4ZmYsIGkgKz0gZCwgZSAvPSAyNTYsIGVMZW4gLT0gOCkgeyB9XG4gICAgYnVmZmVyW29mZnNldCArIGkgLSBkXSB8PSBzICogMTI4O1xufTtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL2llZWU3NTRAMS4yLjEvbm9kZV9tb2R1bGVzL2llZWU3NTQvaW5kZXguanM/Iik7CgovKioqLyB9KSwKCi8qKiovICIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vaXMtb2JzZXJ2YWJsZUAyLjEuMC9ub2RlX21vZHVsZXMvaXMtb2JzZXJ2YWJsZS9pbmRleC5qcyI6Ci8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlwKICAhKioqIC9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9pcy1vYnNlcnZhYmxlQDIuMS4wL25vZGVfbW9kdWxlcy9pcy1vYnNlcnZhYmxlL2luZGV4LmpzICoqKiEKICBcKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKZXZhbCgiXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIGlmICghdmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdXNlLWV4dGVuZC1uYXRpdmUvbm8tdXNlLWV4dGVuZC1uYXRpdmVcbiAgICBpZiAodHlwZW9mIFN5bWJvbC5vYnNlcnZhYmxlID09PSAnc3ltYm9sJyAmJiB0eXBlb2YgdmFsdWVbU3ltYm9sLm9ic2VydmFibGVdID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11c2UtZXh0ZW5kLW5hdGl2ZS9uby11c2UtZXh0ZW5kLW5hdGl2ZVxuICAgICAgICByZXR1cm4gdmFsdWUgPT09IHZhbHVlW1N5bWJvbC5vYnNlcnZhYmxlXSgpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIHZhbHVlWydAQG9ic2VydmFibGUnXSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICByZXR1cm4gdmFsdWUgPT09IHZhbHVlWydAQG9ic2VydmFibGUnXSgpO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59O1xuXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8vaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vaXMtb2JzZXJ2YWJsZUAyLjEuMC9ub2RlX21vZHVsZXMvaXMtb2JzZXJ2YWJsZS9pbmRleC5qcz8iKTsKCi8qKiovIH0pLAoKLyoqKi8gIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9pc2FycmF5QDEuMC4wL25vZGVfbW9kdWxlcy9pc2FycmF5L2luZGV4LmpzIjoKLyohKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiEqXAogICEqKiogL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL2lzYXJyYXlAMS4wLjAvbm9kZV9tb2R1bGVzL2lzYXJyYXkvaW5kZXguanMgKioqIQogIFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKiEgbm8gc3RhdGljIGV4cG9ydHMgZm91bmQgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwpldmFsKCJcbnZhciB0b1N0cmluZyA9IHt9LnRvU3RyaW5nO1xubW9kdWxlLmV4cG9ydHMgPSBBcnJheS5pc0FycmF5IHx8IGZ1bmN0aW9uIChhcnIpIHtcbiAgICByZXR1cm4gdG9TdHJpbmcuY2FsbChhcnIpID09ICdbb2JqZWN0IEFycmF5XSc7XG59O1xuXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8vaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vaXNhcnJheUAxLjAuMC9ub2RlX21vZHVsZXMvaXNhcnJheS9pbmRleC5qcz8iKTsKCi8qKiovIH0pLAoKLyoqKi8gIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9tc0AyLjEuMi9ub2RlX21vZHVsZXMvbXMvaW5kZXguanMiOgovKiEqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlwKICAhKioqIC9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9tc0AyLjEuMi9ub2RlX21vZHVsZXMvbXMvaW5kZXguanMgKioqIQogIFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CmV2YWwoIlxuLyoqXG4gKiBIZWxwZXJzLlxuICovXG52YXIgcyA9IDEwMDA7XG52YXIgbSA9IHMgKiA2MDtcbnZhciBoID0gbSAqIDYwO1xudmFyIGQgPSBoICogMjQ7XG52YXIgdyA9IGQgKiA3O1xudmFyIHkgPSBkICogMzY1LjI1O1xuLyoqXG4gKiBQYXJzZSBvciBmb3JtYXQgdGhlIGdpdmVuIGB2YWxgLlxuICpcbiAqIE9wdGlvbnM6XG4gKlxuICogIC0gYGxvbmdgIHZlcmJvc2UgZm9ybWF0dGluZyBbZmFsc2VdXG4gKlxuICogQHBhcmFtIHtTdHJpbmd8TnVtYmVyfSB2YWxcbiAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cbiAqIEB0aHJvd3Mge0Vycm9yfSB0aHJvdyBhbiBlcnJvciBpZiB2YWwgaXMgbm90IGEgbm9uLWVtcHR5IHN0cmluZyBvciBhIG51bWJlclxuICogQHJldHVybiB7U3RyaW5nfE51bWJlcn1cbiAqIEBhcGkgcHVibGljXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKHZhbCwgb3B0aW9ucykge1xuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgIHZhciB0eXBlID0gdHlwZW9mIHZhbDtcbiAgICBpZiAodHlwZSA9PT0gJ3N0cmluZycgJiYgdmFsLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlKHZhbCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHR5cGUgPT09ICdudW1iZXInICYmIGlzRmluaXRlKHZhbCkpIHtcbiAgICAgICAgcmV0dXJuIG9wdGlvbnMubG9uZyA/IGZtdExvbmcodmFsKSA6IGZtdFNob3J0KHZhbCk7XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcigndmFsIGlzIG5vdCBhIG5vbi1lbXB0eSBzdHJpbmcgb3IgYSB2YWxpZCBudW1iZXIuIHZhbD0nICtcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkodmFsKSk7XG59O1xuLyoqXG4gKiBQYXJzZSB0aGUgZ2l2ZW4gYHN0cmAgYW5kIHJldHVybiBtaWxsaXNlY29uZHMuXG4gKlxuICogQHBhcmFtIHtTdHJpbmd9IHN0clxuICogQHJldHVybiB7TnVtYmVyfVxuICogQGFwaSBwcml2YXRlXG4gKi9cbmZ1bmN0aW9uIHBhcnNlKHN0cikge1xuICAgIHN0ciA9IFN0cmluZyhzdHIpO1xuICAgIGlmIChzdHIubGVuZ3RoID4gMTAwKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIG1hdGNoID0gL14oLT8oPzpcXGQrKT9cXC4/XFxkKykgKihtaWxsaXNlY29uZHM/fG1zZWNzP3xtc3xzZWNvbmRzP3xzZWNzP3xzfG1pbnV0ZXM/fG1pbnM/fG18aG91cnM/fGhycz98aHxkYXlzP3xkfHdlZWtzP3x3fHllYXJzP3x5cnM/fHkpPyQvaS5leGVjKHN0cik7XG4gICAgaWYgKCFtYXRjaCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBuID0gcGFyc2VGbG9hdChtYXRjaFsxXSk7XG4gICAgdmFyIHR5cGUgPSAobWF0Y2hbMl0gfHwgJ21zJykudG9Mb3dlckNhc2UoKTtcbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgY2FzZSAneWVhcnMnOlxuICAgICAgICBjYXNlICd5ZWFyJzpcbiAgICAgICAgY2FzZSAneXJzJzpcbiAgICAgICAgY2FzZSAneXInOlxuICAgICAgICBjYXNlICd5JzpcbiAgICAgICAgICAgIHJldHVybiBuICogeTtcbiAgICAgICAgY2FzZSAnd2Vla3MnOlxuICAgICAgICBjYXNlICd3ZWVrJzpcbiAgICAgICAgY2FzZSAndyc6XG4gICAgICAgICAgICByZXR1cm4gbiAqIHc7XG4gICAgICAgIGNhc2UgJ2RheXMnOlxuICAgICAgICBjYXNlICdkYXknOlxuICAgICAgICBjYXNlICdkJzpcbiAgICAgICAgICAgIHJldHVybiBuICogZDtcbiAgICAgICAgY2FzZSAnaG91cnMnOlxuICAgICAgICBjYXNlICdob3VyJzpcbiAgICAgICAgY2FzZSAnaHJzJzpcbiAgICAgICAgY2FzZSAnaHInOlxuICAgICAgICBjYXNlICdoJzpcbiAgICAgICAgICAgIHJldHVybiBuICogaDtcbiAgICAgICAgY2FzZSAnbWludXRlcyc6XG4gICAgICAgIGNhc2UgJ21pbnV0ZSc6XG4gICAgICAgIGNhc2UgJ21pbnMnOlxuICAgICAgICBjYXNlICdtaW4nOlxuICAgICAgICBjYXNlICdtJzpcbiAgICAgICAgICAgIHJldHVybiBuICogbTtcbiAgICAgICAgY2FzZSAnc2Vjb25kcyc6XG4gICAgICAgIGNhc2UgJ3NlY29uZCc6XG4gICAgICAgIGNhc2UgJ3NlY3MnOlxuICAgICAgICBjYXNlICdzZWMnOlxuICAgICAgICBjYXNlICdzJzpcbiAgICAgICAgICAgIHJldHVybiBuICogcztcbiAgICAgICAgY2FzZSAnbWlsbGlzZWNvbmRzJzpcbiAgICAgICAgY2FzZSAnbWlsbGlzZWNvbmQnOlxuICAgICAgICBjYXNlICdtc2Vjcyc6XG4gICAgICAgIGNhc2UgJ21zZWMnOlxuICAgICAgICBjYXNlICdtcyc6XG4gICAgICAgICAgICByZXR1cm4gbjtcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxufVxuLyoqXG4gKiBTaG9ydCBmb3JtYXQgZm9yIGBtc2AuXG4gKlxuICogQHBhcmFtIHtOdW1iZXJ9IG1zXG4gKiBAcmV0dXJuIHtTdHJpbmd9XG4gKiBAYXBpIHByaXZhdGVcbiAqL1xuZnVuY3Rpb24gZm10U2hvcnQobXMpIHtcbiAgICB2YXIgbXNBYnMgPSBNYXRoLmFicyhtcyk7XG4gICAgaWYgKG1zQWJzID49IGQpIHtcbiAgICAgICAgcmV0dXJuIE1hdGgucm91bmQobXMgLyBkKSArICdkJztcbiAgICB9XG4gICAgaWYgKG1zQWJzID49IGgpIHtcbiAgICAgICAgcmV0dXJuIE1hdGgucm91bmQobXMgLyBoKSArICdoJztcbiAgICB9XG4gICAgaWYgKG1zQWJzID49IG0pIHtcbiAgICAgICAgcmV0dXJuIE1hdGgucm91bmQobXMgLyBtKSArICdtJztcbiAgICB9XG4gICAgaWYgKG1zQWJzID49IHMpIHtcbiAgICAgICAgcmV0dXJuIE1hdGgucm91bmQobXMgLyBzKSArICdzJztcbiAgICB9XG4gICAgcmV0dXJuIG1zICsgJ21zJztcbn1cbi8qKlxuICogTG9uZyBmb3JtYXQgZm9yIGBtc2AuXG4gKlxuICogQHBhcmFtIHtOdW1iZXJ9IG1zXG4gKiBAcmV0dXJuIHtTdHJpbmd9XG4gKiBAYXBpIHByaXZhdGVcbiAqL1xuZnVuY3Rpb24gZm10TG9uZyhtcykge1xuICAgIHZhciBtc0FicyA9IE1hdGguYWJzKG1zKTtcbiAgICBpZiAobXNBYnMgPj0gZCkge1xuICAgICAgICByZXR1cm4gcGx1cmFsKG1zLCBtc0FicywgZCwgJ2RheScpO1xuICAgIH1cbiAgICBpZiAobXNBYnMgPj0gaCkge1xuICAgICAgICByZXR1cm4gcGx1cmFsKG1zLCBtc0FicywgaCwgJ2hvdXInKTtcbiAgICB9XG4gICAgaWYgKG1zQWJzID49IG0pIHtcbiAgICAgICAgcmV0dXJuIHBsdXJhbChtcywgbXNBYnMsIG0sICdtaW51dGUnKTtcbiAgICB9XG4gICAgaWYgKG1zQWJzID49IHMpIHtcbiAgICAgICAgcmV0dXJuIHBsdXJhbChtcywgbXNBYnMsIHMsICdzZWNvbmQnKTtcbiAgICB9XG4gICAgcmV0dXJuIG1zICsgJyBtcyc7XG59XG4vKipcbiAqIFBsdXJhbGl6YXRpb24gaGVscGVyLlxuICovXG5mdW5jdGlvbiBwbHVyYWwobXMsIG1zQWJzLCBuLCBuYW1lKSB7XG4gICAgdmFyIGlzUGx1cmFsID0gbXNBYnMgPj0gbiAqIDEuNTtcbiAgICByZXR1cm4gTWF0aC5yb3VuZChtcyAvIG4pICsgJyAnICsgbmFtZSArIChpc1BsdXJhbCA/ICdzJyA6ICcnKTtcbn1cblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL21zQDIuMS4yL25vZGVfbW9kdWxlcy9tcy9pbmRleC5qcz8iKTsKCi8qKiovIH0pLAoKLyoqKi8gIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vX3NjaGVkdWxlci5qcyI6Ci8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqISpcCiAgISoqKiAvaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vb2JzZXJ2YWJsZS1mbnNAMC42LjEvbm9kZV9tb2R1bGVzL29ic2VydmFibGUtZm5zL2Rpc3QuZXNtL19zY2hlZHVsZXIuanMgKioqIQogIFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKZXZhbCgiXG52YXIgX19nZW5lcmF0b3IgPSAodGhpcyAmJiB0aGlzLl9fZ2VuZXJhdG9yKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgYm9keSkge1xuICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGc7XG4gICAgcmV0dXJuIGcgPSB7IG5leHQ6IHZlcmIoMCksIFwidGhyb3dcIjogdmVyYigxKSwgXCJyZXR1cm5cIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7XG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IHJldHVybiBmdW5jdGlvbiAodikgeyByZXR1cm4gc3RlcChbbiwgdl0pOyB9OyB9XG4gICAgZnVuY3Rpb24gc3RlcChvcCkge1xuICAgICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XG4gICAgICAgIHdoaWxlIChfKSB0cnkge1xuICAgICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0gb3BbMF0gJiAyID8geVtcInJldHVyblwiXSA6IG9wWzBdID8geVtcInRocm93XCJdIHx8ICgodCA9IHlbXCJyZXR1cm5cIl0pICYmIHQuY2FsbCh5KSwgMCkgOiB5Lm5leHQpICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0O1xuICAgICAgICAgICAgaWYgKHkgPSAwLCB0KSBvcCA9IFtvcFswXSAmIDIsIHQudmFsdWVdO1xuICAgICAgICAgICAgc3dpdGNoIChvcFswXSkge1xuICAgICAgICAgICAgICAgIGNhc2UgMDogY2FzZSAxOiB0ID0gb3A7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNDogXy5sYWJlbCsrOyByZXR1cm4geyB2YWx1ZTogb3BbMV0sIGRvbmU6IGZhbHNlIH07XG4gICAgICAgICAgICAgICAgY2FzZSA1OiBfLmxhYmVsKys7IHkgPSBvcFsxXTsgb3AgPSBbMF07IGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIGNhc2UgNzogb3AgPSBfLm9wcy5wb3AoKTsgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBpZiAoISh0ID0gXy50cnlzLCB0ID0gdC5sZW5ndGggPiAwICYmIHRbdC5sZW5ndGggLSAxXSkgJiYgKG9wWzBdID09PSA2IHx8IG9wWzBdID09PSAyKSkgeyBfID0gMDsgY29udGludWU7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCAob3BbMV0gPiB0WzBdICYmIG9wWzFdIDwgdFszXSkpKSB7IF8ubGFiZWwgPSBvcFsxXTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7IF8ubGFiZWwgPSB0WzFdOyB0ID0gb3A7IGJyZWFrOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIF8ubGFiZWwgPCB0WzJdKSB7IF8ubGFiZWwgPSB0WzJdOyBfLm9wcy5wdXNoKG9wKTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRbMl0pIF8ub3BzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3AgPSBib2R5LmNhbGwodGhpc0FyZywgXyk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgb3AgPSBbNiwgZV07IHkgPSAwOyB9IGZpbmFsbHkgeyBmID0gdCA9IDA7IH1cbiAgICAgICAgaWYgKG9wWzBdICYgNSkgdGhyb3cgb3BbMV07IHJldHVybiB7IHZhbHVlOiBvcFswXSA/IG9wWzFdIDogdm9pZCAwLCBkb25lOiB0cnVlIH07XG4gICAgfVxufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQXN5bmNTZXJpYWxTY2hlZHVsZXIgPSB2b2lkIDA7XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7XG4gICAgICAgICAgICBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7XG4gICAgICAgICAgICBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgQXN5bmNTZXJpYWxTY2hlZHVsZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQXN5bmNTZXJpYWxTY2hlZHVsZXIob2JzZXJ2ZXIpIHtcbiAgICAgICAgdGhpcy5fYmFzZU9ic2VydmVyID0gb2JzZXJ2ZXI7XG4gICAgICAgIHRoaXMuX3BlbmRpbmdQcm9taXNlcyA9IG5ldyBTZXQoKTtcbiAgICB9XG4gICAgQXN5bmNTZXJpYWxTY2hlZHVsZXIucHJvdG90eXBlLmNvbXBsZXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBQcm9taXNlLmFsbCh0aGlzLl9wZW5kaW5nUHJvbWlzZXMpXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5fYmFzZU9ic2VydmVyLmNvbXBsZXRlKCk7IH0pXG4gICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7IHJldHVybiBfdGhpcy5fYmFzZU9ic2VydmVyLmVycm9yKGVycm9yKTsgfSk7XG4gICAgfTtcbiAgICBBc3luY1NlcmlhbFNjaGVkdWxlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgdGhpcy5fYmFzZU9ic2VydmVyLmVycm9yKGVycm9yKTtcbiAgICB9O1xuICAgIEFzeW5jU2VyaWFsU2NoZWR1bGVyLnByb3RvdHlwZS5zY2hlZHVsZSA9IGZ1bmN0aW9uICh0YXNrKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBwcmV2UHJvbWlzZXNDb21wbGV0aW9uID0gUHJvbWlzZS5hbGwodGhpcy5fcGVuZGluZ1Byb21pc2VzKTtcbiAgICAgICAgdmFyIHZhbHVlcyA9IFtdO1xuICAgICAgICB2YXIgbmV4dCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWVzLnB1c2godmFsdWUpOyB9O1xuICAgICAgICB2YXIgcHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZSgpXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiBfX2F3YWl0ZXIoX3RoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgX2ksIHZhbHVlc18xLCB2YWx1ZTtcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDogcmV0dXJuIFs0IC8qeWllbGQqLywgcHJldlByb21pc2VzQ29tcGxldGlvbl07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHRhc2sobmV4dCldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9wZW5kaW5nUHJvbWlzZXMuZGVsZXRlKHByb21pc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChfaSA9IDAsIHZhbHVlc18xID0gdmFsdWVzOyBfaSA8IHZhbHVlc18xLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWVzXzFbX2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2Jhc2VPYnNlcnZlci5uZXh0KHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7IH0pXG4gICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICBfdGhpcy5fcGVuZGluZ1Byb21pc2VzLmRlbGV0ZShwcm9taXNlKTtcbiAgICAgICAgICAgIF90aGlzLl9iYXNlT2JzZXJ2ZXIuZXJyb3IoZXJyb3IpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5fcGVuZGluZ1Byb21pc2VzLmFkZChwcm9taXNlKTtcbiAgICB9O1xuICAgIHJldHVybiBBc3luY1NlcmlhbFNjaGVkdWxlcjtcbn0oKSk7XG5leHBvcnRzLkFzeW5jU2VyaWFsU2NoZWR1bGVyID0gQXN5bmNTZXJpYWxTY2hlZHVsZXI7XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vX3NjaGVkdWxlci5qcz8iKTsKCi8qKiovIH0pLAoKLyoqKi8gIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vX3N5bWJvbHMuanMiOgovKiEqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlwKICAhKioqIC9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vX3N5bWJvbHMuanMgKioqIQogIFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CmV2YWwoIlxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5yZWdpc3Rlck9ic2VydmFibGVTeW1ib2wgPSBleHBvcnRzLmdldFN5bWJvbCA9IGV4cG9ydHMuaGFzU3ltYm9sID0gZXhwb3J0cy5oYXNTeW1ib2xzID0gdm9pZCAwO1xudmFyIGhhc1N5bWJvbHMgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCI7IH07XG5leHBvcnRzLmhhc1N5bWJvbHMgPSBoYXNTeW1ib2xzO1xudmFyIGhhc1N5bWJvbCA9IGZ1bmN0aW9uIChuYW1lKSB7IHJldHVybiAoMCwgZXhwb3J0cy5oYXNTeW1ib2xzKSgpICYmIEJvb2xlYW4oU3ltYm9sW25hbWVdKTsgfTtcbmV4cG9ydHMuaGFzU3ltYm9sID0gaGFzU3ltYm9sO1xudmFyIGdldFN5bWJvbCA9IGZ1bmN0aW9uIChuYW1lKSB7IHJldHVybiAoMCwgZXhwb3J0cy5oYXNTeW1ib2wpKG5hbWUpID8gU3ltYm9sW25hbWVdIDogXCJAQFwiICsgbmFtZTsgfTtcbmV4cG9ydHMuZ2V0U3ltYm9sID0gZ2V0U3ltYm9sO1xuZnVuY3Rpb24gcmVnaXN0ZXJPYnNlcnZhYmxlU3ltYm9sKCkge1xuICAgIGlmICgoMCwgZXhwb3J0cy5oYXNTeW1ib2xzKSgpICYmICEoMCwgZXhwb3J0cy5oYXNTeW1ib2wpKFwib2JzZXJ2YWJsZVwiKSkge1xuICAgICAgICBTeW1ib2wub2JzZXJ2YWJsZSA9IFN5bWJvbChcIm9ic2VydmFibGVcIik7XG4gICAgfVxufVxuZXhwb3J0cy5yZWdpc3Rlck9ic2VydmFibGVTeW1ib2wgPSByZWdpc3Rlck9ic2VydmFibGVTeW1ib2w7XG5pZiAoISgwLCBleHBvcnRzLmhhc1N5bWJvbCkoXCJhc3luY0l0ZXJhdG9yXCIpKSB7XG4gICAgU3ltYm9sLmFzeW5jSXRlcmF0b3IgPSBTeW1ib2wuYXN5bmNJdGVyYXRvciB8fCBTeW1ib2wuZm9yKFwiU3ltYm9sLmFzeW5jSXRlcmF0b3JcIik7XG59XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vX3N5bWJvbHMuanM/Iik7CgovKioqLyB9KSwKCi8qKiovICIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vb2JzZXJ2YWJsZS1mbnNAMC42LjEvbm9kZV9tb2R1bGVzL29ic2VydmFibGUtZm5zL2Rpc3QuZXNtL191dGlsLmpzIjoKLyohKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqISpcCiAgISoqKiAvaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vb2JzZXJ2YWJsZS1mbnNAMC42LjEvbm9kZV9tb2R1bGVzL29ic2VydmFibGUtZm5zL2Rpc3QuZXNtL191dGlsLmpzICoqKiEKICBcKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKiEgbm8gc3RhdGljIGV4cG9ydHMgZm91bmQgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwpldmFsKCJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuaXNJdGVyYXRvciA9IGV4cG9ydHMuaXNBc3luY0l0ZXJhdG9yID0gdm9pZCAwO1xuLy8vIDxyZWZlcmVuY2UgbGliPVwiZXMyMDE4XCIgLz5cbnZhciBfc3ltYm9sc18xID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9fc3ltYm9scyAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vX3N5bWJvbHMuanNcIik7XG5mdW5jdGlvbiBpc0FzeW5jSXRlcmF0b3IodGhpbmcpIHtcbiAgICByZXR1cm4gdGhpbmcgJiYgKDAsIF9zeW1ib2xzXzEuaGFzU3ltYm9sKShcImFzeW5jSXRlcmF0b3JcIikgJiYgdGhpbmdbU3ltYm9sLmFzeW5jSXRlcmF0b3JdO1xufVxuZXhwb3J0cy5pc0FzeW5jSXRlcmF0b3IgPSBpc0FzeW5jSXRlcmF0b3I7XG5mdW5jdGlvbiBpc0l0ZXJhdG9yKHRoaW5nKSB7XG4gICAgcmV0dXJuIHRoaW5nICYmICgwLCBfc3ltYm9sc18xLmhhc1N5bWJvbCkoXCJpdGVyYXRvclwiKSAmJiB0aGluZ1tTeW1ib2wuaXRlcmF0b3JdO1xufVxuZXhwb3J0cy5pc0l0ZXJhdG9yID0gaXNJdGVyYXRvcjtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL29ic2VydmFibGUtZm5zQDAuNi4xL25vZGVfbW9kdWxlcy9vYnNlcnZhYmxlLWZucy9kaXN0LmVzbS9fdXRpbC5qcz8iKTsKCi8qKiovIH0pLAoKLyoqKi8gIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vZmlsdGVyLmpzIjoKLyohKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiEqXAogICEqKiogL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL29ic2VydmFibGUtZm5zQDAuNi4xL25vZGVfbW9kdWxlcy9vYnNlcnZhYmxlLWZucy9kaXN0LmVzbS9maWx0ZXIuanMgKioqIQogIFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKiEgbm8gc3RhdGljIGV4cG9ydHMgZm91bmQgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwpldmFsKCJcbnZhciBfX2dlbmVyYXRvciA9ICh0aGlzICYmIHRoaXMuX19nZW5lcmF0b3IpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBib2R5KSB7XG4gICAgdmFyIF8gPSB7IGxhYmVsOiAwLCBzZW50OiBmdW5jdGlvbigpIHsgaWYgKHRbMF0gJiAxKSB0aHJvdyB0WzFdOyByZXR1cm4gdFsxXTsgfSwgdHJ5czogW10sIG9wczogW10gfSwgZiwgeSwgdCwgZztcbiAgICByZXR1cm4gZyA9IHsgbmV4dDogdmVyYigwKSwgXCJ0aHJvd1wiOiB2ZXJiKDEpLCBcInJldHVyblwiOiB2ZXJiKDIpIH0sIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiAoZ1tTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KSwgZztcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgcmV0dXJuIGZ1bmN0aW9uICh2KSB7IHJldHVybiBzdGVwKFtuLCB2XSk7IH07IH1cbiAgICBmdW5jdGlvbiBzdGVwKG9wKSB7XG4gICAgICAgIGlmIChmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiR2VuZXJhdG9yIGlzIGFscmVhZHkgZXhlY3V0aW5nLlwiKTtcbiAgICAgICAgd2hpbGUgKF8pIHRyeSB7XG4gICAgICAgICAgICBpZiAoZiA9IDEsIHkgJiYgKHQgPSBvcFswXSAmIDIgPyB5W1wicmV0dXJuXCJdIDogb3BbMF0gPyB5W1widGhyb3dcIl0gfHwgKCh0ID0geVtcInJldHVyblwiXSkgJiYgdC5jYWxsKHkpLCAwKSA6IHkubmV4dCkgJiYgISh0ID0gdC5jYWxsKHksIG9wWzFdKSkuZG9uZSkgcmV0dXJuIHQ7XG4gICAgICAgICAgICBpZiAoeSA9IDAsIHQpIG9wID0gW29wWzBdICYgMiwgdC52YWx1ZV07XG4gICAgICAgICAgICBzd2l0Y2ggKG9wWzBdKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAwOiBjYXNlIDE6IHQgPSBvcDsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSA0OiBfLmxhYmVsKys7IHJldHVybiB7IHZhbHVlOiBvcFsxXSwgZG9uZTogZmFsc2UgfTtcbiAgICAgICAgICAgICAgICBjYXNlIDU6IF8ubGFiZWwrKzsgeSA9IG9wWzFdOyBvcCA9IFswXTsgY29udGludWU7XG4gICAgICAgICAgICAgICAgY2FzZSA3OiBvcCA9IF8ub3BzLnBvcCgpOyBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIGlmICghKHQgPSBfLnRyeXMsIHQgPSB0Lmxlbmd0aCA+IDAgJiYgdFt0Lmxlbmd0aCAtIDFdKSAmJiAob3BbMF0gPT09IDYgfHwgb3BbMF0gPT09IDIpKSB7IF8gPSAwOyBjb250aW51ZTsgfVxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDMgJiYgKCF0IHx8IChvcFsxXSA+IHRbMF0gJiYgb3BbMV0gPCB0WzNdKSkpIHsgXy5sYWJlbCA9IG9wWzFdOyBicmVhazsgfVxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDYgJiYgXy5sYWJlbCA8IHRbMV0pIHsgXy5sYWJlbCA9IHRbMV07IHQgPSBvcDsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgXy5sYWJlbCA8IHRbMl0pIHsgXy5sYWJlbCA9IHRbMl07IF8ub3BzLnB1c2gob3ApOyBicmVhazsgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodFsyXSkgXy5vcHMucG9wKCk7XG4gICAgICAgICAgICAgICAgICAgIF8udHJ5cy5wb3AoKTsgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvcCA9IGJvZHkuY2FsbCh0aGlzQXJnLCBfKTtcbiAgICAgICAgfSBjYXRjaCAoZSkgeyBvcCA9IFs2LCBlXTsgeSA9IDA7IH0gZmluYWxseSB7IGYgPSB0ID0gMDsgfVxuICAgICAgICBpZiAob3BbMF0gJiA1KSB0aHJvdyBvcFsxXTsgcmV0dXJuIHsgdmFsdWU6IG9wWzBdID8gb3BbMV0gOiB2b2lkIDAsIGRvbmU6IHRydWUgfTtcbiAgICB9XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkge1xuICAgICAgICAgICAgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgIH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkge1xuICAgICAgICAgICAgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgIH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9zY2hlZHVsZXJfMSA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vX3NjaGVkdWxlciAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vX3NjaGVkdWxlci5qc1wiKTtcbnZhciBvYnNlcnZhYmxlXzEgPSBfX2ltcG9ydERlZmF1bHQoX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9vYnNlcnZhYmxlICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL29ic2VydmFibGUtZm5zQDAuNi4xL25vZGVfbW9kdWxlcy9vYnNlcnZhYmxlLWZucy9kaXN0LmVzbS9vYnNlcnZhYmxlLmpzXCIpKTtcbnZhciB1bnN1YnNjcmliZV8xID0gX19pbXBvcnREZWZhdWx0KF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vdW5zdWJzY3JpYmUgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vb2JzZXJ2YWJsZS1mbnNAMC42LjEvbm9kZV9tb2R1bGVzL29ic2VydmFibGUtZm5zL2Rpc3QuZXNtL3Vuc3Vic2NyaWJlLmpzXCIpKTtcbi8qKlxuICogRmlsdGVycyB0aGUgdmFsdWVzIGVtaXR0ZWQgYnkgYW5vdGhlciBvYnNlcnZhYmxlLlxuICogVG8gYmUgYXBwbGllZCB0byBhbiBpbnB1dCBvYnNlcnZhYmxlIHVzaW5nIGBwaXBlKClgLlxuICovXG5mdW5jdGlvbiBmaWx0ZXIodGVzdCkge1xuICAgIHJldHVybiBmdW5jdGlvbiAob2JzZXJ2YWJsZSkge1xuICAgICAgICByZXR1cm4gbmV3IG9ic2VydmFibGVfMS5kZWZhdWx0KGZ1bmN0aW9uIChvYnNlcnZlcikge1xuICAgICAgICAgICAgdmFyIHNjaGVkdWxlciA9IG5ldyBfc2NoZWR1bGVyXzEuQXN5bmNTZXJpYWxTY2hlZHVsZXIob2JzZXJ2ZXIpO1xuICAgICAgICAgICAgdmFyIHN1YnNjcmlwdGlvbiA9IG9ic2VydmFibGUuc3Vic2NyaWJlKHtcbiAgICAgICAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBzY2hlZHVsZXIuY29tcGxldGUoKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NoZWR1bGVyLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG5leHQ6IGZ1bmN0aW9uIChpbnB1dCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICBzY2hlZHVsZXIuc2NoZWR1bGUoZnVuY3Rpb24gKG5leHQpIHsgcmV0dXJuIF9fYXdhaXRlcihfdGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDogcmV0dXJuIFs0IC8qeWllbGQqLywgdGVzdChpbnB1dCldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoX2Euc2VudCgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dChpbnB1dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pOyB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7IHJldHVybiAoMCwgdW5zdWJzY3JpYmVfMS5kZWZhdWx0KShzdWJzY3JpcHRpb24pOyB9O1xuICAgICAgICB9KTtcbiAgICB9O1xufVxuZXhwb3J0cy5kZWZhdWx0ID0gZmlsdGVyO1xuXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8vaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vb2JzZXJ2YWJsZS1mbnNAMC42LjEvbm9kZV9tb2R1bGVzL29ic2VydmFibGUtZm5zL2Rpc3QuZXNtL2ZpbHRlci5qcz8iKTsKCi8qKiovIH0pLAoKLyoqKi8gIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vZmxhdE1hcC5qcyI6Ci8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqISpcCiAgISoqKiAvaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vb2JzZXJ2YWJsZS1mbnNAMC42LjEvbm9kZV9tb2R1bGVzL29ic2VydmFibGUtZm5zL2Rpc3QuZXNtL2ZsYXRNYXAuanMgKioqIQogIFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKZXZhbCgiXG52YXIgX19nZW5lcmF0b3IgPSAodGhpcyAmJiB0aGlzLl9fZ2VuZXJhdG9yKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgYm9keSkge1xuICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGc7XG4gICAgcmV0dXJuIGcgPSB7IG5leHQ6IHZlcmIoMCksIFwidGhyb3dcIjogdmVyYigxKSwgXCJyZXR1cm5cIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7XG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IHJldHVybiBmdW5jdGlvbiAodikgeyByZXR1cm4gc3RlcChbbiwgdl0pOyB9OyB9XG4gICAgZnVuY3Rpb24gc3RlcChvcCkge1xuICAgICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XG4gICAgICAgIHdoaWxlIChfKSB0cnkge1xuICAgICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0gb3BbMF0gJiAyID8geVtcInJldHVyblwiXSA6IG9wWzBdID8geVtcInRocm93XCJdIHx8ICgodCA9IHlbXCJyZXR1cm5cIl0pICYmIHQuY2FsbCh5KSwgMCkgOiB5Lm5leHQpICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0O1xuICAgICAgICAgICAgaWYgKHkgPSAwLCB0KSBvcCA9IFtvcFswXSAmIDIsIHQudmFsdWVdO1xuICAgICAgICAgICAgc3dpdGNoIChvcFswXSkge1xuICAgICAgICAgICAgICAgIGNhc2UgMDogY2FzZSAxOiB0ID0gb3A7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNDogXy5sYWJlbCsrOyByZXR1cm4geyB2YWx1ZTogb3BbMV0sIGRvbmU6IGZhbHNlIH07XG4gICAgICAgICAgICAgICAgY2FzZSA1OiBfLmxhYmVsKys7IHkgPSBvcFsxXTsgb3AgPSBbMF07IGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIGNhc2UgNzogb3AgPSBfLm9wcy5wb3AoKTsgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBpZiAoISh0ID0gXy50cnlzLCB0ID0gdC5sZW5ndGggPiAwICYmIHRbdC5sZW5ndGggLSAxXSkgJiYgKG9wWzBdID09PSA2IHx8IG9wWzBdID09PSAyKSkgeyBfID0gMDsgY29udGludWU7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCAob3BbMV0gPiB0WzBdICYmIG9wWzFdIDwgdFszXSkpKSB7IF8ubGFiZWwgPSBvcFsxXTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7IF8ubGFiZWwgPSB0WzFdOyB0ID0gb3A7IGJyZWFrOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIF8ubGFiZWwgPCB0WzJdKSB7IF8ubGFiZWwgPSB0WzJdOyBfLm9wcy5wdXNoKG9wKTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRbMl0pIF8ub3BzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3AgPSBib2R5LmNhbGwodGhpc0FyZywgXyk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgb3AgPSBbNiwgZV07IHkgPSAwOyB9IGZpbmFsbHkgeyBmID0gdCA9IDA7IH1cbiAgICAgICAgaWYgKG9wWzBdICYgNSkgdGhyb3cgb3BbMV07IHJldHVybiB7IHZhbHVlOiBvcFswXSA/IG9wWzFdIDogdm9pZCAwLCBkb25lOiB0cnVlIH07XG4gICAgfVxufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHtcbiAgICAgICAgICAgIHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHtcbiAgICAgICAgICAgIHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2FzeW5jVmFsdWVzID0gKHRoaXMgJiYgdGhpcy5fX2FzeW5jVmFsdWVzKSB8fCBmdW5jdGlvbiAobykge1xuICAgIGlmICghU3ltYm9sLmFzeW5jSXRlcmF0b3IpXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XG4gICAgdmFyIG0gPSBvW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSwgaTtcbiAgICByZXR1cm4gbSA/IG0uY2FsbChvKSA6IChvID0gdHlwZW9mIF9fdmFsdWVzID09PSBcImZ1bmN0aW9uXCIgPyBfX3ZhbHVlcyhvKSA6IG9bU3ltYm9sLml0ZXJhdG9yXSgpLCBpID0ge30sIHZlcmIoXCJuZXh0XCIpLCB2ZXJiKFwidGhyb3dcIiksIHZlcmIoXCJyZXR1cm5cIiksIGlbU3ltYm9sLmFzeW5jSXRlcmF0b3JdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfSwgaSk7XG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IGlbbl0gPSBvW25dICYmIGZ1bmN0aW9uICh2KSB7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHYgPSBvW25dKHYpLCBzZXR0bGUocmVzb2x2ZSwgcmVqZWN0LCB2LmRvbmUsIHYudmFsdWUpOyB9KTsgfTsgfVxuICAgIGZ1bmN0aW9uIHNldHRsZShyZXNvbHZlLCByZWplY3QsIGQsIHYpIHsgUHJvbWlzZS5yZXNvbHZlKHYpLnRoZW4oZnVuY3Rpb24gKHYpIHsgcmVzb2x2ZSh7IHZhbHVlOiB2LCBkb25lOiBkIH0pOyB9LCByZWplY3QpOyB9XG59O1xudmFyIF9zY2hlZHVsZXJfMSA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vX3NjaGVkdWxlciAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vX3NjaGVkdWxlci5qc1wiKTtcbnZhciBfdXRpbF8xID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9fdXRpbCAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vX3V0aWwuanNcIik7XG52YXIgb2JzZXJ2YWJsZV8xID0gX19pbXBvcnREZWZhdWx0KF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vb2JzZXJ2YWJsZSAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vb2JzZXJ2YWJsZS5qc1wiKSk7XG52YXIgdW5zdWJzY3JpYmVfMSA9IF9faW1wb3J0RGVmYXVsdChfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL3Vuc3Vic2NyaWJlICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL29ic2VydmFibGUtZm5zQDAuNi4xL25vZGVfbW9kdWxlcy9vYnNlcnZhYmxlLWZucy9kaXN0LmVzbS91bnN1YnNjcmliZS5qc1wiKSk7XG4vKipcbiAqIE1hcHMgdGhlIHZhbHVlcyBlbWl0dGVkIGJ5IGFub3RoZXIgb2JzZXJ2YWJsZS4gSW4gY29udHJhc3QgdG8gYG1hcCgpYFxuICogdGhlIGBtYXBwZXJgIGZ1bmN0aW9uIHJldHVybnMgYW4gYXJyYXkgb2YgdmFsdWVzIHRoYXQgd2lsbCBiZSBlbWl0dGVkXG4gKiBzZXBhcmF0ZWx5LlxuICogVXNlIGBmbGF0TWFwKClgIHRvIG1hcCBpbnB1dCB2YWx1ZXMgdG8gemVybywgb25lIG9yIG11bHRpcGxlIG91dHB1dFxuICogdmFsdWVzLiBUbyBiZSBhcHBsaWVkIHRvIGFuIGlucHV0IG9ic2VydmFibGUgdXNpbmcgYHBpcGUoKWAuXG4gKi9cbmZ1bmN0aW9uIGZsYXRNYXAobWFwcGVyKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChvYnNlcnZhYmxlKSB7XG4gICAgICAgIHJldHVybiBuZXcgb2JzZXJ2YWJsZV8xLmRlZmF1bHQoZnVuY3Rpb24gKG9ic2VydmVyKSB7XG4gICAgICAgICAgICB2YXIgc2NoZWR1bGVyID0gbmV3IF9zY2hlZHVsZXJfMS5Bc3luY1NlcmlhbFNjaGVkdWxlcihvYnNlcnZlcik7XG4gICAgICAgICAgICB2YXIgc3Vic2NyaXB0aW9uID0gb2JzZXJ2YWJsZS5zdWJzY3JpYmUoe1xuICAgICAgICAgICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjaGVkdWxlci5jb21wbGV0ZSgpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBzY2hlZHVsZXIuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgbmV4dDogZnVuY3Rpb24gKGlucHV0KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIHNjaGVkdWxlci5zY2hlZHVsZShmdW5jdGlvbiAobmV4dCkgeyByZXR1cm4gX19hd2FpdGVyKF90aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVfMSwgX2EsIG1hcHBlZCwgbWFwcGVkXzEsIG1hcHBlZF8xXzEsIGVsZW1lbnQsIGVfMV8xXzE7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9iKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfYi5sYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sIG1hcHBlcihpbnB1dCldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXBwZWQgPSBfYi5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoISgoMCwgX3V0aWxfMS5pc0l0ZXJhdG9yKShtYXBwZWQpIHx8ICgwLCBfdXRpbF8xLmlzQXN5bmNJdGVyYXRvcikobWFwcGVkKSkpIHJldHVybiBbMyAvKmJyZWFrKi8sIDE0XTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9iLmxhYmVsID0gMjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2IudHJ5cy5wdXNoKFsyLCA3LCA4LCAxM10pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwcGVkXzEgPSBfX2FzeW5jVmFsdWVzKG1hcHBlZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYi5sYWJlbCA9IDM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzogcmV0dXJuIFs0IC8qeWllbGQqLywgbWFwcGVkXzEubmV4dCgpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEobWFwcGVkXzFfMSA9IF9iLnNlbnQoKSwgIW1hcHBlZF8xXzEuZG9uZSkpIHJldHVybiBbMyAvKmJyZWFrKi8sIDZdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudCA9IG1hcHBlZF8xXzEudmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0KGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2IubGFiZWwgPSA1O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDU6IHJldHVybiBbMyAvKmJyZWFrKi8sIDNdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDY6IHJldHVybiBbMyAvKmJyZWFrKi8sIDEzXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA3OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZV8xXzFfMSA9IF9iLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVfMSA9IHsgZXJyb3I6IGVfMV8xXzEgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMyAvKmJyZWFrKi8sIDEzXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA4OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2IudHJ5cy5wdXNoKFs4LCAsIDExLCAxMl0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEobWFwcGVkXzFfMSAmJiAhbWFwcGVkXzFfMS5kb25lICYmIChfYSA9IG1hcHBlZF8xLnJldHVybikpKSByZXR1cm4gWzMgLypicmVhayovLCAxMF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBfYS5jYWxsKG1hcHBlZF8xKV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgOTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9iLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9iLmxhYmVsID0gMTA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTA6IHJldHVybiBbMyAvKmJyZWFrKi8sIDEyXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlXzEpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZV8xLmVycm9yO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs3IC8qZW5kZmluYWxseSovXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMjogcmV0dXJuIFs3IC8qZW5kZmluYWxseSovXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMzogcmV0dXJuIFszIC8qYnJlYWsqLywgMTVdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwcGVkLm1hcChmdW5jdGlvbiAob3V0cHV0KSB7IHJldHVybiBuZXh0KG91dHB1dCk7IH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2IubGFiZWwgPSAxNTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxNTogcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTsgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgeyByZXR1cm4gKDAsIHVuc3Vic2NyaWJlXzEuZGVmYXVsdCkoc3Vic2NyaXB0aW9uKTsgfTtcbiAgICAgICAgfSk7XG4gICAgfTtcbn1cbmV4cG9ydHMuZGVmYXVsdCA9IGZsYXRNYXA7XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vZmxhdE1hcC5qcz8iKTsKCi8qKiovIH0pLAoKLyoqKi8gIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vaW5kZXguanMiOgovKiEqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlwKICAhKioqIC9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vaW5kZXguanMgKioqIQogIFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CmV2YWwoIlxudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy51bnN1YnNjcmliZSA9IGV4cG9ydHMuU3ViamVjdCA9IGV4cG9ydHMuc2NhbiA9IGV4cG9ydHMuT2JzZXJ2YWJsZSA9IGV4cG9ydHMubXVsdGljYXN0ID0gZXhwb3J0cy5tZXJnZSA9IGV4cG9ydHMubWFwID0gZXhwb3J0cy5pbnRlcnZhbCA9IGV4cG9ydHMuZmxhdE1hcCA9IGV4cG9ydHMuZmlsdGVyID0gdm9pZCAwO1xudmFyIGZpbHRlcl8xID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9maWx0ZXIgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vb2JzZXJ2YWJsZS1mbnNAMC42LjEvbm9kZV9tb2R1bGVzL29ic2VydmFibGUtZm5zL2Rpc3QuZXNtL2ZpbHRlci5qc1wiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcImZpbHRlclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gX19pbXBvcnREZWZhdWx0KGZpbHRlcl8xKS5kZWZhdWx0OyB9IH0pO1xudmFyIGZsYXRNYXBfMSA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vZmxhdE1hcCAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vZmxhdE1hcC5qc1wiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcImZsYXRNYXBcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIF9faW1wb3J0RGVmYXVsdChmbGF0TWFwXzEpLmRlZmF1bHQ7IH0gfSk7XG52YXIgaW50ZXJ2YWxfMSA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vaW50ZXJ2YWwgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vb2JzZXJ2YWJsZS1mbnNAMC42LjEvbm9kZV9tb2R1bGVzL29ic2VydmFibGUtZm5zL2Rpc3QuZXNtL2ludGVydmFsLmpzXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiaW50ZXJ2YWxcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIF9faW1wb3J0RGVmYXVsdChpbnRlcnZhbF8xKS5kZWZhdWx0OyB9IH0pO1xudmFyIG1hcF8xID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9tYXAgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vb2JzZXJ2YWJsZS1mbnNAMC42LjEvbm9kZV9tb2R1bGVzL29ic2VydmFibGUtZm5zL2Rpc3QuZXNtL21hcC5qc1wiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIm1hcFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gX19pbXBvcnREZWZhdWx0KG1hcF8xKS5kZWZhdWx0OyB9IH0pO1xudmFyIG1lcmdlXzEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL21lcmdlICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL29ic2VydmFibGUtZm5zQDAuNi4xL25vZGVfbW9kdWxlcy9vYnNlcnZhYmxlLWZucy9kaXN0LmVzbS9tZXJnZS5qc1wiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIm1lcmdlXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBfX2ltcG9ydERlZmF1bHQobWVyZ2VfMSkuZGVmYXVsdDsgfSB9KTtcbnZhciBtdWx0aWNhc3RfMSA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vbXVsdGljYXN0ICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL29ic2VydmFibGUtZm5zQDAuNi4xL25vZGVfbW9kdWxlcy9vYnNlcnZhYmxlLWZucy9kaXN0LmVzbS9tdWx0aWNhc3QuanNcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJtdWx0aWNhc3RcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIF9faW1wb3J0RGVmYXVsdChtdWx0aWNhc3RfMSkuZGVmYXVsdDsgfSB9KTtcbnZhciBvYnNlcnZhYmxlXzEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL29ic2VydmFibGUgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vb2JzZXJ2YWJsZS1mbnNAMC42LjEvbm9kZV9tb2R1bGVzL29ic2VydmFibGUtZm5zL2Rpc3QuZXNtL29ic2VydmFibGUuanNcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJPYnNlcnZhYmxlXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBfX2ltcG9ydERlZmF1bHQob2JzZXJ2YWJsZV8xKS5kZWZhdWx0OyB9IH0pO1xudmFyIHNjYW5fMSA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vc2NhbiAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vc2Nhbi5qc1wiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcInNjYW5cIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIF9faW1wb3J0RGVmYXVsdChzY2FuXzEpLmRlZmF1bHQ7IH0gfSk7XG52YXIgc3ViamVjdF8xID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9zdWJqZWN0ICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL29ic2VydmFibGUtZm5zQDAuNi4xL25vZGVfbW9kdWxlcy9vYnNlcnZhYmxlLWZucy9kaXN0LmVzbS9zdWJqZWN0LmpzXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiU3ViamVjdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gX19pbXBvcnREZWZhdWx0KHN1YmplY3RfMSkuZGVmYXVsdDsgfSB9KTtcbnZhciB1bnN1YnNjcmliZV8xID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi91bnN1YnNjcmliZSAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vdW5zdWJzY3JpYmUuanNcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJ1bnN1YnNjcmliZVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gX19pbXBvcnREZWZhdWx0KHVuc3Vic2NyaWJlXzEpLmRlZmF1bHQ7IH0gfSk7XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vaW5kZXguanM/Iik7CgovKioqLyB9KSwKCi8qKiovICIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vb2JzZXJ2YWJsZS1mbnNAMC42LjEvbm9kZV9tb2R1bGVzL29ic2VydmFibGUtZm5zL2Rpc3QuZXNtL2ludGVydmFsLmpzIjoKLyohKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqISpcCiAgISoqKiAvaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vb2JzZXJ2YWJsZS1mbnNAMC42LjEvbm9kZV9tb2R1bGVzL29ic2VydmFibGUtZm5zL2Rpc3QuZXNtL2ludGVydmFsLmpzICoqKiEKICBcKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKiEgbm8gc3RhdGljIGV4cG9ydHMgZm91bmQgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwpldmFsKCJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBvYnNlcnZhYmxlXzEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL29ic2VydmFibGUgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vb2JzZXJ2YWJsZS1mbnNAMC42LjEvbm9kZV9tb2R1bGVzL29ic2VydmFibGUtZm5zL2Rpc3QuZXNtL29ic2VydmFibGUuanNcIik7XG4vKipcbiAqIENyZWF0ZXMgYW4gb2JzZXJ2YWJsZSB0aGF0IHlpZWxkcyBhIG5ldyB2YWx1ZSBldmVyeSBgcGVyaW9kYCBtaWxsaXNlY29uZHMuXG4gKiBUaGUgZmlyc3QgdmFsdWUgZW1pdHRlZCBpcyAwLCB0aGVuIDEsIDIsIGV0Yy4gVGhlIGZpcnN0IHZhbHVlIGlzIG5vdCBlbWl0dGVkXG4gKiBpbW1lZGlhdGVseSwgYnV0IGFmdGVyIHRoZSBmaXJzdCBpbnRlcnZhbC5cbiAqL1xuZnVuY3Rpb24gaW50ZXJ2YWwocGVyaW9kKSB7XG4gICAgcmV0dXJuIG5ldyBvYnNlcnZhYmxlXzEuT2JzZXJ2YWJsZShmdW5jdGlvbiAob2JzZXJ2ZXIpIHtcbiAgICAgICAgdmFyIGNvdW50ZXIgPSAwO1xuICAgICAgICB2YXIgaGFuZGxlID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dChjb3VudGVyKyspO1xuICAgICAgICB9LCBwZXJpb2QpO1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgeyByZXR1cm4gY2xlYXJJbnRlcnZhbChoYW5kbGUpOyB9O1xuICAgIH0pO1xufVxuZXhwb3J0cy5kZWZhdWx0ID0gaW50ZXJ2YWw7XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vaW50ZXJ2YWwuanM/Iik7CgovKioqLyB9KSwKCi8qKiovICIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vb2JzZXJ2YWJsZS1mbnNAMC42LjEvbm9kZV9tb2R1bGVzL29ic2VydmFibGUtZm5zL2Rpc3QuZXNtL21hcC5qcyI6Ci8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlwKICAhKioqIC9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vbWFwLmpzICoqKiEKICBcKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKZXZhbCgiXG52YXIgX19nZW5lcmF0b3IgPSAodGhpcyAmJiB0aGlzLl9fZ2VuZXJhdG9yKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgYm9keSkge1xuICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGc7XG4gICAgcmV0dXJuIGcgPSB7IG5leHQ6IHZlcmIoMCksIFwidGhyb3dcIjogdmVyYigxKSwgXCJyZXR1cm5cIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7XG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IHJldHVybiBmdW5jdGlvbiAodikgeyByZXR1cm4gc3RlcChbbiwgdl0pOyB9OyB9XG4gICAgZnVuY3Rpb24gc3RlcChvcCkge1xuICAgICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XG4gICAgICAgIHdoaWxlIChfKSB0cnkge1xuICAgICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0gb3BbMF0gJiAyID8geVtcInJldHVyblwiXSA6IG9wWzBdID8geVtcInRocm93XCJdIHx8ICgodCA9IHlbXCJyZXR1cm5cIl0pICYmIHQuY2FsbCh5KSwgMCkgOiB5Lm5leHQpICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0O1xuICAgICAgICAgICAgaWYgKHkgPSAwLCB0KSBvcCA9IFtvcFswXSAmIDIsIHQudmFsdWVdO1xuICAgICAgICAgICAgc3dpdGNoIChvcFswXSkge1xuICAgICAgICAgICAgICAgIGNhc2UgMDogY2FzZSAxOiB0ID0gb3A7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNDogXy5sYWJlbCsrOyByZXR1cm4geyB2YWx1ZTogb3BbMV0sIGRvbmU6IGZhbHNlIH07XG4gICAgICAgICAgICAgICAgY2FzZSA1OiBfLmxhYmVsKys7IHkgPSBvcFsxXTsgb3AgPSBbMF07IGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIGNhc2UgNzogb3AgPSBfLm9wcy5wb3AoKTsgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBpZiAoISh0ID0gXy50cnlzLCB0ID0gdC5sZW5ndGggPiAwICYmIHRbdC5sZW5ndGggLSAxXSkgJiYgKG9wWzBdID09PSA2IHx8IG9wWzBdID09PSAyKSkgeyBfID0gMDsgY29udGludWU7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCAob3BbMV0gPiB0WzBdICYmIG9wWzFdIDwgdFszXSkpKSB7IF8ubGFiZWwgPSBvcFsxXTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7IF8ubGFiZWwgPSB0WzFdOyB0ID0gb3A7IGJyZWFrOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIF8ubGFiZWwgPCB0WzJdKSB7IF8ubGFiZWwgPSB0WzJdOyBfLm9wcy5wdXNoKG9wKTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRbMl0pIF8ub3BzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3AgPSBib2R5LmNhbGwodGhpc0FyZywgXyk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgb3AgPSBbNiwgZV07IHkgPSAwOyB9IGZpbmFsbHkgeyBmID0gdCA9IDA7IH1cbiAgICAgICAgaWYgKG9wWzBdICYgNSkgdGhyb3cgb3BbMV07IHJldHVybiB7IHZhbHVlOiBvcFswXSA/IG9wWzFdIDogdm9pZCAwLCBkb25lOiB0cnVlIH07XG4gICAgfVxufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHtcbiAgICAgICAgICAgIHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHtcbiAgICAgICAgICAgIHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfc2NoZWR1bGVyXzEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL19zY2hlZHVsZXIgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vb2JzZXJ2YWJsZS1mbnNAMC42LjEvbm9kZV9tb2R1bGVzL29ic2VydmFibGUtZm5zL2Rpc3QuZXNtL19zY2hlZHVsZXIuanNcIik7XG52YXIgb2JzZXJ2YWJsZV8xID0gX19pbXBvcnREZWZhdWx0KF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vb2JzZXJ2YWJsZSAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vb2JzZXJ2YWJsZS5qc1wiKSk7XG52YXIgdW5zdWJzY3JpYmVfMSA9IF9faW1wb3J0RGVmYXVsdChfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL3Vuc3Vic2NyaWJlICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL29ic2VydmFibGUtZm5zQDAuNi4xL25vZGVfbW9kdWxlcy9vYnNlcnZhYmxlLWZucy9kaXN0LmVzbS91bnN1YnNjcmliZS5qc1wiKSk7XG4vKipcbiAqIE1hcHMgdGhlIHZhbHVlcyBlbWl0dGVkIGJ5IGFub3RoZXIgb2JzZXJ2YWJsZSB0byBkaWZmZXJlbnQgdmFsdWVzLlxuICogVG8gYmUgYXBwbGllZCB0byBhbiBpbnB1dCBvYnNlcnZhYmxlIHVzaW5nIGBwaXBlKClgLlxuICovXG5mdW5jdGlvbiBtYXAobWFwcGVyKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChvYnNlcnZhYmxlKSB7XG4gICAgICAgIHJldHVybiBuZXcgb2JzZXJ2YWJsZV8xLmRlZmF1bHQoZnVuY3Rpb24gKG9ic2VydmVyKSB7XG4gICAgICAgICAgICB2YXIgc2NoZWR1bGVyID0gbmV3IF9zY2hlZHVsZXJfMS5Bc3luY1NlcmlhbFNjaGVkdWxlcihvYnNlcnZlcik7XG4gICAgICAgICAgICB2YXIgc3Vic2NyaXB0aW9uID0gb2JzZXJ2YWJsZS5zdWJzY3JpYmUoe1xuICAgICAgICAgICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjaGVkdWxlci5jb21wbGV0ZSgpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBzY2hlZHVsZXIuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgbmV4dDogZnVuY3Rpb24gKGlucHV0KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIHNjaGVkdWxlci5zY2hlZHVsZShmdW5jdGlvbiAobmV4dCkgeyByZXR1cm4gX19hd2FpdGVyKF90aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1hcHBlZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDogcmV0dXJuIFs0IC8qeWllbGQqLywgbWFwcGVyKGlucHV0KV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcHBlZCA9IF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHQobWFwcGVkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7IH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsgcmV0dXJuICgwLCB1bnN1YnNjcmliZV8xLmRlZmF1bHQpKHN1YnNjcmlwdGlvbik7IH07XG4gICAgICAgIH0pO1xuICAgIH07XG59XG5leHBvcnRzLmRlZmF1bHQgPSBtYXA7XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vbWFwLmpzPyIpOwoKLyoqKi8gfSksCgovKioqLyAiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL29ic2VydmFibGUtZm5zQDAuNi4xL25vZGVfbW9kdWxlcy9vYnNlcnZhYmxlLWZucy9kaXN0LmVzbS9tZXJnZS5qcyI6Ci8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiEqXAogICEqKiogL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL29ic2VydmFibGUtZm5zQDAuNi4xL25vZGVfbW9kdWxlcy9vYnNlcnZhYmxlLWZucy9kaXN0LmVzbS9tZXJnZS5qcyAqKiohCiAgXCoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKZXZhbCgiXG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgb2JzZXJ2YWJsZV8xID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9vYnNlcnZhYmxlICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL29ic2VydmFibGUtZm5zQDAuNi4xL25vZGVfbW9kdWxlcy9vYnNlcnZhYmxlLWZucy9kaXN0LmVzbS9vYnNlcnZhYmxlLmpzXCIpO1xudmFyIHVuc3Vic2NyaWJlXzEgPSBfX2ltcG9ydERlZmF1bHQoX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi91bnN1YnNjcmliZSAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vdW5zdWJzY3JpYmUuanNcIikpO1xuZnVuY3Rpb24gbWVyZ2UoKSB7XG4gICAgdmFyIG9ic2VydmFibGVzID0gW107XG4gICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgb2JzZXJ2YWJsZXNbX2ldID0gYXJndW1lbnRzW19pXTtcbiAgICB9XG4gICAgaWYgKG9ic2VydmFibGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gb2JzZXJ2YWJsZV8xLk9ic2VydmFibGUuZnJvbShbXSk7XG4gICAgfVxuICAgIHJldHVybiBuZXcgb2JzZXJ2YWJsZV8xLk9ic2VydmFibGUoZnVuY3Rpb24gKG9ic2VydmVyKSB7XG4gICAgICAgIHZhciBjb21wbGV0ZWQgPSAwO1xuICAgICAgICB2YXIgc3Vic2NyaXB0aW9ucyA9IG9ic2VydmFibGVzLm1hcChmdW5jdGlvbiAoaW5wdXQpIHtcbiAgICAgICAgICAgIHJldHVybiBpbnB1dC5zdWJzY3JpYmUoe1xuICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB1bnN1YnNjcmliZUFsbCgpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgbmV4dDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm5leHQodmFsdWUpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCsrY29tcGxldGVkID09PSBvYnNlcnZhYmxlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB1bnN1YnNjcmliZUFsbCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgdW5zdWJzY3JpYmVBbGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzdWJzY3JpcHRpb25zLmZvckVhY2goZnVuY3Rpb24gKHN1YnNjcmlwdGlvbikgeyByZXR1cm4gKDAsIHVuc3Vic2NyaWJlXzEuZGVmYXVsdCkoc3Vic2NyaXB0aW9uKTsgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB1bnN1YnNjcmliZUFsbDtcbiAgICB9KTtcbn1cbmV4cG9ydHMuZGVmYXVsdCA9IG1lcmdlO1xuXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8vaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vb2JzZXJ2YWJsZS1mbnNAMC42LjEvbm9kZV9tb2R1bGVzL29ic2VydmFibGUtZm5zL2Rpc3QuZXNtL21lcmdlLmpzPyIpOwoKLyoqKi8gfSksCgovKioqLyAiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL29ic2VydmFibGUtZm5zQDAuNi4xL25vZGVfbW9kdWxlcy9vYnNlcnZhYmxlLWZucy9kaXN0LmVzbS9tdWx0aWNhc3QuanMiOgovKiEqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqISpcCiAgISoqKiAvaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vb2JzZXJ2YWJsZS1mbnNAMC42LjEvbm9kZV9tb2R1bGVzL29ic2VydmFibGUtZm5zL2Rpc3QuZXNtL211bHRpY2FzdC5qcyAqKiohCiAgXCoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CmV2YWwoIlxudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIG9ic2VydmFibGVfMSA9IF9faW1wb3J0RGVmYXVsdChfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL29ic2VydmFibGUgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vb2JzZXJ2YWJsZS1mbnNAMC42LjEvbm9kZV9tb2R1bGVzL29ic2VydmFibGUtZm5zL2Rpc3QuZXNtL29ic2VydmFibGUuanNcIikpO1xudmFyIHN1YmplY3RfMSA9IF9faW1wb3J0RGVmYXVsdChfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL3N1YmplY3QgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vb2JzZXJ2YWJsZS1mbnNAMC42LjEvbm9kZV9tb2R1bGVzL29ic2VydmFibGUtZm5zL2Rpc3QuZXNtL3N1YmplY3QuanNcIikpO1xudmFyIHVuc3Vic2NyaWJlXzEgPSBfX2ltcG9ydERlZmF1bHQoX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi91bnN1YnNjcmliZSAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vdW5zdWJzY3JpYmUuanNcIikpO1xuLy8gVE9ETzogU3ViamVjdCBhbHJlYWR5IGNyZWF0ZXMgYWRkaXRpb25hbCBvYnNlcnZhYmxlcyBcInVuZGVyIHRoZSBob29kXCIsXG4vLyAgICAgICBub3cgd2UgaW50cm9kdWNlIGV2ZW4gbW9yZS4gQSB0cnVlIG5hdGl2ZSBNdWx0aWNhc3RPYnNlcnZhYmxlXG4vLyAgICAgICB3b3VsZCBiZSBwcmVmZXJhYmxlLlxuLyoqXG4gKiBUYWtlcyBhIFwiY29sZFwiIG9ic2VydmFibGUgYW5kIHJldHVybnMgYSB3cmFwcGluZyBcImhvdFwiIG9ic2VydmFibGUgdGhhdFxuICogcHJveGllcyB0aGUgaW5wdXQgb2JzZXJ2YWJsZSdzIHZhbHVlcyBhbmQgZXJyb3JzLlxuICpcbiAqIEFuIG9ic2VydmFibGUgaXMgY2FsbGVkIFwiY29sZFwiIHdoZW4gaXRzIGluaXRpYWxpemF0aW9uIGZ1bmN0aW9uIGlzIHJ1blxuICogZm9yIGVhY2ggbmV3IHN1YnNjcmliZXIuIFRoaXMgaXMgaG93IG9ic2VydmFibGUtZm5zJ3MgYE9ic2VydmFibGVgXG4gKiBpbXBsZW1lbnRhdGlvbiB3b3Jrcy5cbiAqXG4gKiBBIGhvdCBvYnNlcnZhYmxlIGlzIGFuIG9ic2VydmFibGUgd2hlcmUgbmV3IHN1YnNjcmliZXJzIHN1YnNjcmliZSB0b1xuICogdGhlIHVwY29taW5nIHZhbHVlcyBvZiBhbiBhbHJlYWR5LWluaXRpYWxpYXplZCBvYnNlcnZhYmxlLlxuICpcbiAqIFRoZSBtdWx0aWNhc3Qgb2JzZXJ2YWJsZSB3aWxsIGxhemlseSBzdWJzY3JpYmUgdG8gdGhlIHNvdXJjZSBvYnNlcnZhYmxlXG4gKiBvbmNlIGl0IGhhcyBpdHMgZmlyc3Qgb3duIHN1YnNjcmliZXIgYW5kIHdpbGwgdW5zdWJzY3JpYmUgZnJvbSB0aGVcbiAqIHNvdXJjZSBvYnNlcnZhYmxlIHdoZW4gaXRzIGxhc3Qgb3duIHN1YnNjcmliZXIgdW5zdWJzY3JpYmVkLlxuICovXG5mdW5jdGlvbiBtdWx0aWNhc3QoY29sZE9ic2VydmFibGUpIHtcbiAgICB2YXIgc3ViamVjdCA9IG5ldyBzdWJqZWN0XzEuZGVmYXVsdCgpO1xuICAgIHZhciBzb3VyY2VTdWJzY3JpcHRpb247XG4gICAgdmFyIHN1YnNjcmliZXJDb3VudCA9IDA7XG4gICAgcmV0dXJuIG5ldyBvYnNlcnZhYmxlXzEuZGVmYXVsdChmdW5jdGlvbiAob2JzZXJ2ZXIpIHtcbiAgICAgICAgLy8gSW5pdCBzb3VyY2Ugc3Vic2NyaXB0aW9uIGxhemlseVxuICAgICAgICBpZiAoIXNvdXJjZVN1YnNjcmlwdGlvbikge1xuICAgICAgICAgICAgc291cmNlU3Vic2NyaXB0aW9uID0gY29sZE9ic2VydmFibGUuc3Vic2NyaWJlKHN1YmplY3QpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFBpcGUgYWxsIGV2ZW50cyBmcm9tIGBzdWJqZWN0YCBpbnRvIHRoaXMgb2JzZXJ2YWJsZVxuICAgICAgICB2YXIgc3Vic2NyaXB0aW9uID0gc3ViamVjdC5zdWJzY3JpYmUob2JzZXJ2ZXIpO1xuICAgICAgICBzdWJzY3JpYmVyQ291bnQrKztcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHN1YnNjcmliZXJDb3VudC0tO1xuICAgICAgICAgICAgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICAvLyBDbG9zZSBzb3VyY2Ugc3Vic2NyaXB0aW9uIG9uY2UgbGFzdCBzdWJzY3JpYmVyIGhhcyB1bnN1YnNjcmliZWRcbiAgICAgICAgICAgIGlmIChzdWJzY3JpYmVyQ291bnQgPT09IDApIHtcbiAgICAgICAgICAgICAgICAoMCwgdW5zdWJzY3JpYmVfMS5kZWZhdWx0KShzb3VyY2VTdWJzY3JpcHRpb24pO1xuICAgICAgICAgICAgICAgIHNvdXJjZVN1YnNjcmlwdGlvbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuZGVmYXVsdCA9IG11bHRpY2FzdDtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL29ic2VydmFibGUtZm5zQDAuNi4xL25vZGVfbW9kdWxlcy9vYnNlcnZhYmxlLWZucy9kaXN0LmVzbS9tdWx0aWNhc3QuanM/Iik7CgovKioqLyB9KSwKCi8qKiovICIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vb2JzZXJ2YWJsZS1mbnNAMC42LjEvbm9kZV9tb2R1bGVzL29ic2VydmFibGUtZm5zL2Rpc3QuZXNtL29ic2VydmFibGUuanMiOgovKiEqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiEqXAogICEqKiogL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL29ic2VydmFibGUtZm5zQDAuNi4xL25vZGVfbW9kdWxlcy9vYnNlcnZhYmxlLWZucy9kaXN0LmVzbS9vYnNlcnZhYmxlLmpzICoqKiEKICBcKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CmV2YWwoIlxudmFyIF9fc3ByZWFkQXJyYXkgPSAodGhpcyAmJiB0aGlzLl9fc3ByZWFkQXJyYXkpIHx8IGZ1bmN0aW9uICh0bywgZnJvbSwgcGFjaykge1xuICAgIGlmIChwYWNrIHx8IGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIGZvciAodmFyIGkgPSAwLCBsID0gZnJvbS5sZW5ndGgsIGFyOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgIGlmIChhciB8fCAhKGkgaW4gZnJvbSkpIHtcbiAgICAgICAgICAgIGlmICghYXIpIGFyID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZnJvbSwgMCwgaSk7XG4gICAgICAgICAgICBhcltpXSA9IGZyb21baV07XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRvLmNvbmNhdChhciB8fCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChmcm9tKSk7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5PYnNlcnZhYmxlID0gZXhwb3J0cy5TdWJzY3JpcHRpb25PYnNlcnZlciA9IGV4cG9ydHMuU3Vic2NyaXB0aW9uID0gdm9pZCAwO1xuLyoqXG4gKiBCYXNlZCBvbiA8aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3plbnBhcnNpbmcvemVuLW9ic2VydmFibGUvbWFzdGVyL3NyYy9PYnNlcnZhYmxlLmpzPlxuICogQXQgY29tbWl0OiBmNjM4NDlhOGM2MGFmNWQ1MTRlZmM4ZTlkNjEzOGQ4MjczYzQ5YWQ2XG4gKi9cbl9fd2VicGFja19yZXF1aXJlX18oLyohIC4vc3ltYm9scyAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vc3ltYm9scy5qc1wiKTtcbnZhciBfc3ltYm9sc18xID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9fc3ltYm9scyAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vX3N5bWJvbHMuanNcIik7XG52YXIgU3ltYm9sSXRlcmF0b3IgPSAoMCwgX3N5bWJvbHNfMS5nZXRTeW1ib2wpKFwiaXRlcmF0b3JcIik7XG52YXIgU3ltYm9sT2JzZXJ2YWJsZSA9ICgwLCBfc3ltYm9sc18xLmdldFN5bWJvbCkoXCJvYnNlcnZhYmxlXCIpO1xudmFyIFN5bWJvbFNwZWNpZXMgPSAoMCwgX3N5bWJvbHNfMS5nZXRTeW1ib2wpKFwic3BlY2llc1wiKTtcbi8vID09PSBBYnN0cmFjdCBPcGVyYXRpb25zID09PVxuZnVuY3Rpb24gZ2V0TWV0aG9kKG9iaiwga2V5KSB7XG4gICAgdmFyIHZhbHVlID0gb2JqW2tleV07XG4gICAgaWYgKHZhbHVlID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IodmFsdWUgKyBcIiBpcyBub3QgYSBmdW5jdGlvblwiKTtcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlO1xufVxuZnVuY3Rpb24gZ2V0U3BlY2llcyhvYmopIHtcbiAgICB2YXIgY3RvciA9IG9iai5jb25zdHJ1Y3RvcjtcbiAgICBpZiAoY3RvciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGN0b3IgPSBjdG9yW1N5bWJvbFNwZWNpZXNdO1xuICAgICAgICBpZiAoY3RvciA9PT0gbnVsbCkge1xuICAgICAgICAgICAgY3RvciA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gY3RvciAhPT0gdW5kZWZpbmVkID8gY3RvciA6IE9ic2VydmFibGU7XG59XG5mdW5jdGlvbiBpc09ic2VydmFibGUoeCkge1xuICAgIHJldHVybiB4IGluc3RhbmNlb2YgT2JzZXJ2YWJsZTsgLy8gU1BFQzogQnJhbmQgY2hlY2tcbn1cbmZ1bmN0aW9uIGhvc3RSZXBvcnRFcnJvcihlcnJvcikge1xuICAgIGlmIChob3N0UmVwb3J0RXJyb3IubG9nKSB7XG4gICAgICAgIGhvc3RSZXBvcnRFcnJvci5sb2coZXJyb3IpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IHRocm93IGVycm9yOyB9LCAwKTtcbiAgICB9XG59XG5mdW5jdGlvbiBlbnF1ZXVlKGZuKSB7XG4gICAgUHJvbWlzZS5yZXNvbHZlKCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBmbigpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBob3N0UmVwb3J0RXJyb3IoZSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmZ1bmN0aW9uIGNsZWFudXBTdWJzY3JpcHRpb24oc3Vic2NyaXB0aW9uKSB7XG4gICAgdmFyIGNsZWFudXAgPSBzdWJzY3JpcHRpb24uX2NsZWFudXA7XG4gICAgaWYgKGNsZWFudXAgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHN1YnNjcmlwdGlvbi5fY2xlYW51cCA9IHVuZGVmaW5lZDtcbiAgICBpZiAoIWNsZWFudXApIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgICBpZiAodHlwZW9mIGNsZWFudXAgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgY2xlYW51cCgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdmFyIHVuc3Vic2NyaWJlID0gZ2V0TWV0aG9kKGNsZWFudXAsIFwidW5zdWJzY3JpYmVcIik7XG4gICAgICAgICAgICBpZiAodW5zdWJzY3JpYmUpIHtcbiAgICAgICAgICAgICAgICB1bnN1YnNjcmliZS5jYWxsKGNsZWFudXApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIGhvc3RSZXBvcnRFcnJvcihlKTtcbiAgICB9XG59XG5mdW5jdGlvbiBjbG9zZVN1YnNjcmlwdGlvbihzdWJzY3JpcHRpb24pIHtcbiAgICBzdWJzY3JpcHRpb24uX29ic2VydmVyID0gdW5kZWZpbmVkO1xuICAgIHN1YnNjcmlwdGlvbi5fcXVldWUgPSB1bmRlZmluZWQ7XG4gICAgc3Vic2NyaXB0aW9uLl9zdGF0ZSA9IFwiY2xvc2VkXCI7XG59XG5mdW5jdGlvbiBmbHVzaFN1YnNjcmlwdGlvbihzdWJzY3JpcHRpb24pIHtcbiAgICB2YXIgcXVldWUgPSBzdWJzY3JpcHRpb24uX3F1ZXVlO1xuICAgIGlmICghcXVldWUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBzdWJzY3JpcHRpb24uX3F1ZXVlID0gdW5kZWZpbmVkO1xuICAgIHN1YnNjcmlwdGlvbi5fc3RhdGUgPSBcInJlYWR5XCI7XG4gICAgZm9yICh2YXIgX2kgPSAwLCBxdWV1ZV8xID0gcXVldWU7IF9pIDwgcXVldWVfMS5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgdmFyIGl0ZW0gPSBxdWV1ZV8xW19pXTtcbiAgICAgICAgbm90aWZ5U3Vic2NyaXB0aW9uKHN1YnNjcmlwdGlvbiwgaXRlbS50eXBlLCBpdGVtLnZhbHVlKTtcbiAgICAgICAgaWYgKHN1YnNjcmlwdGlvbi5fc3RhdGUgPT09IFwiY2xvc2VkXCIpIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gbm90aWZ5U3Vic2NyaXB0aW9uKHN1YnNjcmlwdGlvbiwgdHlwZSwgdmFsdWUpIHtcbiAgICBzdWJzY3JpcHRpb24uX3N0YXRlID0gXCJydW5uaW5nXCI7XG4gICAgdmFyIG9ic2VydmVyID0gc3Vic2NyaXB0aW9uLl9vYnNlcnZlcjtcbiAgICB0cnkge1xuICAgICAgICB2YXIgbSA9IG9ic2VydmVyID8gZ2V0TWV0aG9kKG9ic2VydmVyLCB0eXBlKSA6IHVuZGVmaW5lZDtcbiAgICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgICAgICBjYXNlIFwibmV4dFwiOlxuICAgICAgICAgICAgICAgIGlmIChtKVxuICAgICAgICAgICAgICAgICAgICBtLmNhbGwob2JzZXJ2ZXIsIHZhbHVlKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJlcnJvclwiOlxuICAgICAgICAgICAgICAgIGNsb3NlU3Vic2NyaXB0aW9uKHN1YnNjcmlwdGlvbik7XG4gICAgICAgICAgICAgICAgaWYgKG0pXG4gICAgICAgICAgICAgICAgICAgIG0uY2FsbChvYnNlcnZlciwgdmFsdWUpO1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgdmFsdWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiY29tcGxldGVcIjpcbiAgICAgICAgICAgICAgICBjbG9zZVN1YnNjcmlwdGlvbihzdWJzY3JpcHRpb24pO1xuICAgICAgICAgICAgICAgIGlmIChtKVxuICAgICAgICAgICAgICAgICAgICBtLmNhbGwob2JzZXJ2ZXIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIGhvc3RSZXBvcnRFcnJvcihlKTtcbiAgICB9XG4gICAgaWYgKHN1YnNjcmlwdGlvbi5fc3RhdGUgPT09IFwiY2xvc2VkXCIpIHtcbiAgICAgICAgY2xlYW51cFN1YnNjcmlwdGlvbihzdWJzY3JpcHRpb24pO1xuICAgIH1cbiAgICBlbHNlIGlmIChzdWJzY3JpcHRpb24uX3N0YXRlID09PSBcInJ1bm5pbmdcIikge1xuICAgICAgICBzdWJzY3JpcHRpb24uX3N0YXRlID0gXCJyZWFkeVwiO1xuICAgIH1cbn1cbmZ1bmN0aW9uIG9uTm90aWZ5KHN1YnNjcmlwdGlvbiwgdHlwZSwgdmFsdWUpIHtcbiAgICBpZiAoc3Vic2NyaXB0aW9uLl9zdGF0ZSA9PT0gXCJjbG9zZWRcIikge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChzdWJzY3JpcHRpb24uX3N0YXRlID09PSBcImJ1ZmZlcmluZ1wiKSB7XG4gICAgICAgIHN1YnNjcmlwdGlvbi5fcXVldWUgPSBzdWJzY3JpcHRpb24uX3F1ZXVlIHx8IFtdO1xuICAgICAgICBzdWJzY3JpcHRpb24uX3F1ZXVlLnB1c2goeyB0eXBlOiB0eXBlLCB2YWx1ZTogdmFsdWUgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHN1YnNjcmlwdGlvbi5fc3RhdGUgIT09IFwicmVhZHlcIikge1xuICAgICAgICBzdWJzY3JpcHRpb24uX3N0YXRlID0gXCJidWZmZXJpbmdcIjtcbiAgICAgICAgc3Vic2NyaXB0aW9uLl9xdWV1ZSA9IFt7IHR5cGU6IHR5cGUsIHZhbHVlOiB2YWx1ZSB9XTtcbiAgICAgICAgZW5xdWV1ZShmdW5jdGlvbiAoKSB7IHJldHVybiBmbHVzaFN1YnNjcmlwdGlvbihzdWJzY3JpcHRpb24pOyB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBub3RpZnlTdWJzY3JpcHRpb24oc3Vic2NyaXB0aW9uLCB0eXBlLCB2YWx1ZSk7XG59XG52YXIgU3Vic2NyaXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFN1YnNjcmlwdGlvbihvYnNlcnZlciwgc3Vic2NyaWJlcikge1xuICAgICAgICAvLyBBU1NFUlQ6IG9ic2VydmVyIGlzIGFuIG9iamVjdFxuICAgICAgICAvLyBBU1NFUlQ6IHN1YnNjcmliZXIgaXMgY2FsbGFibGVcbiAgICAgICAgdGhpcy5fY2xlYW51cCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5fb2JzZXJ2ZXIgPSBvYnNlcnZlcjtcbiAgICAgICAgdGhpcy5fcXVldWUgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuX3N0YXRlID0gXCJpbml0aWFsaXppbmdcIjtcbiAgICAgICAgdmFyIHN1YnNjcmlwdGlvbk9ic2VydmVyID0gbmV3IFN1YnNjcmlwdGlvbk9ic2VydmVyKHRoaXMpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgdGhpcy5fY2xlYW51cCA9IHN1YnNjcmliZXIuY2FsbCh1bmRlZmluZWQsIHN1YnNjcmlwdGlvbk9ic2VydmVyKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgc3Vic2NyaXB0aW9uT2JzZXJ2ZXIuZXJyb3IoZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlID09PSBcImluaXRpYWxpemluZ1wiKSB7XG4gICAgICAgICAgICB0aGlzLl9zdGF0ZSA9IFwicmVhZHlcIjtcbiAgICAgICAgfVxuICAgIH1cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU3Vic2NyaXB0aW9uLnByb3RvdHlwZSwgXCJjbG9zZWRcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdGF0ZSA9PT0gXCJjbG9zZWRcIjtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIFN1YnNjcmlwdGlvbi5wcm90b3R5cGUudW5zdWJzY3JpYmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZSAhPT0gXCJjbG9zZWRcIikge1xuICAgICAgICAgICAgY2xvc2VTdWJzY3JpcHRpb24odGhpcyk7XG4gICAgICAgICAgICBjbGVhbnVwU3Vic2NyaXB0aW9uKHRoaXMpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gU3Vic2NyaXB0aW9uO1xufSgpKTtcbmV4cG9ydHMuU3Vic2NyaXB0aW9uID0gU3Vic2NyaXB0aW9uO1xudmFyIFN1YnNjcmlwdGlvbk9ic2VydmVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFN1YnNjcmlwdGlvbk9ic2VydmVyKHN1YnNjcmlwdGlvbikge1xuICAgICAgICB0aGlzLl9zdWJzY3JpcHRpb24gPSBzdWJzY3JpcHRpb247XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTdWJzY3JpcHRpb25PYnNlcnZlci5wcm90b3R5cGUsIFwiY2xvc2VkXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9zdWJzY3JpcHRpb24uX3N0YXRlID09PSBcImNsb3NlZFwiOyB9LFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgU3Vic2NyaXB0aW9uT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAodmFsdWUpIHsgb25Ob3RpZnkodGhpcy5fc3Vic2NyaXB0aW9uLCBcIm5leHRcIiwgdmFsdWUpOyB9O1xuICAgIFN1YnNjcmlwdGlvbk9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uICh2YWx1ZSkgeyBvbk5vdGlmeSh0aGlzLl9zdWJzY3JpcHRpb24sIFwiZXJyb3JcIiwgdmFsdWUpOyB9O1xuICAgIFN1YnNjcmlwdGlvbk9ic2VydmVyLnByb3RvdHlwZS5jb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHsgb25Ob3RpZnkodGhpcy5fc3Vic2NyaXB0aW9uLCBcImNvbXBsZXRlXCIpOyB9O1xuICAgIHJldHVybiBTdWJzY3JpcHRpb25PYnNlcnZlcjtcbn0oKSk7XG5leHBvcnRzLlN1YnNjcmlwdGlvbk9ic2VydmVyID0gU3Vic2NyaXB0aW9uT2JzZXJ2ZXI7XG4vKipcbiAqIFRoZSBiYXNpYyBPYnNlcnZhYmxlIGNsYXNzLiBUaGlzIHByaW1pdGl2ZSBpcyB1c2VkIHRvIHdyYXAgYXN5bmNocm9ub3VzXG4gKiBkYXRhIHN0cmVhbXMgaW4gYSBjb21tb24gc3RhbmRhcmRpemVkIGRhdGEgdHlwZSB0aGF0IGlzIGludGVyb3BlcmFibGVcbiAqIGJldHdlZW4gbGlicmFyaWVzIGFuZCBjYW4gYmUgY29tcG9zZWQgdG8gcmVwcmVzZW50IG1vcmUgY29tcGxleCBwcm9jZXNzZXMuXG4gKi9cbnZhciBPYnNlcnZhYmxlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE9ic2VydmFibGUoc3Vic2NyaWJlcikge1xuICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgT2JzZXJ2YWJsZSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJPYnNlcnZhYmxlIGNhbm5vdCBiZSBjYWxsZWQgYXMgYSBmdW5jdGlvblwiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIHN1YnNjcmliZXIgIT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIk9ic2VydmFibGUgaW5pdGlhbGl6ZXIgbXVzdCBiZSBhIGZ1bmN0aW9uXCIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3N1YnNjcmliZXIgPSBzdWJzY3JpYmVyO1xuICAgIH1cbiAgICBPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmUgPSBmdW5jdGlvbiAobmV4dE9yT2JzZXJ2ZXIsIG9uRXJyb3IsIG9uQ29tcGxldGUpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBuZXh0T3JPYnNlcnZlciAhPT0gXCJvYmplY3RcIiB8fCBuZXh0T3JPYnNlcnZlciA9PT0gbnVsbCkge1xuICAgICAgICAgICAgbmV4dE9yT2JzZXJ2ZXIgPSB7XG4gICAgICAgICAgICAgICAgbmV4dDogbmV4dE9yT2JzZXJ2ZXIsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgY29tcGxldGU6IG9uQ29tcGxldGVcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBTdWJzY3JpcHRpb24obmV4dE9yT2JzZXJ2ZXIsIHRoaXMuX3N1YnNjcmliZXIpO1xuICAgIH07XG4gICAgT2JzZXJ2YWJsZS5wcm90b3R5cGUucGlwZSA9IGZ1bmN0aW9uIChmaXJzdCkge1xuICAgICAgICB2YXIgbWFwcGVycyA9IFtdO1xuICAgICAgICBmb3IgKHZhciBfaSA9IDE7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgbWFwcGVyc1tfaSAtIDFdID0gYXJndW1lbnRzW19pXTtcbiAgICAgICAgfVxuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmUgbm8tdGhpcy1hc3NpZ25tZW50XG4gICAgICAgIHZhciBpbnRlcm1lZGlhdGUgPSB0aGlzO1xuICAgICAgICBmb3IgKHZhciBfYSA9IDAsIF9iID0gX19zcHJlYWRBcnJheShbZmlyc3RdLCBtYXBwZXJzLCB0cnVlKTsgX2EgPCBfYi5sZW5ndGg7IF9hKyspIHtcbiAgICAgICAgICAgIHZhciBtYXBwZXIgPSBfYltfYV07XG4gICAgICAgICAgICBpbnRlcm1lZGlhdGUgPSBtYXBwZXIoaW50ZXJtZWRpYXRlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaW50ZXJtZWRpYXRlO1xuICAgIH07XG4gICAgT2JzZXJ2YWJsZS5wcm90b3R5cGUudGFwID0gZnVuY3Rpb24gKG5leHRPck9ic2VydmVyLCBvbkVycm9yLCBvbkNvbXBsZXRlKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciB0YXBPYnNlcnZlciA9IHR5cGVvZiBuZXh0T3JPYnNlcnZlciAhPT0gXCJvYmplY3RcIiB8fCBuZXh0T3JPYnNlcnZlciA9PT0gbnVsbFxuICAgICAgICAgICAgPyB7XG4gICAgICAgICAgICAgICAgbmV4dDogbmV4dE9yT2JzZXJ2ZXIsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgY29tcGxldGU6IG9uQ29tcGxldGVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIDogbmV4dE9yT2JzZXJ2ZXI7XG4gICAgICAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZShmdW5jdGlvbiAob2JzZXJ2ZXIpIHtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5zdWJzY3JpYmUoe1xuICAgICAgICAgICAgICAgIG5leHQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICB0YXBPYnNlcnZlci5uZXh0ICYmIHRhcE9ic2VydmVyLm5leHQodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5uZXh0KHZhbHVlKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFwT2JzZXJ2ZXIuZXJyb3IgJiYgdGFwT2JzZXJ2ZXIuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB0YXBPYnNlcnZlci5jb21wbGV0ZSAmJiB0YXBPYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc3RhcnQ6IGZ1bmN0aW9uIChzdWJzY3JpcHRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgdGFwT2JzZXJ2ZXIuc3RhcnQgJiYgdGFwT2JzZXJ2ZXIuc3RhcnQoc3Vic2NyaXB0aW9uKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBPYnNlcnZhYmxlLnByb3RvdHlwZS5mb3JFYWNoID0gZnVuY3Rpb24gKGZuKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGZuICE9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgICByZWplY3QobmV3IFR5cGVFcnJvcihmbiArIFwiIGlzIG5vdCBhIGZ1bmN0aW9uXCIpKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmdW5jdGlvbiBkb25lKCkge1xuICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgICAgIHJlc29sdmUodW5kZWZpbmVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBzdWJzY3JpcHRpb24gPSBfdGhpcy5zdWJzY3JpYmUoe1xuICAgICAgICAgICAgICAgIG5leHQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm4odmFsdWUsIGRvbmUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh1bmRlZmluZWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIE9ic2VydmFibGUucHJvdG90eXBlLm1hcCA9IGZ1bmN0aW9uIChmbikge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAodHlwZW9mIGZuICE9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoZm4gKyBcIiBpcyBub3QgYSBmdW5jdGlvblwiKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgQyA9IGdldFNwZWNpZXModGhpcyk7XG4gICAgICAgIHJldHVybiBuZXcgQyhmdW5jdGlvbiAob2JzZXJ2ZXIpIHsgcmV0dXJuIF90aGlzLnN1YnNjcmliZSh7XG4gICAgICAgICAgICBuZXh0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgcHJvcGFnYXRlZFZhbHVlID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgcHJvcGFnYXRlZFZhbHVlID0gZm4odmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JzZXJ2ZXIuZXJyb3IoZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG9ic2VydmVyLm5leHQocHJvcGFnYXRlZFZhbHVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGUpIHsgb2JzZXJ2ZXIuZXJyb3IoZSk7IH0sXG4gICAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24gKCkgeyBvYnNlcnZlci5jb21wbGV0ZSgpOyB9LFxuICAgICAgICB9KTsgfSk7XG4gICAgfTtcbiAgICBPYnNlcnZhYmxlLnByb3RvdHlwZS5maWx0ZXIgPSBmdW5jdGlvbiAoZm4pIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgaWYgKHR5cGVvZiBmbiAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKGZuICsgXCIgaXMgbm90IGEgZnVuY3Rpb25cIik7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIEMgPSBnZXRTcGVjaWVzKHRoaXMpO1xuICAgICAgICByZXR1cm4gbmV3IEMoZnVuY3Rpb24gKG9ic2VydmVyKSB7IHJldHVybiBfdGhpcy5zdWJzY3JpYmUoe1xuICAgICAgICAgICAgbmV4dDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFmbih2YWx1ZSkpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYnNlcnZlci5lcnJvcihlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dCh2YWx1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChlKSB7IG9ic2VydmVyLmVycm9yKGUpOyB9LFxuICAgICAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uICgpIHsgb2JzZXJ2ZXIuY29tcGxldGUoKTsgfSxcbiAgICAgICAgfSk7IH0pO1xuICAgIH07XG4gICAgT2JzZXJ2YWJsZS5wcm90b3R5cGUucmVkdWNlID0gZnVuY3Rpb24gKGZuLCBzZWVkKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGlmICh0eXBlb2YgZm4gIT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihmbiArIFwiIGlzIG5vdCBhIGZ1bmN0aW9uXCIpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBDID0gZ2V0U3BlY2llcyh0aGlzKTtcbiAgICAgICAgdmFyIGhhc1NlZWQgPSBhcmd1bWVudHMubGVuZ3RoID4gMTtcbiAgICAgICAgdmFyIGhhc1ZhbHVlID0gZmFsc2U7XG4gICAgICAgIHZhciBhY2MgPSBzZWVkO1xuICAgICAgICByZXR1cm4gbmV3IEMoZnVuY3Rpb24gKG9ic2VydmVyKSB7IHJldHVybiBfdGhpcy5zdWJzY3JpYmUoe1xuICAgICAgICAgICAgbmV4dDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZpcnN0ID0gIWhhc1ZhbHVlO1xuICAgICAgICAgICAgICAgIGhhc1ZhbHVlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBpZiAoIWZpcnN0IHx8IGhhc1NlZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjYyA9IGZuKGFjYywgdmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JzZXJ2ZXIuZXJyb3IoZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGFjYyA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGUpIHsgb2JzZXJ2ZXIuZXJyb3IoZSk7IH0sXG4gICAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICghaGFzVmFsdWUgJiYgIWhhc1NlZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9ic2VydmVyLmVycm9yKG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgcmVkdWNlIGFuIGVtcHR5IHNlcXVlbmNlXCIpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dChhY2MpO1xuICAgICAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTsgfSk7XG4gICAgfTtcbiAgICBPYnNlcnZhYmxlLnByb3RvdHlwZS5jb25jYXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBzb3VyY2VzID0gW107XG4gICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICBzb3VyY2VzW19pXSA9IGFyZ3VtZW50c1tfaV07XG4gICAgICAgIH1cbiAgICAgICAgdmFyIEMgPSBnZXRTcGVjaWVzKHRoaXMpO1xuICAgICAgICByZXR1cm4gbmV3IEMoZnVuY3Rpb24gKG9ic2VydmVyKSB7XG4gICAgICAgICAgICB2YXIgc3Vic2NyaXB0aW9uO1xuICAgICAgICAgICAgdmFyIGluZGV4ID0gMDtcbiAgICAgICAgICAgIGZ1bmN0aW9uIHN0YXJ0TmV4dChuZXh0KSB7XG4gICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uID0gbmV4dC5zdWJzY3JpYmUoe1xuICAgICAgICAgICAgICAgICAgICBuZXh0OiBmdW5jdGlvbiAodikgeyBvYnNlcnZlci5uZXh0KHYpOyB9LFxuICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGUpIHsgb2JzZXJ2ZXIuZXJyb3IoZSk7IH0sXG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT09IHNvdXJjZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydE5leHQoQy5mcm9tKHNvdXJjZXNbaW5kZXgrK10pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN0YXJ0TmV4dChfdGhpcyk7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmIChzdWJzY3JpcHRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIE9ic2VydmFibGUucHJvdG90eXBlLmZsYXRNYXAgPSBmdW5jdGlvbiAoZm4pIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgaWYgKHR5cGVvZiBmbiAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKGZuICsgXCIgaXMgbm90IGEgZnVuY3Rpb25cIik7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIEMgPSBnZXRTcGVjaWVzKHRoaXMpO1xuICAgICAgICByZXR1cm4gbmV3IEMoZnVuY3Rpb24gKG9ic2VydmVyKSB7XG4gICAgICAgICAgICB2YXIgc3Vic2NyaXB0aW9ucyA9IFtdO1xuICAgICAgICAgICAgdmFyIG91dGVyID0gX3RoaXMuc3Vic2NyaWJlKHtcbiAgICAgICAgICAgICAgICBuZXh0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5vcm1hbGl6ZWRWYWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZuKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vcm1hbGl6ZWRWYWx1ZSA9IGZuKHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9ic2VydmVyLmVycm9yKGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbm9ybWFsaXplZFZhbHVlID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdmFyIGlubmVyID0gQy5mcm9tKG5vcm1hbGl6ZWRWYWx1ZSkuc3Vic2NyaWJlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5leHQ6IGZ1bmN0aW9uIChpbm5lclZhbHVlKSB7IG9ic2VydmVyLm5leHQoaW5uZXJWYWx1ZSk7IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGUpIHsgb2JzZXJ2ZXIuZXJyb3IoZSk7IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpID0gc3Vic2NyaXB0aW9ucy5pbmRleE9mKGlubmVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSA+PSAwKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb25zLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZUlmRG9uZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbnMucHVzaChpbm5lcik7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGUpIHsgb2JzZXJ2ZXIuZXJyb3IoZSk7IH0sXG4gICAgICAgICAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uICgpIHsgY29tcGxldGVJZkRvbmUoKTsgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZnVuY3Rpb24gY29tcGxldGVJZkRvbmUoKSB7XG4gICAgICAgICAgICAgICAgaWYgKG91dGVyLmNsb3NlZCAmJiBzdWJzY3JpcHRpb25zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uIChzKSB7IHJldHVybiBzLnVuc3Vic2NyaWJlKCk7IH0pO1xuICAgICAgICAgICAgICAgIG91dGVyLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIE9ic2VydmFibGUucHJvdG90eXBlWyhTeW1ib2wub2JzZXJ2YWJsZSwgU3ltYm9sT2JzZXJ2YWJsZSldID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfTtcbiAgICBPYnNlcnZhYmxlLmZyb20gPSBmdW5jdGlvbiAoeCkge1xuICAgICAgICB2YXIgQyA9ICh0eXBlb2YgdGhpcyA9PT0gXCJmdW5jdGlvblwiID8gdGhpcyA6IE9ic2VydmFibGUpO1xuICAgICAgICBpZiAoeCA9PSBudWxsKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHggKyBcIiBpcyBub3QgYW4gb2JqZWN0XCIpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBvYnNlcnZhYmxlTWV0aG9kID0gZ2V0TWV0aG9kKHgsIFN5bWJvbE9ic2VydmFibGUpO1xuICAgICAgICBpZiAob2JzZXJ2YWJsZU1ldGhvZCkge1xuICAgICAgICAgICAgdmFyIG9ic2VydmFibGVfMSA9IG9ic2VydmFibGVNZXRob2QuY2FsbCh4KTtcbiAgICAgICAgICAgIGlmIChPYmplY3Qob2JzZXJ2YWJsZV8xKSAhPT0gb2JzZXJ2YWJsZV8xKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihvYnNlcnZhYmxlXzEgKyBcIiBpcyBub3QgYW4gb2JqZWN0XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzT2JzZXJ2YWJsZShvYnNlcnZhYmxlXzEpICYmIG9ic2VydmFibGVfMS5jb25zdHJ1Y3RvciA9PT0gQykge1xuICAgICAgICAgICAgICAgIHJldHVybiBvYnNlcnZhYmxlXzE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IEMoZnVuY3Rpb24gKG9ic2VydmVyKSB7IHJldHVybiBvYnNlcnZhYmxlXzEuc3Vic2NyaWJlKG9ic2VydmVyKTsgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCgwLCBfc3ltYm9sc18xLmhhc1N5bWJvbCkoXCJpdGVyYXRvclwiKSkge1xuICAgICAgICAgICAgdmFyIGl0ZXJhdG9yTWV0aG9kXzEgPSBnZXRNZXRob2QoeCwgU3ltYm9sSXRlcmF0b3IpO1xuICAgICAgICAgICAgaWYgKGl0ZXJhdG9yTWV0aG9kXzEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEMoZnVuY3Rpb24gKG9ic2VydmVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGVucXVldWUoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9ic2VydmVyLmNsb3NlZClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gaXRlcmF0b3JNZXRob2RfMS5jYWxsKHgpOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpdGVtID0gX2FbX2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm5leHQoaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9ic2VydmVyLmNsb3NlZClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoeCkpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgQyhmdW5jdGlvbiAob2JzZXJ2ZXIpIHtcbiAgICAgICAgICAgICAgICBlbnF1ZXVlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9ic2VydmVyLmNsb3NlZClcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCB4XzEgPSB4OyBfaSA8IHhfMS5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpdGVtID0geF8xW19pXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm5leHQoaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JzZXJ2ZXIuY2xvc2VkKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcih4ICsgXCIgaXMgbm90IG9ic2VydmFibGVcIik7XG4gICAgfTtcbiAgICBPYnNlcnZhYmxlLm9mID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgaXRlbXMgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgIGl0ZW1zW19pXSA9IGFyZ3VtZW50c1tfaV07XG4gICAgICAgIH1cbiAgICAgICAgdmFyIEMgPSAodHlwZW9mIHRoaXMgPT09IFwiZnVuY3Rpb25cIiA/IHRoaXMgOiBPYnNlcnZhYmxlKTtcbiAgICAgICAgcmV0dXJuIG5ldyBDKGZ1bmN0aW9uIChvYnNlcnZlcikge1xuICAgICAgICAgICAgZW5xdWV1ZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9ic2VydmVyLmNsb3NlZClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgaXRlbXNfMSA9IGl0ZW1zOyBfaSA8IGl0ZW1zXzEubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpdGVtID0gaXRlbXNfMVtfaV07XG4gICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm5leHQoaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYnNlcnZlci5jbG9zZWQpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoT2JzZXJ2YWJsZSwgU3ltYm9sU3BlY2llcywge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICByZXR1cm4gT2JzZXJ2YWJsZTtcbn0oKSk7XG5leHBvcnRzLk9ic2VydmFibGUgPSBPYnNlcnZhYmxlO1xuaWYgKCgwLCBfc3ltYm9sc18xLmhhc1N5bWJvbHMpKCkpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoT2JzZXJ2YWJsZSwgU3ltYm9sKFwiZXh0ZW5zaW9uc1wiKSwge1xuICAgICAgICB2YWx1ZToge1xuICAgICAgICAgICAgc3ltYm9sOiBTeW1ib2xPYnNlcnZhYmxlLFxuICAgICAgICAgICAgaG9zdFJlcG9ydEVycm9yOiBob3N0UmVwb3J0RXJyb3IsXG4gICAgICAgIH0sXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICB9KTtcbn1cbmV4cG9ydHMuZGVmYXVsdCA9IE9ic2VydmFibGU7XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vb2JzZXJ2YWJsZS5qcz8iKTsKCi8qKiovIH0pLAoKLyoqKi8gIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vc2Nhbi5qcyI6Ci8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqISpcCiAgISoqKiAvaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vb2JzZXJ2YWJsZS1mbnNAMC42LjEvbm9kZV9tb2R1bGVzL29ic2VydmFibGUtZm5zL2Rpc3QuZXNtL3NjYW4uanMgKioqIQogIFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKZXZhbCgiXG52YXIgX19nZW5lcmF0b3IgPSAodGhpcyAmJiB0aGlzLl9fZ2VuZXJhdG9yKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgYm9keSkge1xuICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGc7XG4gICAgcmV0dXJuIGcgPSB7IG5leHQ6IHZlcmIoMCksIFwidGhyb3dcIjogdmVyYigxKSwgXCJyZXR1cm5cIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7XG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IHJldHVybiBmdW5jdGlvbiAodikgeyByZXR1cm4gc3RlcChbbiwgdl0pOyB9OyB9XG4gICAgZnVuY3Rpb24gc3RlcChvcCkge1xuICAgICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XG4gICAgICAgIHdoaWxlIChfKSB0cnkge1xuICAgICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0gb3BbMF0gJiAyID8geVtcInJldHVyblwiXSA6IG9wWzBdID8geVtcInRocm93XCJdIHx8ICgodCA9IHlbXCJyZXR1cm5cIl0pICYmIHQuY2FsbCh5KSwgMCkgOiB5Lm5leHQpICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0O1xuICAgICAgICAgICAgaWYgKHkgPSAwLCB0KSBvcCA9IFtvcFswXSAmIDIsIHQudmFsdWVdO1xuICAgICAgICAgICAgc3dpdGNoIChvcFswXSkge1xuICAgICAgICAgICAgICAgIGNhc2UgMDogY2FzZSAxOiB0ID0gb3A7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNDogXy5sYWJlbCsrOyByZXR1cm4geyB2YWx1ZTogb3BbMV0sIGRvbmU6IGZhbHNlIH07XG4gICAgICAgICAgICAgICAgY2FzZSA1OiBfLmxhYmVsKys7IHkgPSBvcFsxXTsgb3AgPSBbMF07IGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIGNhc2UgNzogb3AgPSBfLm9wcy5wb3AoKTsgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBpZiAoISh0ID0gXy50cnlzLCB0ID0gdC5sZW5ndGggPiAwICYmIHRbdC5sZW5ndGggLSAxXSkgJiYgKG9wWzBdID09PSA2IHx8IG9wWzBdID09PSAyKSkgeyBfID0gMDsgY29udGludWU7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCAob3BbMV0gPiB0WzBdICYmIG9wWzFdIDwgdFszXSkpKSB7IF8ubGFiZWwgPSBvcFsxXTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7IF8ubGFiZWwgPSB0WzFdOyB0ID0gb3A7IGJyZWFrOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIF8ubGFiZWwgPCB0WzJdKSB7IF8ubGFiZWwgPSB0WzJdOyBfLm9wcy5wdXNoKG9wKTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRbMl0pIF8ub3BzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3AgPSBib2R5LmNhbGwodGhpc0FyZywgXyk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgb3AgPSBbNiwgZV07IHkgPSAwOyB9IGZpbmFsbHkgeyBmID0gdCA9IDA7IH1cbiAgICAgICAgaWYgKG9wWzBdICYgNSkgdGhyb3cgb3BbMV07IHJldHVybiB7IHZhbHVlOiBvcFswXSA/IG9wWzFdIDogdm9pZCAwLCBkb25lOiB0cnVlIH07XG4gICAgfVxufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHtcbiAgICAgICAgICAgIHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHtcbiAgICAgICAgICAgIHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfc2NoZWR1bGVyXzEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL19zY2hlZHVsZXIgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vb2JzZXJ2YWJsZS1mbnNAMC42LjEvbm9kZV9tb2R1bGVzL29ic2VydmFibGUtZm5zL2Rpc3QuZXNtL19zY2hlZHVsZXIuanNcIik7XG52YXIgb2JzZXJ2YWJsZV8xID0gX19pbXBvcnREZWZhdWx0KF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vb2JzZXJ2YWJsZSAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vb2JzZXJ2YWJsZS5qc1wiKSk7XG52YXIgdW5zdWJzY3JpYmVfMSA9IF9faW1wb3J0RGVmYXVsdChfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL3Vuc3Vic2NyaWJlICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL29ic2VydmFibGUtZm5zQDAuNi4xL25vZGVfbW9kdWxlcy9vYnNlcnZhYmxlLWZucy9kaXN0LmVzbS91bnN1YnNjcmliZS5qc1wiKSk7XG5mdW5jdGlvbiBzY2FuKGFjY3VtdWxhdG9yLCBzZWVkKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChvYnNlcnZhYmxlKSB7XG4gICAgICAgIHJldHVybiBuZXcgb2JzZXJ2YWJsZV8xLmRlZmF1bHQoZnVuY3Rpb24gKG9ic2VydmVyKSB7XG4gICAgICAgICAgICB2YXIgYWNjdW11bGF0ZWQ7XG4gICAgICAgICAgICB2YXIgaW5kZXggPSAwO1xuICAgICAgICAgICAgdmFyIHNjaGVkdWxlciA9IG5ldyBfc2NoZWR1bGVyXzEuQXN5bmNTZXJpYWxTY2hlZHVsZXIob2JzZXJ2ZXIpO1xuICAgICAgICAgICAgdmFyIHN1YnNjcmlwdGlvbiA9IG9ic2VydmFibGUuc3Vic2NyaWJlKHtcbiAgICAgICAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBzY2hlZHVsZXIuY29tcGxldGUoKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NoZWR1bGVyLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG5leHQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICBzY2hlZHVsZXIuc2NoZWR1bGUoZnVuY3Rpb24gKG5leHQpIHsgcmV0dXJuIF9fYXdhaXRlcihfdGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcmV2QWNjO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJldkFjYyA9IGluZGV4ID09PSAwXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAodHlwZW9mIHNlZWQgPT09IFwidW5kZWZpbmVkXCIgPyB2YWx1ZSA6IHNlZWQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBhY2N1bXVsYXRlZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIGFjY3VtdWxhdG9yKHByZXZBY2MsIHZhbHVlLCBpbmRleCsrKV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY3VtdWxhdGVkID0gX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dChhY2N1bXVsYXRlZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pOyB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7IHJldHVybiAoMCwgdW5zdWJzY3JpYmVfMS5kZWZhdWx0KShzdWJzY3JpcHRpb24pOyB9O1xuICAgICAgICB9KTtcbiAgICB9O1xufVxuZXhwb3J0cy5kZWZhdWx0ID0gc2NhbjtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL29ic2VydmFibGUtZm5zQDAuNi4xL25vZGVfbW9kdWxlcy9vYnNlcnZhYmxlLWZucy9kaXN0LmVzbS9zY2FuLmpzPyIpOwoKLyoqKi8gfSksCgovKioqLyAiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL29ic2VydmFibGUtZm5zQDAuNi4xL25vZGVfbW9kdWxlcy9vYnNlcnZhYmxlLWZucy9kaXN0LmVzbS9zdWJqZWN0LmpzIjoKLyohKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlwKICAhKioqIC9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vc3ViamVjdC5qcyAqKiohCiAgXCoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKiEgbm8gc3RhdGljIGV4cG9ydHMgZm91bmQgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwpldmFsKCJcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChiLCBwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGlmICh0eXBlb2YgYiAhPT0gXCJmdW5jdGlvblwiICYmIGIgIT09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2xhc3MgZXh0ZW5kcyB2YWx1ZSBcIiArIFN0cmluZyhiKSArIFwiIGlzIG5vdCBhIGNvbnN0cnVjdG9yIG9yIG51bGxcIik7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgb2JzZXJ2YWJsZV8xID0gX19pbXBvcnREZWZhdWx0KF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vb2JzZXJ2YWJsZSAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vb2JzZXJ2YWJsZS5qc1wiKSk7XG4vLyBUT0RPOiBUaGlzIG9ic2VydmVyIGl0ZXJhdGlvbiBhcHByb2FjaCBsb29rcyBpbmVsZWdhbnQgYW5kIGV4cGVuc2l2ZVxuLy8gSWRlYTogQ29tZSB1cCB3aXRoIHN1cGVyIGNsYXNzIGZvciBTdWJzY3JpcHRpb24gdGhhdCBjb250YWlucyB0aGVcbi8vICAgICAgIG5vdGlmeSosIC4uLiBtZXRob2RzIGFuZCB1c2UgaXQgaGVyZVxuLyoqXG4gKiBBIHN1YmplY3QgaXMgYSBcImhvdFwiIG9ic2VydmFibGUgKHNlZSBgbXVsdGljYXN0YCkgdGhhdCBoYXMgaXRzIG9ic2VydmVyXG4gKiBtZXRob2RzIChgLm5leHQodmFsdWUpYCwgYC5lcnJvcihlcnJvcilgLCBgLmNvbXBsZXRlKClgKSBleHBvc2VkLlxuICpcbiAqIEJlIGNhcmVmdWwsIHRob3VnaCEgV2l0aCBncmVhdCBwb3dlciBjb21lcyBncmVhdCByZXNwb25zaWJpbGl0eS4gT25seSB1c2VcbiAqIHRoZSBgU3ViamVjdGAgd2hlbiB5b3UgcmVhbGx5IG5lZWQgdG8gdHJpZ2dlciB1cGRhdGVzIFwiZnJvbSB0aGUgb3V0c2lkZVwiIGFuZFxuICogdHJ5IHRvIGtlZXAgdGhlIGNvZGUgdGhhdCBjYW4gYWNjZXNzIGl0IHRvIGEgbWluaW11bS4gUmV0dXJuXG4gKiBgT2JzZXJ2YWJsZS5mcm9tKG15U3ViamVjdClgIHRvIG5vdCBhbGxvdyBvdGhlciBjb2RlIHRvIG11dGF0ZS5cbiAqL1xudmFyIE11bHRpY2FzdFN1YmplY3QgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKE11bHRpY2FzdFN1YmplY3QsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gTXVsdGljYXN0U3ViamVjdCgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgZnVuY3Rpb24gKG9ic2VydmVyKSB7XG4gICAgICAgICAgICBfdGhpcy5fb2JzZXJ2ZXJzLmFkZChvYnNlcnZlcik7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuX29ic2VydmVycy5kZWxldGUob2JzZXJ2ZXIpOyB9O1xuICAgICAgICB9KSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5fb2JzZXJ2ZXJzID0gbmV3IFNldCgpO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIE11bHRpY2FzdFN1YmplY3QucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMuX29ic2VydmVyczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgIHZhciBvYnNlcnZlciA9IF9hW19pXTtcbiAgICAgICAgICAgIG9ic2VydmVyLm5leHQodmFsdWUpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBNdWx0aWNhc3RTdWJqZWN0LnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gdGhpcy5fb2JzZXJ2ZXJzOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgdmFyIG9ic2VydmVyID0gX2FbX2ldO1xuICAgICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IoZXJyb3IpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBNdWx0aWNhc3RTdWJqZWN0LnByb3RvdHlwZS5jb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMuX29ic2VydmVyczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgIHZhciBvYnNlcnZlciA9IF9hW19pXTtcbiAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHJldHVybiBNdWx0aWNhc3RTdWJqZWN0O1xufShvYnNlcnZhYmxlXzEuZGVmYXVsdCkpO1xuZXhwb3J0cy5kZWZhdWx0ID0gTXVsdGljYXN0U3ViamVjdDtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL29ic2VydmFibGUtZm5zQDAuNi4xL25vZGVfbW9kdWxlcy9vYnNlcnZhYmxlLWZucy9kaXN0LmVzbS9zdWJqZWN0LmpzPyIpOwoKLyoqKi8gfSksCgovKioqLyAiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL29ic2VydmFibGUtZm5zQDAuNi4xL25vZGVfbW9kdWxlcy9vYnNlcnZhYmxlLWZucy9kaXN0LmVzbS9zeW1ib2xzLmpzIjoKLyohKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlwKICAhKioqIC9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vc3ltYm9scy5qcyAqKiohCiAgXCoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKiEgbm8gc3RhdGljIGV4cG9ydHMgZm91bmQgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwpldmFsKCJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL29ic2VydmFibGUtZm5zQDAuNi4xL25vZGVfbW9kdWxlcy9vYnNlcnZhYmxlLWZucy9kaXN0LmVzbS9zeW1ib2xzLmpzPyIpOwoKLyoqKi8gfSksCgovKioqLyAiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL29ic2VydmFibGUtZm5zQDAuNi4xL25vZGVfbW9kdWxlcy9vYnNlcnZhYmxlLWZucy9kaXN0LmVzbS91bnN1YnNjcmliZS5qcyI6Ci8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiEqXAogICEqKiogL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL29ic2VydmFibGUtZm5zQDAuNi4xL25vZGVfbW9kdWxlcy9vYnNlcnZhYmxlLWZucy9kaXN0LmVzbS91bnN1YnNjcmliZS5qcyAqKiohCiAgXCoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKZXZhbCgiXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG4vKipcbiAqIFVuc3Vic2NyaWJlIGZyb20gYSBzdWJzY3JpcHRpb24gcmV0dXJuZWQgYnkgc29tZXRoaW5nIHRoYXQgbG9va3MgbGlrZSBhbiBvYnNlcnZhYmxlLFxuICogYnV0IGlzIG5vdCBuZWNlc3NhcmlseSBvdXIgb2JzZXJ2YWJsZSBpbXBsZW1lbnRhdGlvbi5cbiAqL1xuZnVuY3Rpb24gdW5zdWJzY3JpYmUoc3Vic2NyaXB0aW9uKSB7XG4gICAgaWYgKHR5cGVvZiBzdWJzY3JpcHRpb24gPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICBzdWJzY3JpcHRpb24oKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoc3Vic2NyaXB0aW9uICYmIHR5cGVvZiBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB9XG59XG5leHBvcnRzLmRlZmF1bHQgPSB1bnN1YnNjcmliZTtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL29ic2VydmFibGUtZm5zQDAuNi4xL25vZGVfbW9kdWxlcy9vYnNlcnZhYmxlLWZucy9kaXN0LmVzbS91bnN1YnNjcmliZS5qcz8iKTsKCi8qKiovIH0pLAoKLyoqKi8gIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9wYXRoLWJyb3dzZXJpZnlAMS4wLjEvbm9kZV9tb2R1bGVzL3BhdGgtYnJvd3NlcmlmeS9pbmRleC5qcyI6Ci8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqISpcCiAgISoqKiAvaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vcGF0aC1icm93c2VyaWZ5QDEuMC4xL25vZGVfbW9kdWxlcy9wYXRoLWJyb3dzZXJpZnkvaW5kZXguanMgKioqIQogIFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKZXZhbCgiLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovKGZ1bmN0aW9uKHByb2Nlc3MpIHsvLyAncGF0aCcgbW9kdWxlIGV4dHJhY3RlZCBmcm9tIE5vZGUuanMgdjguMTEuMSAob25seSB0aGUgcG9zaXggcGFydClcbi8vIHRyYW5zcGxpdGVkIHdpdGggQmFiZWxcbi8vIENvcHlyaWdodCBKb3llbnQsIEluYy4gYW5kIG90aGVyIE5vZGUgY29udHJpYnV0b3JzLlxuLy9cbi8vIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhXG4vLyBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlXG4vLyBcIlNvZnR3YXJlXCIpLCB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmdcbi8vIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCxcbi8vIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXRcbi8vIHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZVxuLy8gZm9sbG93aW5nIGNvbmRpdGlvbnM6XG4vL1xuLy8gVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWRcbi8vIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuLy9cbi8vIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1Ncbi8vIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0Zcbi8vIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU5cbi8vIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLFxuLy8gREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SXG4vLyBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFXG4vLyBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLlxuXG5mdW5jdGlvbiBhc3NlcnRQYXRoKHBhdGgpIHtcbiAgICBpZiAodHlwZW9mIHBhdGggIT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1BhdGggbXVzdCBiZSBhIHN0cmluZy4gUmVjZWl2ZWQgJyArIEpTT04uc3RyaW5naWZ5KHBhdGgpKTtcbiAgICB9XG59XG4vLyBSZXNvbHZlcyAuIGFuZCAuLiBlbGVtZW50cyBpbiBhIHBhdGggd2l0aCBkaXJlY3RvcnkgbmFtZXNcbmZ1bmN0aW9uIG5vcm1hbGl6ZVN0cmluZ1Bvc2l4KHBhdGgsIGFsbG93QWJvdmVSb290KSB7XG4gICAgdmFyIHJlcyA9ICcnO1xuICAgIHZhciBsYXN0U2VnbWVudExlbmd0aCA9IDA7XG4gICAgdmFyIGxhc3RTbGFzaCA9IC0xO1xuICAgIHZhciBkb3RzID0gMDtcbiAgICB2YXIgY29kZTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8PSBwYXRoLmxlbmd0aDsgKytpKSB7XG4gICAgICAgIGlmIChpIDwgcGF0aC5sZW5ndGgpXG4gICAgICAgICAgICBjb2RlID0gcGF0aC5jaGFyQ29kZUF0KGkpO1xuICAgICAgICBlbHNlIGlmIChjb2RlID09PSA0NyAvKi8qLylcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICBjb2RlID0gNDcgLyovKi87XG4gICAgICAgIGlmIChjb2RlID09PSA0NyAvKi8qLykge1xuICAgICAgICAgICAgaWYgKGxhc3RTbGFzaCA9PT0gaSAtIDEgfHwgZG90cyA9PT0gMSkge1xuICAgICAgICAgICAgICAgIC8vIE5PT1BcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGxhc3RTbGFzaCAhPT0gaSAtIDEgJiYgZG90cyA9PT0gMikge1xuICAgICAgICAgICAgICAgIGlmIChyZXMubGVuZ3RoIDwgMiB8fCBsYXN0U2VnbWVudExlbmd0aCAhPT0gMiB8fCByZXMuY2hhckNvZGVBdChyZXMubGVuZ3RoIC0gMSkgIT09IDQ2IC8qLiovIHx8IHJlcy5jaGFyQ29kZUF0KHJlcy5sZW5ndGggLSAyKSAhPT0gNDYgLyouKi8pIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5sZW5ndGggPiAyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGFzdFNsYXNoSW5kZXggPSByZXMubGFzdEluZGV4T2YoJy8nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsYXN0U2xhc2hJbmRleCAhPT0gcmVzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobGFzdFNsYXNoSW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcyA9ICcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0U2VnbWVudExlbmd0aCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXMgPSByZXMuc2xpY2UoMCwgbGFzdFNsYXNoSW5kZXgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0U2VnbWVudExlbmd0aCA9IHJlcy5sZW5ndGggLSAxIC0gcmVzLmxhc3RJbmRleE9mKCcvJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RTbGFzaCA9IGk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZG90cyA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocmVzLmxlbmd0aCA9PT0gMiB8fCByZXMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXMgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RTZWdtZW50TGVuZ3RoID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RTbGFzaCA9IGk7XG4gICAgICAgICAgICAgICAgICAgICAgICBkb3RzID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChhbGxvd0Fib3ZlUm9vdCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmxlbmd0aCA+IDApXG4gICAgICAgICAgICAgICAgICAgICAgICByZXMgKz0gJy8uLic7XG4gICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcyA9ICcuLic7XG4gICAgICAgICAgICAgICAgICAgIGxhc3RTZWdtZW50TGVuZ3RoID0gMjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzLmxlbmd0aCA+IDApXG4gICAgICAgICAgICAgICAgICAgIHJlcyArPSAnLycgKyBwYXRoLnNsaWNlKGxhc3RTbGFzaCArIDEsIGkpO1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgcmVzID0gcGF0aC5zbGljZShsYXN0U2xhc2ggKyAxLCBpKTtcbiAgICAgICAgICAgICAgICBsYXN0U2VnbWVudExlbmd0aCA9IGkgLSBsYXN0U2xhc2ggLSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGFzdFNsYXNoID0gaTtcbiAgICAgICAgICAgIGRvdHMgPSAwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNvZGUgPT09IDQ2IC8qLiovICYmIGRvdHMgIT09IC0xKSB7XG4gICAgICAgICAgICArK2RvdHM7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBkb3RzID0gLTE7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlcztcbn1cbmZ1bmN0aW9uIF9mb3JtYXQoc2VwLCBwYXRoT2JqZWN0KSB7XG4gICAgdmFyIGRpciA9IHBhdGhPYmplY3QuZGlyIHx8IHBhdGhPYmplY3Qucm9vdDtcbiAgICB2YXIgYmFzZSA9IHBhdGhPYmplY3QuYmFzZSB8fCAocGF0aE9iamVjdC5uYW1lIHx8ICcnKSArIChwYXRoT2JqZWN0LmV4dCB8fCAnJyk7XG4gICAgaWYgKCFkaXIpIHtcbiAgICAgICAgcmV0dXJuIGJhc2U7XG4gICAgfVxuICAgIGlmIChkaXIgPT09IHBhdGhPYmplY3Qucm9vdCkge1xuICAgICAgICByZXR1cm4gZGlyICsgYmFzZTtcbiAgICB9XG4gICAgcmV0dXJuIGRpciArIHNlcCArIGJhc2U7XG59XG52YXIgcG9zaXggPSB7XG4gICAgLy8gcGF0aC5yZXNvbHZlKFtmcm9tIC4uLl0sIHRvKVxuICAgIHJlc29sdmU6IGZ1bmN0aW9uIHJlc29sdmUoKSB7XG4gICAgICAgIHZhciByZXNvbHZlZFBhdGggPSAnJztcbiAgICAgICAgdmFyIHJlc29sdmVkQWJzb2x1dGUgPSBmYWxzZTtcbiAgICAgICAgdmFyIGN3ZDtcbiAgICAgICAgZm9yICh2YXIgaSA9IGFyZ3VtZW50cy5sZW5ndGggLSAxOyBpID49IC0xICYmICFyZXNvbHZlZEFic29sdXRlOyBpLS0pIHtcbiAgICAgICAgICAgIHZhciBwYXRoO1xuICAgICAgICAgICAgaWYgKGkgPj0gMClcbiAgICAgICAgICAgICAgICBwYXRoID0gYXJndW1lbnRzW2ldO1xuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGN3ZCA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgICBjd2QgPSBwcm9jZXNzLmN3ZCgpO1xuICAgICAgICAgICAgICAgIHBhdGggPSBjd2Q7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhc3NlcnRQYXRoKHBhdGgpO1xuICAgICAgICAgICAgLy8gU2tpcCBlbXB0eSBlbnRyaWVzXG4gICAgICAgICAgICBpZiAocGF0aC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlc29sdmVkUGF0aCA9IHBhdGggKyAnLycgKyByZXNvbHZlZFBhdGg7XG4gICAgICAgICAgICByZXNvbHZlZEFic29sdXRlID0gcGF0aC5jaGFyQ29kZUF0KDApID09PSA0NyAvKi8qLztcbiAgICAgICAgfVxuICAgICAgICAvLyBBdCB0aGlzIHBvaW50IHRoZSBwYXRoIHNob3VsZCBiZSByZXNvbHZlZCB0byBhIGZ1bGwgYWJzb2x1dGUgcGF0aCwgYnV0XG4gICAgICAgIC8vIGhhbmRsZSByZWxhdGl2ZSBwYXRocyB0byBiZSBzYWZlIChtaWdodCBoYXBwZW4gd2hlbiBwcm9jZXNzLmN3ZCgpIGZhaWxzKVxuICAgICAgICAvLyBOb3JtYWxpemUgdGhlIHBhdGhcbiAgICAgICAgcmVzb2x2ZWRQYXRoID0gbm9ybWFsaXplU3RyaW5nUG9zaXgocmVzb2x2ZWRQYXRoLCAhcmVzb2x2ZWRBYnNvbHV0ZSk7XG4gICAgICAgIGlmIChyZXNvbHZlZEFic29sdXRlKSB7XG4gICAgICAgICAgICBpZiAocmVzb2x2ZWRQYXRoLmxlbmd0aCA+IDApXG4gICAgICAgICAgICAgICAgcmV0dXJuICcvJyArIHJlc29sdmVkUGF0aDtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICByZXR1cm4gJy8nO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHJlc29sdmVkUGF0aC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzb2x2ZWRQYXRoO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuICcuJztcbiAgICAgICAgfVxuICAgIH0sXG4gICAgbm9ybWFsaXplOiBmdW5jdGlvbiBub3JtYWxpemUocGF0aCkge1xuICAgICAgICBhc3NlcnRQYXRoKHBhdGgpO1xuICAgICAgICBpZiAocGF0aC5sZW5ndGggPT09IDApXG4gICAgICAgICAgICByZXR1cm4gJy4nO1xuICAgICAgICB2YXIgaXNBYnNvbHV0ZSA9IHBhdGguY2hhckNvZGVBdCgwKSA9PT0gNDcgLyovKi87XG4gICAgICAgIHZhciB0cmFpbGluZ1NlcGFyYXRvciA9IHBhdGguY2hhckNvZGVBdChwYXRoLmxlbmd0aCAtIDEpID09PSA0NyAvKi8qLztcbiAgICAgICAgLy8gTm9ybWFsaXplIHRoZSBwYXRoXG4gICAgICAgIHBhdGggPSBub3JtYWxpemVTdHJpbmdQb3NpeChwYXRoLCAhaXNBYnNvbHV0ZSk7XG4gICAgICAgIGlmIChwYXRoLmxlbmd0aCA9PT0gMCAmJiAhaXNBYnNvbHV0ZSlcbiAgICAgICAgICAgIHBhdGggPSAnLic7XG4gICAgICAgIGlmIChwYXRoLmxlbmd0aCA+IDAgJiYgdHJhaWxpbmdTZXBhcmF0b3IpXG4gICAgICAgICAgICBwYXRoICs9ICcvJztcbiAgICAgICAgaWYgKGlzQWJzb2x1dGUpXG4gICAgICAgICAgICByZXR1cm4gJy8nICsgcGF0aDtcbiAgICAgICAgcmV0dXJuIHBhdGg7XG4gICAgfSxcbiAgICBpc0Fic29sdXRlOiBmdW5jdGlvbiBpc0Fic29sdXRlKHBhdGgpIHtcbiAgICAgICAgYXNzZXJ0UGF0aChwYXRoKTtcbiAgICAgICAgcmV0dXJuIHBhdGgubGVuZ3RoID4gMCAmJiBwYXRoLmNoYXJDb2RlQXQoMCkgPT09IDQ3IC8qLyovO1xuICAgIH0sXG4gICAgam9pbjogZnVuY3Rpb24gam9pbigpIHtcbiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApXG4gICAgICAgICAgICByZXR1cm4gJy4nO1xuICAgICAgICB2YXIgam9pbmVkO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdmFyIGFyZyA9IGFyZ3VtZW50c1tpXTtcbiAgICAgICAgICAgIGFzc2VydFBhdGgoYXJnKTtcbiAgICAgICAgICAgIGlmIChhcmcubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGlmIChqb2luZWQgPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICAgICAgam9pbmVkID0gYXJnO1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgam9pbmVkICs9ICcvJyArIGFyZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoam9pbmVkID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICByZXR1cm4gJy4nO1xuICAgICAgICByZXR1cm4gcG9zaXgubm9ybWFsaXplKGpvaW5lZCk7XG4gICAgfSxcbiAgICByZWxhdGl2ZTogZnVuY3Rpb24gcmVsYXRpdmUoZnJvbSwgdG8pIHtcbiAgICAgICAgYXNzZXJ0UGF0aChmcm9tKTtcbiAgICAgICAgYXNzZXJ0UGF0aCh0byk7XG4gICAgICAgIGlmIChmcm9tID09PSB0bylcbiAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgZnJvbSA9IHBvc2l4LnJlc29sdmUoZnJvbSk7XG4gICAgICAgIHRvID0gcG9zaXgucmVzb2x2ZSh0byk7XG4gICAgICAgIGlmIChmcm9tID09PSB0bylcbiAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgLy8gVHJpbSBhbnkgbGVhZGluZyBiYWNrc2xhc2hlc1xuICAgICAgICB2YXIgZnJvbVN0YXJ0ID0gMTtcbiAgICAgICAgZm9yICg7IGZyb21TdGFydCA8IGZyb20ubGVuZ3RoOyArK2Zyb21TdGFydCkge1xuICAgICAgICAgICAgaWYgKGZyb20uY2hhckNvZGVBdChmcm9tU3RhcnQpICE9PSA0NyAvKi8qLylcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICB2YXIgZnJvbUVuZCA9IGZyb20ubGVuZ3RoO1xuICAgICAgICB2YXIgZnJvbUxlbiA9IGZyb21FbmQgLSBmcm9tU3RhcnQ7XG4gICAgICAgIC8vIFRyaW0gYW55IGxlYWRpbmcgYmFja3NsYXNoZXNcbiAgICAgICAgdmFyIHRvU3RhcnQgPSAxO1xuICAgICAgICBmb3IgKDsgdG9TdGFydCA8IHRvLmxlbmd0aDsgKyt0b1N0YXJ0KSB7XG4gICAgICAgICAgICBpZiAodG8uY2hhckNvZGVBdCh0b1N0YXJ0KSAhPT0gNDcgLyovKi8pXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHRvRW5kID0gdG8ubGVuZ3RoO1xuICAgICAgICB2YXIgdG9MZW4gPSB0b0VuZCAtIHRvU3RhcnQ7XG4gICAgICAgIC8vIENvbXBhcmUgcGF0aHMgdG8gZmluZCB0aGUgbG9uZ2VzdCBjb21tb24gcGF0aCBmcm9tIHJvb3RcbiAgICAgICAgdmFyIGxlbmd0aCA9IGZyb21MZW4gPCB0b0xlbiA/IGZyb21MZW4gOiB0b0xlbjtcbiAgICAgICAgdmFyIGxhc3RDb21tb25TZXAgPSAtMTtcbiAgICAgICAgdmFyIGkgPSAwO1xuICAgICAgICBmb3IgKDsgaSA8PSBsZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgaWYgKGkgPT09IGxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGlmICh0b0xlbiA+IGxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodG8uY2hhckNvZGVBdCh0b1N0YXJ0ICsgaSkgPT09IDQ3IC8qLyovKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBnZXQgaGVyZSBpZiBgZnJvbWAgaXMgdGhlIGV4YWN0IGJhc2UgcGF0aCBmb3IgYHRvYC5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvciBleGFtcGxlOiBmcm9tPScvZm9vL2Jhcic7IHRvPScvZm9vL2Jhci9iYXonXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG8uc2xpY2UodG9TdGFydCArIGkgKyAxKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBnZXQgaGVyZSBpZiBgZnJvbWAgaXMgdGhlIHJvb3RcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvciBleGFtcGxlOiBmcm9tPScvJzsgdG89Jy9mb28nXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG8uc2xpY2UodG9TdGFydCArIGkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGZyb21MZW4gPiBsZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZyb20uY2hhckNvZGVBdChmcm9tU3RhcnQgKyBpKSA9PT0gNDcgLyovKi8pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdlIGdldCBoZXJlIGlmIGB0b2AgaXMgdGhlIGV4YWN0IGJhc2UgcGF0aCBmb3IgYGZyb21gLlxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRm9yIGV4YW1wbGU6IGZyb209Jy9mb28vYmFyL2Jheic7IHRvPScvZm9vL2JhcidcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RDb21tb25TZXAgPSBpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGkgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdlIGdldCBoZXJlIGlmIGB0b2AgaXMgdGhlIHJvb3QuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBGb3IgZXhhbXBsZTogZnJvbT0nL2Zvbyc7IHRvPScvJ1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFzdENvbW1vblNlcCA9IDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgZnJvbUNvZGUgPSBmcm9tLmNoYXJDb2RlQXQoZnJvbVN0YXJ0ICsgaSk7XG4gICAgICAgICAgICB2YXIgdG9Db2RlID0gdG8uY2hhckNvZGVBdCh0b1N0YXJ0ICsgaSk7XG4gICAgICAgICAgICBpZiAoZnJvbUNvZGUgIT09IHRvQ29kZSlcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGVsc2UgaWYgKGZyb21Db2RlID09PSA0NyAvKi8qLylcbiAgICAgICAgICAgICAgICBsYXN0Q29tbW9uU2VwID0gaTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgb3V0ID0gJyc7XG4gICAgICAgIC8vIEdlbmVyYXRlIHRoZSByZWxhdGl2ZSBwYXRoIGJhc2VkIG9uIHRoZSBwYXRoIGRpZmZlcmVuY2UgYmV0d2VlbiBgdG9gXG4gICAgICAgIC8vIGFuZCBgZnJvbWBcbiAgICAgICAgZm9yIChpID0gZnJvbVN0YXJ0ICsgbGFzdENvbW1vblNlcCArIDE7IGkgPD0gZnJvbUVuZDsgKytpKSB7XG4gICAgICAgICAgICBpZiAoaSA9PT0gZnJvbUVuZCB8fCBmcm9tLmNoYXJDb2RlQXQoaSkgPT09IDQ3IC8qLyovKSB7XG4gICAgICAgICAgICAgICAgaWYgKG91dC5sZW5ndGggPT09IDApXG4gICAgICAgICAgICAgICAgICAgIG91dCArPSAnLi4nO1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgb3V0ICs9ICcvLi4nO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIExhc3RseSwgYXBwZW5kIHRoZSByZXN0IG9mIHRoZSBkZXN0aW5hdGlvbiAoYHRvYCkgcGF0aCB0aGF0IGNvbWVzIGFmdGVyXG4gICAgICAgIC8vIHRoZSBjb21tb24gcGF0aCBwYXJ0c1xuICAgICAgICBpZiAob3V0Lmxlbmd0aCA+IDApXG4gICAgICAgICAgICByZXR1cm4gb3V0ICsgdG8uc2xpY2UodG9TdGFydCArIGxhc3RDb21tb25TZXApO1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRvU3RhcnQgKz0gbGFzdENvbW1vblNlcDtcbiAgICAgICAgICAgIGlmICh0by5jaGFyQ29kZUF0KHRvU3RhcnQpID09PSA0NyAvKi8qLylcbiAgICAgICAgICAgICAgICArK3RvU3RhcnQ7XG4gICAgICAgICAgICByZXR1cm4gdG8uc2xpY2UodG9TdGFydCk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIF9tYWtlTG9uZzogZnVuY3Rpb24gX21ha2VMb25nKHBhdGgpIHtcbiAgICAgICAgcmV0dXJuIHBhdGg7XG4gICAgfSxcbiAgICBkaXJuYW1lOiBmdW5jdGlvbiBkaXJuYW1lKHBhdGgpIHtcbiAgICAgICAgYXNzZXJ0UGF0aChwYXRoKTtcbiAgICAgICAgaWYgKHBhdGgubGVuZ3RoID09PSAwKVxuICAgICAgICAgICAgcmV0dXJuICcuJztcbiAgICAgICAgdmFyIGNvZGUgPSBwYXRoLmNoYXJDb2RlQXQoMCk7XG4gICAgICAgIHZhciBoYXNSb290ID0gY29kZSA9PT0gNDcgLyovKi87XG4gICAgICAgIHZhciBlbmQgPSAtMTtcbiAgICAgICAgdmFyIG1hdGNoZWRTbGFzaCA9IHRydWU7XG4gICAgICAgIGZvciAodmFyIGkgPSBwYXRoLmxlbmd0aCAtIDE7IGkgPj0gMTsgLS1pKSB7XG4gICAgICAgICAgICBjb2RlID0gcGF0aC5jaGFyQ29kZUF0KGkpO1xuICAgICAgICAgICAgaWYgKGNvZGUgPT09IDQ3IC8qLyovKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFtYXRjaGVkU2xhc2gpIHtcbiAgICAgICAgICAgICAgICAgICAgZW5kID0gaTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gV2Ugc2F3IHRoZSBmaXJzdCBub24tcGF0aCBzZXBhcmF0b3JcbiAgICAgICAgICAgICAgICBtYXRjaGVkU2xhc2ggPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoZW5kID09PSAtMSlcbiAgICAgICAgICAgIHJldHVybiBoYXNSb290ID8gJy8nIDogJy4nO1xuICAgICAgICBpZiAoaGFzUm9vdCAmJiBlbmQgPT09IDEpXG4gICAgICAgICAgICByZXR1cm4gJy8vJztcbiAgICAgICAgcmV0dXJuIHBhdGguc2xpY2UoMCwgZW5kKTtcbiAgICB9LFxuICAgIGJhc2VuYW1lOiBmdW5jdGlvbiBiYXNlbmFtZShwYXRoLCBleHQpIHtcbiAgICAgICAgaWYgKGV4dCAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiBleHQgIT09ICdzdHJpbmcnKVxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignXCJleHRcIiBhcmd1bWVudCBtdXN0IGJlIGEgc3RyaW5nJyk7XG4gICAgICAgIGFzc2VydFBhdGgocGF0aCk7XG4gICAgICAgIHZhciBzdGFydCA9IDA7XG4gICAgICAgIHZhciBlbmQgPSAtMTtcbiAgICAgICAgdmFyIG1hdGNoZWRTbGFzaCA9IHRydWU7XG4gICAgICAgIHZhciBpO1xuICAgICAgICBpZiAoZXh0ICE9PSB1bmRlZmluZWQgJiYgZXh0Lmxlbmd0aCA+IDAgJiYgZXh0Lmxlbmd0aCA8PSBwYXRoLmxlbmd0aCkge1xuICAgICAgICAgICAgaWYgKGV4dC5sZW5ndGggPT09IHBhdGgubGVuZ3RoICYmIGV4dCA9PT0gcGF0aClcbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICB2YXIgZXh0SWR4ID0gZXh0Lmxlbmd0aCAtIDE7XG4gICAgICAgICAgICB2YXIgZmlyc3ROb25TbGFzaEVuZCA9IC0xO1xuICAgICAgICAgICAgZm9yIChpID0gcGF0aC5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgICAgICAgICAgIHZhciBjb2RlID0gcGF0aC5jaGFyQ29kZUF0KGkpO1xuICAgICAgICAgICAgICAgIGlmIChjb2RlID09PSA0NyAvKi8qLykge1xuICAgICAgICAgICAgICAgICAgICAvLyBJZiB3ZSByZWFjaGVkIGEgcGF0aCBzZXBhcmF0b3IgdGhhdCB3YXMgbm90IHBhcnQgb2YgYSBzZXQgb2YgcGF0aFxuICAgICAgICAgICAgICAgICAgICAvLyBzZXBhcmF0b3JzIGF0IHRoZSBlbmQgb2YgdGhlIHN0cmluZywgc3RvcCBub3dcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFtYXRjaGVkU2xhc2gpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0ID0gaSArIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpcnN0Tm9uU2xhc2hFbmQgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBzYXcgdGhlIGZpcnN0IG5vbi1wYXRoIHNlcGFyYXRvciwgcmVtZW1iZXIgdGhpcyBpbmRleCBpbiBjYXNlXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB3ZSBuZWVkIGl0IGlmIHRoZSBleHRlbnNpb24gZW5kcyB1cCBub3QgbWF0Y2hpbmdcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZWRTbGFzaCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3ROb25TbGFzaEVuZCA9IGkgKyAxO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChleHRJZHggPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVHJ5IHRvIG1hdGNoIHRoZSBleHBsaWNpdCBleHRlbnNpb25cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb2RlID09PSBleHQuY2hhckNvZGVBdChleHRJZHgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKC0tZXh0SWR4ID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBtYXRjaGVkIHRoZSBleHRlbnNpb24sIHNvIG1hcmsgdGhpcyBhcyB0aGUgZW5kIG9mIG91ciBwYXRoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbXBvbmVudFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQgPSBpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEV4dGVuc2lvbiBkb2VzIG5vdCBtYXRjaCwgc28gb3VyIHJlc3VsdCBpcyB0aGUgZW50aXJlIHBhdGhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjb21wb25lbnRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRJZHggPSAtMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQgPSBmaXJzdE5vblNsYXNoRW5kO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHN0YXJ0ID09PSBlbmQpXG4gICAgICAgICAgICAgICAgZW5kID0gZmlyc3ROb25TbGFzaEVuZDtcbiAgICAgICAgICAgIGVsc2UgaWYgKGVuZCA9PT0gLTEpXG4gICAgICAgICAgICAgICAgZW5kID0gcGF0aC5sZW5ndGg7XG4gICAgICAgICAgICByZXR1cm4gcGF0aC5zbGljZShzdGFydCwgZW5kKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGZvciAoaSA9IHBhdGgubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHtcbiAgICAgICAgICAgICAgICBpZiAocGF0aC5jaGFyQ29kZUF0KGkpID09PSA0NyAvKi8qLykge1xuICAgICAgICAgICAgICAgICAgICAvLyBJZiB3ZSByZWFjaGVkIGEgcGF0aCBzZXBhcmF0b3IgdGhhdCB3YXMgbm90IHBhcnQgb2YgYSBzZXQgb2YgcGF0aFxuICAgICAgICAgICAgICAgICAgICAvLyBzZXBhcmF0b3JzIGF0IHRoZSBlbmQgb2YgdGhlIHN0cmluZywgc3RvcCBub3dcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFtYXRjaGVkU2xhc2gpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0ID0gaSArIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChlbmQgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFdlIHNhdyB0aGUgZmlyc3Qgbm9uLXBhdGggc2VwYXJhdG9yLCBtYXJrIHRoaXMgYXMgdGhlIGVuZCBvZiBvdXJcbiAgICAgICAgICAgICAgICAgICAgLy8gcGF0aCBjb21wb25lbnRcbiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlZFNsYXNoID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGVuZCA9IGkgKyAxO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChlbmQgPT09IC0xKVxuICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgIHJldHVybiBwYXRoLnNsaWNlKHN0YXJ0LCBlbmQpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBleHRuYW1lOiBmdW5jdGlvbiBleHRuYW1lKHBhdGgpIHtcbiAgICAgICAgYXNzZXJ0UGF0aChwYXRoKTtcbiAgICAgICAgdmFyIHN0YXJ0RG90ID0gLTE7XG4gICAgICAgIHZhciBzdGFydFBhcnQgPSAwO1xuICAgICAgICB2YXIgZW5kID0gLTE7XG4gICAgICAgIHZhciBtYXRjaGVkU2xhc2ggPSB0cnVlO1xuICAgICAgICAvLyBUcmFjayB0aGUgc3RhdGUgb2YgY2hhcmFjdGVycyAoaWYgYW55KSB3ZSBzZWUgYmVmb3JlIG91ciBmaXJzdCBkb3QgYW5kXG4gICAgICAgIC8vIGFmdGVyIGFueSBwYXRoIHNlcGFyYXRvciB3ZSBmaW5kXG4gICAgICAgIHZhciBwcmVEb3RTdGF0ZSA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSBwYXRoLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7XG4gICAgICAgICAgICB2YXIgY29kZSA9IHBhdGguY2hhckNvZGVBdChpKTtcbiAgICAgICAgICAgIGlmIChjb2RlID09PSA0NyAvKi8qLykge1xuICAgICAgICAgICAgICAgIC8vIElmIHdlIHJlYWNoZWQgYSBwYXRoIHNlcGFyYXRvciB0aGF0IHdhcyBub3QgcGFydCBvZiBhIHNldCBvZiBwYXRoXG4gICAgICAgICAgICAgICAgLy8gc2VwYXJhdG9ycyBhdCB0aGUgZW5kIG9mIHRoZSBzdHJpbmcsIHN0b3Agbm93XG4gICAgICAgICAgICAgICAgaWYgKCFtYXRjaGVkU2xhc2gpIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRQYXJ0ID0gaSArIDE7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChlbmQgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgLy8gV2Ugc2F3IHRoZSBmaXJzdCBub24tcGF0aCBzZXBhcmF0b3IsIG1hcmsgdGhpcyBhcyB0aGUgZW5kIG9mIG91clxuICAgICAgICAgICAgICAgIC8vIGV4dGVuc2lvblxuICAgICAgICAgICAgICAgIG1hdGNoZWRTbGFzaCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGVuZCA9IGkgKyAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNvZGUgPT09IDQ2IC8qLiovKSB7XG4gICAgICAgICAgICAgICAgLy8gSWYgdGhpcyBpcyBvdXIgZmlyc3QgZG90LCBtYXJrIGl0IGFzIHRoZSBzdGFydCBvZiBvdXIgZXh0ZW5zaW9uXG4gICAgICAgICAgICAgICAgaWYgKHN0YXJ0RG90ID09PSAtMSlcbiAgICAgICAgICAgICAgICAgICAgc3RhcnREb3QgPSBpO1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHByZURvdFN0YXRlICE9PSAxKVxuICAgICAgICAgICAgICAgICAgICBwcmVEb3RTdGF0ZSA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChzdGFydERvdCAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAvLyBXZSBzYXcgYSBub24tZG90IGFuZCBub24tcGF0aCBzZXBhcmF0b3IgYmVmb3JlIG91ciBkb3QsIHNvIHdlIHNob3VsZFxuICAgICAgICAgICAgICAgIC8vIGhhdmUgYSBnb29kIGNoYW5jZSBhdCBoYXZpbmcgYSBub24tZW1wdHkgZXh0ZW5zaW9uXG4gICAgICAgICAgICAgICAgcHJlRG90U3RhdGUgPSAtMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoc3RhcnREb3QgPT09IC0xIHx8IGVuZCA9PT0gLTEgfHxcbiAgICAgICAgICAgIC8vIFdlIHNhdyBhIG5vbi1kb3QgY2hhcmFjdGVyIGltbWVkaWF0ZWx5IGJlZm9yZSB0aGUgZG90XG4gICAgICAgICAgICBwcmVEb3RTdGF0ZSA9PT0gMCB8fFxuICAgICAgICAgICAgLy8gVGhlIChyaWdodC1tb3N0KSB0cmltbWVkIHBhdGggY29tcG9uZW50IGlzIGV4YWN0bHkgJy4uJ1xuICAgICAgICAgICAgcHJlRG90U3RhdGUgPT09IDEgJiYgc3RhcnREb3QgPT09IGVuZCAtIDEgJiYgc3RhcnREb3QgPT09IHN0YXJ0UGFydCArIDEpIHtcbiAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcGF0aC5zbGljZShzdGFydERvdCwgZW5kKTtcbiAgICB9LFxuICAgIGZvcm1hdDogZnVuY3Rpb24gZm9ybWF0KHBhdGhPYmplY3QpIHtcbiAgICAgICAgaWYgKHBhdGhPYmplY3QgPT09IG51bGwgfHwgdHlwZW9mIHBhdGhPYmplY3QgIT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdUaGUgXCJwYXRoT2JqZWN0XCIgYXJndW1lbnQgbXVzdCBiZSBvZiB0eXBlIE9iamVjdC4gUmVjZWl2ZWQgdHlwZSAnICsgdHlwZW9mIHBhdGhPYmplY3QpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBfZm9ybWF0KCcvJywgcGF0aE9iamVjdCk7XG4gICAgfSxcbiAgICBwYXJzZTogZnVuY3Rpb24gcGFyc2UocGF0aCkge1xuICAgICAgICBhc3NlcnRQYXRoKHBhdGgpO1xuICAgICAgICB2YXIgcmV0ID0geyByb290OiAnJywgZGlyOiAnJywgYmFzZTogJycsIGV4dDogJycsIG5hbWU6ICcnIH07XG4gICAgICAgIGlmIChwYXRoLmxlbmd0aCA9PT0gMClcbiAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgIHZhciBjb2RlID0gcGF0aC5jaGFyQ29kZUF0KDApO1xuICAgICAgICB2YXIgaXNBYnNvbHV0ZSA9IGNvZGUgPT09IDQ3IC8qLyovO1xuICAgICAgICB2YXIgc3RhcnQ7XG4gICAgICAgIGlmIChpc0Fic29sdXRlKSB7XG4gICAgICAgICAgICByZXQucm9vdCA9ICcvJztcbiAgICAgICAgICAgIHN0YXJ0ID0gMTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHN0YXJ0ID0gMDtcbiAgICAgICAgfVxuICAgICAgICB2YXIgc3RhcnREb3QgPSAtMTtcbiAgICAgICAgdmFyIHN0YXJ0UGFydCA9IDA7XG4gICAgICAgIHZhciBlbmQgPSAtMTtcbiAgICAgICAgdmFyIG1hdGNoZWRTbGFzaCA9IHRydWU7XG4gICAgICAgIHZhciBpID0gcGF0aC5sZW5ndGggLSAxO1xuICAgICAgICAvLyBUcmFjayB0aGUgc3RhdGUgb2YgY2hhcmFjdGVycyAoaWYgYW55KSB3ZSBzZWUgYmVmb3JlIG91ciBmaXJzdCBkb3QgYW5kXG4gICAgICAgIC8vIGFmdGVyIGFueSBwYXRoIHNlcGFyYXRvciB3ZSBmaW5kXG4gICAgICAgIHZhciBwcmVEb3RTdGF0ZSA9IDA7XG4gICAgICAgIC8vIEdldCBub24tZGlyIGluZm9cbiAgICAgICAgZm9yICg7IGkgPj0gc3RhcnQ7IC0taSkge1xuICAgICAgICAgICAgY29kZSA9IHBhdGguY2hhckNvZGVBdChpKTtcbiAgICAgICAgICAgIGlmIChjb2RlID09PSA0NyAvKi8qLykge1xuICAgICAgICAgICAgICAgIC8vIElmIHdlIHJlYWNoZWQgYSBwYXRoIHNlcGFyYXRvciB0aGF0IHdhcyBub3QgcGFydCBvZiBhIHNldCBvZiBwYXRoXG4gICAgICAgICAgICAgICAgLy8gc2VwYXJhdG9ycyBhdCB0aGUgZW5kIG9mIHRoZSBzdHJpbmcsIHN0b3Agbm93XG4gICAgICAgICAgICAgICAgaWYgKCFtYXRjaGVkU2xhc2gpIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRQYXJ0ID0gaSArIDE7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChlbmQgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgLy8gV2Ugc2F3IHRoZSBmaXJzdCBub24tcGF0aCBzZXBhcmF0b3IsIG1hcmsgdGhpcyBhcyB0aGUgZW5kIG9mIG91clxuICAgICAgICAgICAgICAgIC8vIGV4dGVuc2lvblxuICAgICAgICAgICAgICAgIG1hdGNoZWRTbGFzaCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGVuZCA9IGkgKyAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNvZGUgPT09IDQ2IC8qLiovKSB7XG4gICAgICAgICAgICAgICAgLy8gSWYgdGhpcyBpcyBvdXIgZmlyc3QgZG90LCBtYXJrIGl0IGFzIHRoZSBzdGFydCBvZiBvdXIgZXh0ZW5zaW9uXG4gICAgICAgICAgICAgICAgaWYgKHN0YXJ0RG90ID09PSAtMSlcbiAgICAgICAgICAgICAgICAgICAgc3RhcnREb3QgPSBpO1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHByZURvdFN0YXRlICE9PSAxKVxuICAgICAgICAgICAgICAgICAgICBwcmVEb3RTdGF0ZSA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChzdGFydERvdCAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAvLyBXZSBzYXcgYSBub24tZG90IGFuZCBub24tcGF0aCBzZXBhcmF0b3IgYmVmb3JlIG91ciBkb3QsIHNvIHdlIHNob3VsZFxuICAgICAgICAgICAgICAgIC8vIGhhdmUgYSBnb29kIGNoYW5jZSBhdCBoYXZpbmcgYSBub24tZW1wdHkgZXh0ZW5zaW9uXG4gICAgICAgICAgICAgICAgcHJlRG90U3RhdGUgPSAtMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoc3RhcnREb3QgPT09IC0xIHx8IGVuZCA9PT0gLTEgfHxcbiAgICAgICAgICAgIC8vIFdlIHNhdyBhIG5vbi1kb3QgY2hhcmFjdGVyIGltbWVkaWF0ZWx5IGJlZm9yZSB0aGUgZG90XG4gICAgICAgICAgICBwcmVEb3RTdGF0ZSA9PT0gMCB8fFxuICAgICAgICAgICAgLy8gVGhlIChyaWdodC1tb3N0KSB0cmltbWVkIHBhdGggY29tcG9uZW50IGlzIGV4YWN0bHkgJy4uJ1xuICAgICAgICAgICAgcHJlRG90U3RhdGUgPT09IDEgJiYgc3RhcnREb3QgPT09IGVuZCAtIDEgJiYgc3RhcnREb3QgPT09IHN0YXJ0UGFydCArIDEpIHtcbiAgICAgICAgICAgIGlmIChlbmQgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXJ0UGFydCA9PT0gMCAmJiBpc0Fic29sdXRlKVxuICAgICAgICAgICAgICAgICAgICByZXQuYmFzZSA9IHJldC5uYW1lID0gcGF0aC5zbGljZSgxLCBlbmQpO1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgcmV0LmJhc2UgPSByZXQubmFtZSA9IHBhdGguc2xpY2Uoc3RhcnRQYXJ0LCBlbmQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKHN0YXJ0UGFydCA9PT0gMCAmJiBpc0Fic29sdXRlKSB7XG4gICAgICAgICAgICAgICAgcmV0Lm5hbWUgPSBwYXRoLnNsaWNlKDEsIHN0YXJ0RG90KTtcbiAgICAgICAgICAgICAgICByZXQuYmFzZSA9IHBhdGguc2xpY2UoMSwgZW5kKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldC5uYW1lID0gcGF0aC5zbGljZShzdGFydFBhcnQsIHN0YXJ0RG90KTtcbiAgICAgICAgICAgICAgICByZXQuYmFzZSA9IHBhdGguc2xpY2Uoc3RhcnRQYXJ0LCBlbmQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0LmV4dCA9IHBhdGguc2xpY2Uoc3RhcnREb3QsIGVuZCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHN0YXJ0UGFydCA+IDApXG4gICAgICAgICAgICByZXQuZGlyID0gcGF0aC5zbGljZSgwLCBzdGFydFBhcnQgLSAxKTtcbiAgICAgICAgZWxzZSBpZiAoaXNBYnNvbHV0ZSlcbiAgICAgICAgICAgIHJldC5kaXIgPSAnLyc7XG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgfSxcbiAgICBzZXA6ICcvJyxcbiAgICBkZWxpbWl0ZXI6ICc6JyxcbiAgICB3aW4zMjogbnVsbCxcbiAgICBwb3NpeDogbnVsbFxufTtcbnBvc2l4LnBvc2l4ID0gcG9zaXg7XG5tb2R1bGUuZXhwb3J0cyA9IHBvc2l4O1xuXG4vKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi99LmNhbGwodGhpcywgX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi8uLi8uLi8uLi9wcm9jZXNzQDAuMTEuMTAvbm9kZV9tb2R1bGVzL3Byb2Nlc3MvYnJvd3Nlci5qcyAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9wcm9jZXNzQDAuMTEuMTAvbm9kZV9tb2R1bGVzL3Byb2Nlc3MvYnJvd3Nlci5qc1wiKSkpXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8vaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vcGF0aC1icm93c2VyaWZ5QDEuMC4xL25vZGVfbW9kdWxlcy9wYXRoLWJyb3dzZXJpZnkvaW5kZXguanM/Iik7CgovKioqLyB9KSwKCi8qKiovICIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vcHJvY2Vzc0AwLjExLjEwL25vZGVfbW9kdWxlcy9wcm9jZXNzL2Jyb3dzZXIuanMiOgovKiEqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiEqXAogICEqKiogL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL3Byb2Nlc3NAMC4xMS4xMC9ub2RlX21vZHVsZXMvcHJvY2Vzcy9icm93c2VyLmpzICoqKiEKICBcKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CmV2YWwoIlxuLy8gc2hpbSBmb3IgdXNpbmcgcHJvY2VzcyBpbiBicm93c2VyXG52YXIgcHJvY2VzcyA9IG1vZHVsZS5leHBvcnRzID0ge307XG4vLyBjYWNoZWQgZnJvbSB3aGF0ZXZlciBnbG9iYWwgaXMgcHJlc2VudCBzbyB0aGF0IHRlc3QgcnVubmVycyB0aGF0IHN0dWIgaXRcbi8vIGRvbid0IGJyZWFrIHRoaW5ncy4gIEJ1dCB3ZSBuZWVkIHRvIHdyYXAgaXQgaW4gYSB0cnkgY2F0Y2ggaW4gY2FzZSBpdCBpc1xuLy8gd3JhcHBlZCBpbiBzdHJpY3QgbW9kZSBjb2RlIHdoaWNoIGRvZXNuJ3QgZGVmaW5lIGFueSBnbG9iYWxzLiAgSXQncyBpbnNpZGUgYVxuLy8gZnVuY3Rpb24gYmVjYXVzZSB0cnkvY2F0Y2hlcyBkZW9wdGltaXplIGluIGNlcnRhaW4gZW5naW5lcy5cbnZhciBjYWNoZWRTZXRUaW1lb3V0O1xudmFyIGNhY2hlZENsZWFyVGltZW91dDtcbmZ1bmN0aW9uIGRlZmF1bHRTZXRUaW1vdXQoKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdzZXRUaW1lb3V0IGhhcyBub3QgYmVlbiBkZWZpbmVkJyk7XG59XG5mdW5jdGlvbiBkZWZhdWx0Q2xlYXJUaW1lb3V0KCkge1xuICAgIHRocm93IG5ldyBFcnJvcignY2xlYXJUaW1lb3V0IGhhcyBub3QgYmVlbiBkZWZpbmVkJyk7XG59XG4oZnVuY3Rpb24gKCkge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICh0eXBlb2Ygc2V0VGltZW91dCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgY2FjaGVkU2V0VGltZW91dCA9IHNldFRpbWVvdXQ7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjYWNoZWRTZXRUaW1lb3V0ID0gZGVmYXVsdFNldFRpbW91dDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICBjYWNoZWRTZXRUaW1lb3V0ID0gZGVmYXVsdFNldFRpbW91dDtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKHR5cGVvZiBjbGVhclRpbWVvdXQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIGNhY2hlZENsZWFyVGltZW91dCA9IGNsZWFyVGltZW91dDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNhY2hlZENsZWFyVGltZW91dCA9IGRlZmF1bHRDbGVhclRpbWVvdXQ7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgY2FjaGVkQ2xlYXJUaW1lb3V0ID0gZGVmYXVsdENsZWFyVGltZW91dDtcbiAgICB9XG59KCkpO1xuZnVuY3Rpb24gcnVuVGltZW91dChmdW4pIHtcbiAgICBpZiAoY2FjaGVkU2V0VGltZW91dCA9PT0gc2V0VGltZW91dCkge1xuICAgICAgICAvL25vcm1hbCBlbnZpcm9tZW50cyBpbiBzYW5lIHNpdHVhdGlvbnNcbiAgICAgICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuLCAwKTtcbiAgICB9XG4gICAgLy8gaWYgc2V0VGltZW91dCB3YXNuJ3QgYXZhaWxhYmxlIGJ1dCB3YXMgbGF0dGVyIGRlZmluZWRcbiAgICBpZiAoKGNhY2hlZFNldFRpbWVvdXQgPT09IGRlZmF1bHRTZXRUaW1vdXQgfHwgIWNhY2hlZFNldFRpbWVvdXQpICYmIHNldFRpbWVvdXQpIHtcbiAgICAgICAgY2FjaGVkU2V0VGltZW91dCA9IHNldFRpbWVvdXQ7XG4gICAgICAgIHJldHVybiBzZXRUaW1lb3V0KGZ1biwgMCk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAgIC8vIHdoZW4gd2hlbiBzb21lYm9keSBoYXMgc2NyZXdlZCB3aXRoIHNldFRpbWVvdXQgYnV0IG5vIEkuRS4gbWFkZG5lc3NcbiAgICAgICAgcmV0dXJuIGNhY2hlZFNldFRpbWVvdXQoZnVuLCAwKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIFdoZW4gd2UgYXJlIGluIEkuRS4gYnV0IHRoZSBzY3JpcHQgaGFzIGJlZW4gZXZhbGVkIHNvIEkuRS4gZG9lc24ndCB0cnVzdCB0aGUgZ2xvYmFsIG9iamVjdCB3aGVuIGNhbGxlZCBub3JtYWxseVxuICAgICAgICAgICAgcmV0dXJuIGNhY2hlZFNldFRpbWVvdXQuY2FsbChudWxsLCBmdW4sIDApO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAvLyBzYW1lIGFzIGFib3ZlIGJ1dCB3aGVuIGl0J3MgYSB2ZXJzaW9uIG9mIEkuRS4gdGhhdCBtdXN0IGhhdmUgdGhlIGdsb2JhbCBvYmplY3QgZm9yICd0aGlzJywgaG9wZnVsbHkgb3VyIGNvbnRleHQgY29ycmVjdCBvdGhlcndpc2UgaXQgd2lsbCB0aHJvdyBhIGdsb2JhbCBlcnJvclxuICAgICAgICAgICAgcmV0dXJuIGNhY2hlZFNldFRpbWVvdXQuY2FsbCh0aGlzLCBmdW4sIDApO1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gcnVuQ2xlYXJUaW1lb3V0KG1hcmtlcikge1xuICAgIGlmIChjYWNoZWRDbGVhclRpbWVvdXQgPT09IGNsZWFyVGltZW91dCkge1xuICAgICAgICAvL25vcm1hbCBlbnZpcm9tZW50cyBpbiBzYW5lIHNpdHVhdGlvbnNcbiAgICAgICAgcmV0dXJuIGNsZWFyVGltZW91dChtYXJrZXIpO1xuICAgIH1cbiAgICAvLyBpZiBjbGVhclRpbWVvdXQgd2Fzbid0IGF2YWlsYWJsZSBidXQgd2FzIGxhdHRlciBkZWZpbmVkXG4gICAgaWYgKChjYWNoZWRDbGVhclRpbWVvdXQgPT09IGRlZmF1bHRDbGVhclRpbWVvdXQgfHwgIWNhY2hlZENsZWFyVGltZW91dCkgJiYgY2xlYXJUaW1lb3V0KSB7XG4gICAgICAgIGNhY2hlZENsZWFyVGltZW91dCA9IGNsZWFyVGltZW91dDtcbiAgICAgICAgcmV0dXJuIGNsZWFyVGltZW91dChtYXJrZXIpO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgICAvLyB3aGVuIHdoZW4gc29tZWJvZHkgaGFzIHNjcmV3ZWQgd2l0aCBzZXRUaW1lb3V0IGJ1dCBubyBJLkUuIG1hZGRuZXNzXG4gICAgICAgIHJldHVybiBjYWNoZWRDbGVhclRpbWVvdXQobWFya2VyKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIFdoZW4gd2UgYXJlIGluIEkuRS4gYnV0IHRoZSBzY3JpcHQgaGFzIGJlZW4gZXZhbGVkIHNvIEkuRS4gZG9lc24ndCAgdHJ1c3QgdGhlIGdsb2JhbCBvYmplY3Qgd2hlbiBjYWxsZWQgbm9ybWFsbHlcbiAgICAgICAgICAgIHJldHVybiBjYWNoZWRDbGVhclRpbWVvdXQuY2FsbChudWxsLCBtYXJrZXIpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAvLyBzYW1lIGFzIGFib3ZlIGJ1dCB3aGVuIGl0J3MgYSB2ZXJzaW9uIG9mIEkuRS4gdGhhdCBtdXN0IGhhdmUgdGhlIGdsb2JhbCBvYmplY3QgZm9yICd0aGlzJywgaG9wZnVsbHkgb3VyIGNvbnRleHQgY29ycmVjdCBvdGhlcndpc2UgaXQgd2lsbCB0aHJvdyBhIGdsb2JhbCBlcnJvci5cbiAgICAgICAgICAgIC8vIFNvbWUgdmVyc2lvbnMgb2YgSS5FLiBoYXZlIGRpZmZlcmVudCBydWxlcyBmb3IgY2xlYXJUaW1lb3V0IHZzIHNldFRpbWVvdXRcbiAgICAgICAgICAgIHJldHVybiBjYWNoZWRDbGVhclRpbWVvdXQuY2FsbCh0aGlzLCBtYXJrZXIpO1xuICAgICAgICB9XG4gICAgfVxufVxudmFyIHF1ZXVlID0gW107XG52YXIgZHJhaW5pbmcgPSBmYWxzZTtcbnZhciBjdXJyZW50UXVldWU7XG52YXIgcXVldWVJbmRleCA9IC0xO1xuZnVuY3Rpb24gY2xlYW5VcE5leHRUaWNrKCkge1xuICAgIGlmICghZHJhaW5pbmcgfHwgIWN1cnJlbnRRdWV1ZSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGRyYWluaW5nID0gZmFsc2U7XG4gICAgaWYgKGN1cnJlbnRRdWV1ZS5sZW5ndGgpIHtcbiAgICAgICAgcXVldWUgPSBjdXJyZW50UXVldWUuY29uY2F0KHF1ZXVlKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHF1ZXVlSW5kZXggPSAtMTtcbiAgICB9XG4gICAgaWYgKHF1ZXVlLmxlbmd0aCkge1xuICAgICAgICBkcmFpblF1ZXVlKCk7XG4gICAgfVxufVxuZnVuY3Rpb24gZHJhaW5RdWV1ZSgpIHtcbiAgICBpZiAoZHJhaW5pbmcpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgdGltZW91dCA9IHJ1blRpbWVvdXQoY2xlYW5VcE5leHRUaWNrKTtcbiAgICBkcmFpbmluZyA9IHRydWU7XG4gICAgdmFyIGxlbiA9IHF1ZXVlLmxlbmd0aDtcbiAgICB3aGlsZSAobGVuKSB7XG4gICAgICAgIGN1cnJlbnRRdWV1ZSA9IHF1ZXVlO1xuICAgICAgICBxdWV1ZSA9IFtdO1xuICAgICAgICB3aGlsZSAoKytxdWV1ZUluZGV4IDwgbGVuKSB7XG4gICAgICAgICAgICBpZiAoY3VycmVudFF1ZXVlKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudFF1ZXVlW3F1ZXVlSW5kZXhdLnJ1bigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHF1ZXVlSW5kZXggPSAtMTtcbiAgICAgICAgbGVuID0gcXVldWUubGVuZ3RoO1xuICAgIH1cbiAgICBjdXJyZW50UXVldWUgPSBudWxsO1xuICAgIGRyYWluaW5nID0gZmFsc2U7XG4gICAgcnVuQ2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xufVxucHJvY2Vzcy5uZXh0VGljayA9IGZ1bmN0aW9uIChmdW4pIHtcbiAgICB2YXIgYXJncyA9IG5ldyBBcnJheShhcmd1bWVudHMubGVuZ3RoIC0gMSk7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBhcmdzW2kgLSAxXSA9IGFyZ3VtZW50c1tpXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBxdWV1ZS5wdXNoKG5ldyBJdGVtKGZ1biwgYXJncykpO1xuICAgIGlmIChxdWV1ZS5sZW5ndGggPT09IDEgJiYgIWRyYWluaW5nKSB7XG4gICAgICAgIHJ1blRpbWVvdXQoZHJhaW5RdWV1ZSk7XG4gICAgfVxufTtcbi8vIHY4IGxpa2VzIHByZWRpY3RpYmxlIG9iamVjdHNcbmZ1bmN0aW9uIEl0ZW0oZnVuLCBhcnJheSkge1xuICAgIHRoaXMuZnVuID0gZnVuO1xuICAgIHRoaXMuYXJyYXkgPSBhcnJheTtcbn1cbkl0ZW0ucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmZ1bi5hcHBseShudWxsLCB0aGlzLmFycmF5KTtcbn07XG5wcm9jZXNzLnRpdGxlID0gJ2Jyb3dzZXInO1xucHJvY2Vzcy5icm93c2VyID0gdHJ1ZTtcbnByb2Nlc3MuZW52ID0ge307XG5wcm9jZXNzLmFyZ3YgPSBbXTtcbnByb2Nlc3MudmVyc2lvbiA9ICcnOyAvLyBlbXB0eSBzdHJpbmcgdG8gYXZvaWQgcmVnZXhwIGlzc3Vlc1xucHJvY2Vzcy52ZXJzaW9ucyA9IHt9O1xuZnVuY3Rpb24gbm9vcCgpIHsgfVxucHJvY2Vzcy5vbiA9IG5vb3A7XG5wcm9jZXNzLmFkZExpc3RlbmVyID0gbm9vcDtcbnByb2Nlc3Mub25jZSA9IG5vb3A7XG5wcm9jZXNzLm9mZiA9IG5vb3A7XG5wcm9jZXNzLnJlbW92ZUxpc3RlbmVyID0gbm9vcDtcbnByb2Nlc3MucmVtb3ZlQWxsTGlzdGVuZXJzID0gbm9vcDtcbnByb2Nlc3MuZW1pdCA9IG5vb3A7XG5wcm9jZXNzLnByZXBlbmRMaXN0ZW5lciA9IG5vb3A7XG5wcm9jZXNzLnByZXBlbmRPbmNlTGlzdGVuZXIgPSBub29wO1xucHJvY2Vzcy5saXN0ZW5lcnMgPSBmdW5jdGlvbiAobmFtZSkgeyByZXR1cm4gW107IH07XG5wcm9jZXNzLmJpbmRpbmcgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgIHRocm93IG5ldyBFcnJvcigncHJvY2Vzcy5iaW5kaW5nIGlzIG5vdCBzdXBwb3J0ZWQnKTtcbn07XG5wcm9jZXNzLmN3ZCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuICcvJzsgfTtcbnByb2Nlc3MuY2hkaXIgPSBmdW5jdGlvbiAoZGlyKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdwcm9jZXNzLmNoZGlyIGlzIG5vdCBzdXBwb3J0ZWQnKTtcbn07XG5wcm9jZXNzLnVtYXNrID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gMDsgfTtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL3Byb2Nlc3NAMC4xMS4xMC9ub2RlX21vZHVsZXMvcHJvY2Vzcy9icm93c2VyLmpzPyIpOwoKLyoqKi8gfSksCgovKioqLyAiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3JhbmRvbWJ5dGVzQDIuMS4wL25vZGVfbW9kdWxlcy9yYW5kb21ieXRlcy9icm93c2VyLmpzIjoKLyohKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlwKICAhKioqIC9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9yYW5kb21ieXRlc0AyLjEuMC9ub2RlX21vZHVsZXMvcmFuZG9tYnl0ZXMvYnJvd3Nlci5qcyAqKiohCiAgXCoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKiEgbm8gc3RhdGljIGV4cG9ydHMgZm91bmQgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwpldmFsKCIvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi8oZnVuY3Rpb24oZ2xvYmFsLCBwcm9jZXNzKSB7XG4vLyBsaW1pdCBvZiBDcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKClcbi8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9DcnlwdG8vZ2V0UmFuZG9tVmFsdWVzXG52YXIgTUFYX0JZVEVTID0gNjU1MzY7XG4vLyBOb2RlIHN1cHBvcnRzIHJlcXVlc3RpbmcgdXAgdG8gdGhpcyBudW1iZXIgb2YgYnl0ZXNcbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ub2RlanMvbm9kZS9ibG9iL21hc3Rlci9saWIvaW50ZXJuYWwvY3J5cHRvL3JhbmRvbS5qcyNMNDhcbnZhciBNQVhfVUlOVDMyID0gNDI5NDk2NzI5NTtcbmZ1bmN0aW9uIG9sZEJyb3dzZXIoKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdTZWN1cmUgcmFuZG9tIG51bWJlciBnZW5lcmF0aW9uIGlzIG5vdCBzdXBwb3J0ZWQgYnkgdGhpcyBicm93c2VyLlxcblVzZSBDaHJvbWUsIEZpcmVmb3ggb3IgSW50ZXJuZXQgRXhwbG9yZXIgMTEnKTtcbn1cbnZhciBCdWZmZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISBzYWZlLWJ1ZmZlciAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9zYWZlLWJ1ZmZlckA1LjIuMS9ub2RlX21vZHVsZXMvc2FmZS1idWZmZXIvaW5kZXguanNcIikuQnVmZmVyO1xudmFyIGNyeXB0byA9IGdsb2JhbC5jcnlwdG8gfHwgZ2xvYmFsLm1zQ3J5cHRvO1xuaWYgKGNyeXB0byAmJiBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSByYW5kb21CeXRlcztcbn1cbmVsc2Uge1xuICAgIG1vZHVsZS5leHBvcnRzID0gb2xkQnJvd3Nlcjtcbn1cbmZ1bmN0aW9uIHJhbmRvbUJ5dGVzKHNpemUsIGNiKSB7XG4gICAgLy8gcGhhbnRvbWpzIG5lZWRzIHRvIHRocm93XG4gICAgaWYgKHNpemUgPiBNQVhfVUlOVDMyKVxuICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigncmVxdWVzdGVkIHRvbyBtYW55IHJhbmRvbSBieXRlcycpO1xuICAgIHZhciBieXRlcyA9IEJ1ZmZlci5hbGxvY1Vuc2FmZShzaXplKTtcbiAgICBpZiAoc2l6ZSA+IDApIHsgLy8gZ2V0UmFuZG9tVmFsdWVzIGZhaWxzIG9uIElFIGlmIHNpemUgPT0gMFxuICAgICAgICBpZiAoc2l6ZSA+IE1BWF9CWVRFUykgeyAvLyB0aGlzIGlzIHRoZSBtYXggYnl0ZXMgY3J5cHRvLmdldFJhbmRvbVZhbHVlc1xuICAgICAgICAgICAgLy8gY2FuIGRvIGF0IG9uY2Ugc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS93aW5kb3cuY3J5cHRvLmdldFJhbmRvbVZhbHVlc1xuICAgICAgICAgICAgZm9yICh2YXIgZ2VuZXJhdGVkID0gMDsgZ2VuZXJhdGVkIDwgc2l6ZTsgZ2VuZXJhdGVkICs9IE1BWF9CWVRFUykge1xuICAgICAgICAgICAgICAgIC8vIGJ1ZmZlci5zbGljZSBhdXRvbWF0aWNhbGx5IGNoZWNrcyBpZiB0aGUgZW5kIGlzIHBhc3QgdGhlIGVuZCBvZlxuICAgICAgICAgICAgICAgIC8vIHRoZSBidWZmZXIgc28gd2UgZG9uJ3QgaGF2ZSB0byBoZXJlXG4gICAgICAgICAgICAgICAgY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhieXRlcy5zbGljZShnZW5lcmF0ZWQsIGdlbmVyYXRlZCArIE1BWF9CWVRFUykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhieXRlcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKHR5cGVvZiBjYiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICByZXR1cm4gcHJvY2Vzcy5uZXh0VGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjYihudWxsLCBieXRlcyk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gYnl0ZXM7XG59XG5cbi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqL30uY2FsbCh0aGlzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuLy4uLy4uLy4uL3dlYnBhY2tANC40Ni4wX3dlYnBhY2stY2xpQDQuMTAuMC9ub2RlX21vZHVsZXMvd2VicGFjay9idWlsZGluL2dsb2JhbC5qcyAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS93ZWJwYWNrQDQuNDYuMF93ZWJwYWNrLWNsaUA0LjEwLjAvbm9kZV9tb2R1bGVzL3dlYnBhY2svYnVpbGRpbi9nbG9iYWwuanNcIiksIF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vLi4vLi4vLi4vcHJvY2Vzc0AwLjExLjEwL25vZGVfbW9kdWxlcy9wcm9jZXNzL2Jyb3dzZXIuanMgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vcHJvY2Vzc0AwLjExLjEwL25vZGVfbW9kdWxlcy9wcm9jZXNzL2Jyb3dzZXIuanNcIikpKVxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL3JhbmRvbWJ5dGVzQDIuMS4wL25vZGVfbW9kdWxlcy9yYW5kb21ieXRlcy9icm93c2VyLmpzPyIpOwoKLyoqKi8gfSksCgovKioqLyAiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3JhbmRvbWZpbGxAMS4wLjQvbm9kZV9tb2R1bGVzL3JhbmRvbWZpbGwvYnJvd3Nlci5qcyI6Ci8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiEqXAogICEqKiogL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL3JhbmRvbWZpbGxAMS4wLjQvbm9kZV9tb2R1bGVzL3JhbmRvbWZpbGwvYnJvd3Nlci5qcyAqKiohCiAgXCoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKZXZhbCgiLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovKGZ1bmN0aW9uKGdsb2JhbCwgcHJvY2Vzcykge1xuZnVuY3Rpb24gb2xkQnJvd3NlcigpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3NlY3VyZSByYW5kb20gbnVtYmVyIGdlbmVyYXRpb24gbm90IHN1cHBvcnRlZCBieSB0aGlzIGJyb3dzZXJcXG51c2UgY2hyb21lLCBGaXJlRm94IG9yIEludGVybmV0IEV4cGxvcmVyIDExJyk7XG59XG52YXIgc2FmZUJ1ZmZlciA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIHNhZmUtYnVmZmVyICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3NhZmUtYnVmZmVyQDUuMi4xL25vZGVfbW9kdWxlcy9zYWZlLWJ1ZmZlci9pbmRleC5qc1wiKTtcbnZhciByYW5kb21ieXRlcyA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIHJhbmRvbWJ5dGVzICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3JhbmRvbWJ5dGVzQDIuMS4wL25vZGVfbW9kdWxlcy9yYW5kb21ieXRlcy9icm93c2VyLmpzXCIpO1xudmFyIEJ1ZmZlciA9IHNhZmVCdWZmZXIuQnVmZmVyO1xudmFyIGtCdWZmZXJNYXhMZW5ndGggPSBzYWZlQnVmZmVyLmtNYXhMZW5ndGg7XG52YXIgY3J5cHRvID0gZ2xvYmFsLmNyeXB0byB8fCBnbG9iYWwubXNDcnlwdG87XG52YXIga01heFVpbnQzMiA9IE1hdGgucG93KDIsIDMyKSAtIDE7XG5mdW5jdGlvbiBhc3NlcnRPZmZzZXQob2Zmc2V0LCBsZW5ndGgpIHtcbiAgICBpZiAodHlwZW9mIG9mZnNldCAhPT0gJ251bWJlcicgfHwgb2Zmc2V0ICE9PSBvZmZzZXQpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1zZWxmLWNvbXBhcmVcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignb2Zmc2V0IG11c3QgYmUgYSBudW1iZXInKTtcbiAgICB9XG4gICAgaWYgKG9mZnNldCA+IGtNYXhVaW50MzIgfHwgb2Zmc2V0IDwgMCkge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdvZmZzZXQgbXVzdCBiZSBhIHVpbnQzMicpO1xuICAgIH1cbiAgICBpZiAob2Zmc2V0ID4ga0J1ZmZlck1heExlbmd0aCB8fCBvZmZzZXQgPiBsZW5ndGgpIHtcbiAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ29mZnNldCBvdXQgb2YgcmFuZ2UnKTtcbiAgICB9XG59XG5mdW5jdGlvbiBhc3NlcnRTaXplKHNpemUsIG9mZnNldCwgbGVuZ3RoKSB7XG4gICAgaWYgKHR5cGVvZiBzaXplICE9PSAnbnVtYmVyJyB8fCBzaXplICE9PSBzaXplKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tc2VsZi1jb21wYXJlXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ3NpemUgbXVzdCBiZSBhIG51bWJlcicpO1xuICAgIH1cbiAgICBpZiAoc2l6ZSA+IGtNYXhVaW50MzIgfHwgc2l6ZSA8IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignc2l6ZSBtdXN0IGJlIGEgdWludDMyJyk7XG4gICAgfVxuICAgIGlmIChzaXplICsgb2Zmc2V0ID4gbGVuZ3RoIHx8IHNpemUgPiBrQnVmZmVyTWF4TGVuZ3RoKSB7XG4gICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdidWZmZXIgdG9vIHNtYWxsJyk7XG4gICAgfVxufVxuaWYgKChjcnlwdG8gJiYgY3J5cHRvLmdldFJhbmRvbVZhbHVlcykgfHwgIXByb2Nlc3MuYnJvd3Nlcikge1xuICAgIGV4cG9ydHMucmFuZG9tRmlsbCA9IHJhbmRvbUZpbGw7XG4gICAgZXhwb3J0cy5yYW5kb21GaWxsU3luYyA9IHJhbmRvbUZpbGxTeW5jO1xufVxuZWxzZSB7XG4gICAgZXhwb3J0cy5yYW5kb21GaWxsID0gb2xkQnJvd3NlcjtcbiAgICBleHBvcnRzLnJhbmRvbUZpbGxTeW5jID0gb2xkQnJvd3Nlcjtcbn1cbmZ1bmN0aW9uIHJhbmRvbUZpbGwoYnVmLCBvZmZzZXQsIHNpemUsIGNiKSB7XG4gICAgaWYgKCFCdWZmZXIuaXNCdWZmZXIoYnVmKSAmJiAhKGJ1ZiBpbnN0YW5jZW9mIGdsb2JhbC5VaW50OEFycmF5KSkge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdcImJ1ZlwiIGFyZ3VtZW50IG11c3QgYmUgYSBCdWZmZXIgb3IgVWludDhBcnJheScpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIG9mZnNldCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBjYiA9IG9mZnNldDtcbiAgICAgICAgb2Zmc2V0ID0gMDtcbiAgICAgICAgc2l6ZSA9IGJ1Zi5sZW5ndGg7XG4gICAgfVxuICAgIGVsc2UgaWYgKHR5cGVvZiBzaXplID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGNiID0gc2l6ZTtcbiAgICAgICAgc2l6ZSA9IGJ1Zi5sZW5ndGggLSBvZmZzZXQ7XG4gICAgfVxuICAgIGVsc2UgaWYgKHR5cGVvZiBjYiAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdcImNiXCIgYXJndW1lbnQgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7XG4gICAgfVxuICAgIGFzc2VydE9mZnNldChvZmZzZXQsIGJ1Zi5sZW5ndGgpO1xuICAgIGFzc2VydFNpemUoc2l6ZSwgb2Zmc2V0LCBidWYubGVuZ3RoKTtcbiAgICByZXR1cm4gYWN0dWFsRmlsbChidWYsIG9mZnNldCwgc2l6ZSwgY2IpO1xufVxuZnVuY3Rpb24gYWN0dWFsRmlsbChidWYsIG9mZnNldCwgc2l6ZSwgY2IpIHtcbiAgICBpZiAocHJvY2Vzcy5icm93c2VyKSB7XG4gICAgICAgIHZhciBvdXJCdWYgPSBidWYuYnVmZmVyO1xuICAgICAgICB2YXIgdWludCA9IG5ldyBVaW50OEFycmF5KG91ckJ1Ziwgb2Zmc2V0LCBzaXplKTtcbiAgICAgICAgY3J5cHRvLmdldFJhbmRvbVZhbHVlcyh1aW50KTtcbiAgICAgICAgaWYgKGNiKSB7XG4gICAgICAgICAgICBwcm9jZXNzLm5leHRUaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBjYihudWxsLCBidWYpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGJ1ZjtcbiAgICB9XG4gICAgaWYgKGNiKSB7XG4gICAgICAgIHJhbmRvbWJ5dGVzKHNpemUsIGZ1bmN0aW9uIChlcnIsIGJ5dGVzKSB7XG4gICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNiKGVycik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBieXRlcy5jb3B5KGJ1Ziwgb2Zmc2V0KTtcbiAgICAgICAgICAgIGNiKG51bGwsIGJ1Zik7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBieXRlcyA9IHJhbmRvbWJ5dGVzKHNpemUpO1xuICAgIGJ5dGVzLmNvcHkoYnVmLCBvZmZzZXQpO1xuICAgIHJldHVybiBidWY7XG59XG5mdW5jdGlvbiByYW5kb21GaWxsU3luYyhidWYsIG9mZnNldCwgc2l6ZSkge1xuICAgIGlmICh0eXBlb2Ygb2Zmc2V0ID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICBvZmZzZXQgPSAwO1xuICAgIH1cbiAgICBpZiAoIUJ1ZmZlci5pc0J1ZmZlcihidWYpICYmICEoYnVmIGluc3RhbmNlb2YgZ2xvYmFsLlVpbnQ4QXJyYXkpKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1wiYnVmXCIgYXJndW1lbnQgbXVzdCBiZSBhIEJ1ZmZlciBvciBVaW50OEFycmF5Jyk7XG4gICAgfVxuICAgIGFzc2VydE9mZnNldChvZmZzZXQsIGJ1Zi5sZW5ndGgpO1xuICAgIGlmIChzaXplID09PSB1bmRlZmluZWQpXG4gICAgICAgIHNpemUgPSBidWYubGVuZ3RoIC0gb2Zmc2V0O1xuICAgIGFzc2VydFNpemUoc2l6ZSwgb2Zmc2V0LCBidWYubGVuZ3RoKTtcbiAgICByZXR1cm4gYWN0dWFsRmlsbChidWYsIG9mZnNldCwgc2l6ZSk7XG59XG5cbi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqL30uY2FsbCh0aGlzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuLy4uLy4uLy4uL3dlYnBhY2tANC40Ni4wX3dlYnBhY2stY2xpQDQuMTAuMC9ub2RlX21vZHVsZXMvd2VicGFjay9idWlsZGluL2dsb2JhbC5qcyAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS93ZWJwYWNrQDQuNDYuMF93ZWJwYWNrLWNsaUA0LjEwLjAvbm9kZV9tb2R1bGVzL3dlYnBhY2svYnVpbGRpbi9nbG9iYWwuanNcIiksIF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vLi4vLi4vLi4vcHJvY2Vzc0AwLjExLjEwL25vZGVfbW9kdWxlcy9wcm9jZXNzL2Jyb3dzZXIuanMgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vcHJvY2Vzc0AwLjExLjEwL25vZGVfbW9kdWxlcy9wcm9jZXNzL2Jyb3dzZXIuanNcIikpKVxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL3JhbmRvbWZpbGxAMS4wLjQvbm9kZV9tb2R1bGVzL3JhbmRvbWZpbGwvYnJvd3Nlci5qcz8iKTsKCi8qKiovIH0pLAoKLyoqKi8gIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9zYWZlLWJ1ZmZlckA1LjIuMS9ub2RlX21vZHVsZXMvc2FmZS1idWZmZXIvaW5kZXguanMiOgovKiEqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlwKICAhKioqIC9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9zYWZlLWJ1ZmZlckA1LjIuMS9ub2RlX21vZHVsZXMvc2FmZS1idWZmZXIvaW5kZXguanMgKioqIQogIFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CmV2YWwoIlxuLyohIHNhZmUtYnVmZmVyLiBNSVQgTGljZW5zZS4gRmVyb3NzIEFib3VraGFkaWplaCA8aHR0cHM6Ly9mZXJvc3Mub3JnL29wZW5zb3VyY2U+ICovXG4vKiBlc2xpbnQtZGlzYWJsZSBub2RlL25vLWRlcHJlY2F0ZWQtYXBpICovXG52YXIgYnVmZmVyID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgYnVmZmVyICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2J1ZmZlckA0LjkuMi9ub2RlX21vZHVsZXMvYnVmZmVyL2luZGV4LmpzXCIpO1xudmFyIEJ1ZmZlciA9IGJ1ZmZlci5CdWZmZXI7XG4vLyBhbHRlcm5hdGl2ZSB0byB1c2luZyBPYmplY3Qua2V5cyBmb3Igb2xkIGJyb3dzZXJzXG5mdW5jdGlvbiBjb3B5UHJvcHMoc3JjLCBkc3QpIHtcbiAgICBmb3IgKHZhciBrZXkgaW4gc3JjKSB7XG4gICAgICAgIGRzdFtrZXldID0gc3JjW2tleV07XG4gICAgfVxufVxuaWYgKEJ1ZmZlci5mcm9tICYmIEJ1ZmZlci5hbGxvYyAmJiBCdWZmZXIuYWxsb2NVbnNhZmUgJiYgQnVmZmVyLmFsbG9jVW5zYWZlU2xvdykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gYnVmZmVyO1xufVxuZWxzZSB7XG4gICAgLy8gQ29weSBwcm9wZXJ0aWVzIGZyb20gcmVxdWlyZSgnYnVmZmVyJylcbiAgICBjb3B5UHJvcHMoYnVmZmVyLCBleHBvcnRzKTtcbiAgICBleHBvcnRzLkJ1ZmZlciA9IFNhZmVCdWZmZXI7XG59XG5mdW5jdGlvbiBTYWZlQnVmZmVyKGFyZywgZW5jb2RpbmdPck9mZnNldCwgbGVuZ3RoKSB7XG4gICAgcmV0dXJuIEJ1ZmZlcihhcmcsIGVuY29kaW5nT3JPZmZzZXQsIGxlbmd0aCk7XG59XG5TYWZlQnVmZmVyLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQnVmZmVyLnByb3RvdHlwZSk7XG4vLyBDb3B5IHN0YXRpYyBtZXRob2RzIGZyb20gQnVmZmVyXG5jb3B5UHJvcHMoQnVmZmVyLCBTYWZlQnVmZmVyKTtcblNhZmVCdWZmZXIuZnJvbSA9IGZ1bmN0aW9uIChhcmcsIGVuY29kaW5nT3JPZmZzZXQsIGxlbmd0aCkge1xuICAgIGlmICh0eXBlb2YgYXJnID09PSAnbnVtYmVyJykge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdBcmd1bWVudCBtdXN0IG5vdCBiZSBhIG51bWJlcicpO1xuICAgIH1cbiAgICByZXR1cm4gQnVmZmVyKGFyZywgZW5jb2RpbmdPck9mZnNldCwgbGVuZ3RoKTtcbn07XG5TYWZlQnVmZmVyLmFsbG9jID0gZnVuY3Rpb24gKHNpemUsIGZpbGwsIGVuY29kaW5nKSB7XG4gICAgaWYgKHR5cGVvZiBzaXplICE9PSAnbnVtYmVyJykge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdBcmd1bWVudCBtdXN0IGJlIGEgbnVtYmVyJyk7XG4gICAgfVxuICAgIHZhciBidWYgPSBCdWZmZXIoc2l6ZSk7XG4gICAgaWYgKGZpbGwgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBpZiAodHlwZW9mIGVuY29kaW5nID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgYnVmLmZpbGwoZmlsbCwgZW5jb2RpbmcpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYnVmLmZpbGwoZmlsbCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGJ1Zi5maWxsKDApO1xuICAgIH1cbiAgICByZXR1cm4gYnVmO1xufTtcblNhZmVCdWZmZXIuYWxsb2NVbnNhZmUgPSBmdW5jdGlvbiAoc2l6ZSkge1xuICAgIGlmICh0eXBlb2Ygc2l6ZSAhPT0gJ251bWJlcicpIHtcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignQXJndW1lbnQgbXVzdCBiZSBhIG51bWJlcicpO1xuICAgIH1cbiAgICByZXR1cm4gQnVmZmVyKHNpemUpO1xufTtcblNhZmVCdWZmZXIuYWxsb2NVbnNhZmVTbG93ID0gZnVuY3Rpb24gKHNpemUpIHtcbiAgICBpZiAodHlwZW9mIHNpemUgIT09ICdudW1iZXInKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0FyZ3VtZW50IG11c3QgYmUgYSBudW1iZXInKTtcbiAgICB9XG4gICAgcmV0dXJuIGJ1ZmZlci5TbG93QnVmZmVyKHNpemUpO1xufTtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL3NhZmUtYnVmZmVyQDUuMi4xL25vZGVfbW9kdWxlcy9zYWZlLWJ1ZmZlci9pbmRleC5qcz8iKTsKCi8qKiovIH0pLAoKLyoqKi8gIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9zZXRpbW1lZGlhdGVAMS4wLjUvbm9kZV9tb2R1bGVzL3NldGltbWVkaWF0ZS9zZXRJbW1lZGlhdGUuanMiOgovKiEqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlwKICAhKioqIC9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9zZXRpbW1lZGlhdGVAMS4wLjUvbm9kZV9tb2R1bGVzL3NldGltbWVkaWF0ZS9zZXRJbW1lZGlhdGUuanMgKioqIQogIFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CmV2YWwoIi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLyhmdW5jdGlvbihnbG9iYWwsIHByb2Nlc3MpIHtcbihmdW5jdGlvbiAoZ2xvYmFsLCB1bmRlZmluZWQpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICBpZiAoZ2xvYmFsLnNldEltbWVkaWF0ZSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBuZXh0SGFuZGxlID0gMTsgLy8gU3BlYyBzYXlzIGdyZWF0ZXIgdGhhbiB6ZXJvXG4gICAgdmFyIHRhc2tzQnlIYW5kbGUgPSB7fTtcbiAgICB2YXIgY3VycmVudGx5UnVubmluZ0FUYXNrID0gZmFsc2U7XG4gICAgdmFyIGRvYyA9IGdsb2JhbC5kb2N1bWVudDtcbiAgICB2YXIgcmVnaXN0ZXJJbW1lZGlhdGU7XG4gICAgZnVuY3Rpb24gc2V0SW1tZWRpYXRlKGNhbGxiYWNrKSB7XG4gICAgICAgIC8vIENhbGxiYWNrIGNhbiBlaXRoZXIgYmUgYSBmdW5jdGlvbiBvciBhIHN0cmluZ1xuICAgICAgICBpZiAodHlwZW9mIGNhbGxiYWNrICE9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrID0gbmV3IEZ1bmN0aW9uKFwiXCIgKyBjYWxsYmFjayk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQ29weSBmdW5jdGlvbiBhcmd1bWVudHNcbiAgICAgICAgdmFyIGFyZ3MgPSBuZXcgQXJyYXkoYXJndW1lbnRzLmxlbmd0aCAtIDEpO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGFyZ3NbaV0gPSBhcmd1bWVudHNbaSArIDFdO1xuICAgICAgICB9XG4gICAgICAgIC8vIFN0b3JlIGFuZCByZWdpc3RlciB0aGUgdGFza1xuICAgICAgICB2YXIgdGFzayA9IHsgY2FsbGJhY2s6IGNhbGxiYWNrLCBhcmdzOiBhcmdzIH07XG4gICAgICAgIHRhc2tzQnlIYW5kbGVbbmV4dEhhbmRsZV0gPSB0YXNrO1xuICAgICAgICByZWdpc3RlckltbWVkaWF0ZShuZXh0SGFuZGxlKTtcbiAgICAgICAgcmV0dXJuIG5leHRIYW5kbGUrKztcbiAgICB9XG4gICAgZnVuY3Rpb24gY2xlYXJJbW1lZGlhdGUoaGFuZGxlKSB7XG4gICAgICAgIGRlbGV0ZSB0YXNrc0J5SGFuZGxlW2hhbmRsZV07XG4gICAgfVxuICAgIGZ1bmN0aW9uIHJ1bih0YXNrKSB7XG4gICAgICAgIHZhciBjYWxsYmFjayA9IHRhc2suY2FsbGJhY2s7XG4gICAgICAgIHZhciBhcmdzID0gdGFzay5hcmdzO1xuICAgICAgICBzd2l0Y2ggKGFyZ3MubGVuZ3RoKSB7XG4gICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhhcmdzWzBdKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhhcmdzWzBdLCBhcmdzWzFdKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkodW5kZWZpbmVkLCBhcmdzKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cbiAgICBmdW5jdGlvbiBydW5JZlByZXNlbnQoaGFuZGxlKSB7XG4gICAgICAgIC8vIEZyb20gdGhlIHNwZWM6IFwiV2FpdCB1bnRpbCBhbnkgaW52b2NhdGlvbnMgb2YgdGhpcyBhbGdvcml0aG0gc3RhcnRlZCBiZWZvcmUgdGhpcyBvbmUgaGF2ZSBjb21wbGV0ZWQuXCJcbiAgICAgICAgLy8gU28gaWYgd2UncmUgY3VycmVudGx5IHJ1bm5pbmcgYSB0YXNrLCB3ZSdsbCBuZWVkIHRvIGRlbGF5IHRoaXMgaW52b2NhdGlvbi5cbiAgICAgICAgaWYgKGN1cnJlbnRseVJ1bm5pbmdBVGFzaykge1xuICAgICAgICAgICAgLy8gRGVsYXkgYnkgZG9pbmcgYSBzZXRUaW1lb3V0LiBzZXRJbW1lZGlhdGUgd2FzIHRyaWVkIGluc3RlYWQsIGJ1dCBpbiBGaXJlZm94IDcgaXQgZ2VuZXJhdGVkIGFcbiAgICAgICAgICAgIC8vIFwidG9vIG11Y2ggcmVjdXJzaW9uXCIgZXJyb3IuXG4gICAgICAgICAgICBzZXRUaW1lb3V0KHJ1bklmUHJlc2VudCwgMCwgaGFuZGxlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHZhciB0YXNrID0gdGFza3NCeUhhbmRsZVtoYW5kbGVdO1xuICAgICAgICAgICAgaWYgKHRhc2spIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50bHlSdW5uaW5nQVRhc2sgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIHJ1bih0YXNrKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFySW1tZWRpYXRlKGhhbmRsZSk7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRseVJ1bm5pbmdBVGFzayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBmdW5jdGlvbiBpbnN0YWxsTmV4dFRpY2tJbXBsZW1lbnRhdGlvbigpIHtcbiAgICAgICAgcmVnaXN0ZXJJbW1lZGlhdGUgPSBmdW5jdGlvbiAoaGFuZGxlKSB7XG4gICAgICAgICAgICBwcm9jZXNzLm5leHRUaWNrKGZ1bmN0aW9uICgpIHsgcnVuSWZQcmVzZW50KGhhbmRsZSk7IH0pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBmdW5jdGlvbiBjYW5Vc2VQb3N0TWVzc2FnZSgpIHtcbiAgICAgICAgLy8gVGhlIHRlc3QgYWdhaW5zdCBgaW1wb3J0U2NyaXB0c2AgcHJldmVudHMgdGhpcyBpbXBsZW1lbnRhdGlvbiBmcm9tIGJlaW5nIGluc3RhbGxlZCBpbnNpZGUgYSB3ZWIgd29ya2VyLFxuICAgICAgICAvLyB3aGVyZSBgZ2xvYmFsLnBvc3RNZXNzYWdlYCBtZWFucyBzb21ldGhpbmcgY29tcGxldGVseSBkaWZmZXJlbnQgYW5kIGNhbid0IGJlIHVzZWQgZm9yIHRoaXMgcHVycG9zZS5cbiAgICAgICAgaWYgKGdsb2JhbC5wb3N0TWVzc2FnZSAmJiAhZ2xvYmFsLmltcG9ydFNjcmlwdHMpIHtcbiAgICAgICAgICAgIHZhciBwb3N0TWVzc2FnZUlzQXN5bmNocm9ub3VzID0gdHJ1ZTtcbiAgICAgICAgICAgIHZhciBvbGRPbk1lc3NhZ2UgPSBnbG9iYWwub25tZXNzYWdlO1xuICAgICAgICAgICAgZ2xvYmFsLm9ubWVzc2FnZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBwb3N0TWVzc2FnZUlzQXN5bmNocm9ub3VzID0gZmFsc2U7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgZ2xvYmFsLnBvc3RNZXNzYWdlKFwiXCIsIFwiKlwiKTtcbiAgICAgICAgICAgIGdsb2JhbC5vbm1lc3NhZ2UgPSBvbGRPbk1lc3NhZ2U7XG4gICAgICAgICAgICByZXR1cm4gcG9zdE1lc3NhZ2VJc0FzeW5jaHJvbm91cztcbiAgICAgICAgfVxuICAgIH1cbiAgICBmdW5jdGlvbiBpbnN0YWxsUG9zdE1lc3NhZ2VJbXBsZW1lbnRhdGlvbigpIHtcbiAgICAgICAgLy8gSW5zdGFsbHMgYW4gZXZlbnQgaGFuZGxlciBvbiBgZ2xvYmFsYCBmb3IgdGhlIGBtZXNzYWdlYCBldmVudDogc2VlXG4gICAgICAgIC8vICogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vRE9NL3dpbmRvdy5wb3N0TWVzc2FnZVxuICAgICAgICAvLyAqIGh0dHA6Ly93d3cud2hhdHdnLm9yZy9zcGVjcy93ZWItYXBwcy9jdXJyZW50LXdvcmsvbXVsdGlwYWdlL2NvbW1zLmh0bWwjY3Jvc3NEb2N1bWVudE1lc3NhZ2VzXG4gICAgICAgIHZhciBtZXNzYWdlUHJlZml4ID0gXCJzZXRJbW1lZGlhdGUkXCIgKyBNYXRoLnJhbmRvbSgpICsgXCIkXCI7XG4gICAgICAgIHZhciBvbkdsb2JhbE1lc3NhZ2UgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIGlmIChldmVudC5zb3VyY2UgPT09IGdsb2JhbCAmJlxuICAgICAgICAgICAgICAgIHR5cGVvZiBldmVudC5kYXRhID09PSBcInN0cmluZ1wiICYmXG4gICAgICAgICAgICAgICAgZXZlbnQuZGF0YS5pbmRleE9mKG1lc3NhZ2VQcmVmaXgpID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcnVuSWZQcmVzZW50KCtldmVudC5kYXRhLnNsaWNlKG1lc3NhZ2VQcmVmaXgubGVuZ3RoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGlmIChnbG9iYWwuYWRkRXZlbnRMaXN0ZW5lcikge1xuICAgICAgICAgICAgZ2xvYmFsLmFkZEV2ZW50TGlzdGVuZXIoXCJtZXNzYWdlXCIsIG9uR2xvYmFsTWVzc2FnZSwgZmFsc2UpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZ2xvYmFsLmF0dGFjaEV2ZW50KFwib25tZXNzYWdlXCIsIG9uR2xvYmFsTWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmVnaXN0ZXJJbW1lZGlhdGUgPSBmdW5jdGlvbiAoaGFuZGxlKSB7XG4gICAgICAgICAgICBnbG9iYWwucG9zdE1lc3NhZ2UobWVzc2FnZVByZWZpeCArIGhhbmRsZSwgXCIqXCIpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBmdW5jdGlvbiBpbnN0YWxsTWVzc2FnZUNoYW5uZWxJbXBsZW1lbnRhdGlvbigpIHtcbiAgICAgICAgdmFyIGNoYW5uZWwgPSBuZXcgTWVzc2FnZUNoYW5uZWwoKTtcbiAgICAgICAgY2hhbm5lbC5wb3J0MS5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIHZhciBoYW5kbGUgPSBldmVudC5kYXRhO1xuICAgICAgICAgICAgcnVuSWZQcmVzZW50KGhhbmRsZSk7XG4gICAgICAgIH07XG4gICAgICAgIHJlZ2lzdGVySW1tZWRpYXRlID0gZnVuY3Rpb24gKGhhbmRsZSkge1xuICAgICAgICAgICAgY2hhbm5lbC5wb3J0Mi5wb3N0TWVzc2FnZShoYW5kbGUpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBmdW5jdGlvbiBpbnN0YWxsUmVhZHlTdGF0ZUNoYW5nZUltcGxlbWVudGF0aW9uKCkge1xuICAgICAgICB2YXIgaHRtbCA9IGRvYy5kb2N1bWVudEVsZW1lbnQ7XG4gICAgICAgIHJlZ2lzdGVySW1tZWRpYXRlID0gZnVuY3Rpb24gKGhhbmRsZSkge1xuICAgICAgICAgICAgLy8gQ3JlYXRlIGEgPHNjcmlwdD4gZWxlbWVudDsgaXRzIHJlYWR5c3RhdGVjaGFuZ2UgZXZlbnQgd2lsbCBiZSBmaXJlZCBhc3luY2hyb25vdXNseSBvbmNlIGl0IGlzIGluc2VydGVkXG4gICAgICAgICAgICAvLyBpbnRvIHRoZSBkb2N1bWVudC4gRG8gc28sIHRodXMgcXVldWluZyB1cCB0aGUgdGFzay4gUmVtZW1iZXIgdG8gY2xlYW4gdXAgb25jZSBpdCdzIGJlZW4gY2FsbGVkLlxuICAgICAgICAgICAgdmFyIHNjcmlwdCA9IGRvYy5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIpO1xuICAgICAgICAgICAgc2NyaXB0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBydW5JZlByZXNlbnQoaGFuZGxlKTtcbiAgICAgICAgICAgICAgICBzY3JpcHQub25yZWFkeXN0YXRlY2hhbmdlID0gbnVsbDtcbiAgICAgICAgICAgICAgICBodG1sLnJlbW92ZUNoaWxkKHNjcmlwdCk7XG4gICAgICAgICAgICAgICAgc2NyaXB0ID0gbnVsbDtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBodG1sLmFwcGVuZENoaWxkKHNjcmlwdCk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIGZ1bmN0aW9uIGluc3RhbGxTZXRUaW1lb3V0SW1wbGVtZW50YXRpb24oKSB7XG4gICAgICAgIHJlZ2lzdGVySW1tZWRpYXRlID0gZnVuY3Rpb24gKGhhbmRsZSkge1xuICAgICAgICAgICAgc2V0VGltZW91dChydW5JZlByZXNlbnQsIDAsIGhhbmRsZSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIC8vIElmIHN1cHBvcnRlZCwgd2Ugc2hvdWxkIGF0dGFjaCB0byB0aGUgcHJvdG90eXBlIG9mIGdsb2JhbCwgc2luY2UgdGhhdCBpcyB3aGVyZSBzZXRUaW1lb3V0IGV0IGFsLiBsaXZlLlxuICAgIHZhciBhdHRhY2hUbyA9IE9iamVjdC5nZXRQcm90b3R5cGVPZiAmJiBPYmplY3QuZ2V0UHJvdG90eXBlT2YoZ2xvYmFsKTtcbiAgICBhdHRhY2hUbyA9IGF0dGFjaFRvICYmIGF0dGFjaFRvLnNldFRpbWVvdXQgPyBhdHRhY2hUbyA6IGdsb2JhbDtcbiAgICAvLyBEb24ndCBnZXQgZm9vbGVkIGJ5IGUuZy4gYnJvd3NlcmlmeSBlbnZpcm9ubWVudHMuXG4gICAgaWYgKHt9LnRvU3RyaW5nLmNhbGwoZ2xvYmFsLnByb2Nlc3MpID09PSBcIltvYmplY3QgcHJvY2Vzc11cIikge1xuICAgICAgICAvLyBGb3IgTm9kZS5qcyBiZWZvcmUgMC45XG4gICAgICAgIGluc3RhbGxOZXh0VGlja0ltcGxlbWVudGF0aW9uKCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNhblVzZVBvc3RNZXNzYWdlKCkpIHtcbiAgICAgICAgLy8gRm9yIG5vbi1JRTEwIG1vZGVybiBicm93c2Vyc1xuICAgICAgICBpbnN0YWxsUG9zdE1lc3NhZ2VJbXBsZW1lbnRhdGlvbigpO1xuICAgIH1cbiAgICBlbHNlIGlmIChnbG9iYWwuTWVzc2FnZUNoYW5uZWwpIHtcbiAgICAgICAgLy8gRm9yIHdlYiB3b3JrZXJzLCB3aGVyZSBzdXBwb3J0ZWRcbiAgICAgICAgaW5zdGFsbE1lc3NhZ2VDaGFubmVsSW1wbGVtZW50YXRpb24oKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoZG9jICYmIFwib25yZWFkeXN0YXRlY2hhbmdlXCIgaW4gZG9jLmNyZWF0ZUVsZW1lbnQoXCJzY3JpcHRcIikpIHtcbiAgICAgICAgLy8gRm9yIElFIDbigJM4XG4gICAgICAgIGluc3RhbGxSZWFkeVN0YXRlQ2hhbmdlSW1wbGVtZW50YXRpb24oKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIEZvciBvbGRlciBicm93c2Vyc1xuICAgICAgICBpbnN0YWxsU2V0VGltZW91dEltcGxlbWVudGF0aW9uKCk7XG4gICAgfVxuICAgIGF0dGFjaFRvLnNldEltbWVkaWF0ZSA9IHNldEltbWVkaWF0ZTtcbiAgICBhdHRhY2hUby5jbGVhckltbWVkaWF0ZSA9IGNsZWFySW1tZWRpYXRlO1xufSh0eXBlb2Ygc2VsZiA9PT0gXCJ1bmRlZmluZWRcIiA/IHR5cGVvZiBnbG9iYWwgPT09IFwidW5kZWZpbmVkXCIgPyB0aGlzIDogZ2xvYmFsIDogc2VsZikpO1xuXG4vKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi99LmNhbGwodGhpcywgX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi8uLi8uLi8uLi93ZWJwYWNrQDQuNDYuMF93ZWJwYWNrLWNsaUA0LjEwLjAvbm9kZV9tb2R1bGVzL3dlYnBhY2svYnVpbGRpbi9nbG9iYWwuanMgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vd2VicGFja0A0LjQ2LjBfd2VicGFjay1jbGlANC4xMC4wL25vZGVfbW9kdWxlcy93ZWJwYWNrL2J1aWxkaW4vZ2xvYmFsLmpzXCIpLCBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuLy4uLy4uLy4uL3Byb2Nlc3NAMC4xMS4xMC9ub2RlX21vZHVsZXMvcHJvY2Vzcy9icm93c2VyLmpzICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3Byb2Nlc3NAMC4xMS4xMC9ub2RlX21vZHVsZXMvcHJvY2Vzcy9icm93c2VyLmpzXCIpKSlcblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS9zZXRpbW1lZGlhdGVAMS4wLjUvbm9kZV9tb2R1bGVzL3NldGltbWVkaWF0ZS9zZXRJbW1lZGlhdGUuanM/Iik7CgovKioqLyB9KSwKCi8qKiovICIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS9jb21tb24uanMiOgovKiEqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiEqXAogICEqKiogL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vY29tbW9uLmpzICoqKiEKICBcKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CmV2YWwoIlxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zZXJpYWxpemUgPSBleHBvcnRzLmRlc2VyaWFsaXplID0gZXhwb3J0cy5yZWdpc3RlclNlcmlhbGl6ZXIgPSB2b2lkIDA7XG52YXIgc2VyaWFsaXplcnNfMSA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vc2VyaWFsaXplcnMgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS9zZXJpYWxpemVycy5qc1wiKTtcbnZhciByZWdpc3RlcmVkU2VyaWFsaXplciA9IHNlcmlhbGl6ZXJzXzEuRGVmYXVsdFNlcmlhbGl6ZXI7XG5mdW5jdGlvbiByZWdpc3RlclNlcmlhbGl6ZXIoc2VyaWFsaXplcikge1xuICAgIHJlZ2lzdGVyZWRTZXJpYWxpemVyID0gKDAsIHNlcmlhbGl6ZXJzXzEuZXh0ZW5kU2VyaWFsaXplcikocmVnaXN0ZXJlZFNlcmlhbGl6ZXIsIHNlcmlhbGl6ZXIpO1xufVxuZXhwb3J0cy5yZWdpc3RlclNlcmlhbGl6ZXIgPSByZWdpc3RlclNlcmlhbGl6ZXI7XG5mdW5jdGlvbiBkZXNlcmlhbGl6ZShtZXNzYWdlKSB7XG4gICAgcmV0dXJuIHJlZ2lzdGVyZWRTZXJpYWxpemVyLmRlc2VyaWFsaXplKG1lc3NhZ2UpO1xufVxuZXhwb3J0cy5kZXNlcmlhbGl6ZSA9IGRlc2VyaWFsaXplO1xuZnVuY3Rpb24gc2VyaWFsaXplKGlucHV0KSB7XG4gICAgcmV0dXJuIHJlZ2lzdGVyZWRTZXJpYWxpemVyLnNlcmlhbGl6ZShpbnB1dCk7XG59XG5leHBvcnRzLnNlcmlhbGl6ZSA9IHNlcmlhbGl6ZTtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vY29tbW9uLmpzPyIpOwoKLyoqKi8gfSksCgovKioqLyAiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vaW5kZXguanMiOgovKiEqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqISpcCiAgISoqKiAvaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS9pbmRleC5qcyAqKiohCiAgXCoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CmV2YWwoIlxudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgdmFyIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG0sIGspO1xuICAgIGlmICghZGVzYyB8fCAoXCJnZXRcIiBpbiBkZXNjID8gIW0uX19lc01vZHVsZSA6IGRlc2Mud3JpdGFibGUgfHwgZGVzYy5jb25maWd1cmFibGUpKSB7XG4gICAgICBkZXNjID0geyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9O1xuICAgIH1cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIGRlc2MpO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX2V4cG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9fZXhwb3J0U3RhcikgfHwgZnVuY3Rpb24obSwgZXhwb3J0cykge1xuICAgIGZvciAodmFyIHAgaW4gbSkgaWYgKHAgIT09IFwiZGVmYXVsdFwiICYmICFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZXhwb3J0cywgcCkpIF9fY3JlYXRlQmluZGluZyhleHBvcnRzLCBtLCBwKTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlRyYW5zZmVyID0gZXhwb3J0cy5EZWZhdWx0U2VyaWFsaXplciA9IGV4cG9ydHMuZXhwb3NlID0gZXhwb3J0cy5yZWdpc3RlclNlcmlhbGl6ZXIgPSB2b2lkIDA7XG52YXIgY29tbW9uXzEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL2NvbW1vbiAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS90aHJlYWRzQDEuNy4wL25vZGVfbW9kdWxlcy90aHJlYWRzL2Rpc3QtZXNtL2NvbW1vbi5qc1wiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcInJlZ2lzdGVyU2VyaWFsaXplclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gY29tbW9uXzEucmVnaXN0ZXJTZXJpYWxpemVyOyB9IH0pO1xuX19leHBvcnRTdGFyKF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vbWFzdGVyL2luZGV4ICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vbWFzdGVyL2luZGV4LmpzXCIpLCBleHBvcnRzKTtcbnZhciBpbmRleF8xID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi93b3JrZXIvaW5kZXggKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS93b3JrZXIvaW5kZXguanNcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJleHBvc2VcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGluZGV4XzEuZXhwb3NlOyB9IH0pO1xudmFyIHNlcmlhbGl6ZXJzXzEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL3NlcmlhbGl6ZXJzICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vc2VyaWFsaXplcnMuanNcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJEZWZhdWx0U2VyaWFsaXplclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gc2VyaWFsaXplcnNfMS5EZWZhdWx0U2VyaWFsaXplcjsgfSB9KTtcbnZhciB0cmFuc2ZlcmFibGVfMSA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vdHJhbnNmZXJhYmxlICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vdHJhbnNmZXJhYmxlLmpzXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiVHJhbnNmZXJcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRyYW5zZmVyYWJsZV8xLlRyYW5zZmVyOyB9IH0pO1xuXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8vaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS9pbmRleC5qcz8iKTsKCi8qKiovIH0pLAoKLyoqKi8gIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS90aHJlYWRzQDEuNy4wL25vZGVfbW9kdWxlcy90aHJlYWRzL2Rpc3QtZXNtL21hc3Rlci9nZXQtYnVuZGxlLXVybC5icm93c2VyLmpzIjoKLyohKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiEqXAogICEqKiogL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vbWFzdGVyL2dldC1idW5kbGUtdXJsLmJyb3dzZXIuanMgKioqIQogIFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKiEgbm8gc3RhdGljIGV4cG9ydHMgZm91bmQgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwpldmFsKCJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZ2V0QnVuZGxlVVJMID0gZXhwb3J0cy5nZXRCYXNlVVJMID0gdm9pZCAwO1xuLy8gU291cmNlOiA8aHR0cHM6Ly9naXRodWIuY29tL3BhcmNlbC1idW5kbGVyL3BhcmNlbC9ibG9iL21hc3Rlci9wYWNrYWdlcy9jb3JlL3BhcmNlbC1idW5kbGVyL3NyYy9idWlsdGlucy9idW5kbGUtdXJsLmpzPlxudmFyIGJ1bmRsZVVSTDtcbmZ1bmN0aW9uIGdldEJ1bmRsZVVSTENhY2hlZCgpIHtcbiAgICBpZiAoIWJ1bmRsZVVSTCkge1xuICAgICAgICBidW5kbGVVUkwgPSBnZXRCdW5kbGVVUkwoKTtcbiAgICB9XG4gICAgcmV0dXJuIGJ1bmRsZVVSTDtcbn1cbmV4cG9ydHMuZ2V0QnVuZGxlVVJMID0gZ2V0QnVuZGxlVVJMQ2FjaGVkO1xuZnVuY3Rpb24gZ2V0QnVuZGxlVVJMKCkge1xuICAgIC8vIEF0dGVtcHQgdG8gZmluZCB0aGUgVVJMIG9mIHRoZSBjdXJyZW50IHNjcmlwdCBhbmQgdXNlIHRoYXQgYXMgdGhlIGJhc2UgVVJMXG4gICAgdHJ5IHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yO1xuICAgIH1cbiAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgIHZhciBtYXRjaGVzID0gKFwiXCIgKyBlcnIuc3RhY2spLm1hdGNoKC8oaHR0cHM/fGZpbGV8ZnRwfGNocm9tZS1leHRlbnNpb258bW96LWV4dGVuc2lvbik6XFwvXFwvW14pXFxuXSsvZyk7XG4gICAgICAgIGlmIChtYXRjaGVzKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0QmFzZVVSTChtYXRjaGVzWzBdKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gXCIvXCI7XG59XG5mdW5jdGlvbiBnZXRCYXNlVVJMKHVybCkge1xuICAgIHJldHVybiAoXCJcIiArIHVybCkucmVwbGFjZSgvXigoPzpodHRwcz98ZmlsZXxmdHB8Y2hyb21lLWV4dGVuc2lvbnxtb3otZXh0ZW5zaW9uKTpcXC9cXC8uKyk/XFwvW14vXSsoPzpcXD8uKik/JC8sICckMScpICsgJy8nO1xufVxuZXhwb3J0cy5nZXRCYXNlVVJMID0gZ2V0QmFzZVVSTDtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vbWFzdGVyL2dldC1idW5kbGUtdXJsLmJyb3dzZXIuanM/Iik7CgovKioqLyB9KSwKCi8qKiovICIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS9tYXN0ZXIvaW1wbGVtZW50YXRpb24uYnJvd3Nlci5qcyI6Ci8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlwKICAhKioqIC9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS90aHJlYWRzQDEuNy4wL25vZGVfbW9kdWxlcy90aHJlYWRzL2Rpc3QtZXNtL21hc3Rlci9pbXBsZW1lbnRhdGlvbi5icm93c2VyLmpzICoqKiEKICBcKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKZXZhbCgiXG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYiwgcCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBpZiAodHlwZW9mIGIgIT09IFwiZnVuY3Rpb25cIiAmJiBiICE9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNsYXNzIGV4dGVuZHMgdmFsdWUgXCIgKyBTdHJpbmcoYikgKyBcIiBpcyBub3QgYSBjb25zdHJ1Y3RvciBvciBudWxsXCIpO1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5pc1dvcmtlclJ1bnRpbWUgPSBleHBvcnRzLmdldFdvcmtlckltcGxlbWVudGF0aW9uID0gZXhwb3J0cy5kZWZhdWx0UG9vbFNpemUgPSB2b2lkIDA7XG4vLyB0c2xpbnQ6ZGlzYWJsZSBtYXgtY2xhc3Nlcy1wZXItZmlsZVxudmFyIGdldF9idW5kbGVfdXJsX2Jyb3dzZXJfMSA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vZ2V0LWJ1bmRsZS11cmwuYnJvd3NlciAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS90aHJlYWRzQDEuNy4wL25vZGVfbW9kdWxlcy90aHJlYWRzL2Rpc3QtZXNtL21hc3Rlci9nZXQtYnVuZGxlLXVybC5icm93c2VyLmpzXCIpO1xuZXhwb3J0cy5kZWZhdWx0UG9vbFNpemUgPSB0eXBlb2YgbmF2aWdhdG9yICE9PSBcInVuZGVmaW5lZFwiICYmIG5hdmlnYXRvci5oYXJkd2FyZUNvbmN1cnJlbmN5XG4gICAgPyBuYXZpZ2F0b3IuaGFyZHdhcmVDb25jdXJyZW5jeVxuICAgIDogNDtcbnZhciBpc0Fic29sdXRlVVJMID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiAvXlthLXpBLVpdW2EtekEtWlxcZCtcXC0uXSo6Ly50ZXN0KHZhbHVlKTsgfTtcbmZ1bmN0aW9uIGNyZWF0ZVNvdXJjZUJsb2JVUkwoY29kZSkge1xuICAgIHZhciBibG9iID0gbmV3IEJsb2IoW2NvZGVdLCB7IHR5cGU6IFwiYXBwbGljYXRpb24vamF2YXNjcmlwdFwiIH0pO1xuICAgIHJldHVybiBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xufVxuZnVuY3Rpb24gc2VsZWN0V29ya2VySW1wbGVtZW50YXRpb24oKSB7XG4gICAgaWYgKHR5cGVvZiBXb3JrZXIgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgLy8gTWlnaHQgaGFwcGVuIG9uIFNhZmFyaSwgZm9yIGluc3RhbmNlXG4gICAgICAgIC8vIFRoZSBpZGVhIGlzIHRvIG9ubHkgZmFpbCBpZiB0aGUgY29uc3RydWN0b3IgaXMgYWN0dWFsbHkgdXNlZFxuICAgICAgICByZXR1cm4gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZnVuY3Rpb24gTm9XZWJXb3JrZXIoKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoXCJObyB3ZWIgd29ya2VyIGltcGxlbWVudGF0aW9uIGF2YWlsYWJsZS4gWW91IG1pZ2h0IGhhdmUgdHJpZWQgdG8gc3Bhd24gYSB3b3JrZXIgd2l0aGluIGEgd29ya2VyIGluIGEgYnJvd3NlciB0aGF0IGRvZXNuJ3Qgc3VwcG9ydCB3b3JrZXJzIGluIHdvcmtlcnMuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIE5vV2ViV29ya2VyO1xuICAgICAgICB9KCkpO1xuICAgIH1cbiAgICB2YXIgV2ViV29ya2VyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgICAgICBfX2V4dGVuZHMoV2ViV29ya2VyLCBfc3VwZXIpO1xuICAgICAgICBmdW5jdGlvbiBXZWJXb3JrZXIodXJsLCBvcHRpb25zKSB7XG4gICAgICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB1cmwgPT09IFwic3RyaW5nXCIgJiYgb3B0aW9ucyAmJiBvcHRpb25zLl9iYXNlVVJMKSB7XG4gICAgICAgICAgICAgICAgdXJsID0gbmV3IFVSTCh1cmwsIG9wdGlvbnMuX2Jhc2VVUkwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHVybCA9PT0gXCJzdHJpbmdcIiAmJiAhaXNBYnNvbHV0ZVVSTCh1cmwpICYmICgwLCBnZXRfYnVuZGxlX3VybF9icm93c2VyXzEuZ2V0QnVuZGxlVVJMKSgpLm1hdGNoKC9eZmlsZTpcXC9cXC8vaSkpIHtcbiAgICAgICAgICAgICAgICB1cmwgPSBuZXcgVVJMKHVybCwgKDAsIGdldF9idW5kbGVfdXJsX2Jyb3dzZXJfMS5nZXRCdW5kbGVVUkwpKCkucmVwbGFjZSgvXFwvW15cXC9dKyQvLCBcIi9cIikpO1xuICAgICAgICAgICAgICAgIGlmICgoX2EgPSBvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMuQ09SU1dvcmthcm91bmQpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsID0gY3JlYXRlU291cmNlQmxvYlVSTChcImltcG9ydFNjcmlwdHMoXCIuY29uY2F0KEpTT04uc3RyaW5naWZ5KHVybCksIFwiKTtcIikpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0eXBlb2YgdXJsID09PSBcInN0cmluZ1wiICYmIGlzQWJzb2x1dGVVUkwodXJsKSkge1xuICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBzb3VyY2UgY29kZSBibG9iIGxvYWRpbmcgSlMgZmlsZSB2aWEgYGltcG9ydFNjcmlwdHMoKWBcbiAgICAgICAgICAgICAgICAvLyB0byBjaXJjdW12ZW50IHdvcmtlciBDT1JTIHJlc3RyaWN0aW9uc1xuICAgICAgICAgICAgICAgIGlmICgoX2IgPSBvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMuQ09SU1dvcmthcm91bmQpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsID0gY3JlYXRlU291cmNlQmxvYlVSTChcImltcG9ydFNjcmlwdHMoXCIuY29uY2F0KEpTT04uc3RyaW5naWZ5KHVybCksIFwiKTtcIikpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBfc3VwZXIuY2FsbCh0aGlzLCB1cmwsIG9wdGlvbnMpIHx8IHRoaXM7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFdlYldvcmtlcjtcbiAgICB9KFdvcmtlcikpO1xuICAgIHZhciBCbG9iV29ya2VyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgICAgICBfX2V4dGVuZHMoQmxvYldvcmtlciwgX3N1cGVyKTtcbiAgICAgICAgZnVuY3Rpb24gQmxvYldvcmtlcihibG9iLCBvcHRpb25zKSB7XG4gICAgICAgICAgICB2YXIgdXJsID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG4gICAgICAgICAgICByZXR1cm4gX3N1cGVyLmNhbGwodGhpcywgdXJsLCBvcHRpb25zKSB8fCB0aGlzO1xuICAgICAgICB9XG4gICAgICAgIEJsb2JXb3JrZXIuZnJvbVRleHQgPSBmdW5jdGlvbiAoc291cmNlLCBvcHRpb25zKSB7XG4gICAgICAgICAgICB2YXIgYmxvYiA9IG5ldyB3aW5kb3cuQmxvYihbc291cmNlXSwgeyB0eXBlOiBcInRleHQvamF2YXNjcmlwdFwiIH0pO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBCbG9iV29ya2VyKGJsb2IsIG9wdGlvbnMpO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gQmxvYldvcmtlcjtcbiAgICB9KFdlYldvcmtlcikpO1xuICAgIHJldHVybiB7XG4gICAgICAgIGJsb2I6IEJsb2JXb3JrZXIsXG4gICAgICAgIGRlZmF1bHQ6IFdlYldvcmtlclxuICAgIH07XG59XG52YXIgaW1wbGVtZW50YXRpb247XG5mdW5jdGlvbiBnZXRXb3JrZXJJbXBsZW1lbnRhdGlvbigpIHtcbiAgICBpZiAoIWltcGxlbWVudGF0aW9uKSB7XG4gICAgICAgIGltcGxlbWVudGF0aW9uID0gc2VsZWN0V29ya2VySW1wbGVtZW50YXRpb24oKTtcbiAgICB9XG4gICAgcmV0dXJuIGltcGxlbWVudGF0aW9uO1xufVxuZXhwb3J0cy5nZXRXb3JrZXJJbXBsZW1lbnRhdGlvbiA9IGdldFdvcmtlckltcGxlbWVudGF0aW9uO1xuZnVuY3Rpb24gaXNXb3JrZXJSdW50aW1lKCkge1xuICAgIHZhciBpc1dpbmRvd0NvbnRleHQgPSB0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YgV2luZG93ICE9PSBcInVuZGVmaW5lZFwiICYmIHNlbGYgaW5zdGFuY2VvZiBXaW5kb3c7XG4gICAgcmV0dXJuIHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiICYmIHNlbGYucG9zdE1lc3NhZ2UgJiYgIWlzV2luZG93Q29udGV4dCA/IHRydWUgOiBmYWxzZTtcbn1cbmV4cG9ydHMuaXNXb3JrZXJSdW50aW1lID0gaXNXb3JrZXJSdW50aW1lO1xuXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8vaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS9tYXN0ZXIvaW1wbGVtZW50YXRpb24uYnJvd3Nlci5qcz8iKTsKCi8qKiovIH0pLAoKLyoqKi8gIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS90aHJlYWRzQDEuNy4wL25vZGVfbW9kdWxlcy90aHJlYWRzL2Rpc3QtZXNtL21hc3Rlci9pbmRleC5qcyI6Ci8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqISpcCiAgISoqKiAvaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS9tYXN0ZXIvaW5kZXguanMgKioqIQogIFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKZXZhbCgiXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLldvcmtlciA9IGV4cG9ydHMuQmxvYldvcmtlciA9IGV4cG9ydHMuaXNXb3JrZXJSdW50aW1lID0gZXhwb3J0cy5UaHJlYWQgPSBleHBvcnRzLnNwYXduID0gZXhwb3J0cy5Qb29sID0gdm9pZCAwO1xudmFyIGltcGxlbWVudGF0aW9uXzEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL2ltcGxlbWVudGF0aW9uICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vbWFzdGVyL2ltcGxlbWVudGF0aW9uLmJyb3dzZXIuanNcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJpc1dvcmtlclJ1bnRpbWVcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGltcGxlbWVudGF0aW9uXzEuaXNXb3JrZXJSdW50aW1lOyB9IH0pO1xudmFyIHBvb2xfMSA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vcG9vbCAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS90aHJlYWRzQDEuNy4wL25vZGVfbW9kdWxlcy90aHJlYWRzL2Rpc3QtZXNtL21hc3Rlci9wb29sLmpzXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiUG9vbFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gcG9vbF8xLlBvb2w7IH0gfSk7XG52YXIgc3Bhd25fMSA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vc3Bhd24gKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS9tYXN0ZXIvc3Bhd24uanNcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJzcGF3blwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gc3Bhd25fMS5zcGF3bjsgfSB9KTtcbnZhciB0aHJlYWRfMSA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vdGhyZWFkICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vbWFzdGVyL3RocmVhZC5qc1wiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIlRocmVhZFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhyZWFkXzEuVGhyZWFkOyB9IH0pO1xuLyoqIFNlcGFyYXRlIGNsYXNzIHRvIHNwYXduIHdvcmtlcnMgZnJvbSBzb3VyY2UgY29kZSBibG9icyBvciBzdHJpbmdzLiAqL1xuZXhwb3J0cy5CbG9iV29ya2VyID0gKDAsIGltcGxlbWVudGF0aW9uXzEuZ2V0V29ya2VySW1wbGVtZW50YXRpb24pKCkuYmxvYjtcbi8qKiBXb3JrZXIgaW1wbGVtZW50YXRpb24uIEVpdGhlciB3ZWIgd29ya2VyIG9yIGEgbm9kZS5qcyBXb3JrZXIgY2xhc3MuICovXG5leHBvcnRzLldvcmtlciA9ICgwLCBpbXBsZW1lbnRhdGlvbl8xLmdldFdvcmtlckltcGxlbWVudGF0aW9uKSgpLmRlZmF1bHQ7XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS90aHJlYWRzQDEuNy4wL25vZGVfbW9kdWxlcy90aHJlYWRzL2Rpc3QtZXNtL21hc3Rlci9pbmRleC5qcz8iKTsKCi8qKiovIH0pLAoKLyoqKi8gIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS90aHJlYWRzQDEuNy4wL25vZGVfbW9kdWxlcy90aHJlYWRzL2Rpc3QtZXNtL21hc3Rlci9pbnZvY2F0aW9uLXByb3h5LmpzIjoKLyohKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiEqXAogICEqKiogL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vbWFzdGVyL2ludm9jYXRpb24tcHJveHkuanMgKioqIQogIFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKiEgbm8gc3RhdGljIGV4cG9ydHMgZm91bmQgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwpldmFsKCJcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuY3JlYXRlUHJveHlNb2R1bGUgPSBleHBvcnRzLmNyZWF0ZVByb3h5RnVuY3Rpb24gPSB2b2lkIDA7XG4vKlxuICogVGhpcyBzb3VyY2UgZmlsZSBjb250YWlucyB0aGUgY29kZSBmb3IgcHJveHlpbmcgY2FsbHMgaW4gdGhlIG1hc3RlciB0aHJlYWQgdG8gY2FsbHMgaW4gdGhlIHdvcmtlcnNcbiAqIGJ5IGAucG9zdE1lc3NhZ2UoKWAtaW5nLlxuICpcbiAqIEtlZXAgaW4gbWluZCB0aGF0IHRoaXMgY29kZSBjYW4gbWFrZSBvciBicmVhayB0aGUgcHJvZ3JhbSdzIHBlcmZvcm1hbmNlISBOZWVkIHRvIG9wdGltaXplIG1vcmXigKZcbiAqL1xudmFyIGRlYnVnXzEgPSBfX2ltcG9ydERlZmF1bHQoX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgZGVidWcgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vZGVidWdANC4zLjQvbm9kZV9tb2R1bGVzL2RlYnVnL3NyYy9icm93c2VyLmpzXCIpKTtcbnZhciBvYnNlcnZhYmxlX2Zuc18xID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgb2JzZXJ2YWJsZS1mbnMgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vb2JzZXJ2YWJsZS1mbnNAMC42LjEvbm9kZV9tb2R1bGVzL29ic2VydmFibGUtZm5zL2Rpc3QuZXNtL2luZGV4LmpzXCIpO1xudmFyIGNvbW1vbl8xID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi4vY29tbW9uICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vY29tbW9uLmpzXCIpO1xudmFyIG9ic2VydmFibGVfcHJvbWlzZV8xID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi4vb2JzZXJ2YWJsZS1wcm9taXNlICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vb2JzZXJ2YWJsZS1wcm9taXNlLmpzXCIpO1xudmFyIHRyYW5zZmVyYWJsZV8xID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi4vdHJhbnNmZXJhYmxlICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vdHJhbnNmZXJhYmxlLmpzXCIpO1xudmFyIG1lc3NhZ2VzXzEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuLi90eXBlcy9tZXNzYWdlcyAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS90aHJlYWRzQDEuNy4wL25vZGVfbW9kdWxlcy90aHJlYWRzL2Rpc3QtZXNtL3R5cGVzL21lc3NhZ2VzLmpzXCIpO1xudmFyIGRlYnVnTWVzc2FnZXMgPSAoMCwgZGVidWdfMS5kZWZhdWx0KShcInRocmVhZHM6bWFzdGVyOm1lc3NhZ2VzXCIpO1xudmFyIG5leHRKb2JVSUQgPSAxO1xudmFyIGRlZHVwZSA9IGZ1bmN0aW9uIChhcnJheSkgeyByZXR1cm4gQXJyYXkuZnJvbShuZXcgU2V0KGFycmF5KSk7IH07XG52YXIgaXNKb2JFcnJvck1lc3NhZ2UgPSBmdW5jdGlvbiAoZGF0YSkgeyByZXR1cm4gZGF0YSAmJiBkYXRhLnR5cGUgPT09IG1lc3NhZ2VzXzEuV29ya2VyTWVzc2FnZVR5cGUuZXJyb3I7IH07XG52YXIgaXNKb2JSZXN1bHRNZXNzYWdlID0gZnVuY3Rpb24gKGRhdGEpIHsgcmV0dXJuIGRhdGEgJiYgZGF0YS50eXBlID09PSBtZXNzYWdlc18xLldvcmtlck1lc3NhZ2VUeXBlLnJlc3VsdDsgfTtcbnZhciBpc0pvYlN0YXJ0TWVzc2FnZSA9IGZ1bmN0aW9uIChkYXRhKSB7IHJldHVybiBkYXRhICYmIGRhdGEudHlwZSA9PT0gbWVzc2FnZXNfMS5Xb3JrZXJNZXNzYWdlVHlwZS5ydW5uaW5nOyB9O1xuZnVuY3Rpb24gY3JlYXRlT2JzZXJ2YWJsZUZvckpvYih3b3JrZXIsIGpvYlVJRCkge1xuICAgIHJldHVybiBuZXcgb2JzZXJ2YWJsZV9mbnNfMS5PYnNlcnZhYmxlKGZ1bmN0aW9uIChvYnNlcnZlcikge1xuICAgICAgICB2YXIgYXN5bmNUeXBlO1xuICAgICAgICB2YXIgbWVzc2FnZUhhbmRsZXIgPSAoZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICBkZWJ1Z01lc3NhZ2VzKFwiTWVzc2FnZSBmcm9tIHdvcmtlcjpcIiwgZXZlbnQuZGF0YSk7XG4gICAgICAgICAgICBpZiAoIWV2ZW50LmRhdGEgfHwgZXZlbnQuZGF0YS51aWQgIT09IGpvYlVJRClcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBpZiAoaXNKb2JTdGFydE1lc3NhZ2UoZXZlbnQuZGF0YSkpIHtcbiAgICAgICAgICAgICAgICBhc3luY1R5cGUgPSBldmVudC5kYXRhLnJlc3VsdFR5cGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChpc0pvYlJlc3VsdE1lc3NhZ2UoZXZlbnQuZGF0YSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoYXN5bmNUeXBlID09PSBcInByb21pc2VcIikge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGV2ZW50LmRhdGEucGF5bG9hZCAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dCgoMCwgY29tbW9uXzEuZGVzZXJpYWxpemUpKGV2ZW50LmRhdGEucGF5bG9hZCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgICAgICAgICAgICAgIHdvcmtlci5yZW1vdmVFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLCBtZXNzYWdlSGFuZGxlcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQuZGF0YS5wYXlsb2FkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5uZXh0KCgwLCBjb21tb25fMS5kZXNlcmlhbGl6ZSkoZXZlbnQuZGF0YS5wYXlsb2FkKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmRhdGEuY29tcGxldGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB3b3JrZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgbWVzc2FnZUhhbmRsZXIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoaXNKb2JFcnJvck1lc3NhZ2UoZXZlbnQuZGF0YSkpIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSAoMCwgY29tbW9uXzEuZGVzZXJpYWxpemUpKGV2ZW50LmRhdGEuZXJyb3IpO1xuICAgICAgICAgICAgICAgIGlmIChhc3luY1R5cGUgPT09IFwicHJvbWlzZVwiIHx8ICFhc3luY1R5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB3b3JrZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgbWVzc2FnZUhhbmRsZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgd29ya2VyLmFkZEV2ZW50TGlzdGVuZXIoXCJtZXNzYWdlXCIsIG1lc3NhZ2VIYW5kbGVyKTtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmIChhc3luY1R5cGUgPT09IFwib2JzZXJ2YWJsZVwiIHx8ICFhc3luY1R5cGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgY2FuY2VsTWVzc2FnZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogbWVzc2FnZXNfMS5NYXN0ZXJNZXNzYWdlVHlwZS5jYW5jZWwsXG4gICAgICAgICAgICAgICAgICAgIHVpZDogam9iVUlEXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB3b3JrZXIucG9zdE1lc3NhZ2UoY2FuY2VsTWVzc2FnZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB3b3JrZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgbWVzc2FnZUhhbmRsZXIpO1xuICAgICAgICB9O1xuICAgIH0pO1xufVxuZnVuY3Rpb24gcHJlcGFyZUFyZ3VtZW50cyhyYXdBcmdzKSB7XG4gICAgaWYgKHJhd0FyZ3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIC8vIEV4aXQgZWFybHkgaWYgcG9zc2libGVcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGFyZ3M6IFtdLFxuICAgICAgICAgICAgdHJhbnNmZXJhYmxlczogW11cbiAgICAgICAgfTtcbiAgICB9XG4gICAgdmFyIGFyZ3MgPSBbXTtcbiAgICB2YXIgdHJhbnNmZXJhYmxlcyA9IFtdO1xuICAgIGZvciAodmFyIF9pID0gMCwgcmF3QXJnc18xID0gcmF3QXJnczsgX2kgPCByYXdBcmdzXzEubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgIHZhciBhcmcgPSByYXdBcmdzXzFbX2ldO1xuICAgICAgICBpZiAoKDAsIHRyYW5zZmVyYWJsZV8xLmlzVHJhbnNmZXJEZXNjcmlwdG9yKShhcmcpKSB7XG4gICAgICAgICAgICBhcmdzLnB1c2goKDAsIGNvbW1vbl8xLnNlcmlhbGl6ZSkoYXJnLnNlbmQpKTtcbiAgICAgICAgICAgIHRyYW5zZmVyYWJsZXMucHVzaC5hcHBseSh0cmFuc2ZlcmFibGVzLCBhcmcudHJhbnNmZXJhYmxlcyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBhcmdzLnB1c2goKDAsIGNvbW1vbl8xLnNlcmlhbGl6ZSkoYXJnKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgYXJnczogYXJncyxcbiAgICAgICAgdHJhbnNmZXJhYmxlczogdHJhbnNmZXJhYmxlcy5sZW5ndGggPT09IDAgPyB0cmFuc2ZlcmFibGVzIDogZGVkdXBlKHRyYW5zZmVyYWJsZXMpXG4gICAgfTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZVByb3h5RnVuY3Rpb24od29ya2VyLCBtZXRob2QpIHtcbiAgICByZXR1cm4gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHJhd0FyZ3MgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgIHJhd0FyZ3NbX2ldID0gYXJndW1lbnRzW19pXTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgdWlkID0gbmV4dEpvYlVJRCsrO1xuICAgICAgICB2YXIgX2EgPSBwcmVwYXJlQXJndW1lbnRzKHJhd0FyZ3MpLCBhcmdzID0gX2EuYXJncywgdHJhbnNmZXJhYmxlcyA9IF9hLnRyYW5zZmVyYWJsZXM7XG4gICAgICAgIHZhciBydW5NZXNzYWdlID0ge1xuICAgICAgICAgICAgdHlwZTogbWVzc2FnZXNfMS5NYXN0ZXJNZXNzYWdlVHlwZS5ydW4sXG4gICAgICAgICAgICB1aWQ6IHVpZCxcbiAgICAgICAgICAgIG1ldGhvZDogbWV0aG9kLFxuICAgICAgICAgICAgYXJnczogYXJnc1xuICAgICAgICB9O1xuICAgICAgICBkZWJ1Z01lc3NhZ2VzKFwiU2VuZGluZyBjb21tYW5kIHRvIHJ1biBmdW5jdGlvbiB0byB3b3JrZXI6XCIsIHJ1bk1lc3NhZ2UpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgd29ya2VyLnBvc3RNZXNzYWdlKHJ1bk1lc3NhZ2UsIHRyYW5zZmVyYWJsZXMpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgcmV0dXJuIG9ic2VydmFibGVfcHJvbWlzZV8xLk9ic2VydmFibGVQcm9taXNlLmZyb20oUHJvbWlzZS5yZWplY3QoZXJyb3IpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb2JzZXJ2YWJsZV9wcm9taXNlXzEuT2JzZXJ2YWJsZVByb21pc2UuZnJvbSgoMCwgb2JzZXJ2YWJsZV9mbnNfMS5tdWx0aWNhc3QpKGNyZWF0ZU9ic2VydmFibGVGb3JKb2Iod29ya2VyLCB1aWQpKSk7XG4gICAgfSk7XG59XG5leHBvcnRzLmNyZWF0ZVByb3h5RnVuY3Rpb24gPSBjcmVhdGVQcm94eUZ1bmN0aW9uO1xuZnVuY3Rpb24gY3JlYXRlUHJveHlNb2R1bGUod29ya2VyLCBtZXRob2ROYW1lcykge1xuICAgIHZhciBwcm94eSA9IHt9O1xuICAgIGZvciAodmFyIF9pID0gMCwgbWV0aG9kTmFtZXNfMSA9IG1ldGhvZE5hbWVzOyBfaSA8IG1ldGhvZE5hbWVzXzEubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgIHZhciBtZXRob2ROYW1lID0gbWV0aG9kTmFtZXNfMVtfaV07XG4gICAgICAgIHByb3h5W21ldGhvZE5hbWVdID0gY3JlYXRlUHJveHlGdW5jdGlvbih3b3JrZXIsIG1ldGhvZE5hbWUpO1xuICAgIH1cbiAgICByZXR1cm4gcHJveHk7XG59XG5leHBvcnRzLmNyZWF0ZVByb3h5TW9kdWxlID0gY3JlYXRlUHJveHlNb2R1bGU7XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS90aHJlYWRzQDEuNy4wL25vZGVfbW9kdWxlcy90aHJlYWRzL2Rpc3QtZXNtL21hc3Rlci9pbnZvY2F0aW9uLXByb3h5LmpzPyIpOwoKLyoqKi8gfSksCgovKioqLyAiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vbWFzdGVyL3Bvb2wtdHlwZXMuanMiOgovKiEqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqISpcCiAgISoqKiAvaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS9tYXN0ZXIvcG9vbC10eXBlcy5qcyAqKiohCiAgXCoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CmV2YWwoIlxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5Qb29sRXZlbnRUeXBlID0gdm9pZCAwO1xuKGZ1bmN0aW9uIChQb29sRXZlbnRUeXBlKSB7XG4gICAgUG9vbEV2ZW50VHlwZVtcImluaXRpYWxpemVkXCJdID0gXCJpbml0aWFsaXplZFwiO1xuICAgIFBvb2xFdmVudFR5cGVbXCJ0YXNrQ2FuY2VsZWRcIl0gPSBcInRhc2tDYW5jZWxlZFwiO1xuICAgIFBvb2xFdmVudFR5cGVbXCJ0YXNrQ29tcGxldGVkXCJdID0gXCJ0YXNrQ29tcGxldGVkXCI7XG4gICAgUG9vbEV2ZW50VHlwZVtcInRhc2tGYWlsZWRcIl0gPSBcInRhc2tGYWlsZWRcIjtcbiAgICBQb29sRXZlbnRUeXBlW1widGFza1F1ZXVlZFwiXSA9IFwidGFza1F1ZXVlZFwiO1xuICAgIFBvb2xFdmVudFR5cGVbXCJ0YXNrUXVldWVEcmFpbmVkXCJdID0gXCJ0YXNrUXVldWVEcmFpbmVkXCI7XG4gICAgUG9vbEV2ZW50VHlwZVtcInRhc2tTdGFydFwiXSA9IFwidGFza1N0YXJ0XCI7XG4gICAgUG9vbEV2ZW50VHlwZVtcInRlcm1pbmF0ZWRcIl0gPSBcInRlcm1pbmF0ZWRcIjtcbn0pKGV4cG9ydHMuUG9vbEV2ZW50VHlwZSB8fCAoZXhwb3J0cy5Qb29sRXZlbnRUeXBlID0ge30pKTtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vbWFzdGVyL3Bvb2wtdHlwZXMuanM/Iik7CgovKioqLyB9KSwKCi8qKiovICIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS9tYXN0ZXIvcG9vbC5qcyI6Ci8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlwKICAhKioqIC9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS90aHJlYWRzQDEuNy4wL25vZGVfbW9kdWxlcy90aHJlYWRzL2Rpc3QtZXNtL21hc3Rlci9wb29sLmpzICoqKiEKICBcKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKZXZhbCgiXG52YXIgX19nZW5lcmF0b3IgPSAodGhpcyAmJiB0aGlzLl9fZ2VuZXJhdG9yKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgYm9keSkge1xuICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGc7XG4gICAgcmV0dXJuIGcgPSB7IG5leHQ6IHZlcmIoMCksIFwidGhyb3dcIjogdmVyYigxKSwgXCJyZXR1cm5cIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7XG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IHJldHVybiBmdW5jdGlvbiAodikgeyByZXR1cm4gc3RlcChbbiwgdl0pOyB9OyB9XG4gICAgZnVuY3Rpb24gc3RlcChvcCkge1xuICAgICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XG4gICAgICAgIHdoaWxlIChfKSB0cnkge1xuICAgICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0gb3BbMF0gJiAyID8geVtcInJldHVyblwiXSA6IG9wWzBdID8geVtcInRocm93XCJdIHx8ICgodCA9IHlbXCJyZXR1cm5cIl0pICYmIHQuY2FsbCh5KSwgMCkgOiB5Lm5leHQpICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0O1xuICAgICAgICAgICAgaWYgKHkgPSAwLCB0KSBvcCA9IFtvcFswXSAmIDIsIHQudmFsdWVdO1xuICAgICAgICAgICAgc3dpdGNoIChvcFswXSkge1xuICAgICAgICAgICAgICAgIGNhc2UgMDogY2FzZSAxOiB0ID0gb3A7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNDogXy5sYWJlbCsrOyByZXR1cm4geyB2YWx1ZTogb3BbMV0sIGRvbmU6IGZhbHNlIH07XG4gICAgICAgICAgICAgICAgY2FzZSA1OiBfLmxhYmVsKys7IHkgPSBvcFsxXTsgb3AgPSBbMF07IGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIGNhc2UgNzogb3AgPSBfLm9wcy5wb3AoKTsgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBpZiAoISh0ID0gXy50cnlzLCB0ID0gdC5sZW5ndGggPiAwICYmIHRbdC5sZW5ndGggLSAxXSkgJiYgKG9wWzBdID09PSA2IHx8IG9wWzBdID09PSAyKSkgeyBfID0gMDsgY29udGludWU7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCAob3BbMV0gPiB0WzBdICYmIG9wWzFdIDwgdFszXSkpKSB7IF8ubGFiZWwgPSBvcFsxXTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7IF8ubGFiZWwgPSB0WzFdOyB0ID0gb3A7IGJyZWFrOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIF8ubGFiZWwgPCB0WzJdKSB7IF8ubGFiZWwgPSB0WzJdOyBfLm9wcy5wdXNoKG9wKTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRbMl0pIF8ub3BzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3AgPSBib2R5LmNhbGwodGhpc0FyZywgXyk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgb3AgPSBbNiwgZV07IHkgPSAwOyB9IGZpbmFsbHkgeyBmID0gdCA9IDA7IH1cbiAgICAgICAgaWYgKG9wWzBdICYgNSkgdGhyb3cgb3BbMV07IHJldHVybiB7IHZhbHVlOiBvcFswXSA/IG9wWzFdIDogdm9pZCAwLCBkb25lOiB0cnVlIH07XG4gICAgfVxufTtcbnZhciBfX3NwcmVhZEFycmF5ID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5KSB8fCBmdW5jdGlvbiAodG8sIGZyb20sIHBhY2spIHtcbiAgICBpZiAocGFjayB8fCBhcmd1bWVudHMubGVuZ3RoID09PSAyKSBmb3IgKHZhciBpID0gMCwgbCA9IGZyb20ubGVuZ3RoLCBhcjsgaSA8IGw7IGkrKykge1xuICAgICAgICBpZiAoYXIgfHwgIShpIGluIGZyb20pKSB7XG4gICAgICAgICAgICBpZiAoIWFyKSBhciA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGZyb20sIDAsIGkpO1xuICAgICAgICAgICAgYXJbaV0gPSBmcm9tW2ldO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0by5jb25jYXQoYXIgfHwgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZnJvbSkpO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuUG9vbCA9IGV4cG9ydHMuVGhyZWFkID0gZXhwb3J0cy5Qb29sRXZlbnRUeXBlID0gdm9pZCAwO1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkge1xuICAgICAgICAgICAgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgIH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkge1xuICAgICAgICAgICAgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgIH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIGRlYnVnXzEgPSBfX2ltcG9ydERlZmF1bHQoX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgZGVidWcgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vZGVidWdANC4zLjQvbm9kZV9tb2R1bGVzL2RlYnVnL3NyYy9icm93c2VyLmpzXCIpKTtcbnZhciBvYnNlcnZhYmxlX2Zuc18xID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgb2JzZXJ2YWJsZS1mbnMgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vb2JzZXJ2YWJsZS1mbnNAMC42LjEvbm9kZV9tb2R1bGVzL29ic2VydmFibGUtZm5zL2Rpc3QuZXNtL2luZGV4LmpzXCIpO1xudmFyIHBvbnlmaWxsc18xID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi4vcG9ueWZpbGxzICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vcG9ueWZpbGxzLmpzXCIpO1xudmFyIGltcGxlbWVudGF0aW9uXzEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL2ltcGxlbWVudGF0aW9uICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vbWFzdGVyL2ltcGxlbWVudGF0aW9uLmJyb3dzZXIuanNcIik7XG52YXIgcG9vbF90eXBlc18xID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9wb29sLXR5cGVzICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vbWFzdGVyL3Bvb2wtdHlwZXMuanNcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJQb29sRXZlbnRUeXBlXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBwb29sX3R5cGVzXzEuUG9vbEV2ZW50VHlwZTsgfSB9KTtcbnZhciB0aHJlYWRfMSA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vdGhyZWFkICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vbWFzdGVyL3RocmVhZC5qc1wiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIlRocmVhZFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhyZWFkXzEuVGhyZWFkOyB9IH0pO1xudmFyIG5leHRQb29sSUQgPSAxO1xuZnVuY3Rpb24gY3JlYXRlQXJyYXkoc2l6ZSkge1xuICAgIHZhciBhcnJheSA9IFtdO1xuICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCBzaXplOyBpbmRleCsrKSB7XG4gICAgICAgIGFycmF5LnB1c2goaW5kZXgpO1xuICAgIH1cbiAgICByZXR1cm4gYXJyYXk7XG59XG5mdW5jdGlvbiBkZWxheShtcykge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXR1cm4gc2V0VGltZW91dChyZXNvbHZlLCBtcyk7IH0pO1xufVxuZnVuY3Rpb24gZmxhdE1hcChhcnJheSwgbWFwcGVyKSB7XG4gICAgcmV0dXJuIGFycmF5LnJlZHVjZShmdW5jdGlvbiAoZmxhdHRlbmVkLCBlbGVtZW50KSB7IHJldHVybiBfX3NwcmVhZEFycmF5KF9fc3ByZWFkQXJyYXkoW10sIGZsYXR0ZW5lZCwgdHJ1ZSksIG1hcHBlcihlbGVtZW50KSwgdHJ1ZSk7IH0sIFtdKTtcbn1cbmZ1bmN0aW9uIHNsdWdpZnkodGV4dCkge1xuICAgIHJldHVybiB0ZXh0LnJlcGxhY2UoL1xcVy9nLCBcIiBcIikudHJpbSgpLnJlcGxhY2UoL1xccysvZywgXCItXCIpO1xufVxuZnVuY3Rpb24gc3Bhd25Xb3JrZXJzKHNwYXduV29ya2VyLCBjb3VudCkge1xuICAgIHJldHVybiBjcmVhdGVBcnJheShjb3VudCkubWFwKGZ1bmN0aW9uICgpIHsgcmV0dXJuICh7XG4gICAgICAgIGluaXQ6IHNwYXduV29ya2VyKCksXG4gICAgICAgIHJ1bm5pbmdUYXNrczogW11cbiAgICB9KTsgfSk7XG59XG52YXIgV29ya2VyUG9vbCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBXb3JrZXJQb29sKHNwYXduV29ya2VyLCBvcHRpb25zT3JTaXplKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuZXZlbnRTdWJqZWN0ID0gbmV3IG9ic2VydmFibGVfZm5zXzEuU3ViamVjdCgpO1xuICAgICAgICB0aGlzLmluaXRFcnJvcnMgPSBbXTtcbiAgICAgICAgdGhpcy5pc0Nsb3NpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5uZXh0VGFza0lEID0gMTtcbiAgICAgICAgdGhpcy50YXNrUXVldWUgPSBbXTtcbiAgICAgICAgdmFyIG9wdGlvbnMgPSB0eXBlb2Ygb3B0aW9uc09yU2l6ZSA9PT0gXCJudW1iZXJcIlxuICAgICAgICAgICAgPyB7IHNpemU6IG9wdGlvbnNPclNpemUgfVxuICAgICAgICAgICAgOiBvcHRpb25zT3JTaXplIHx8IHt9O1xuICAgICAgICB2YXIgX2EgPSBvcHRpb25zLnNpemUsIHNpemUgPSBfYSA9PT0gdm9pZCAwID8gaW1wbGVtZW50YXRpb25fMS5kZWZhdWx0UG9vbFNpemUgOiBfYTtcbiAgICAgICAgdGhpcy5kZWJ1ZyA9ICgwLCBkZWJ1Z18xLmRlZmF1bHQpKFwidGhyZWFkczpwb29sOlwiLmNvbmNhdChzbHVnaWZ5KG9wdGlvbnMubmFtZSB8fCBTdHJpbmcobmV4dFBvb2xJRCsrKSkpKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICAgICAgdGhpcy53b3JrZXJzID0gc3Bhd25Xb3JrZXJzKHNwYXduV29ya2VyLCBzaXplKTtcbiAgICAgICAgdGhpcy5ldmVudE9ic2VydmFibGUgPSAoMCwgb2JzZXJ2YWJsZV9mbnNfMS5tdWx0aWNhc3QpKG9ic2VydmFibGVfZm5zXzEuT2JzZXJ2YWJsZS5mcm9tKHRoaXMuZXZlbnRTdWJqZWN0KSk7XG4gICAgICAgIFByb21pc2UuYWxsKHRoaXMud29ya2Vycy5tYXAoZnVuY3Rpb24gKHdvcmtlcikgeyByZXR1cm4gd29ya2VyLmluaXQ7IH0pKS50aGVuKGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLmV2ZW50U3ViamVjdC5uZXh0KHtcbiAgICAgICAgICAgIHR5cGU6IHBvb2xfdHlwZXNfMS5Qb29sRXZlbnRUeXBlLmluaXRpYWxpemVkLFxuICAgICAgICAgICAgc2l6ZTogX3RoaXMud29ya2Vycy5sZW5ndGhcbiAgICAgICAgfSk7IH0sIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgX3RoaXMuZGVidWcoXCJFcnJvciB3aGlsZSBpbml0aWFsaXppbmcgcG9vbCB3b3JrZXI6XCIsIGVycm9yKTtcbiAgICAgICAgICAgIF90aGlzLmV2ZW50U3ViamVjdC5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICBfdGhpcy5pbml0RXJyb3JzLnB1c2goZXJyb3IpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgV29ya2VyUG9vbC5wcm90b3R5cGUuZmluZElkbGluZ1dvcmtlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF9hID0gdGhpcy5vcHRpb25zLmNvbmN1cnJlbmN5LCBjb25jdXJyZW5jeSA9IF9hID09PSB2b2lkIDAgPyAxIDogX2E7XG4gICAgICAgIHJldHVybiB0aGlzLndvcmtlcnMuZmluZChmdW5jdGlvbiAod29ya2VyKSB7IHJldHVybiB3b3JrZXIucnVubmluZ1Rhc2tzLmxlbmd0aCA8IGNvbmN1cnJlbmN5OyB9KTtcbiAgICB9O1xuICAgIFdvcmtlclBvb2wucHJvdG90eXBlLnJ1blBvb2xUYXNrID0gZnVuY3Rpb24gKHdvcmtlciwgdGFzaykge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgd29ya2VySUQsIHJldHVyblZhbHVlLCBfYSwgX2IsIGVycm9yXzE7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9jKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChfYy5sYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICB3b3JrZXJJRCA9IHRoaXMud29ya2Vycy5pbmRleE9mKHdvcmtlcikgKyAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWJ1ZyhcIlJ1bm5pbmcgdGFzayAjXCIuY29uY2F0KHRhc2suaWQsIFwiIG9uIHdvcmtlciAjXCIpLmNvbmNhdCh3b3JrZXJJRCwgXCIuLi5cIikpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ldmVudFN1YmplY3QubmV4dCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogcG9vbF90eXBlc18xLlBvb2xFdmVudFR5cGUudGFza1N0YXJ0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tJRDogdGFzay5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JrZXJJRDogd29ya2VySURcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgX2MubGFiZWwgPSAxO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYy50cnlzLnB1c2goWzEsIDQsICwgNV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgX2IgPSAoX2EgPSB0YXNrKS5ydW47XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB3b3JrZXIuaW5pdF07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjogcmV0dXJuIFs0IC8qeWllbGQqLywgX2IuYXBwbHkoX2EsIFtfYy5zZW50KCldKV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gX2Muc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWJ1ZyhcIlRhc2sgI1wiLmNvbmNhdCh0YXNrLmlkLCBcIiBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5XCIpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXZlbnRTdWJqZWN0Lm5leHQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHBvb2xfdHlwZXNfMS5Qb29sRXZlbnRUeXBlLnRhc2tDb21wbGV0ZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsdWU6IHJldHVyblZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tJRDogdGFzay5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JrZXJJRDogd29ya2VySURcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgNV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yXzEgPSBfYy5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRlYnVnKFwiVGFzayAjXCIuY29uY2F0KHRhc2suaWQsIFwiIGZhaWxlZFwiKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmV2ZW50U3ViamVjdC5uZXh0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBwb29sX3R5cGVzXzEuUG9vbEV2ZW50VHlwZS50YXNrRmFpbGVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tJRDogdGFzay5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogZXJyb3JfMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JrZXJJRDogd29ya2VySURcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgNV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNTogcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFdvcmtlclBvb2wucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uICh3b3JrZXIsIHRhc2spIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHJ1blByb21pc2U7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHJ1blByb21pc2UgPSAoZnVuY3Rpb24gKCkgeyByZXR1cm4gX19hd2FpdGVyKF90aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmVtb3ZlVGFza0Zyb21Xb3JrZXJzUnVubmluZ1Rhc2tzO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVUYXNrRnJvbVdvcmtlcnNSdW5uaW5nVGFza3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JrZXIucnVubmluZ1Rhc2tzID0gd29ya2VyLnJ1bm5pbmdUYXNrcy5maWx0ZXIoZnVuY3Rpb24gKHNvbWVSdW5Qcm9taXNlKSB7IHJldHVybiBzb21lUnVuUHJvbWlzZSAhPT0gcnVuUHJvbWlzZTsgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIERlZmVyIHRhc2sgZXhlY3V0aW9uIGJ5IG9uZSB0aWNrIHRvIGdpdmUgaGFuZGxlcnMgdGltZSB0byBzdWJzY3JpYmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgZGVsYXkoMCldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGVmZXIgdGFzayBleGVjdXRpb24gYnkgb25lIHRpY2sgdG8gZ2l2ZSBoYW5kbGVycyB0aW1lIHRvIHN1YnNjcmliZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9hLmxhYmVsID0gMjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9hLnRyeXMucHVzaChbMiwgLCA0LCA1XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHRoaXMucnVuUG9vbFRhc2sod29ya2VyLCB0YXNrKV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMyAvKmJyZWFrKi8sIDVdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlVGFza0Zyb21Xb3JrZXJzUnVubmluZ1Rhc2tzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc0Nsb3NpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2NoZWR1bGVXb3JrKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs3IC8qZW5kZmluYWxseSovXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDU6IHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7IH0pKCk7XG4gICAgICAgICAgICAgICAgd29ya2VyLnJ1bm5pbmdUYXNrcy5wdXNoKHJ1blByb21pc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFdvcmtlclBvb2wucHJvdG90eXBlLnNjaGVkdWxlV29yayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5kZWJ1ZyhcIkF0dGVtcHQgZGUtcXVldWVpbmcgYSB0YXNrIGluIG9yZGVyIHRvIHJ1biBpdC4uLlwiKTtcbiAgICAgICAgdmFyIGF2YWlsYWJsZVdvcmtlciA9IHRoaXMuZmluZElkbGluZ1dvcmtlcigpO1xuICAgICAgICBpZiAoIWF2YWlsYWJsZVdvcmtlcilcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdmFyIG5leHRUYXNrID0gdGhpcy50YXNrUXVldWUuc2hpZnQoKTtcbiAgICAgICAgaWYgKCFuZXh0VGFzaykge1xuICAgICAgICAgICAgdGhpcy5kZWJ1ZyhcIlRhc2sgcXVldWUgaXMgZW1wdHlcIik7XG4gICAgICAgICAgICB0aGlzLmV2ZW50U3ViamVjdC5uZXh0KHsgdHlwZTogcG9vbF90eXBlc18xLlBvb2xFdmVudFR5cGUudGFza1F1ZXVlRHJhaW5lZCB9KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJ1bihhdmFpbGFibGVXb3JrZXIsIG5leHRUYXNrKTtcbiAgICB9O1xuICAgIFdvcmtlclBvb2wucHJvdG90eXBlLnRhc2tDb21wbGV0aW9uID0gZnVuY3Rpb24gKHRhc2tJRCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgdmFyIGV2ZW50U3Vic2NyaXB0aW9uID0gX3RoaXMuZXZlbnRzKCkuc3Vic2NyaWJlKGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgIGlmIChldmVudC50eXBlID09PSBwb29sX3R5cGVzXzEuUG9vbEV2ZW50VHlwZS50YXNrQ29tcGxldGVkICYmIGV2ZW50LnRhc2tJRCA9PT0gdGFza0lEKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50U3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZXZlbnQucmV0dXJuVmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChldmVudC50eXBlID09PSBwb29sX3R5cGVzXzEuUG9vbEV2ZW50VHlwZS50YXNrRmFpbGVkICYmIGV2ZW50LnRhc2tJRCA9PT0gdGFza0lEKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50U3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChldmVudC5lcnJvcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IHBvb2xfdHlwZXNfMS5Qb29sRXZlbnRUeXBlLnRlcm1pbmF0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KEVycm9yKFwiUG9vbCBoYXMgYmVlbiB0ZXJtaW5hdGVkIGJlZm9yZSB0YXNrIHdhcyBydW4uXCIpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBXb3JrZXJQb29sLnByb3RvdHlwZS5zZXR0bGVkID0gZnVuY3Rpb24gKGFsbG93UmVzb2x2aW5nSW1tZWRpYXRlbHkpIHtcbiAgICAgICAgaWYgKGFsbG93UmVzb2x2aW5nSW1tZWRpYXRlbHkgPT09IHZvaWQgMCkgeyBhbGxvd1Jlc29sdmluZ0ltbWVkaWF0ZWx5ID0gZmFsc2U7IH1cbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGdldEN1cnJlbnRseVJ1bm5pbmdUYXNrcywgdGFza0ZhaWx1cmVzLCBmYWlsdXJlU3Vic2NyaXB0aW9uO1xuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldEN1cnJlbnRseVJ1bm5pbmdUYXNrcyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZsYXRNYXAoX3RoaXMud29ya2VycywgZnVuY3Rpb24gKHdvcmtlcikgeyByZXR1cm4gd29ya2VyLnJ1bm5pbmdUYXNrczsgfSk7IH07XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXNrRmFpbHVyZXMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhaWx1cmVTdWJzY3JpcHRpb24gPSB0aGlzLmV2ZW50T2JzZXJ2YWJsZS5zdWJzY3JpYmUoZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LnR5cGUgPT09IHBvb2xfdHlwZXNfMS5Qb29sRXZlbnRUeXBlLnRhc2tGYWlsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza0ZhaWx1cmVzLnB1c2goZXZlbnQuZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5pdEVycm9ycy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIFByb21pc2UucmVqZWN0KHRoaXMuaW5pdEVycm9yc1swXSldO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoYWxsb3dSZXNvbHZpbmdJbW1lZGlhdGVseSAmJiB0aGlzLnRhc2tRdWV1ZS5sZW5ndGggPT09IDApKSByZXR1cm4gWzMgLypicmVhayovLCAyXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sICgwLCBwb255ZmlsbHNfMS5hbGxTZXR0bGVkKShnZXRDdXJyZW50bHlSdW5uaW5nVGFza3MoKSldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgdGFza0ZhaWx1cmVzXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOiByZXR1cm4gWzQgLyp5aWVsZCovLCBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1YnNjcmlwdGlvbiA9IF90aGlzLmV2ZW50T2JzZXJ2YWJsZS5zdWJzY3JpYmUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0OiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudC50eXBlID09PSBwb29sX3R5cGVzXzEuUG9vbEV2ZW50VHlwZS50YXNrUXVldWVEcmFpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh2b2lkIDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogcmVqZWN0IC8vIG1ha2UgYSBwb29sLXdpZGUgZXJyb3IgcmVqZWN0IHRoZSBjb21wbGV0ZWQoKSByZXN1bHQgcHJvbWlzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCAoMCwgcG9ueWZpbGxzXzEuYWxsU2V0dGxlZCkoZ2V0Q3VycmVudGx5UnVubmluZ1Rhc2tzKCkpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZmFpbHVyZVN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRhc2tGYWlsdXJlc107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgV29ya2VyUG9vbC5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKGFsbG93UmVzb2x2aW5nSW1tZWRpYXRlbHkpIHtcbiAgICAgICAgaWYgKGFsbG93UmVzb2x2aW5nSW1tZWRpYXRlbHkgPT09IHZvaWQgMCkgeyBhbGxvd1Jlc29sdmluZ0ltbWVkaWF0ZWx5ID0gZmFsc2U7IH1cbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHNldHRsZW1lbnRQcm9taXNlLCBlYXJseUV4aXRQcm9taXNlLCBlcnJvcnM7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGxlbWVudFByb21pc2UgPSB0aGlzLnNldHRsZWQoYWxsb3dSZXNvbHZpbmdJbW1lZGlhdGVseSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlYXJseUV4aXRQcm9taXNlID0gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWJzY3JpcHRpb24gPSBfdGhpcy5ldmVudE9ic2VydmFibGUuc3Vic2NyaWJlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dDogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQudHlwZSA9PT0gcG9vbF90eXBlc18xLlBvb2xFdmVudFR5cGUudGFza1F1ZXVlRHJhaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc2V0dGxlbWVudFByb21pc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gcG9vbF90eXBlc18xLlBvb2xFdmVudFR5cGUudGFza0ZhaWxlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChldmVudC5lcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiByZWplY3QgLy8gbWFrZSBhIHBvb2wtd2lkZSBlcnJvciByZWplY3QgdGhlIGNvbXBsZXRlZCgpIHJlc3VsdCBwcm9taXNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIFByb21pc2UucmFjZShbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldHRsZW1lbnRQcm9taXNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlYXJseUV4aXRQcm9taXNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXSldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvcnMgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3JzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcnNbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgV29ya2VyUG9vbC5wcm90b3R5cGUuZXZlbnRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ldmVudE9ic2VydmFibGU7XG4gICAgfTtcbiAgICBXb3JrZXJQb29sLnByb3RvdHlwZS5xdWV1ZSA9IGZ1bmN0aW9uICh0YXNrRnVuY3Rpb24pIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdmFyIF9hID0gdGhpcy5vcHRpb25zLm1heFF1ZXVlZEpvYnMsIG1heFF1ZXVlZEpvYnMgPSBfYSA9PT0gdm9pZCAwID8gSW5maW5pdHkgOiBfYTtcbiAgICAgICAgaWYgKHRoaXMuaXNDbG9zaW5nKSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcihcIkNhbm5vdCBzY2hlZHVsZSBwb29sIHRhc2tzIGFmdGVyIHRlcm1pbmF0ZSgpIGhhcyBiZWVuIGNhbGxlZC5cIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaW5pdEVycm9ycy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0aHJvdyB0aGlzLmluaXRFcnJvcnNbMF07XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHRhc2tJRCA9IHRoaXMubmV4dFRhc2tJRCsrO1xuICAgICAgICB2YXIgdGFza0NvbXBsZXRpb24gPSB0aGlzLnRhc2tDb21wbGV0aW9uKHRhc2tJRCk7XG4gICAgICAgIHRhc2tDb21wbGV0aW9uLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgLy8gUHJldmVudCB1bmhhbmRsZWQgcmVqZWN0aW9ucyBoZXJlIGFzIHdlIGFzc3VtZSB0aGUgdXNlciB3aWxsIHVzZVxuICAgICAgICAgICAgLy8gYHBvb2wuY29tcGxldGVkKClgLCBgcG9vbC5zZXR0bGVkKClgIG9yIGB0YXNrLmNhdGNoKClgIHRvIGhhbmRsZSBlcnJvcnNcbiAgICAgICAgICAgIF90aGlzLmRlYnVnKFwiVGFzayAjXCIuY29uY2F0KHRhc2tJRCwgXCIgZXJyb3JlZDpcIiksIGVycm9yKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHZhciB0YXNrID0ge1xuICAgICAgICAgICAgaWQ6IHRhc2tJRCxcbiAgICAgICAgICAgIHJ1bjogdGFza0Z1bmN0aW9uLFxuICAgICAgICAgICAgY2FuY2VsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLnRhc2tRdWV1ZS5pbmRleE9mKHRhc2spID09PSAtMSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIF90aGlzLnRhc2tRdWV1ZSA9IF90aGlzLnRhc2tRdWV1ZS5maWx0ZXIoZnVuY3Rpb24gKHNvbWVUYXNrKSB7IHJldHVybiBzb21lVGFzayAhPT0gdGFzazsgfSk7XG4gICAgICAgICAgICAgICAgX3RoaXMuZXZlbnRTdWJqZWN0Lm5leHQoe1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiBwb29sX3R5cGVzXzEuUG9vbEV2ZW50VHlwZS50YXNrQ2FuY2VsZWQsXG4gICAgICAgICAgICAgICAgICAgIHRhc2tJRDogdGFzay5pZFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRoZW46IHRhc2tDb21wbGV0aW9uLnRoZW4uYmluZCh0YXNrQ29tcGxldGlvbilcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHRoaXMudGFza1F1ZXVlLmxlbmd0aCA+PSBtYXhRdWV1ZWRKb2JzKSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcihcIk1heGltdW0gbnVtYmVyIG9mIHBvb2wgdGFza3MgcXVldWVkLiBSZWZ1c2luZyB0byBxdWV1ZSBhbm90aGVyIG9uZS5cXG5cIiArXG4gICAgICAgICAgICAgICAgXCJUaGlzIHVzdWFsbHkgaGFwcGVucyBmb3Igb25lIG9mIHR3byByZWFzb25zOiBXZSBhcmUgZWl0aGVyIGF0IHBlYWsgXCIgK1xuICAgICAgICAgICAgICAgIFwid29ya2xvYWQgcmlnaHQgbm93IG9yIHNvbWUgdGFza3MganVzdCB3b24ndCBmaW5pc2gsIHRodXMgYmxvY2tpbmcgdGhlIHBvb2wuXCIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZGVidWcoXCJRdWV1ZWluZyB0YXNrICNcIi5jb25jYXQodGFzay5pZCwgXCIuLi5cIikpO1xuICAgICAgICB0aGlzLnRhc2tRdWV1ZS5wdXNoKHRhc2spO1xuICAgICAgICB0aGlzLmV2ZW50U3ViamVjdC5uZXh0KHtcbiAgICAgICAgICAgIHR5cGU6IHBvb2xfdHlwZXNfMS5Qb29sRXZlbnRUeXBlLnRhc2tRdWV1ZWQsXG4gICAgICAgICAgICB0YXNrSUQ6IHRhc2suaWRcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc2NoZWR1bGVXb3JrKCk7XG4gICAgICAgIHJldHVybiB0YXNrO1xuICAgIH07XG4gICAgV29ya2VyUG9vbC5wcm90b3R5cGUudGVybWluYXRlID0gZnVuY3Rpb24gKGZvcmNlKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzQ2xvc2luZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISFmb3JjZSkgcmV0dXJuIFszIC8qYnJlYWsqLywgMl07XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLmNvbXBsZXRlZCh0cnVlKV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLmxhYmVsID0gMjtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ldmVudFN1YmplY3QubmV4dCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogcG9vbF90eXBlc18xLlBvb2xFdmVudFR5cGUudGVybWluYXRlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1haW5pbmdRdWV1ZTogX19zcHJlYWRBcnJheShbXSwgdGhpcy50YXNrUXVldWUsIHRydWUpXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXZlbnRTdWJqZWN0LmNvbXBsZXRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBQcm9taXNlLmFsbCh0aGlzLndvcmtlcnMubWFwKGZ1bmN0aW9uICh3b3JrZXIpIHsgcmV0dXJuIF9fYXdhaXRlcihfdGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsgdmFyIF9hLCBfYjsgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2IgPSAoX2EgPSB0aHJlYWRfMS5UaHJlYWQpLnRlcm1pbmF0ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB3b3JrZXIuaW5pdF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6IHJldHVybiBbMiAvKnJldHVybiovLCBfYi5hcHBseShfYSwgW19jLnNlbnQoKV0pXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOyB9KTsgfSkpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHJldHVybiBXb3JrZXJQb29sO1xufSgpKTtcbldvcmtlclBvb2wuRXZlbnRUeXBlID0gcG9vbF90eXBlc18xLlBvb2xFdmVudFR5cGU7XG4vKipcbiAqIFRocmVhZCBwb29sIGNvbnN0cnVjdG9yLiBDcmVhdGVzIGEgbmV3IHBvb2wgYW5kIHNwYXducyBpdHMgd29ya2VyIHRocmVhZHMuXG4gKi9cbmZ1bmN0aW9uIFBvb2xDb25zdHJ1Y3RvcihzcGF3bldvcmtlciwgb3B0aW9uc09yU2l6ZSkge1xuICAgIC8vIFRoZSBmdW5jdGlvbiBleGlzdHMgb25seSBzbyB3ZSBkb24ndCBuZWVkIHRvIHVzZSBgbmV3YCB0byBjcmVhdGUgYSBwb29sICh3ZSBzdGlsbCBjYW4sIHRob3VnaCkuXG4gICAgLy8gSWYgdGhlIFBvb2wgaXMgYSBjbGFzcyBvciBub3QgaXMgYW4gaW1wbGVtZW50YXRpb24gZGV0YWlsIHRoYXQgc2hvdWxkIG5vdCBjb25jZXJuIHRoZSB1c2VyLlxuICAgIHJldHVybiBuZXcgV29ya2VyUG9vbChzcGF3bldvcmtlciwgb3B0aW9uc09yU2l6ZSk7XG59XG5Qb29sQ29uc3RydWN0b3IuRXZlbnRUeXBlID0gcG9vbF90eXBlc18xLlBvb2xFdmVudFR5cGU7XG4vKipcbiAqIFRocmVhZCBwb29sIGNvbnN0cnVjdG9yLiBDcmVhdGVzIGEgbmV3IHBvb2wgYW5kIHNwYXducyBpdHMgd29ya2VyIHRocmVhZHMuXG4gKi9cbmV4cG9ydHMuUG9vbCA9IFBvb2xDb25zdHJ1Y3RvcjtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vbWFzdGVyL3Bvb2wuanM/Iik7CgovKioqLyB9KSwKCi8qKiovICIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS9tYXN0ZXIvc3Bhd24uanMiOgovKiEqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiEqXAogICEqKiogL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vbWFzdGVyL3NwYXduLmpzICoqKiEKICBcKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CmV2YWwoIi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLyhmdW5jdGlvbihwcm9jZXNzKSB7XG52YXIgX19nZW5lcmF0b3IgPSAodGhpcyAmJiB0aGlzLl9fZ2VuZXJhdG9yKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgYm9keSkge1xuICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGc7XG4gICAgcmV0dXJuIGcgPSB7IG5leHQ6IHZlcmIoMCksIFwidGhyb3dcIjogdmVyYigxKSwgXCJyZXR1cm5cIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7XG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IHJldHVybiBmdW5jdGlvbiAodikgeyByZXR1cm4gc3RlcChbbiwgdl0pOyB9OyB9XG4gICAgZnVuY3Rpb24gc3RlcChvcCkge1xuICAgICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XG4gICAgICAgIHdoaWxlIChfKSB0cnkge1xuICAgICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0gb3BbMF0gJiAyID8geVtcInJldHVyblwiXSA6IG9wWzBdID8geVtcInRocm93XCJdIHx8ICgodCA9IHlbXCJyZXR1cm5cIl0pICYmIHQuY2FsbCh5KSwgMCkgOiB5Lm5leHQpICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0O1xuICAgICAgICAgICAgaWYgKHkgPSAwLCB0KSBvcCA9IFtvcFswXSAmIDIsIHQudmFsdWVdO1xuICAgICAgICAgICAgc3dpdGNoIChvcFswXSkge1xuICAgICAgICAgICAgICAgIGNhc2UgMDogY2FzZSAxOiB0ID0gb3A7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNDogXy5sYWJlbCsrOyByZXR1cm4geyB2YWx1ZTogb3BbMV0sIGRvbmU6IGZhbHNlIH07XG4gICAgICAgICAgICAgICAgY2FzZSA1OiBfLmxhYmVsKys7IHkgPSBvcFsxXTsgb3AgPSBbMF07IGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIGNhc2UgNzogb3AgPSBfLm9wcy5wb3AoKTsgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBpZiAoISh0ID0gXy50cnlzLCB0ID0gdC5sZW5ndGggPiAwICYmIHRbdC5sZW5ndGggLSAxXSkgJiYgKG9wWzBdID09PSA2IHx8IG9wWzBdID09PSAyKSkgeyBfID0gMDsgY29udGludWU7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCAob3BbMV0gPiB0WzBdICYmIG9wWzFdIDwgdFszXSkpKSB7IF8ubGFiZWwgPSBvcFsxXTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7IF8ubGFiZWwgPSB0WzFdOyB0ID0gb3A7IGJyZWFrOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIF8ubGFiZWwgPCB0WzJdKSB7IF8ubGFiZWwgPSB0WzJdOyBfLm9wcy5wdXNoKG9wKTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRbMl0pIF8ub3BzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3AgPSBib2R5LmNhbGwodGhpc0FyZywgXyk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgb3AgPSBbNiwgZV07IHkgPSAwOyB9IGZpbmFsbHkgeyBmID0gdCA9IDA7IH1cbiAgICAgICAgaWYgKG9wWzBdICYgNSkgdGhyb3cgb3BbMV07IHJldHVybiB7IHZhbHVlOiBvcFswXSA/IG9wWzFdIDogdm9pZCAwLCBkb25lOiB0cnVlIH07XG4gICAgfVxufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc3Bhd24gPSB2b2lkIDA7XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7XG4gICAgICAgICAgICBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7XG4gICAgICAgICAgICBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgZGVidWdfMSA9IF9faW1wb3J0RGVmYXVsdChfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISBkZWJ1ZyAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9kZWJ1Z0A0LjMuNC9ub2RlX21vZHVsZXMvZGVidWcvc3JjL2Jyb3dzZXIuanNcIikpO1xudmFyIG9ic2VydmFibGVfZm5zXzEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISBvYnNlcnZhYmxlLWZucyAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9vYnNlcnZhYmxlLWZuc0AwLjYuMS9ub2RlX21vZHVsZXMvb2JzZXJ2YWJsZS1mbnMvZGlzdC5lc20vaW5kZXguanNcIik7XG52YXIgY29tbW9uXzEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuLi9jb21tb24gKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS9jb21tb24uanNcIik7XG52YXIgcHJvbWlzZV8xID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi4vcHJvbWlzZSAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS90aHJlYWRzQDEuNy4wL25vZGVfbW9kdWxlcy90aHJlYWRzL2Rpc3QtZXNtL3Byb21pc2UuanNcIik7XG52YXIgc3ltYm9sc18xID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi4vc3ltYm9scyAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS90aHJlYWRzQDEuNy4wL25vZGVfbW9kdWxlcy90aHJlYWRzL2Rpc3QtZXNtL3N5bWJvbHMuanNcIik7XG52YXIgbWFzdGVyXzEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuLi90eXBlcy9tYXN0ZXIgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS90eXBlcy9tYXN0ZXIuanNcIik7XG52YXIgaW52b2NhdGlvbl9wcm94eV8xID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9pbnZvY2F0aW9uLXByb3h5ICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vbWFzdGVyL2ludm9jYXRpb24tcHJveHkuanNcIik7XG52YXIgZGVidWdNZXNzYWdlcyA9ICgwLCBkZWJ1Z18xLmRlZmF1bHQpKFwidGhyZWFkczptYXN0ZXI6bWVzc2FnZXNcIik7XG52YXIgZGVidWdTcGF3biA9ICgwLCBkZWJ1Z18xLmRlZmF1bHQpKFwidGhyZWFkczptYXN0ZXI6c3Bhd25cIik7XG52YXIgZGVidWdUaHJlYWRVdGlscyA9ICgwLCBkZWJ1Z18xLmRlZmF1bHQpKFwidGhyZWFkczptYXN0ZXI6dGhyZWFkLXV0aWxzXCIpO1xudmFyIGlzSW5pdE1lc3NhZ2UgPSBmdW5jdGlvbiAoZGF0YSkgeyByZXR1cm4gZGF0YSAmJiBkYXRhLnR5cGUgPT09IFwiaW5pdFwiOyB9O1xudmFyIGlzVW5jYXVnaHRFcnJvck1lc3NhZ2UgPSBmdW5jdGlvbiAoZGF0YSkgeyByZXR1cm4gZGF0YSAmJiBkYXRhLnR5cGUgPT09IFwidW5jYXVnaHRFcnJvclwiOyB9O1xudmFyIGluaXRNZXNzYWdlVGltZW91dCA9IHR5cGVvZiBwcm9jZXNzICE9PSBcInVuZGVmaW5lZFwiICYmIHByb2Nlc3MuZW52LlRIUkVBRFNfV09SS0VSX0lOSVRfVElNRU9VVFxuICAgID8gTnVtYmVyLnBhcnNlSW50KHByb2Nlc3MuZW52LlRIUkVBRFNfV09SS0VSX0lOSVRfVElNRU9VVCwgMTApXG4gICAgOiAxMDAwMDtcbmZ1bmN0aW9uIHdpdGhUaW1lb3V0KHByb21pc2UsIHRpbWVvdXRJbk1zLCBlcnJvck1lc3NhZ2UpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0aW1lb3V0SGFuZGxlLCB0aW1lb3V0LCByZXN1bHQ7XG4gICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcbiAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0SGFuZGxlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IHJldHVybiByZWplY3QoRXJyb3IoZXJyb3JNZXNzYWdlKSk7IH0sIHRpbWVvdXRJbk1zKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIFByb21pc2UucmFjZShbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvbWlzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0XG4gICAgICAgICAgICAgICAgICAgICAgICBdKV07XG4gICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0SGFuZGxlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHJlc3VsdF07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gcmVjZWl2ZUluaXRNZXNzYWdlKHdvcmtlcikge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIHZhciBtZXNzYWdlSGFuZGxlciA9IChmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIGRlYnVnTWVzc2FnZXMoXCJNZXNzYWdlIGZyb20gd29ya2VyIGJlZm9yZSBmaW5pc2hpbmcgaW5pdGlhbGl6YXRpb246XCIsIGV2ZW50LmRhdGEpO1xuICAgICAgICAgICAgaWYgKGlzSW5pdE1lc3NhZ2UoZXZlbnQuZGF0YSkpIHtcbiAgICAgICAgICAgICAgICB3b3JrZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgbWVzc2FnZUhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIHJlc29sdmUoZXZlbnQuZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChpc1VuY2F1Z2h0RXJyb3JNZXNzYWdlKGV2ZW50LmRhdGEpKSB7XG4gICAgICAgICAgICAgICAgd29ya2VyLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtZXNzYWdlXCIsIG1lc3NhZ2VIYW5kbGVyKTtcbiAgICAgICAgICAgICAgICByZWplY3QoKDAsIGNvbW1vbl8xLmRlc2VyaWFsaXplKShldmVudC5kYXRhLmVycm9yKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB3b3JrZXIuYWRkRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgbWVzc2FnZUhhbmRsZXIpO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gY3JlYXRlRXZlbnRPYnNlcnZhYmxlKHdvcmtlciwgd29ya2VyVGVybWluYXRpb24pIHtcbiAgICByZXR1cm4gbmV3IG9ic2VydmFibGVfZm5zXzEuT2JzZXJ2YWJsZShmdW5jdGlvbiAob2JzZXJ2ZXIpIHtcbiAgICAgICAgdmFyIG1lc3NhZ2VIYW5kbGVyID0gKGZ1bmN0aW9uIChtZXNzYWdlRXZlbnQpIHtcbiAgICAgICAgICAgIHZhciB3b3JrZXJFdmVudCA9IHtcbiAgICAgICAgICAgICAgICB0eXBlOiBtYXN0ZXJfMS5Xb3JrZXJFdmVudFR5cGUubWVzc2FnZSxcbiAgICAgICAgICAgICAgICBkYXRhOiBtZXNzYWdlRXZlbnQuZGF0YVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIG9ic2VydmVyLm5leHQod29ya2VyRXZlbnQpO1xuICAgICAgICB9KTtcbiAgICAgICAgdmFyIHJlamVjdGlvbkhhbmRsZXIgPSAoZnVuY3Rpb24gKGVycm9yRXZlbnQpIHtcbiAgICAgICAgICAgIGRlYnVnVGhyZWFkVXRpbHMoXCJVbmhhbmRsZWQgcHJvbWlzZSByZWplY3Rpb24gZXZlbnQgaW4gdGhyZWFkOlwiLCBlcnJvckV2ZW50KTtcbiAgICAgICAgICAgIHZhciB3b3JrZXJFdmVudCA9IHtcbiAgICAgICAgICAgICAgICB0eXBlOiBtYXN0ZXJfMS5Xb3JrZXJFdmVudFR5cGUuaW50ZXJuYWxFcnJvcixcbiAgICAgICAgICAgICAgICBlcnJvcjogRXJyb3IoZXJyb3JFdmVudC5yZWFzb24pXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dCh3b3JrZXJFdmVudCk7XG4gICAgICAgIH0pO1xuICAgICAgICB3b3JrZXIuYWRkRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgbWVzc2FnZUhhbmRsZXIpO1xuICAgICAgICB3b3JrZXIuYWRkRXZlbnRMaXN0ZW5lcihcInVuaGFuZGxlZHJlamVjdGlvblwiLCByZWplY3Rpb25IYW5kbGVyKTtcbiAgICAgICAgd29ya2VyVGVybWluYXRpb24udGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdGVybWluYXRpb25FdmVudCA9IHtcbiAgICAgICAgICAgICAgICB0eXBlOiBtYXN0ZXJfMS5Xb3JrZXJFdmVudFR5cGUudGVybWluYXRpb25cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB3b3JrZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgbWVzc2FnZUhhbmRsZXIpO1xuICAgICAgICAgICAgd29ya2VyLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ1bmhhbmRsZWRyZWplY3Rpb25cIiwgcmVqZWN0aW9uSGFuZGxlcik7XG4gICAgICAgICAgICBvYnNlcnZlci5uZXh0KHRlcm1pbmF0aW9uRXZlbnQpO1xuICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBjcmVhdGVUZXJtaW5hdG9yKHdvcmtlcikge1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgdmFyIF9hID0gKDAsIHByb21pc2VfMS5jcmVhdGVQcm9taXNlV2l0aFJlc29sdmVyKSgpLCB0ZXJtaW5hdGlvbiA9IF9hWzBdLCByZXNvbHZlciA9IF9hWzFdO1xuICAgIHZhciB0ZXJtaW5hdGUgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBfX2F3YWl0ZXIoX3RoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcbiAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgIGRlYnVnVGhyZWFkVXRpbHMoXCJUZXJtaW5hdGluZyB3b3JrZXJcIik7XG4gICAgICAgICAgICAgICAgICAgIC8vIE5ld2VyIHZlcnNpb25zIG9mIHdvcmtlcl90aHJlYWRzIHdvcmtlcnMgcmV0dXJuIGEgcHJvbWlzZVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB3b3JrZXIudGVybWluYXRlKCldO1xuICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgLy8gTmV3ZXIgdmVyc2lvbnMgb2Ygd29ya2VyX3RocmVhZHMgd29ya2VycyByZXR1cm4gYSBwcm9taXNlXG4gICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTsgfTtcbiAgICByZXR1cm4geyB0ZXJtaW5hdGU6IHRlcm1pbmF0ZSwgdGVybWluYXRpb246IHRlcm1pbmF0aW9uIH07XG59XG5mdW5jdGlvbiBzZXRQcml2YXRlVGhyZWFkUHJvcHMocmF3LCB3b3JrZXIsIHdvcmtlckV2ZW50cywgdGVybWluYXRlKSB7XG4gICAgdmFyIF9hO1xuICAgIHZhciB3b3JrZXJFcnJvcnMgPSB3b3JrZXJFdmVudHNcbiAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAoZXZlbnQpIHsgcmV0dXJuIGV2ZW50LnR5cGUgPT09IG1hc3Rlcl8xLldvcmtlckV2ZW50VHlwZS5pbnRlcm5hbEVycm9yOyB9KVxuICAgICAgICAubWFwKGZ1bmN0aW9uIChlcnJvckV2ZW50KSB7IHJldHVybiBlcnJvckV2ZW50LmVycm9yOyB9KTtcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmUgcHJlZmVyLW9iamVjdC1zcHJlYWRcbiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihyYXcsIChfYSA9IHt9LFxuICAgICAgICBfYVtzeW1ib2xzXzEuJGVycm9yc10gPSB3b3JrZXJFcnJvcnMsXG4gICAgICAgIF9hW3N5bWJvbHNfMS4kZXZlbnRzXSA9IHdvcmtlckV2ZW50cyxcbiAgICAgICAgX2Fbc3ltYm9sc18xLiR0ZXJtaW5hdGVdID0gdGVybWluYXRlLFxuICAgICAgICBfYVtzeW1ib2xzXzEuJHdvcmtlcl0gPSB3b3JrZXIsXG4gICAgICAgIF9hKSk7XG59XG4vKipcbiAqIFNwYXduIGEgbmV3IHRocmVhZC4gVGFrZXMgYSBmcmVzaCB3b3JrZXIgaW5zdGFuY2UsIHdyYXBzIGl0IGluIGEgdGhpblxuICogYWJzdHJhY3Rpb24gbGF5ZXIgdG8gcHJvdmlkZSB0aGUgdHJhbnNwYXJlbnQgQVBJIGFuZCB2ZXJpZmllcyB0aGF0XG4gKiB0aGUgd29ya2VyIGhhcyBpbml0aWFsaXplZCBzdWNjZXNzZnVsbHkuXG4gKlxuICogQHBhcmFtIHdvcmtlciBJbnN0YW5jZSBvZiBgV29ya2VyYC4gRWl0aGVyIGEgd2ViIHdvcmtlciwgYHdvcmtlcl90aHJlYWRzYCB3b3JrZXIgb3IgYHRpbnktd29ya2VyYCB3b3JrZXIuXG4gKiBAcGFyYW0gW29wdGlvbnNdXG4gKiBAcGFyYW0gW29wdGlvbnMudGltZW91dF0gSW5pdCBtZXNzYWdlIHRpbWVvdXQuIERlZmF1bHQ6IDEwMDAwIG9yIHNldCBieSBlbnZpcm9ubWVudCB2YXJpYWJsZS5cbiAqL1xuZnVuY3Rpb24gc3Bhd24od29ya2VyLCBvcHRpb25zKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdGltZW91dCwgaW5pdE1lc3NhZ2UsIGV4cG9zZWQsIF9hLCB0ZXJtaW5hdGlvbiwgdGVybWluYXRlLCBldmVudHMsIHByb3h5LCBwcm94eSwgdHlwZTtcbiAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYikge1xuICAgICAgICAgICAgc3dpdGNoIChfYi5sYWJlbCkge1xuICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgZGVidWdTcGF3bihcIkluaXRpYWxpemluZyBuZXcgdGhyZWFkXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aW1lb3V0ID0gb3B0aW9ucyAmJiBvcHRpb25zLnRpbWVvdXQgPyBvcHRpb25zLnRpbWVvdXQgOiBpbml0TWVzc2FnZVRpbWVvdXQ7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHdpdGhUaW1lb3V0KHJlY2VpdmVJbml0TWVzc2FnZSh3b3JrZXIpLCB0aW1lb3V0LCBcIlRpbWVvdXQ6IERpZCBub3QgcmVjZWl2ZSBhbiBpbml0IG1lc3NhZ2UgZnJvbSB3b3JrZXIgYWZ0ZXIgXCIuY29uY2F0KHRpbWVvdXQsIFwibXMuIE1ha2Ugc3VyZSB0aGUgd29ya2VyIGNhbGxzIGV4cG9zZSgpLlwiKSldO1xuICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgaW5pdE1lc3NhZ2UgPSBfYi5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgIGV4cG9zZWQgPSBpbml0TWVzc2FnZS5leHBvc2VkO1xuICAgICAgICAgICAgICAgICAgICBfYSA9IGNyZWF0ZVRlcm1pbmF0b3Iod29ya2VyKSwgdGVybWluYXRpb24gPSBfYS50ZXJtaW5hdGlvbiwgdGVybWluYXRlID0gX2EudGVybWluYXRlO1xuICAgICAgICAgICAgICAgICAgICBldmVudHMgPSBjcmVhdGVFdmVudE9ic2VydmFibGUod29ya2VyLCB0ZXJtaW5hdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChleHBvc2VkLnR5cGUgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJveHkgPSAoMCwgaW52b2NhdGlvbl9wcm94eV8xLmNyZWF0ZVByb3h5RnVuY3Rpb24pKHdvcmtlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgc2V0UHJpdmF0ZVRocmVhZFByb3BzKHByb3h5LCB3b3JrZXIsIGV2ZW50cywgdGVybWluYXRlKV07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZXhwb3NlZC50eXBlID09PSBcIm1vZHVsZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm94eSA9ICgwLCBpbnZvY2F0aW9uX3Byb3h5XzEuY3JlYXRlUHJveHlNb2R1bGUpKHdvcmtlciwgZXhwb3NlZC5tZXRob2RzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBzZXRQcml2YXRlVGhyZWFkUHJvcHMocHJveHksIHdvcmtlciwgZXZlbnRzLCB0ZXJtaW5hdGUpXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgPSBleHBvc2VkLnR5cGU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcihcIldvcmtlciBpbml0IG1lc3NhZ2Ugc3RhdGVzIHVuZXhwZWN0ZWQgdHlwZSBvZiBleHBvc2UoKTogXCIuY29uY2F0KHR5cGUpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuZXhwb3J0cy5zcGF3biA9IHNwYXduO1xuXG4vKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi99LmNhbGwodGhpcywgX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi8uLi8uLi8uLi8uLi8uLi9wcm9jZXNzQDAuMTEuMTAvbm9kZV9tb2R1bGVzL3Byb2Nlc3MvYnJvd3Nlci5qcyAqLyBcIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9wcm9jZXNzQDAuMTEuMTAvbm9kZV9tb2R1bGVzL3Byb2Nlc3MvYnJvd3Nlci5qc1wiKSkpXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8vaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS9tYXN0ZXIvc3Bhd24uanM/Iik7CgovKioqLyB9KSwKCi8qKiovICIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS9tYXN0ZXIvdGhyZWFkLmpzIjoKLyohKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqISpcCiAgISoqKiAvaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS9tYXN0ZXIvdGhyZWFkLmpzICoqKiEKICBcKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKiEgbm8gc3RhdGljIGV4cG9ydHMgZm91bmQgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwpldmFsKCJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuVGhyZWFkID0gdm9pZCAwO1xudmFyIHN5bWJvbHNfMSA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4uL3N5bWJvbHMgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS9zeW1ib2xzLmpzXCIpO1xuZnVuY3Rpb24gZmFpbChtZXNzYWdlKSB7XG4gICAgdGhyb3cgRXJyb3IobWVzc2FnZSk7XG59XG4vKiogVGhyZWFkIHV0aWxpdHkgZnVuY3Rpb25zLiBVc2UgdGhlbSB0byBtYW5hZ2Ugb3IgaW5zcGVjdCBhIGBzcGF3bigpYC1lZCB0aHJlYWQuICovXG5leHBvcnRzLlRocmVhZCA9IHtcbiAgICAvKiogUmV0dXJuIGFuIG9ic2VydmFibGUgdGhhdCBjYW4gYmUgdXNlZCB0byBzdWJzY3JpYmUgdG8gYWxsIGVycm9ycyBoYXBwZW5pbmcgaW4gdGhlIHRocmVhZC4gKi9cbiAgICBlcnJvcnM6IGZ1bmN0aW9uICh0aHJlYWQpIHtcbiAgICAgICAgcmV0dXJuIHRocmVhZFtzeW1ib2xzXzEuJGVycm9yc10gfHwgZmFpbChcIkVycm9yIG9ic2VydmFibGUgbm90IGZvdW5kLiBNYWtlIHN1cmUgdG8gcGFzcyBhIHRocmVhZCBpbnN0YW5jZSBhcyByZXR1cm5lZCBieSB0aGUgc3Bhd24oKSBwcm9taXNlLlwiKTtcbiAgICB9LFxuICAgIC8qKiBSZXR1cm4gYW4gb2JzZXJ2YWJsZSB0aGF0IGNhbiBiZSB1c2VkIHRvIHN1YnNjcmliZSB0byBpbnRlcm5hbCBldmVudHMgaGFwcGVuaW5nIGluIHRoZSB0aHJlYWQuIFVzZWZ1bCBmb3IgZGVidWdnaW5nLiAqL1xuICAgIGV2ZW50czogZnVuY3Rpb24gKHRocmVhZCkge1xuICAgICAgICByZXR1cm4gdGhyZWFkW3N5bWJvbHNfMS4kZXZlbnRzXSB8fCBmYWlsKFwiRXZlbnRzIG9ic2VydmFibGUgbm90IGZvdW5kLiBNYWtlIHN1cmUgdG8gcGFzcyBhIHRocmVhZCBpbnN0YW5jZSBhcyByZXR1cm5lZCBieSB0aGUgc3Bhd24oKSBwcm9taXNlLlwiKTtcbiAgICB9LFxuICAgIC8qKiBUZXJtaW5hdGUgYSB0aHJlYWQuIFJlbWVtYmVyIHRvIHRlcm1pbmF0ZSBldmVyeSB0aHJlYWQgd2hlbiB5b3UgYXJlIGRvbmUgdXNpbmcgaXQuICovXG4gICAgdGVybWluYXRlOiBmdW5jdGlvbiAodGhyZWFkKSB7XG4gICAgICAgIHJldHVybiB0aHJlYWRbc3ltYm9sc18xLiR0ZXJtaW5hdGVdKCk7XG4gICAgfVxufTtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vbWFzdGVyL3RocmVhZC5qcz8iKTsKCi8qKiovIH0pLAoKLyoqKi8gIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS90aHJlYWRzQDEuNy4wL25vZGVfbW9kdWxlcy90aHJlYWRzL2Rpc3QtZXNtL29ic2VydmFibGUtcHJvbWlzZS5qcyI6Ci8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqISpcCiAgISoqKiAvaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS9vYnNlcnZhYmxlLXByb21pc2UuanMgKioqIQogIFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKZXZhbCgiXG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYiwgcCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBpZiAodHlwZW9mIGIgIT09IFwiZnVuY3Rpb25cIiAmJiBiICE9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNsYXNzIGV4dGVuZHMgdmFsdWUgXCIgKyBTdHJpbmcoYikgKyBcIiBpcyBub3QgYSBjb25zdHJ1Y3RvciBvciBudWxsXCIpO1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5PYnNlcnZhYmxlUHJvbWlzZSA9IHZvaWQgMDtcbnZhciBvYnNlcnZhYmxlX2Zuc18xID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgb2JzZXJ2YWJsZS1mbnMgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vb2JzZXJ2YWJsZS1mbnNAMC42LjEvbm9kZV9tb2R1bGVzL29ic2VydmFibGUtZm5zL2Rpc3QuZXNtL2luZGV4LmpzXCIpO1xudmFyIGRvTm90aGluZyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfTtcbnZhciByZXR1cm5JbnB1dCA9IGZ1bmN0aW9uIChpbnB1dCkgeyByZXR1cm4gaW5wdXQ7IH07XG52YXIgcnVuRGVmZXJyZWQgPSBmdW5jdGlvbiAoZm4pIHsgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oZm4pOyB9O1xuZnVuY3Rpb24gZmFpbChlcnJvcikge1xuICAgIHRocm93IGVycm9yO1xufVxuZnVuY3Rpb24gaXNUaGVuYWJsZSh0aGluZykge1xuICAgIHJldHVybiB0aGluZyAmJiB0eXBlb2YgdGhpbmcudGhlbiA9PT0gXCJmdW5jdGlvblwiO1xufVxuLyoqXG4gKiBDcmVhdGVzIGEgaHlicmlkLCBjb21iaW5pbmcgdGhlIEFQSXMgb2YgYW4gT2JzZXJ2YWJsZSBhbmQgYSBQcm9taXNlLlxuICpcbiAqIEl0IGlzIHVzZWQgdG8gcHJveHkgYXN5bmMgcHJvY2VzcyBzdGF0ZXMgd2hlbiB3ZSBhcmUgaW5pdGlhbGx5IG5vdCBzdXJlXG4gKiBpZiB0aGF0IGFzeW5jIHByb2Nlc3Mgd2lsbCB5aWVsZCB2YWx1ZXMgb25jZSAoLT4gUHJvbWlzZSkgb3IgbXVsdGlwbGVcbiAqIHRpbWVzICgtPiBPYnNlcnZhYmxlKS5cbiAqXG4gKiBOb3RlIHRoYXQgdGhlIG9ic2VydmFibGUgcHJvbWlzZSBpbmhlcml0cyBzb21lIG9mIHRoZSBvYnNlcnZhYmxlJ3MgY2hhcmFjdGVyaXN0aWNzOlxuICogVGhlIGBpbml0YCBmdW5jdGlvbiB3aWxsIGJlIGNhbGxlZCAqb25jZSBmb3IgZXZlcnkgdGltZSBhbnlvbmUgc3Vic2NyaWJlcyB0byBpdCouXG4gKlxuICogSWYgdGhpcyBpcyB1bmRlc2lyZWQsIGRlcml2ZSBhIGhvdCBvYnNlcnZhYmxlIGZyb20gaXQgdXNpbmcgYG1ha2VIb3QoKWAgYW5kXG4gKiBzdWJzY3JpYmUgdG8gdGhhdC5cbiAqL1xudmFyIE9ic2VydmFibGVQcm9taXNlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhPYnNlcnZhYmxlUHJvbWlzZSwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBPYnNlcnZhYmxlUHJvbWlzZShpbml0KSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIGZ1bmN0aW9uIChvcmlnaW5hbE9ic2VydmVyKSB7XG4gICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmUgbm8tdGhpcy1hc3NpZ25tZW50XG4gICAgICAgICAgICB2YXIgc2VsZiA9IF90aGlzO1xuICAgICAgICAgICAgdmFyIG9ic2VydmVyID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBvcmlnaW5hbE9ic2VydmVyKSwgeyBjb21wbGV0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbE9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYub25Db21wbGV0aW9uKCk7XG4gICAgICAgICAgICAgICAgfSwgZXJyb3I6IGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbE9ic2VydmVyLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5vbkVycm9yKGVycm9yKTtcbiAgICAgICAgICAgICAgICB9LCBuZXh0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxPYnNlcnZlci5uZXh0KHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5vbk5leHQodmFsdWUpO1xuICAgICAgICAgICAgICAgIH0gfSk7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIF90aGlzLmluaXRIYXNSdW4gPSB0cnVlO1xuICAgICAgICAgICAgICAgIHJldHVybiBpbml0KG9ic2VydmVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIG9ic2VydmVyLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkgfHwgdGhpcztcbiAgICAgICAgX3RoaXMuaW5pdEhhc1J1biA9IGZhbHNlO1xuICAgICAgICBfdGhpcy5mdWxmaWxsbWVudENhbGxiYWNrcyA9IFtdO1xuICAgICAgICBfdGhpcy5yZWplY3Rpb25DYWxsYmFja3MgPSBbXTtcbiAgICAgICAgX3RoaXMuZmlyc3RWYWx1ZVNldCA9IGZhbHNlO1xuICAgICAgICBfdGhpcy5zdGF0ZSA9IFwicGVuZGluZ1wiO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIE9ic2VydmFibGVQcm9taXNlLnByb3RvdHlwZS5vbk5leHQgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgaWYgKCF0aGlzLmZpcnN0VmFsdWVTZXQpIHtcbiAgICAgICAgICAgIHRoaXMuZmlyc3RWYWx1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy5maXJzdFZhbHVlU2V0ID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgT2JzZXJ2YWJsZVByb21pc2UucHJvdG90eXBlLm9uRXJyb3IgPSBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IFwicmVqZWN0ZWRcIjtcbiAgICAgICAgdGhpcy5yZWplY3Rpb24gPSBlcnJvcjtcbiAgICAgICAgdmFyIF9sb29wXzEgPSBmdW5jdGlvbiAob25SZWplY3RlZCkge1xuICAgICAgICAgICAgLy8gUHJvbWlzaWZ5aW5nIHRoZSBjYWxsIHRvIHR1cm4gZXJyb3JzIGludG8gdW5oYW5kbGVkIHByb21pc2UgcmVqZWN0aW9uc1xuICAgICAgICAgICAgLy8gaW5zdGVhZCBvZiB0aGVtIGZhaWxpbmcgc3luYyBhbmQgY2FuY2VsbGluZyB0aGUgaXRlcmF0aW9uXG4gICAgICAgICAgICBydW5EZWZlcnJlZChmdW5jdGlvbiAoKSB7IHJldHVybiBvblJlamVjdGVkKGVycm9yKTsgfSk7XG4gICAgICAgIH07XG4gICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSB0aGlzLnJlamVjdGlvbkNhbGxiYWNrczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgIHZhciBvblJlamVjdGVkID0gX2FbX2ldO1xuICAgICAgICAgICAgX2xvb3BfMShvblJlamVjdGVkKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgT2JzZXJ2YWJsZVByb21pc2UucHJvdG90eXBlLm9uQ29tcGxldGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5zdGF0ZSA9IFwiZnVsZmlsbGVkXCI7XG4gICAgICAgIHZhciBfbG9vcF8yID0gZnVuY3Rpb24gKG9uRnVsZmlsbGVkKSB7XG4gICAgICAgICAgICAvLyBQcm9taXNpZnlpbmcgdGhlIGNhbGwgdG8gdHVybiBlcnJvcnMgaW50byB1bmhhbmRsZWQgcHJvbWlzZSByZWplY3Rpb25zXG4gICAgICAgICAgICAvLyBpbnN0ZWFkIG9mIHRoZW0gZmFpbGluZyBzeW5jIGFuZCBjYW5jZWxsaW5nIHRoZSBpdGVyYXRpb25cbiAgICAgICAgICAgIHJ1bkRlZmVycmVkKGZ1bmN0aW9uICgpIHsgcmV0dXJuIG9uRnVsZmlsbGVkKF90aGlzLmZpcnN0VmFsdWUpOyB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMuZnVsZmlsbG1lbnRDYWxsYmFja3M7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICB2YXIgb25GdWxmaWxsZWQgPSBfYVtfaV07XG4gICAgICAgICAgICBfbG9vcF8yKG9uRnVsZmlsbGVkKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgT2JzZXJ2YWJsZVByb21pc2UucHJvdG90eXBlLnRoZW4gPSBmdW5jdGlvbiAob25GdWxmaWxsZWRSYXcsIG9uUmVqZWN0ZWRSYXcpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdmFyIG9uRnVsZmlsbGVkID0gb25GdWxmaWxsZWRSYXcgfHwgcmV0dXJuSW5wdXQ7XG4gICAgICAgIHZhciBvblJlamVjdGVkID0gb25SZWplY3RlZFJhdyB8fCBmYWlsO1xuICAgICAgICB2YXIgb25SZWplY3RlZENhbGxlZCA9IGZhbHNlO1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgdmFyIHJlamVjdGlvbkNhbGxiYWNrID0gZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9uUmVqZWN0ZWRDYWxsZWQpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICBvblJlamVjdGVkQ2FsbGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG9uUmVqZWN0ZWQoZXJyb3IpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGFub3RoZXJFcnJvcikge1xuICAgICAgICAgICAgICAgICAgICByZWplY3QoYW5vdGhlckVycm9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdmFyIGZ1bGZpbGxtZW50Q2FsbGJhY2sgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG9uRnVsZmlsbGVkKHZhbHVlKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICByZWplY3Rpb25DYWxsYmFjayhlcnJvcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmICghX3RoaXMuaW5pdEhhc1J1bikge1xuICAgICAgICAgICAgICAgIF90aGlzLnN1YnNjcmliZSh7IGVycm9yOiByZWplY3Rpb25DYWxsYmFjayB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChfdGhpcy5zdGF0ZSA9PT0gXCJmdWxmaWxsZWRcIikge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNvbHZlKG9uRnVsZmlsbGVkKF90aGlzLmZpcnN0VmFsdWUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChfdGhpcy5zdGF0ZSA9PT0gXCJyZWplY3RlZFwiKSB7XG4gICAgICAgICAgICAgICAgb25SZWplY3RlZENhbGxlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUob25SZWplY3RlZChfdGhpcy5yZWplY3Rpb24pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF90aGlzLmZ1bGZpbGxtZW50Q2FsbGJhY2tzLnB1c2goZnVsZmlsbG1lbnRDYWxsYmFjayk7XG4gICAgICAgICAgICBfdGhpcy5yZWplY3Rpb25DYWxsYmFja3MucHVzaChyZWplY3Rpb25DYWxsYmFjayk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgT2JzZXJ2YWJsZVByb21pc2UucHJvdG90eXBlLmNhdGNoID0gZnVuY3Rpb24gKG9uUmVqZWN0ZWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGhlbih1bmRlZmluZWQsIG9uUmVqZWN0ZWQpO1xuICAgIH07XG4gICAgT2JzZXJ2YWJsZVByb21pc2UucHJvdG90eXBlLmZpbmFsbHkgPSBmdW5jdGlvbiAob25Db21wbGV0ZWQpIHtcbiAgICAgICAgdmFyIGhhbmRsZXIgPSBvbkNvbXBsZXRlZCB8fCBkb05vdGhpbmc7XG4gICAgICAgIHJldHVybiB0aGlzLnRoZW4oZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBoYW5kbGVyKCk7XG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgIH0sIGZ1bmN0aW9uICgpIHsgcmV0dXJuIGhhbmRsZXIoKTsgfSk7XG4gICAgfTtcbiAgICBPYnNlcnZhYmxlUHJvbWlzZS5mcm9tID0gZnVuY3Rpb24gKHRoaW5nKSB7XG4gICAgICAgIGlmIChpc1RoZW5hYmxlKHRoaW5nKSkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlUHJvbWlzZShmdW5jdGlvbiAob2JzZXJ2ZXIpIHtcbiAgICAgICAgICAgICAgICB2YXIgb25GdWxmaWxsZWQgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dCh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB2YXIgb25SZWplY3RlZCA9IGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB0aGluZy50aGVuKG9uRnVsZmlsbGVkLCBvblJlamVjdGVkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIF9zdXBlci5mcm9tLmNhbGwodGhpcywgdGhpbmcpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gT2JzZXJ2YWJsZVByb21pc2U7XG59KG9ic2VydmFibGVfZm5zXzEuT2JzZXJ2YWJsZSkpO1xuZXhwb3J0cy5PYnNlcnZhYmxlUHJvbWlzZSA9IE9ic2VydmFibGVQcm9taXNlO1xuXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8vaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS9vYnNlcnZhYmxlLXByb21pc2UuanM/Iik7CgovKioqLyB9KSwKCi8qKiovICIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS9wb255ZmlsbHMuanMiOgovKiEqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiEqXAogICEqKiogL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vcG9ueWZpbGxzLmpzICoqKiEKICBcKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CmV2YWwoIlxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5hbGxTZXR0bGVkID0gdm9pZCAwO1xuLy8gQmFzZWQgb24gPGh0dHBzOi8vZ2l0aHViLmNvbS9lcy1zaGltcy9Qcm9taXNlLmFsbFNldHRsZWQvYmxvYi9tYXN0ZXIvaW1wbGVtZW50YXRpb24uanM+XG5mdW5jdGlvbiBhbGxTZXR0bGVkKHZhbHVlcykge1xuICAgIHJldHVybiBQcm9taXNlLmFsbCh2YWx1ZXMubWFwKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgIHZhciBvbkZ1bGZpbGwgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN0YXR1czogJ2Z1bGZpbGxlZCcsIHZhbHVlOiB2YWx1ZSB9O1xuICAgICAgICB9O1xuICAgICAgICB2YXIgb25SZWplY3QgPSBmdW5jdGlvbiAocmVhc29uKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdGF0dXM6ICdyZWplY3RlZCcsIHJlYXNvbjogcmVhc29uIH07XG4gICAgICAgIH07XG4gICAgICAgIHZhciBpdGVtUHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZShpdGVtKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiBpdGVtUHJvbWlzZS50aGVuKG9uRnVsZmlsbCwgb25SZWplY3QpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcbiAgICAgICAgfVxuICAgIH0pKTtcbn1cbmV4cG9ydHMuYWxsU2V0dGxlZCA9IGFsbFNldHRsZWQ7XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS90aHJlYWRzQDEuNy4wL25vZGVfbW9kdWxlcy90aHJlYWRzL2Rpc3QtZXNtL3BvbnlmaWxscy5qcz8iKTsKCi8qKiovIH0pLAoKLyoqKi8gIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS90aHJlYWRzQDEuNy4wL25vZGVfbW9kdWxlcy90aHJlYWRzL2Rpc3QtZXNtL3Byb21pc2UuanMiOgovKiEqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlwKICAhKioqIC9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS90aHJlYWRzQDEuNy4wL25vZGVfbW9kdWxlcy90aHJlYWRzL2Rpc3QtZXNtL3Byb21pc2UuanMgKioqIQogIFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CmV2YWwoIlxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5jcmVhdGVQcm9taXNlV2l0aFJlc29sdmVyID0gdm9pZCAwO1xudmFyIGRvTm90aGluZyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfTtcbi8qKlxuICogQ3JlYXRlcyBhIG5ldyBwcm9taXNlIGFuZCBleHBvc2VzIGl0cyByZXNvbHZlciBmdW5jdGlvbi5cbiAqIFVzZSB3aXRoIGNhcmUhXG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZVByb21pc2VXaXRoUmVzb2x2ZXIoKSB7XG4gICAgdmFyIGFscmVhZHlSZXNvbHZlZCA9IGZhbHNlO1xuICAgIHZhciByZXNvbHZlZFRvO1xuICAgIHZhciByZXNvbHZlciA9IGRvTm90aGluZztcbiAgICB2YXIgcHJvbWlzZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7XG4gICAgICAgIGlmIChhbHJlYWR5UmVzb2x2ZWQpIHtcbiAgICAgICAgICAgIHJlc29sdmUocmVzb2x2ZWRUbyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXNvbHZlciA9IHJlc29sdmU7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICB2YXIgZXhwb3NlZFJlc29sdmVyID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgIGFscmVhZHlSZXNvbHZlZCA9IHRydWU7XG4gICAgICAgIHJlc29sdmVkVG8gPSB2YWx1ZTtcbiAgICAgICAgcmVzb2x2ZXIocmVzb2x2ZWRUbyk7XG4gICAgfTtcbiAgICByZXR1cm4gW3Byb21pc2UsIGV4cG9zZWRSZXNvbHZlcl07XG59XG5leHBvcnRzLmNyZWF0ZVByb21pc2VXaXRoUmVzb2x2ZXIgPSBjcmVhdGVQcm9taXNlV2l0aFJlc29sdmVyO1xuXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8vaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS9wcm9taXNlLmpzPyIpOwoKLyoqKi8gfSksCgovKioqLyAiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vc2VyaWFsaXplcnMuanMiOgovKiEqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqISpcCiAgISoqKiAvaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS9zZXJpYWxpemVycy5qcyAqKiohCiAgXCoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CmV2YWwoIlxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5EZWZhdWx0U2VyaWFsaXplciA9IGV4cG9ydHMuZXh0ZW5kU2VyaWFsaXplciA9IHZvaWQgMDtcbmZ1bmN0aW9uIGV4dGVuZFNlcmlhbGl6ZXIoZXh0ZW5kLCBpbXBsZW1lbnRhdGlvbikge1xuICAgIHZhciBmYWxsYmFja0Rlc2VyaWFsaXplciA9IGV4dGVuZC5kZXNlcmlhbGl6ZS5iaW5kKGV4dGVuZCk7XG4gICAgdmFyIGZhbGxiYWNrU2VyaWFsaXplciA9IGV4dGVuZC5zZXJpYWxpemUuYmluZChleHRlbmQpO1xuICAgIHJldHVybiB7XG4gICAgICAgIGRlc2VyaWFsaXplOiBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgICAgICAgICAgcmV0dXJuIGltcGxlbWVudGF0aW9uLmRlc2VyaWFsaXplKG1lc3NhZ2UsIGZhbGxiYWNrRGVzZXJpYWxpemVyKTtcbiAgICAgICAgfSxcbiAgICAgICAgc2VyaWFsaXplOiBmdW5jdGlvbiAoaW5wdXQpIHtcbiAgICAgICAgICAgIHJldHVybiBpbXBsZW1lbnRhdGlvbi5zZXJpYWxpemUoaW5wdXQsIGZhbGxiYWNrU2VyaWFsaXplcik7XG4gICAgICAgIH1cbiAgICB9O1xufVxuZXhwb3J0cy5leHRlbmRTZXJpYWxpemVyID0gZXh0ZW5kU2VyaWFsaXplcjtcbnZhciBEZWZhdWx0RXJyb3JTZXJpYWxpemVyID0ge1xuICAgIGRlc2VyaWFsaXplOiBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihFcnJvcihtZXNzYWdlLm1lc3NhZ2UpLCB7XG4gICAgICAgICAgICBuYW1lOiBtZXNzYWdlLm5hbWUsXG4gICAgICAgICAgICBzdGFjazogbWVzc2FnZS5zdGFja1xuICAgICAgICB9KTtcbiAgICB9LFxuICAgIHNlcmlhbGl6ZTogZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBfX2Vycm9yX21hcmtlcjogXCIkJGVycm9yXCIsXG4gICAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICAgICAgbmFtZTogZXJyb3IubmFtZSxcbiAgICAgICAgICAgIHN0YWNrOiBlcnJvci5zdGFja1xuICAgICAgICB9O1xuICAgIH1cbn07XG52YXIgaXNTZXJpYWxpemVkRXJyb3IgPSBmdW5jdGlvbiAodGhpbmcpIHsgcmV0dXJuIHRoaW5nICYmIHR5cGVvZiB0aGluZyA9PT0gXCJvYmplY3RcIiAmJiBcIl9fZXJyb3JfbWFya2VyXCIgaW4gdGhpbmcgJiYgdGhpbmcuX19lcnJvcl9tYXJrZXIgPT09IFwiJCRlcnJvclwiOyB9O1xuZXhwb3J0cy5EZWZhdWx0U2VyaWFsaXplciA9IHtcbiAgICBkZXNlcmlhbGl6ZTogZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICAgICAgaWYgKGlzU2VyaWFsaXplZEVycm9yKG1lc3NhZ2UpKSB7XG4gICAgICAgICAgICByZXR1cm4gRGVmYXVsdEVycm9yU2VyaWFsaXplci5kZXNlcmlhbGl6ZShtZXNzYWdlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBtZXNzYWdlO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBzZXJpYWxpemU6IGZ1bmN0aW9uIChpbnB1dCkge1xuICAgICAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICAgICAgcmV0dXJuIERlZmF1bHRFcnJvclNlcmlhbGl6ZXIuc2VyaWFsaXplKGlucHV0KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBpbnB1dDtcbiAgICAgICAgfVxuICAgIH1cbn07XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS90aHJlYWRzQDEuNy4wL25vZGVfbW9kdWxlcy90aHJlYWRzL2Rpc3QtZXNtL3NlcmlhbGl6ZXJzLmpzPyIpOwoKLyoqKi8gfSksCgovKioqLyAiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vc3ltYm9scy5qcyI6Ci8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiEqXAogICEqKiogL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vc3ltYm9scy5qcyAqKiohCiAgXCoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKZXZhbCgiXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLiR3b3JrZXIgPSBleHBvcnRzLiR0cmFuc2ZlcmFibGUgPSBleHBvcnRzLiR0ZXJtaW5hdGUgPSBleHBvcnRzLiRldmVudHMgPSBleHBvcnRzLiRlcnJvcnMgPSB2b2lkIDA7XG5leHBvcnRzLiRlcnJvcnMgPSBTeW1ib2woXCJ0aHJlYWQuZXJyb3JzXCIpO1xuZXhwb3J0cy4kZXZlbnRzID0gU3ltYm9sKFwidGhyZWFkLmV2ZW50c1wiKTtcbmV4cG9ydHMuJHRlcm1pbmF0ZSA9IFN5bWJvbChcInRocmVhZC50ZXJtaW5hdGVcIik7XG5leHBvcnRzLiR0cmFuc2ZlcmFibGUgPSBTeW1ib2woXCJ0aHJlYWQudHJhbnNmZXJhYmxlXCIpO1xuZXhwb3J0cy4kd29ya2VyID0gU3ltYm9sKFwidGhyZWFkLndvcmtlclwiKTtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vc3ltYm9scy5qcz8iKTsKCi8qKiovIH0pLAoKLyoqKi8gIi4uLy4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS90aHJlYWRzQDEuNy4wL25vZGVfbW9kdWxlcy90aHJlYWRzL2Rpc3QtZXNtL3RyYW5zZmVyYWJsZS5qcyI6Ci8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqISpcCiAgISoqKiAvaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS90cmFuc2ZlcmFibGUuanMgKioqIQogIFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKZXZhbCgiXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlRyYW5zZmVyID0gZXhwb3J0cy5pc1RyYW5zZmVyRGVzY3JpcHRvciA9IHZvaWQgMDtcbnZhciBzeW1ib2xzXzEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL3N5bWJvbHMgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS9zeW1ib2xzLmpzXCIpO1xuZnVuY3Rpb24gaXNUcmFuc2ZlcmFibGUodGhpbmcpIHtcbiAgICBpZiAoIXRoaW5nIHx8IHR5cGVvZiB0aGluZyAhPT0gXCJvYmplY3RcIilcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIC8vIERvbid0IGNoZWNrIHRvbyB0aG9yb3VnaGx5LCBzaW5jZSB0aGUgbGlzdCBvZiB0cmFuc2ZlcmFibGUgdGhpbmdzIGluIEpTIG1pZ2h0IGdyb3cgb3ZlciB0aW1lXG4gICAgcmV0dXJuIHRydWU7XG59XG5mdW5jdGlvbiBpc1RyYW5zZmVyRGVzY3JpcHRvcih0aGluZykge1xuICAgIHJldHVybiB0aGluZyAmJiB0eXBlb2YgdGhpbmcgPT09IFwib2JqZWN0XCIgJiYgdGhpbmdbc3ltYm9sc18xLiR0cmFuc2ZlcmFibGVdO1xufVxuZXhwb3J0cy5pc1RyYW5zZmVyRGVzY3JpcHRvciA9IGlzVHJhbnNmZXJEZXNjcmlwdG9yO1xuZnVuY3Rpb24gVHJhbnNmZXIocGF5bG9hZCwgdHJhbnNmZXJhYmxlcykge1xuICAgIHZhciBfYTtcbiAgICBpZiAoIXRyYW5zZmVyYWJsZXMpIHtcbiAgICAgICAgaWYgKCFpc1RyYW5zZmVyYWJsZShwYXlsb2FkKSlcbiAgICAgICAgICAgIHRocm93IEVycm9yKCk7XG4gICAgICAgIHRyYW5zZmVyYWJsZXMgPSBbcGF5bG9hZF07XG4gICAgfVxuICAgIHJldHVybiBfYSA9IHt9LFxuICAgICAgICBfYVtzeW1ib2xzXzEuJHRyYW5zZmVyYWJsZV0gPSB0cnVlLFxuICAgICAgICBfYS5zZW5kID0gcGF5bG9hZCxcbiAgICAgICAgX2EudHJhbnNmZXJhYmxlcyA9IHRyYW5zZmVyYWJsZXMsXG4gICAgICAgIF9hO1xufVxuZXhwb3J0cy5UcmFuc2ZlciA9IFRyYW5zZmVyO1xuXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8vaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS90cmFuc2ZlcmFibGUuanM/Iik7CgovKioqLyB9KSwKCi8qKiovICIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS90eXBlcy9tYXN0ZXIuanMiOgovKiEqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiEqXAogICEqKiogL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vdHlwZXMvbWFzdGVyLmpzICoqKiEKICBcKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CmV2YWwoIlxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5Xb3JrZXJFdmVudFR5cGUgPSB2b2lkIDA7XG4oZnVuY3Rpb24gKFdvcmtlckV2ZW50VHlwZSkge1xuICAgIFdvcmtlckV2ZW50VHlwZVtcImludGVybmFsRXJyb3JcIl0gPSBcImludGVybmFsRXJyb3JcIjtcbiAgICBXb3JrZXJFdmVudFR5cGVbXCJtZXNzYWdlXCJdID0gXCJtZXNzYWdlXCI7XG4gICAgV29ya2VyRXZlbnRUeXBlW1widGVybWluYXRpb25cIl0gPSBcInRlcm1pbmF0aW9uXCI7XG59KShleHBvcnRzLldvcmtlckV2ZW50VHlwZSB8fCAoZXhwb3J0cy5Xb3JrZXJFdmVudFR5cGUgPSB7fSkpO1xuXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8vaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS90eXBlcy9tYXN0ZXIuanM/Iik7CgovKioqLyB9KSwKCi8qKiovICIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS90eXBlcy9tZXNzYWdlcy5qcyI6Ci8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlwKICAhKioqIC9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS90aHJlYWRzQDEuNy4wL25vZGVfbW9kdWxlcy90aHJlYWRzL2Rpc3QtZXNtL3R5cGVzL21lc3NhZ2VzLmpzICoqKiEKICBcKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKZXZhbCgiXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLldvcmtlck1lc3NhZ2VUeXBlID0gZXhwb3J0cy5NYXN0ZXJNZXNzYWdlVHlwZSA9IHZvaWQgMDtcbihmdW5jdGlvbiAoTWFzdGVyTWVzc2FnZVR5cGUpIHtcbiAgICBNYXN0ZXJNZXNzYWdlVHlwZVtcImNhbmNlbFwiXSA9IFwiY2FuY2VsXCI7XG4gICAgTWFzdGVyTWVzc2FnZVR5cGVbXCJydW5cIl0gPSBcInJ1blwiO1xufSkoZXhwb3J0cy5NYXN0ZXJNZXNzYWdlVHlwZSB8fCAoZXhwb3J0cy5NYXN0ZXJNZXNzYWdlVHlwZSA9IHt9KSk7XG4oZnVuY3Rpb24gKFdvcmtlck1lc3NhZ2VUeXBlKSB7XG4gICAgV29ya2VyTWVzc2FnZVR5cGVbXCJlcnJvclwiXSA9IFwiZXJyb3JcIjtcbiAgICBXb3JrZXJNZXNzYWdlVHlwZVtcImluaXRcIl0gPSBcImluaXRcIjtcbiAgICBXb3JrZXJNZXNzYWdlVHlwZVtcInJlc3VsdFwiXSA9IFwicmVzdWx0XCI7XG4gICAgV29ya2VyTWVzc2FnZVR5cGVbXCJydW5uaW5nXCJdID0gXCJydW5uaW5nXCI7XG4gICAgV29ya2VyTWVzc2FnZVR5cGVbXCJ1bmNhdWdodEVycm9yXCJdID0gXCJ1bmNhdWdodEVycm9yXCI7XG59KShleHBvcnRzLldvcmtlck1lc3NhZ2VUeXBlIHx8IChleHBvcnRzLldvcmtlck1lc3NhZ2VUeXBlID0ge30pKTtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vdHlwZXMvbWVzc2FnZXMuanM/Iik7CgovKioqLyB9KSwKCi8qKiovICIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS93b3JrZXIvaW1wbGVtZW50YXRpb24uYnJvd3Nlci5qcyI6Ci8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlwKICAhKioqIC9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS90aHJlYWRzQDEuNy4wL25vZGVfbW9kdWxlcy90aHJlYWRzL2Rpc3QtZXNtL3dvcmtlci9pbXBsZW1lbnRhdGlvbi5icm93c2VyLmpzICoqKiEKICBcKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKZXZhbCgiXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG4vLy8gPHJlZmVyZW5jZSBsaWI9XCJkb21cIiAvPlxuLy8gdHNsaW50OmRpc2FibGUgbm8tc2hhZG93ZWQtdmFyaWFibGVcbnZhciBpc1dvcmtlclJ1bnRpbWUgPSBmdW5jdGlvbiBpc1dvcmtlclJ1bnRpbWUoKSB7XG4gICAgdmFyIGlzV2luZG93Q29udGV4dCA9IHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZiBXaW5kb3cgIT09IFwidW5kZWZpbmVkXCIgJiYgc2VsZiBpbnN0YW5jZW9mIFdpbmRvdztcbiAgICByZXR1cm4gdHlwZW9mIHNlbGYgIT09IFwidW5kZWZpbmVkXCIgJiYgc2VsZi5wb3N0TWVzc2FnZSAmJiAhaXNXaW5kb3dDb250ZXh0ID8gdHJ1ZSA6IGZhbHNlO1xufTtcbnZhciBwb3N0TWVzc2FnZVRvTWFzdGVyID0gZnVuY3Rpb24gcG9zdE1lc3NhZ2VUb01hc3RlcihkYXRhLCB0cmFuc2Zlckxpc3QpIHtcbiAgICBzZWxmLnBvc3RNZXNzYWdlKGRhdGEsIHRyYW5zZmVyTGlzdCk7XG59O1xudmFyIHN1YnNjcmliZVRvTWFzdGVyTWVzc2FnZXMgPSBmdW5jdGlvbiBzdWJzY3JpYmVUb01hc3Rlck1lc3NhZ2VzKG9uTWVzc2FnZSkge1xuICAgIHZhciBtZXNzYWdlSGFuZGxlciA9IGZ1bmN0aW9uIChtZXNzYWdlRXZlbnQpIHtcbiAgICAgICAgb25NZXNzYWdlKG1lc3NhZ2VFdmVudC5kYXRhKTtcbiAgICB9O1xuICAgIHZhciB1bnN1YnNjcmliZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2VsZi5yZW1vdmVFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLCBtZXNzYWdlSGFuZGxlcik7XG4gICAgfTtcbiAgICBzZWxmLmFkZEV2ZW50TGlzdGVuZXIoXCJtZXNzYWdlXCIsIG1lc3NhZ2VIYW5kbGVyKTtcbiAgICByZXR1cm4gdW5zdWJzY3JpYmU7XG59O1xuZXhwb3J0cy5kZWZhdWx0ID0ge1xuICAgIGlzV29ya2VyUnVudGltZTogaXNXb3JrZXJSdW50aW1lLFxuICAgIHBvc3RNZXNzYWdlVG9NYXN0ZXI6IHBvc3RNZXNzYWdlVG9NYXN0ZXIsXG4gICAgc3Vic2NyaWJlVG9NYXN0ZXJNZXNzYWdlczogc3Vic2NyaWJlVG9NYXN0ZXJNZXNzYWdlc1xufTtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vd29ya2VyL2ltcGxlbWVudGF0aW9uLmJyb3dzZXIuanM/Iik7CgovKioqLyB9KSwKCi8qKiovICIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS93b3JrZXIvaW5kZXguanMiOgovKiEqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiEqXAogICEqKiogL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vd29ya2VyL2luZGV4LmpzICoqKiEKICBcKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CmV2YWwoIi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLyhmdW5jdGlvbihwcm9jZXNzKSB7XG52YXIgX19nZW5lcmF0b3IgPSAodGhpcyAmJiB0aGlzLl9fZ2VuZXJhdG9yKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgYm9keSkge1xuICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGc7XG4gICAgcmV0dXJuIGcgPSB7IG5leHQ6IHZlcmIoMCksIFwidGhyb3dcIjogdmVyYigxKSwgXCJyZXR1cm5cIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7XG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IHJldHVybiBmdW5jdGlvbiAodikgeyByZXR1cm4gc3RlcChbbiwgdl0pOyB9OyB9XG4gICAgZnVuY3Rpb24gc3RlcChvcCkge1xuICAgICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XG4gICAgICAgIHdoaWxlIChfKSB0cnkge1xuICAgICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0gb3BbMF0gJiAyID8geVtcInJldHVyblwiXSA6IG9wWzBdID8geVtcInRocm93XCJdIHx8ICgodCA9IHlbXCJyZXR1cm5cIl0pICYmIHQuY2FsbCh5KSwgMCkgOiB5Lm5leHQpICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0O1xuICAgICAgICAgICAgaWYgKHkgPSAwLCB0KSBvcCA9IFtvcFswXSAmIDIsIHQudmFsdWVdO1xuICAgICAgICAgICAgc3dpdGNoIChvcFswXSkge1xuICAgICAgICAgICAgICAgIGNhc2UgMDogY2FzZSAxOiB0ID0gb3A7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNDogXy5sYWJlbCsrOyByZXR1cm4geyB2YWx1ZTogb3BbMV0sIGRvbmU6IGZhbHNlIH07XG4gICAgICAgICAgICAgICAgY2FzZSA1OiBfLmxhYmVsKys7IHkgPSBvcFsxXTsgb3AgPSBbMF07IGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIGNhc2UgNzogb3AgPSBfLm9wcy5wb3AoKTsgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBpZiAoISh0ID0gXy50cnlzLCB0ID0gdC5sZW5ndGggPiAwICYmIHRbdC5sZW5ndGggLSAxXSkgJiYgKG9wWzBdID09PSA2IHx8IG9wWzBdID09PSAyKSkgeyBfID0gMDsgY29udGludWU7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCAob3BbMV0gPiB0WzBdICYmIG9wWzFdIDwgdFszXSkpKSB7IF8ubGFiZWwgPSBvcFsxXTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7IF8ubGFiZWwgPSB0WzFdOyB0ID0gb3A7IGJyZWFrOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIF8ubGFiZWwgPCB0WzJdKSB7IF8ubGFiZWwgPSB0WzJdOyBfLm9wcy5wdXNoKG9wKTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRbMl0pIF8ub3BzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3AgPSBib2R5LmNhbGwodGhpc0FyZywgXyk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgb3AgPSBbNiwgZV07IHkgPSAwOyB9IGZpbmFsbHkgeyBmID0gdCA9IDA7IH1cbiAgICAgICAgaWYgKG9wWzBdICYgNSkgdGhyb3cgb3BbMV07IHJldHVybiB7IHZhbHVlOiBvcFswXSA/IG9wWzFdIDogdm9pZCAwLCBkb25lOiB0cnVlIH07XG4gICAgfVxufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZXhwb3NlID0gZXhwb3J0cy5pc1dvcmtlclJ1bnRpbWUgPSBleHBvcnRzLlRyYW5zZmVyID0gZXhwb3J0cy5yZWdpc3RlclNlcmlhbGl6ZXIgPSB2b2lkIDA7XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7XG4gICAgICAgICAgICBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7XG4gICAgICAgICAgICBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgaXNfb2JzZXJ2YWJsZV8xID0gX19pbXBvcnREZWZhdWx0KF9fd2VicGFja19yZXF1aXJlX18oLyohIGlzLW9ic2VydmFibGUgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vaXMtb2JzZXJ2YWJsZUAyLjEuMC9ub2RlX21vZHVsZXMvaXMtb2JzZXJ2YWJsZS9pbmRleC5qc1wiKSk7XG52YXIgY29tbW9uXzEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuLi9jb21tb24gKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS9jb21tb24uanNcIik7XG52YXIgdHJhbnNmZXJhYmxlXzEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuLi90cmFuc2ZlcmFibGUgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS90cmFuc2ZlcmFibGUuanNcIik7XG52YXIgbWVzc2FnZXNfMSA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4uL3R5cGVzL21lc3NhZ2VzICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vdHlwZXMvbWVzc2FnZXMuanNcIik7XG52YXIgaW1wbGVtZW50YXRpb25fMSA9IF9faW1wb3J0RGVmYXVsdChfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL2ltcGxlbWVudGF0aW9uICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vd29ya2VyL2ltcGxlbWVudGF0aW9uLmJyb3dzZXIuanNcIikpO1xudmFyIGNvbW1vbl8yID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi4vY29tbW9uICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vY29tbW9uLmpzXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwicmVnaXN0ZXJTZXJpYWxpemVyXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBjb21tb25fMi5yZWdpc3RlclNlcmlhbGl6ZXI7IH0gfSk7XG52YXIgdHJhbnNmZXJhYmxlXzIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuLi90cmFuc2ZlcmFibGUgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0LWVzbS90cmFuc2ZlcmFibGUuanNcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJUcmFuc2ZlclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdHJhbnNmZXJhYmxlXzIuVHJhbnNmZXI7IH0gfSk7XG4vKiogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyBjb2RlIGlzIGN1cnJlbnRseSBydW5uaW5nIGluIGEgd29ya2VyLiAqL1xuZXhwb3J0cy5pc1dvcmtlclJ1bnRpbWUgPSBpbXBsZW1lbnRhdGlvbl8xLmRlZmF1bHQuaXNXb3JrZXJSdW50aW1lO1xudmFyIGV4cG9zZUNhbGxlZCA9IGZhbHNlO1xudmFyIGFjdGl2ZVN1YnNjcmlwdGlvbnMgPSBuZXcgTWFwKCk7XG52YXIgaXNNYXN0ZXJKb2JDYW5jZWxNZXNzYWdlID0gZnVuY3Rpb24gKHRoaW5nKSB7IHJldHVybiB0aGluZyAmJiB0aGluZy50eXBlID09PSBtZXNzYWdlc18xLk1hc3Rlck1lc3NhZ2VUeXBlLmNhbmNlbDsgfTtcbnZhciBpc01hc3RlckpvYlJ1bk1lc3NhZ2UgPSBmdW5jdGlvbiAodGhpbmcpIHsgcmV0dXJuIHRoaW5nICYmIHRoaW5nLnR5cGUgPT09IG1lc3NhZ2VzXzEuTWFzdGVyTWVzc2FnZVR5cGUucnVuOyB9O1xuLyoqXG4gKiBUaGVyZSBhcmUgaXNzdWVzIHdpdGggYGlzLW9ic2VydmFibGVgIG5vdCByZWNvZ25pemluZyB6ZW4tb2JzZXJ2YWJsZSdzIGluc3RhbmNlcy5cbiAqIFdlIGFyZSB1c2luZyBgb2JzZXJ2YWJsZS1mbnNgLCBidXQgaXQncyBiYXNlZCBvbiB6ZW4tb2JzZXJ2YWJsZSwgdG9vLlxuICovXG52YXIgaXNPYnNlcnZhYmxlID0gZnVuY3Rpb24gKHRoaW5nKSB7IHJldHVybiAoMCwgaXNfb2JzZXJ2YWJsZV8xLmRlZmF1bHQpKHRoaW5nKSB8fCBpc1plbk9ic2VydmFibGUodGhpbmcpOyB9O1xuZnVuY3Rpb24gaXNaZW5PYnNlcnZhYmxlKHRoaW5nKSB7XG4gICAgcmV0dXJuIHRoaW5nICYmIHR5cGVvZiB0aGluZyA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgdGhpbmcuc3Vic2NyaWJlID09PSBcImZ1bmN0aW9uXCI7XG59XG5mdW5jdGlvbiBkZWNvbnN0cnVjdFRyYW5zZmVyKHRoaW5nKSB7XG4gICAgcmV0dXJuICgwLCB0cmFuc2ZlcmFibGVfMS5pc1RyYW5zZmVyRGVzY3JpcHRvcikodGhpbmcpXG4gICAgICAgID8geyBwYXlsb2FkOiB0aGluZy5zZW5kLCB0cmFuc2ZlcmFibGVzOiB0aGluZy50cmFuc2ZlcmFibGVzIH1cbiAgICAgICAgOiB7IHBheWxvYWQ6IHRoaW5nLCB0cmFuc2ZlcmFibGVzOiB1bmRlZmluZWQgfTtcbn1cbmZ1bmN0aW9uIHBvc3RGdW5jdGlvbkluaXRNZXNzYWdlKCkge1xuICAgIHZhciBpbml0TWVzc2FnZSA9IHtcbiAgICAgICAgdHlwZTogbWVzc2FnZXNfMS5Xb3JrZXJNZXNzYWdlVHlwZS5pbml0LFxuICAgICAgICBleHBvc2VkOiB7XG4gICAgICAgICAgICB0eXBlOiBcImZ1bmN0aW9uXCJcbiAgICAgICAgfVxuICAgIH07XG4gICAgaW1wbGVtZW50YXRpb25fMS5kZWZhdWx0LnBvc3RNZXNzYWdlVG9NYXN0ZXIoaW5pdE1lc3NhZ2UpO1xufVxuZnVuY3Rpb24gcG9zdE1vZHVsZUluaXRNZXNzYWdlKG1ldGhvZE5hbWVzKSB7XG4gICAgdmFyIGluaXRNZXNzYWdlID0ge1xuICAgICAgICB0eXBlOiBtZXNzYWdlc18xLldvcmtlck1lc3NhZ2VUeXBlLmluaXQsXG4gICAgICAgIGV4cG9zZWQ6IHtcbiAgICAgICAgICAgIHR5cGU6IFwibW9kdWxlXCIsXG4gICAgICAgICAgICBtZXRob2RzOiBtZXRob2ROYW1lc1xuICAgICAgICB9XG4gICAgfTtcbiAgICBpbXBsZW1lbnRhdGlvbl8xLmRlZmF1bHQucG9zdE1lc3NhZ2VUb01hc3Rlcihpbml0TWVzc2FnZSk7XG59XG5mdW5jdGlvbiBwb3N0Sm9iRXJyb3JNZXNzYWdlKHVpZCwgcmF3RXJyb3IpIHtcbiAgICB2YXIgX2EgPSBkZWNvbnN0cnVjdFRyYW5zZmVyKHJhd0Vycm9yKSwgZXJyb3IgPSBfYS5wYXlsb2FkLCB0cmFuc2ZlcmFibGVzID0gX2EudHJhbnNmZXJhYmxlcztcbiAgICB2YXIgZXJyb3JNZXNzYWdlID0ge1xuICAgICAgICB0eXBlOiBtZXNzYWdlc18xLldvcmtlck1lc3NhZ2VUeXBlLmVycm9yLFxuICAgICAgICB1aWQ6IHVpZCxcbiAgICAgICAgZXJyb3I6ICgwLCBjb21tb25fMS5zZXJpYWxpemUpKGVycm9yKVxuICAgIH07XG4gICAgaW1wbGVtZW50YXRpb25fMS5kZWZhdWx0LnBvc3RNZXNzYWdlVG9NYXN0ZXIoZXJyb3JNZXNzYWdlLCB0cmFuc2ZlcmFibGVzKTtcbn1cbmZ1bmN0aW9uIHBvc3RKb2JSZXN1bHRNZXNzYWdlKHVpZCwgY29tcGxldGVkLCByZXN1bHRWYWx1ZSkge1xuICAgIHZhciBfYSA9IGRlY29uc3RydWN0VHJhbnNmZXIocmVzdWx0VmFsdWUpLCBwYXlsb2FkID0gX2EucGF5bG9hZCwgdHJhbnNmZXJhYmxlcyA9IF9hLnRyYW5zZmVyYWJsZXM7XG4gICAgdmFyIHJlc3VsdE1lc3NhZ2UgPSB7XG4gICAgICAgIHR5cGU6IG1lc3NhZ2VzXzEuV29ya2VyTWVzc2FnZVR5cGUucmVzdWx0LFxuICAgICAgICB1aWQ6IHVpZCxcbiAgICAgICAgY29tcGxldGU6IGNvbXBsZXRlZCA/IHRydWUgOiB1bmRlZmluZWQsXG4gICAgICAgIHBheWxvYWQ6IHBheWxvYWRcbiAgICB9O1xuICAgIGltcGxlbWVudGF0aW9uXzEuZGVmYXVsdC5wb3N0TWVzc2FnZVRvTWFzdGVyKHJlc3VsdE1lc3NhZ2UsIHRyYW5zZmVyYWJsZXMpO1xufVxuZnVuY3Rpb24gcG9zdEpvYlN0YXJ0TWVzc2FnZSh1aWQsIHJlc3VsdFR5cGUpIHtcbiAgICB2YXIgc3RhcnRNZXNzYWdlID0ge1xuICAgICAgICB0eXBlOiBtZXNzYWdlc18xLldvcmtlck1lc3NhZ2VUeXBlLnJ1bm5pbmcsXG4gICAgICAgIHVpZDogdWlkLFxuICAgICAgICByZXN1bHRUeXBlOiByZXN1bHRUeXBlXG4gICAgfTtcbiAgICBpbXBsZW1lbnRhdGlvbl8xLmRlZmF1bHQucG9zdE1lc3NhZ2VUb01hc3RlcihzdGFydE1lc3NhZ2UpO1xufVxuZnVuY3Rpb24gcG9zdFVuY2F1Z2h0RXJyb3JNZXNzYWdlKGVycm9yKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgdmFyIGVycm9yTWVzc2FnZSA9IHtcbiAgICAgICAgICAgIHR5cGU6IG1lc3NhZ2VzXzEuV29ya2VyTWVzc2FnZVR5cGUudW5jYXVnaHRFcnJvcixcbiAgICAgICAgICAgIGVycm9yOiAoMCwgY29tbW9uXzEuc2VyaWFsaXplKShlcnJvcilcbiAgICAgICAgfTtcbiAgICAgICAgaW1wbGVtZW50YXRpb25fMS5kZWZhdWx0LnBvc3RNZXNzYWdlVG9NYXN0ZXIoZXJyb3JNZXNzYWdlKTtcbiAgICB9XG4gICAgY2F0Y2ggKHN1YkVycm9yKSB7XG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJOb3QgcmVwb3J0aW5nIHVuY2F1Z2h0IGVycm9yIGJhY2sgdG8gbWFzdGVyIHRocmVhZCBhcyBpdCBcIiArXG4gICAgICAgICAgICBcIm9jY3VyZWQgd2hpbGUgcmVwb3J0aW5nIGFuIHVuY2F1Z2h0IGVycm9yIGFscmVhZHkuXCIgK1xuICAgICAgICAgICAgXCJcXG5MYXRlc3QgZXJyb3I6XCIsIHN1YkVycm9yLCBcIlxcbk9yaWdpbmFsIGVycm9yOlwiLCBlcnJvcik7XG4gICAgfVxufVxuZnVuY3Rpb24gcnVuRnVuY3Rpb24oam9iVUlELCBmbiwgYXJncykge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHN5bmNSZXN1bHQsIHJlc3VsdFR5cGUsIHN1YnNjcmlwdGlvbiwgcmVzdWx0LCBlcnJvcl8xO1xuICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3luY1Jlc3VsdCA9IGZuLmFwcGx5KHZvaWQgMCwgYXJncyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgcG9zdEpvYkVycm9yTWVzc2FnZShqb2JVSUQsIGVycm9yKV07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0VHlwZSA9IGlzT2JzZXJ2YWJsZShzeW5jUmVzdWx0KSA/IFwib2JzZXJ2YWJsZVwiIDogXCJwcm9taXNlXCI7XG4gICAgICAgICAgICAgICAgICAgIHBvc3RKb2JTdGFydE1lc3NhZ2Uoam9iVUlELCByZXN1bHRUeXBlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc09ic2VydmFibGUoc3luY1Jlc3VsdCkpIHJldHVybiBbMyAvKmJyZWFrKi8sIDFdO1xuICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb24gPSBzeW5jUmVzdWx0LnN1YnNjcmliZShmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHBvc3RKb2JSZXN1bHRNZXNzYWdlKGpvYlVJRCwgZmFsc2UsICgwLCBjb21tb25fMS5zZXJpYWxpemUpKHZhbHVlKSk7IH0sIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcG9zdEpvYkVycm9yTWVzc2FnZShqb2JVSUQsICgwLCBjb21tb25fMS5zZXJpYWxpemUpKGVycm9yKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmVTdWJzY3JpcHRpb25zLmRlbGV0ZShqb2JVSUQpO1xuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwb3N0Sm9iUmVzdWx0TWVzc2FnZShqb2JVSUQsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlU3Vic2NyaXB0aW9ucy5kZWxldGUoam9iVUlEKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGFjdGl2ZVN1YnNjcmlwdGlvbnMuc2V0KGpvYlVJRCwgc3Vic2NyaXB0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgNF07XG4gICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICBfYS50cnlzLnB1c2goWzEsIDMsICwgNF0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBzeW5jUmVzdWx0XTtcbiAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgcG9zdEpvYlJlc3VsdE1lc3NhZ2Uoam9iVUlELCB0cnVlLCAoMCwgY29tbW9uXzEuc2VyaWFsaXplKShyZXN1bHQpKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgNF07XG4gICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICBlcnJvcl8xID0gX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICBwb3N0Sm9iRXJyb3JNZXNzYWdlKGpvYlVJRCwgKDAsIGNvbW1vbl8xLnNlcmlhbGl6ZSkoZXJyb3JfMSkpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzMgLypicmVhayovLCA0XTtcbiAgICAgICAgICAgICAgICBjYXNlIDQ6IHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG4vKipcbiAqIEV4cG9zZSBhIGZ1bmN0aW9uIG9yIGEgbW9kdWxlIChhbiBvYmplY3Qgd2hvc2UgdmFsdWVzIGFyZSBmdW5jdGlvbnMpXG4gKiB0byB0aGUgbWFpbiB0aHJlYWQuIE11c3QgYmUgY2FsbGVkIGV4YWN0bHkgb25jZSBpbiBldmVyeSB3b3JrZXIgdGhyZWFkXG4gKiB0byBzaWduYWwgaXRzIEFQSSB0byB0aGUgbWFpbiB0aHJlYWQuXG4gKlxuICogQHBhcmFtIGV4cG9zZWQgRnVuY3Rpb24gb3Igb2JqZWN0IHdob3NlIHZhbHVlcyBhcmUgZnVuY3Rpb25zXG4gKi9cbmZ1bmN0aW9uIGV4cG9zZShleHBvc2VkKSB7XG4gICAgaWYgKCFpbXBsZW1lbnRhdGlvbl8xLmRlZmF1bHQuaXNXb3JrZXJSdW50aW1lKCkpIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoXCJleHBvc2UoKSBjYWxsZWQgaW4gdGhlIG1hc3RlciB0aHJlYWQuXCIpO1xuICAgIH1cbiAgICBpZiAoZXhwb3NlQ2FsbGVkKSB7XG4gICAgICAgIHRocm93IEVycm9yKFwiZXhwb3NlKCkgY2FsbGVkIG1vcmUgdGhhbiBvbmNlLiBUaGlzIGlzIG5vdCBwb3NzaWJsZS4gUGFzcyBhbiBvYmplY3QgdG8gZXhwb3NlKCkgaWYgeW91IHdhbnQgdG8gZXhwb3NlIG11bHRpcGxlIGZ1bmN0aW9ucy5cIik7XG4gICAgfVxuICAgIGV4cG9zZUNhbGxlZCA9IHRydWU7XG4gICAgaWYgKHR5cGVvZiBleHBvc2VkID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgaW1wbGVtZW50YXRpb25fMS5kZWZhdWx0LnN1YnNjcmliZVRvTWFzdGVyTWVzc2FnZXMoZnVuY3Rpb24gKG1lc3NhZ2VEYXRhKSB7XG4gICAgICAgICAgICBpZiAoaXNNYXN0ZXJKb2JSdW5NZXNzYWdlKG1lc3NhZ2VEYXRhKSAmJiAhbWVzc2FnZURhdGEubWV0aG9kKSB7XG4gICAgICAgICAgICAgICAgcnVuRnVuY3Rpb24obWVzc2FnZURhdGEudWlkLCBleHBvc2VkLCBtZXNzYWdlRGF0YS5hcmdzLm1hcChjb21tb25fMS5kZXNlcmlhbGl6ZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcG9zdEZ1bmN0aW9uSW5pdE1lc3NhZ2UoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAodHlwZW9mIGV4cG9zZWQgPT09IFwib2JqZWN0XCIgJiYgZXhwb3NlZCkge1xuICAgICAgICBpbXBsZW1lbnRhdGlvbl8xLmRlZmF1bHQuc3Vic2NyaWJlVG9NYXN0ZXJNZXNzYWdlcyhmdW5jdGlvbiAobWVzc2FnZURhdGEpIHtcbiAgICAgICAgICAgIGlmIChpc01hc3RlckpvYlJ1bk1lc3NhZ2UobWVzc2FnZURhdGEpICYmIG1lc3NhZ2VEYXRhLm1ldGhvZCkge1xuICAgICAgICAgICAgICAgIHJ1bkZ1bmN0aW9uKG1lc3NhZ2VEYXRhLnVpZCwgZXhwb3NlZFttZXNzYWdlRGF0YS5tZXRob2RdLCBtZXNzYWdlRGF0YS5hcmdzLm1hcChjb21tb25fMS5kZXNlcmlhbGl6ZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdmFyIG1ldGhvZE5hbWVzID0gT2JqZWN0LmtleXMoZXhwb3NlZCkuZmlsdGVyKGZ1bmN0aW9uIChrZXkpIHsgcmV0dXJuIHR5cGVvZiBleHBvc2VkW2tleV0gPT09IFwiZnVuY3Rpb25cIjsgfSk7XG4gICAgICAgIHBvc3RNb2R1bGVJbml0TWVzc2FnZShtZXRob2ROYW1lcyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICB0aHJvdyBFcnJvcihcIkludmFsaWQgYXJndW1lbnQgcGFzc2VkIHRvIGV4cG9zZSgpLiBFeHBlY3RlZCBhIGZ1bmN0aW9uIG9yIGFuIG9iamVjdCwgZ290OiBcIi5jb25jYXQoZXhwb3NlZCkpO1xuICAgIH1cbiAgICBpbXBsZW1lbnRhdGlvbl8xLmRlZmF1bHQuc3Vic2NyaWJlVG9NYXN0ZXJNZXNzYWdlcyhmdW5jdGlvbiAobWVzc2FnZURhdGEpIHtcbiAgICAgICAgaWYgKGlzTWFzdGVySm9iQ2FuY2VsTWVzc2FnZShtZXNzYWdlRGF0YSkpIHtcbiAgICAgICAgICAgIHZhciBqb2JVSUQgPSBtZXNzYWdlRGF0YS51aWQ7XG4gICAgICAgICAgICB2YXIgc3Vic2NyaXB0aW9uID0gYWN0aXZlU3Vic2NyaXB0aW9ucy5nZXQoam9iVUlEKTtcbiAgICAgICAgICAgIGlmIChzdWJzY3JpcHRpb24pIHtcbiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgICAgICBhY3RpdmVTdWJzY3JpcHRpb25zLmRlbGV0ZShqb2JVSUQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLmV4cG9zZSA9IGV4cG9zZTtcbmlmICh0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2Ygc2VsZi5hZGRFdmVudExpc3RlbmVyID09PSBcImZ1bmN0aW9uXCIgJiYgaW1wbGVtZW50YXRpb25fMS5kZWZhdWx0LmlzV29ya2VyUnVudGltZSgpKSB7XG4gICAgc2VsZi5hZGRFdmVudExpc3RlbmVyKFwiZXJyb3JcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIC8vIFBvc3Qgd2l0aCBzb21lIGRlbGF5LCBzbyB0aGUgbWFzdGVyIGhhZCBzb21lIHRpbWUgdG8gc3Vic2NyaWJlIHRvIG1lc3NhZ2VzXG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyByZXR1cm4gcG9zdFVuY2F1Z2h0RXJyb3JNZXNzYWdlKGV2ZW50LmVycm9yIHx8IGV2ZW50KTsgfSwgMjUwKTtcbiAgICB9KTtcbiAgICBzZWxmLmFkZEV2ZW50TGlzdGVuZXIoXCJ1bmhhbmRsZWRyZWplY3Rpb25cIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIHZhciBlcnJvciA9IGV2ZW50LnJlYXNvbjtcbiAgICAgICAgaWYgKGVycm9yICYmIHR5cGVvZiBlcnJvci5tZXNzYWdlID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAvLyBQb3N0IHdpdGggc29tZSBkZWxheSwgc28gdGhlIG1hc3RlciBoYWQgc29tZSB0aW1lIHRvIHN1YnNjcmliZSB0byBtZXNzYWdlc1xuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IHJldHVybiBwb3N0VW5jYXVnaHRFcnJvck1lc3NhZ2UoZXJyb3IpOyB9LCAyNTApO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5pZiAodHlwZW9mIHByb2Nlc3MgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mIHByb2Nlc3Mub24gPT09IFwiZnVuY3Rpb25cIiAmJiBpbXBsZW1lbnRhdGlvbl8xLmRlZmF1bHQuaXNXb3JrZXJSdW50aW1lKCkpIHtcbiAgICBwcm9jZXNzLm9uKFwidW5jYXVnaHRFeGNlcHRpb25cIiwgZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIC8vIFBvc3Qgd2l0aCBzb21lIGRlbGF5LCBzbyB0aGUgbWFzdGVyIGhhZCBzb21lIHRpbWUgdG8gc3Vic2NyaWJlIHRvIG1lc3NhZ2VzXG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyByZXR1cm4gcG9zdFVuY2F1Z2h0RXJyb3JNZXNzYWdlKGVycm9yKTsgfSwgMjUwKTtcbiAgICB9KTtcbiAgICBwcm9jZXNzLm9uKFwidW5oYW5kbGVkUmVqZWN0aW9uXCIsIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICBpZiAoZXJyb3IgJiYgdHlwZW9mIGVycm9yLm1lc3NhZ2UgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgIC8vIFBvc3Qgd2l0aCBzb21lIGRlbGF5LCBzbyB0aGUgbWFzdGVyIGhhZCBzb21lIHRpbWUgdG8gc3Vic2NyaWJlIHRvIG1lc3NhZ2VzXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgcmV0dXJuIHBvc3RVbmNhdWdodEVycm9yTWVzc2FnZShlcnJvcik7IH0sIDI1MCk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cblxuLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovfS5jYWxsKHRoaXMsIF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vLi4vLi4vLi4vLi4vLi4vcHJvY2Vzc0AwLjExLjEwL25vZGVfbW9kdWxlcy9wcm9jZXNzL2Jyb3dzZXIuanMgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vcHJvY2Vzc0AwLjExLjEwL25vZGVfbW9kdWxlcy9wcm9jZXNzL2Jyb3dzZXIuanNcIikpKVxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vL2hvbWUvcGF2ZWwvd29yay9mbHVlbmNlL2ZsdWVuY2UtanMvbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vd29ya2VyL2luZGV4LmpzPyIpOwoKLyoqKi8gfSksCgovKioqLyAiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC9vYnNlcnZhYmxlLmpzIjoKLyohKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlwKICAhKioqIC9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS90aHJlYWRzQDEuNy4wL25vZGVfbW9kdWxlcy90aHJlYWRzL2Rpc3Qvb2JzZXJ2YWJsZS5qcyAqKiohCiAgXCoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKiEgbm8gc3RhdGljIGV4cG9ydHMgZm91bmQgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwpldmFsKCJcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChiLCBwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGlmICh0eXBlb2YgYiAhPT0gXCJmdW5jdGlvblwiICYmIGIgIT09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2xhc3MgZXh0ZW5kcyB2YWx1ZSBcIiArIFN0cmluZyhiKSArIFwiIGlzIG5vdCBhIGNvbnN0cnVjdG9yIG9yIG51bGxcIik7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG52YXIgX19zcHJlYWRBcnJheSA9ICh0aGlzICYmIHRoaXMuX19zcHJlYWRBcnJheSkgfHwgZnVuY3Rpb24gKHRvLCBmcm9tLCBwYWNrKSB7XG4gICAgaWYgKHBhY2sgfHwgYXJndW1lbnRzLmxlbmd0aCA9PT0gMikgZm9yICh2YXIgaSA9IDAsIGwgPSBmcm9tLmxlbmd0aCwgYXI7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgaWYgKGFyIHx8ICEoaSBpbiBmcm9tKSkge1xuICAgICAgICAgICAgaWYgKCFhcikgYXIgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChmcm9tLCAwLCBpKTtcbiAgICAgICAgICAgIGFyW2ldID0gZnJvbVtpXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdG8uY29uY2F0KGFyIHx8IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGZyb20pKTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlN1YmplY3QgPSBleHBvcnRzLk9ic2VydmFibGUgPSB2b2lkIDA7XG52YXIgb2JzZXJ2YWJsZV9mbnNfMSA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIG9ic2VydmFibGUtZm5zICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL29ic2VydmFibGUtZm5zQDAuNi4xL25vZGVfbW9kdWxlcy9vYnNlcnZhYmxlLWZucy9kaXN0LmVzbS9pbmRleC5qc1wiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk9ic2VydmFibGVcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIG9ic2VydmFibGVfZm5zXzEuT2JzZXJ2YWJsZTsgfSB9KTtcbnZhciAkb2JzZXJ2ZXJzID0gU3ltYm9sKFwib2JzZXJ2ZXJzXCIpO1xuLyoqXG4gKiBPYnNlcnZhYmxlIHN1YmplY3QuIEltcGxlbWVudHMgdGhlIE9ic2VydmFibGUgaW50ZXJmYWNlLCBidXQgYWxzbyBleHBvc2VzXG4gKiB0aGUgYG5leHQoKWAsIGBlcnJvcigpYCwgYGNvbXBsZXRlKClgIG1ldGhvZHMgdG8gaW5pdGlhdGUgb2JzZXJ2YWJsZVxuICogdXBkYXRlcyBcImZyb20gdGhlIG91dHNpZGVcIi5cbiAqXG4gKiBVc2UgYE9ic2VydmFibGUuZnJvbShzdWJqZWN0KWAgdG8gZGVyaXZlIGFuIG9ic2VydmFibGUgdGhhdCBwcm94aWVzIGFsbFxuICogdmFsdWVzLCBlcnJvcnMgYW5kIHRoZSBjb21wbGV0aW9uIHJhaXNlZCBvbiB0aGlzIHN1YmplY3QsIGJ1dCBkb2VzIG5vdFxuICogZXhwb3NlIHRoZSBgbmV4dCgpYCwgYGVycm9yKClgLCBgY29tcGxldGUoKWAgbWV0aG9kcy5cbiAqL1xudmFyIFN1YmplY3QgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFN1YmplY3QsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gU3ViamVjdCgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgZnVuY3Rpb24gKG9ic2VydmVyKSB7XG4gICAgICAgICAgICBfdGhpc1skb2JzZXJ2ZXJzXSA9IF9fc3ByZWFkQXJyYXkoX19zcHJlYWRBcnJheShbXSwgKF90aGlzWyRvYnNlcnZlcnNdIHx8IFtdKSwgdHJ1ZSksIFtcbiAgICAgICAgICAgICAgICBvYnNlcnZlclxuICAgICAgICAgICAgXSwgZmFsc2UpO1xuICAgICAgICAgICAgdmFyIHVuc3Vic2NyaWJlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIF90aGlzWyRvYnNlcnZlcnNdID0gX3RoaXNbJG9ic2VydmVyc10uZmlsdGVyKGZ1bmN0aW9uIChzb21lT2JzZXJ2ZXIpIHsgcmV0dXJuIHNvbWVPYnNlcnZlciAhPT0gb2JzZXJ2ZXI7IH0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJldHVybiB1bnN1YnNjcmliZTtcbiAgICAgICAgfSkgfHwgdGhpcztcbiAgICAgICAgX3RoaXNbJG9ic2VydmVyc10gPSBbXTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBTdWJqZWN0LnByb3RvdHlwZS5jb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpc1skb2JzZXJ2ZXJzXS5mb3JFYWNoKGZ1bmN0aW9uIChvYnNlcnZlcikgeyByZXR1cm4gb2JzZXJ2ZXIuY29tcGxldGUoKTsgfSk7XG4gICAgfTtcbiAgICBTdWJqZWN0LnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICB0aGlzWyRvYnNlcnZlcnNdLmZvckVhY2goZnVuY3Rpb24gKG9ic2VydmVyKSB7IHJldHVybiBvYnNlcnZlci5lcnJvcihlcnJvcik7IH0pO1xuICAgIH07XG4gICAgU3ViamVjdC5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICB0aGlzWyRvYnNlcnZlcnNdLmZvckVhY2goZnVuY3Rpb24gKG9ic2VydmVyKSB7IHJldHVybiBvYnNlcnZlci5uZXh0KHZhbHVlKTsgfSk7XG4gICAgfTtcbiAgICByZXR1cm4gU3ViamVjdDtcbn0ob2JzZXJ2YWJsZV9mbnNfMS5PYnNlcnZhYmxlKSk7XG5leHBvcnRzLlN1YmplY3QgPSBTdWJqZWN0O1xuXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8vaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0L29ic2VydmFibGUuanM/Iik7CgovKioqLyB9KSwKCi8qKiovICIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9vYnNlcnZhYmxlLmpzIjoKLyohKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqISpcCiAgISoqKiAvaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9vYnNlcnZhYmxlLmpzICoqKiEKICBcKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKiEgbm8gc3RhdGljIGV4cG9ydHMgZm91bmQgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwpldmFsKCJcbm1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9kaXN0L29ic2VydmFibGUgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vdGhyZWFkc0AxLjcuMC9ub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0L29ic2VydmFibGUuanNcIik7XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy9ob21lL3BhdmVsL3dvcmsvZmx1ZW5jZS9mbHVlbmNlLWpzL25vZGVfbW9kdWxlcy8ucG5wbS90aHJlYWRzQDEuNy4wL25vZGVfbW9kdWxlcy90aHJlYWRzL29ic2VydmFibGUuanM/Iik7CgovKioqLyB9KSwKCi8qKiovICIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vdGltZXJzLWJyb3dzZXJpZnlAMi4wLjEyL25vZGVfbW9kdWxlcy90aW1lcnMtYnJvd3NlcmlmeS9tYWluLmpzIjoKLyohKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqISpcCiAgISoqKiAvaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vdGltZXJzLWJyb3dzZXJpZnlAMi4wLjEyL25vZGVfbW9kdWxlcy90aW1lcnMtYnJvd3NlcmlmeS9tYWluLmpzICoqKiEKICBcKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKiEgbm8gc3RhdGljIGV4cG9ydHMgZm91bmQgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwpldmFsKCIvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi8oZnVuY3Rpb24oZ2xvYmFsKSB7XG52YXIgc2NvcGUgPSAodHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiAmJiBnbG9iYWwpIHx8XG4gICAgKHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiICYmIHNlbGYpIHx8XG4gICAgd2luZG93O1xudmFyIGFwcGx5ID0gRnVuY3Rpb24ucHJvdG90eXBlLmFwcGx5O1xuLy8gRE9NIEFQSXMsIGZvciBjb21wbGV0ZW5lc3NcbmV4cG9ydHMuc2V0VGltZW91dCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbmV3IFRpbWVvdXQoYXBwbHkuY2FsbChzZXRUaW1lb3V0LCBzY29wZSwgYXJndW1lbnRzKSwgY2xlYXJUaW1lb3V0KTtcbn07XG5leHBvcnRzLnNldEludGVydmFsID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBuZXcgVGltZW91dChhcHBseS5jYWxsKHNldEludGVydmFsLCBzY29wZSwgYXJndW1lbnRzKSwgY2xlYXJJbnRlcnZhbCk7XG59O1xuZXhwb3J0cy5jbGVhclRpbWVvdXQgPVxuICAgIGV4cG9ydHMuY2xlYXJJbnRlcnZhbCA9IGZ1bmN0aW9uICh0aW1lb3V0KSB7XG4gICAgICAgIGlmICh0aW1lb3V0KSB7XG4gICAgICAgICAgICB0aW1lb3V0LmNsb3NlKCk7XG4gICAgICAgIH1cbiAgICB9O1xuZnVuY3Rpb24gVGltZW91dChpZCwgY2xlYXJGbikge1xuICAgIHRoaXMuX2lkID0gaWQ7XG4gICAgdGhpcy5fY2xlYXJGbiA9IGNsZWFyRm47XG59XG5UaW1lb3V0LnByb3RvdHlwZS51bnJlZiA9IFRpbWVvdXQucHJvdG90eXBlLnJlZiA9IGZ1bmN0aW9uICgpIHsgfTtcblRpbWVvdXQucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuX2NsZWFyRm4uY2FsbChzY29wZSwgdGhpcy5faWQpO1xufTtcbi8vIERvZXMgbm90IHN0YXJ0IHRoZSB0aW1lLCBqdXN0IHNldHMgdXAgdGhlIG1lbWJlcnMgbmVlZGVkLlxuZXhwb3J0cy5lbnJvbGwgPSBmdW5jdGlvbiAoaXRlbSwgbXNlY3MpIHtcbiAgICBjbGVhclRpbWVvdXQoaXRlbS5faWRsZVRpbWVvdXRJZCk7XG4gICAgaXRlbS5faWRsZVRpbWVvdXQgPSBtc2Vjcztcbn07XG5leHBvcnRzLnVuZW5yb2xsID0gZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBjbGVhclRpbWVvdXQoaXRlbS5faWRsZVRpbWVvdXRJZCk7XG4gICAgaXRlbS5faWRsZVRpbWVvdXQgPSAtMTtcbn07XG5leHBvcnRzLl91bnJlZkFjdGl2ZSA9IGV4cG9ydHMuYWN0aXZlID0gZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBjbGVhclRpbWVvdXQoaXRlbS5faWRsZVRpbWVvdXRJZCk7XG4gICAgdmFyIG1zZWNzID0gaXRlbS5faWRsZVRpbWVvdXQ7XG4gICAgaWYgKG1zZWNzID49IDApIHtcbiAgICAgICAgaXRlbS5faWRsZVRpbWVvdXRJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gb25UaW1lb3V0KCkge1xuICAgICAgICAgICAgaWYgKGl0ZW0uX29uVGltZW91dClcbiAgICAgICAgICAgICAgICBpdGVtLl9vblRpbWVvdXQoKTtcbiAgICAgICAgfSwgbXNlY3MpO1xuICAgIH1cbn07XG4vLyBzZXRpbW1lZGlhdGUgYXR0YWNoZXMgaXRzZWxmIHRvIHRoZSBnbG9iYWwgb2JqZWN0XG5fX3dlYnBhY2tfcmVxdWlyZV9fKC8qISBzZXRpbW1lZGlhdGUgKi8gXCIuLi8uLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vc2V0aW1tZWRpYXRlQDEuMC41L25vZGVfbW9kdWxlcy9zZXRpbW1lZGlhdGUvc2V0SW1tZWRpYXRlLmpzXCIpO1xuLy8gT24gc29tZSBleG90aWMgZW52aXJvbm1lbnRzLCBpdCdzIG5vdCBjbGVhciB3aGljaCBvYmplY3QgYHNldGltbWVkaWF0ZWAgd2FzXG4vLyBhYmxlIHRvIGluc3RhbGwgb250by4gIFNlYXJjaCBlYWNoIHBvc3NpYmlsaXR5IGluIHRoZSBzYW1lIG9yZGVyIGFzIHRoZVxuLy8gYHNldGltbWVkaWF0ZWAgbGlicmFyeS5cbmV4cG9ydHMuc2V0SW1tZWRpYXRlID0gKHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiICYmIHNlbGYuc2V0SW1tZWRpYXRlKSB8fFxuICAgICh0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiICYmIGdsb2JhbC5zZXRJbW1lZGlhdGUpIHx8XG4gICAgKHRoaXMgJiYgdGhpcy5zZXRJbW1lZGlhdGUpO1xuZXhwb3J0cy5jbGVhckltbWVkaWF0ZSA9ICh0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiAmJiBzZWxmLmNsZWFySW1tZWRpYXRlKSB8fFxuICAgICh0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiICYmIGdsb2JhbC5jbGVhckltbWVkaWF0ZSkgfHxcbiAgICAodGhpcyAmJiB0aGlzLmNsZWFySW1tZWRpYXRlKTtcblxuLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovfS5jYWxsKHRoaXMsIF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vLi4vLi4vLi4vd2VicGFja0A0LjQ2LjBfd2VicGFjay1jbGlANC4xMC4wL25vZGVfbW9kdWxlcy93ZWJwYWNrL2J1aWxkaW4vZ2xvYmFsLmpzICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3dlYnBhY2tANC40Ni4wX3dlYnBhY2stY2xpQDQuMTAuMC9ub2RlX21vZHVsZXMvd2VicGFjay9idWlsZGluL2dsb2JhbC5qc1wiKSkpXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8vaG9tZS9wYXZlbC93b3JrL2ZsdWVuY2UvZmx1ZW5jZS1qcy9ub2RlX21vZHVsZXMvLnBucG0vdGltZXJzLWJyb3dzZXJpZnlAMi4wLjEyL25vZGVfbW9kdWxlcy90aW1lcnMtYnJvd3NlcmlmeS9tYWluLmpzPyIpOwoKLyoqKi8gfSksCgovKioqLyAiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3dlYnBhY2tANC40Ni4wX3dlYnBhY2stY2xpQDQuMTAuMC9ub2RlX21vZHVsZXMvd2VicGFjay9idWlsZGluL2dsb2JhbC5qcyI6Ci8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqISpcCiAgISoqKiAod2VicGFjaykvYnVpbGRpbi9nbG9iYWwuanMgKioqIQogIFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKZXZhbCgiXG52YXIgZztcbi8vIFRoaXMgd29ya3MgaW4gbm9uLXN0cmljdCBtb2RlXG5nID0gKGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcztcbn0pKCk7XG50cnkge1xuICAgIC8vIFRoaXMgd29ya3MgaWYgZXZhbCBpcyBhbGxvd2VkIChzZWUgQ1NQKVxuICAgIGcgPSBnIHx8IG5ldyBGdW5jdGlvbihcInJldHVybiB0aGlzXCIpKCk7XG59XG5jYXRjaCAoZSkge1xuICAgIC8vIFRoaXMgd29ya3MgaWYgdGhlIHdpbmRvdyByZWZlcmVuY2UgaXMgYXZhaWxhYmxlXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgPT09IFwib2JqZWN0XCIpXG4gICAgICAgIGcgPSB3aW5kb3c7XG59XG4vLyBnIGNhbiBzdGlsbCBiZSB1bmRlZmluZWQsIGJ1dCBub3RoaW5nIHRvIGRvIGFib3V0IGl0Li4uXG4vLyBXZSByZXR1cm4gdW5kZWZpbmVkLCBpbnN0ZWFkIG9mIG5vdGhpbmcgaGVyZSwgc28gaXQnc1xuLy8gZWFzaWVyIHRvIGhhbmRsZSB0aGlzIGNhc2UuIGlmKCFnbG9iYWwpIHsgLi4ufVxubW9kdWxlLmV4cG9ydHMgPSBnO1xuXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8od2VicGFjaykvYnVpbGRpbi9nbG9iYWwuanM/Iik7CgovKioqLyB9KSwKCi8qKiovICIuL3NyYy9pbmRleC50cyI6Ci8qISoqKioqKioqKioqKioqKioqKioqKiohKlwKICAhKioqIC4vc3JjL2luZGV4LnRzICoqKiEKICBcKioqKioqKioqKioqKioqKioqKioqKi8KLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKZXZhbCgiXG4vKlxuICogQ29weXJpZ2h0IDIwMjIgRmx1ZW5jZSBMYWJzIExpbWl0ZWRcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9fZ2VuZXJhdG9yID0gKHRoaXMgJiYgdGhpcy5fX2dlbmVyYXRvcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIGJvZHkpIHtcbiAgICB2YXIgXyA9IHsgbGFiZWw6IDAsIHNlbnQ6IGZ1bmN0aW9uKCkgeyBpZiAodFswXSAmIDEpIHRocm93IHRbMV07IHJldHVybiB0WzFdOyB9LCB0cnlzOiBbXSwgb3BzOiBbXSB9LCBmLCB5LCB0LCBnO1xuICAgIHJldHVybiBnID0geyBuZXh0OiB2ZXJiKDApLCBcInRocm93XCI6IHZlcmIoMSksIFwicmV0dXJuXCI6IHZlcmIoMikgfSwgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIChnW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXM7IH0pLCBnO1xuICAgIGZ1bmN0aW9uIHZlcmIobikgeyByZXR1cm4gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHN0ZXAoW24sIHZdKTsgfTsgfVxuICAgIGZ1bmN0aW9uIHN0ZXAob3ApIHtcbiAgICAgICAgaWYgKGYpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBleGVjdXRpbmcuXCIpO1xuICAgICAgICB3aGlsZSAoXykgdHJ5IHtcbiAgICAgICAgICAgIGlmIChmID0gMSwgeSAmJiAodCA9IG9wWzBdICYgMiA/IHlbXCJyZXR1cm5cIl0gOiBvcFswXSA/IHlbXCJ0aHJvd1wiXSB8fCAoKHQgPSB5W1wicmV0dXJuXCJdKSAmJiB0LmNhbGwoeSksIDApIDogeS5uZXh0KSAmJiAhKHQgPSB0LmNhbGwoeSwgb3BbMV0pKS5kb25lKSByZXR1cm4gdDtcbiAgICAgICAgICAgIGlmICh5ID0gMCwgdCkgb3AgPSBbb3BbMF0gJiAyLCB0LnZhbHVlXTtcbiAgICAgICAgICAgIHN3aXRjaCAob3BbMF0pIHtcbiAgICAgICAgICAgICAgICBjYXNlIDA6IGNhc2UgMTogdCA9IG9wOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDQ6IF8ubGFiZWwrKzsgcmV0dXJuIHsgdmFsdWU6IG9wWzFdLCBkb25lOiBmYWxzZSB9O1xuICAgICAgICAgICAgICAgIGNhc2UgNTogXy5sYWJlbCsrOyB5ID0gb3BbMV07IG9wID0gWzBdOyBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBjYXNlIDc6IG9wID0gXy5vcHMucG9wKCk7IF8udHJ5cy5wb3AoKTsgY29udGludWU7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEodCA9IF8udHJ5cywgdCA9IHQubGVuZ3RoID4gMCAmJiB0W3QubGVuZ3RoIC0gMV0pICYmIChvcFswXSA9PT0gNiB8fCBvcFswXSA9PT0gMikpIHsgXyA9IDA7IGNvbnRpbnVlOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gMyAmJiAoIXQgfHwgKG9wWzFdID4gdFswXSAmJiBvcFsxXSA8IHRbM10pKSkgeyBfLmxhYmVsID0gb3BbMV07IGJyZWFrOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gNiAmJiBfLmxhYmVsIDwgdFsxXSkgeyBfLmxhYmVsID0gdFsxXTsgdCA9IG9wOyBicmVhazsgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodCAmJiBfLmxhYmVsIDwgdFsyXSkgeyBfLmxhYmVsID0gdFsyXTsgXy5vcHMucHVzaChvcCk7IGJyZWFrOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKSBfLm9wcy5wb3AoKTtcbiAgICAgICAgICAgICAgICAgICAgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9wID0gYm9keS5jYWxsKHRoaXNBcmcsIF8pO1xuICAgICAgICB9IGNhdGNoIChlKSB7IG9wID0gWzYsIGVdOyB5ID0gMDsgfSBmaW5hbGx5IHsgZiA9IHQgPSAwOyB9XG4gICAgICAgIGlmIChvcFswXSAmIDUpIHRocm93IG9wWzFdOyByZXR1cm4geyB2YWx1ZTogb3BbMF0gPyBvcFsxXSA6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9O1xuICAgIH1cbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgbWFyaW5lX2pzXzEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISBAZmx1ZW5jZWxhYnMvbWFyaW5lLWpzICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmbHVlbmNlbGFicyttYXJpbmUtanNAMC4zLjM4L25vZGVfbW9kdWxlcy9AZmx1ZW5jZWxhYnMvbWFyaW5lLWpzL2Rpc3QvaW5kZXguanNcIik7XG52YXIgb2JzZXJ2YWJsZV8xID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgdGhyZWFkcy9vYnNlcnZhYmxlICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvb2JzZXJ2YWJsZS5qc1wiKTtcbnZhciB0aHJlYWRzXzEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISB0aHJlYWRzICovIFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3RocmVhZHNAMS43LjAvbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC1lc20vaW5kZXguanNcIik7XG52YXIgbWFyaW5lU2VydmljZXMgPSBuZXcgTWFwKCk7XG52YXIgY29udHJvbE1vZHVsZTtcbnZhciBvbkxvZ01lc3NhZ2UgPSBuZXcgb2JzZXJ2YWJsZV8xLlN1YmplY3QoKTtcbnZhciBhc0FycmF5ID0gZnVuY3Rpb24gKGJ1Zikge1xuICAgIHJldHVybiBuZXcgVWludDhBcnJheShidWYpO1xufTtcbnZhciB0b0V4cG9zZSA9IHtcbiAgICBpbml0OiBmdW5jdGlvbiAoY29udHJvbE1vZHVsZVdhc20pIHsgcmV0dXJuIF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcbiAgICAgICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sIFdlYkFzc2VtYmx5LmNvbXBpbGUoYXNBcnJheShjb250cm9sTW9kdWxlV2FzbSkpXTtcbiAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xNb2R1bGUgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7IH0sXG4gICAgY3JlYXRlU2VydmljZTogZnVuY3Rpb24gKHdhc20sIHNlcnZpY2VJZCwgbWFyaW5lQ29uZmlnLCBlbnZzKSB7IHJldHVybiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgc2VydmljZSwgc3J2O1xuICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICBpZiAoIWNvbnRyb2xNb2R1bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTWFyaW5lSlMgaXMgbm90IGluaXRpYWxpemVkLiBUbyBpbml0aWFsaXplIGNhbGwgYGluaXRgIGZ1bmN0aW9uJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgV2ViQXNzZW1ibHkuY29tcGlsZShhc0FycmF5KHdhc20pKV07XG4gICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlID0gX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICBzcnYgPSBuZXcgbWFyaW5lX2pzXzEuTWFyaW5lU2VydmljZShjb250cm9sTW9kdWxlLCBzZXJ2aWNlLCBzZXJ2aWNlSWQsIG9uTG9nTWVzc2FnZS5uZXh0LmJpbmQob25Mb2dNZXNzYWdlKSwgbWFyaW5lQ29uZmlnLCBlbnZzKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgc3J2LmluaXQoKV07XG4gICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgIG1hcmluZVNlcnZpY2VzLnNldChzZXJ2aWNlSWQsIHNydik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7IH0sXG4gICAgdGVybWluYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIG1hcmluZVNlcnZpY2VzLmZvckVhY2goZnVuY3Rpb24gKHZhbCwga2V5KSB7XG4gICAgICAgICAgICB2YWwudGVybWluYXRlKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBvbkxvZ01lc3NhZ2UuY29tcGxldGUoKTtcbiAgICB9LFxuICAgIGNhbGxTZXJ2aWNlOiBmdW5jdGlvbiAoc2VydmljZUlkLCBmdW5jdGlvbk5hbWUsIGFyZ3MsIGNhbGxQYXJhbXMpIHtcbiAgICAgICAgdmFyIHNydiA9IG1hcmluZVNlcnZpY2VzLmdldChzZXJ2aWNlSWQpO1xuICAgICAgICBpZiAoIXNydikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwic2VydmljZSB3aXRoIGlkPVwiLmNvbmNhdChzZXJ2aWNlSWQsIFwiIG5vdCBmb3VuZFwiKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHNydi5jYWxsKGZ1bmN0aW9uTmFtZSwgYXJncywgY2FsbFBhcmFtcyk7XG4gICAgfSxcbiAgICBvbkxvZ01lc3NhZ2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIG9ic2VydmFibGVfMS5PYnNlcnZhYmxlLmZyb20ob25Mb2dNZXNzYWdlKTtcbiAgICB9LFxufTtcbigwLCB0aHJlYWRzXzEuZXhwb3NlKSh0b0V4cG9zZSk7XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vc3JjL2luZGV4LnRzPyIpOwoKLyoqKi8gfSkKCi8qKioqKiovIH0pOw==";
